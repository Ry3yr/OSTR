‚Ä¢Each release branch of PHP is fully supported for two years from its initial stable release https://www.php.net/supported-versions.php
PHP Backup: https://ry3yr.github.io/php.zip
Run php server locally (android): https://apkcombo.com/de/palapa-web-server/com.alfanla.android.pws/download/apk#urusai.social/@alcea/111761622206017944#i.ibb.co/cx175BB/Screenshot-20240115-165447-Opera.png
Install ComposerPackagesManually(Windows) https://m.youtube.com/watch?v=j8kpwzE6ju0
https://alcea-wisteria.de/PHP/composer-packages/
___________________________________________________________________________________________________________________
_____https://stackoverflow.com/questions/40545795/how-do-i-install-composer-php-packages-without-composer------
*php-install



AudioIntentReciver (Control Poweramp via PHP, Tasker, Macrodroid n Root)
----------------------------

commandprocess.php
--
<?php
header('Content-Type: text/plain');
header('Cache-Control: no-cache, no-store, must-revalidate');
header('Pragma: no-cache');
header('Expires: 0');
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: GET');
date_default_timezone_set('Europe/Berlin');
if (isset($_GET['delete']) && $_GET['delete'] === 'ok') {
    $commandFile = 'commands.txt';
    if (file_exists($commandFile)) {
        if (unlink($commandFile)) {
            echo "OK: Command file deleted";
        } else {
            echo "ERROR: Could not delete command file";
        }
    } else {
        echo "OK: Command file does not exist (already deleted)";
    }
    exit;
}
$command = $_GET['command'] ?? '';
if ($command === '') {
    echo "ERROR: No command provided";
    exit;
}
$timestamp = date('YmdHis');
$entry = $timestamp . ' - ' . $command;
$commandFile = 'commands.txt';
$existingCommands = [];
if (file_exists($commandFile)) {
    $existingCommands = file($commandFile, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
}
array_unshift($existingCommands, $entry);
$existingCommands = array_slice($existingCommands, 0, 4);
if (file_put_contents($commandFile, implode(PHP_EOL, $existingCommands) . PHP_EOL) === false) {
    echo "ERROR: Could not write to command file";
    exit;
}
?>

index.html
--
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Player Remote</title>
<details><summary>CMD Shell</summary>
<pre>
#!/bin/bash
URL="https://alcea-wisteria.de/PHP/0demo/2025-12-22-DeviceNAppCtrl/%5BAndroid%5D_Poweramp%E2%80%90%28Tasker%29%2820251222%29/commands.txt"
echo "Fetching commands from: $URL"
first_line=$(curl -s "$URL" | head -n 1)
if [ -z "$first_line" ]; then
    echo "Error: Could not fetch or file is empty"
    exit 1
fi
echo "First line: $first_line"
command="${first_line:17}"
echo "Executing command: $command"
eval "$command"
exit_code=$?
if [ $exit_code -eq 0 ]; then
    echo "Command executed successfully"
    delete_url="https://alcea-wisteria.de/PHP/0demo/2025-12-22-DeviceNAppCtrl/%5BAndroid%5D_Poweramp%E2%80%90%28Tasker%29%2820251222%29/commandprocess.php?delete=ok"
    echo "Making GET request to: $delete_url"
    delete_response=$(curl -s "$delete_url")
    curl_exit_code=$?
    if [ $curl_exit_code -eq 0 ]; then
        echo "Delete request sent successfully"
        echo "Response: $delete_response"
    else
        echo "Warning: Failed to send delete request (curl exit code: $curl_exit_code)"
    fi
else
    echo "Error executing command"
    exit 1
fi

<hr style="width:50%;float:left;">
<u>AudioIntentReceive.macro (Macrodroid)</u>
{"globalVariables":[],"macro":{"disabledTimestamp":0,"exportedActionBlocks":[],"forceEvenIfNotEnabledTimestamp":0,"isActionBlock":false,"isExtra":false,"isFavourite":false,"lastEditedTimestamp":1766437547779,"localVariables":[],"localVarsAlphabetical":true,"m_GUID":-7890590420177522383,"m_actionList":[{"blockNextAction":false,"m_nonRoot":false,"m_script":"#!/bin/bash\nURL\u003d\"https://alcea-wisteria.de/PHP/0demo/2025-12-22-DeviceNAppCtrl/%5BAndroid%5D_Poweramp%E2%80%90%28Tasker%29%2820251222%29/commands.txt\"\necho \"Fetching commands from: $URL\"\nfirst_line\u003d$(curl -s \"$URL\" | head -n 1)\nif [ -z \"$first_line\" ]; then\n    echo \"Error: Could not fetch or file is empty\"\n    exit 1\nfi\necho \"First line: $first_line\"\ncommand\u003d\"${first_line:17}\"\necho \"Executing command: $command\"\neval \"$command\"\nexit_code\u003d$?\nif [ $exit_code -eq 0 ]; then\n    echo \"Command executed successfully\"\n    delete_url\u003d\"https://alcea-wisteria.de/PHP/0demo/2025-12-22-DeviceNAppCtrl/%5BAndroid%5D_Poweramp%E2%80%90%28Tasker%29%2820251222%29/commandprocess.php?delete\u003dok\"\n    echo \"Making GET request to: $delete_url\"\n    delete_response\u003d$(curl -s \"$delete_url\")\n    curl_exit_code\u003d$?\n    if [ $curl_exit_code -eq 0 ]; then\n        echo \"Delete request sent successfully\"\n        echo \"Response: $delete_response\"\n    else\n        echo \"Warning: Failed to send delete request (curl exit code: $curl_exit_code)\"\n    fi\nelse\n    echo \"Error executing command\"\n    exit 1\nfi\n","timeoutSeconds":30,"useHelper":false,"useShizuku":false,"disableLogging":false,"m_SIGUID":-7400398854717422661,"m_classType":"ShellScriptAction","m_constraintList":[],"m_isDisabled":false,"m_isOrCondition":false},{"m_delayInMilliSeconds":0,"m_delayInSeconds":2,"m_useAlarm":true,"unitForVariables":0,"disableLogging":false,"m_SIGUID":-6918740774120871296,"m_classType":"PauseAction","m_constraintList":[],"m_isDisabled":false,"m_isOrCondition":false},{"m_appName":"Task Shortcut","m_intentEncoded":"task:TrackAudioPlayerSend#Intent;action\u003dnet.dinglisch.android.tasker.WIDICKYUM;component\u003dnet.dinglisch.android.taskerm/.IntentHandler;S.mcro\u003d%3CTask%20sr%3D%22%22%3E%3Cid%3E-3%3C%2Fid%3E%3CImg%20sr%3D%22icn%22ve%3D%222%22%3E%3Ccls%3Ecom.maxmpz.audioplayer.standard_adaptive%3C%2Fcls%3E%3Cpkg%3Ecom.maxmpz.audioplayer%3C%2Fpkg%3E%3C%2FImg%3E%3Cnme%3ETrackAudioPlayerSend%3C%2Fnme%3E%3Cpri%3E7%3C%2Fpri%3E%3Crty%3E2%3C%2Frty%3E%3CAction%20sr%3D%22act0%22ve%3D%227%22%3E%3CStr%20sr%3D%22arg0%22ve%3D%223%22%3ETrackAudioPlayerSend%3C%2FStr%3E%3CInt%20sr%3D%22arg1%22val%3D%227%22%2F%3E%3CStr%20sr%3D%22arg2%22ve%3D%223%22%2F%3E%3CStr%20sr%3D%22arg3%22ve%3D%223%22%2F%3E%3CStr%20sr%3D%22arg4%22ve%3D%223%22%2F%3E%3CInt%20sr%3D%22arg5%22val%3D%221%22%2F%3E%3Ccode%3E130%3C%2Fcode%3E%3C%2FAction%3E%3Ccdate%3E1766436510717%3C%2Fcdate%3E%3Cedate%3E1766436510717%3C%2Fedate%3E%3C%2FTask%3E;end","m_name":"TrackAudioPlayerSend","disableLogging":false,"m_SIGUID":-6281820491066775691,"m_classType":"LaunchShortcutAction","m_constraintList":[],"m_isDisabled":false,"m_isOrCondition":false}],"m_category":"Nicht kategorisiert","m_constraintList":[{"checkThisMacro":true,"m_invoked":false,"m_macroIds":[],"m_macroNames":[],"m_timePeriodSeconds":4,"disableLogging":false,"m_SIGUID":-8368519708659995381,"m_classType":"LastRunTimeConstraint","m_constraintList":[],"m_isDisabled":false,"m_isOrCondition":false},{"customAddedSSIDs":[],"m_SSIDList":[null],"m_wifiState":0,"disableLogging":false,"m_SIGUID":-7151573572426603523,"m_classType":"WifiConstraint","m_constraintList":[],"m_isDisabled":false,"m_isOrCondition":false},{"m_anyDevice":true,"m_btState":2,"m_deviceName":"Any Device","disableLogging":false,"m_SIGUID":-5759114516428804920,"m_classType":"BluetoothConstraint","m_constraintList":[],"m_isDisabled":false,"m_isOrCondition":false},{"a":true,"m_screenOn":false,"disableLogging":false,"m_SIGUID":-5961729435389429292,"m_classType":"ScreenOnOffConstraint","m_constraintList":[],"m_isDisabled":false,"m_isOrCondition":false}],"m_description":"","m_descriptionOpen":false,"m_enabled":true,"m_excludeLog":false,"m_headingColor":0,"m_isOrCondition":false,"m_name":"AudioIntentReceive","m_triggerList":[{"m_ignoreReferenceStartTime":false,"m_minutes":0,"m_seconds":31,"m_startHour":0,"m_startMinute":0,"m_useAlarm":true,"disableLogging":false,"m_SIGUID":-6597252848197539427,"m_classType":"RegularIntervalTrigger","m_constraintList":[],"m_isDisabled":true,"m_isOrCondition":false},{"disableLogging":false,"m_SIGUID":-4665790134467948861,"m_classType":"ShortcutTrigger","m_constraintList":[],"m_isDisabled":false,"m_isOrCondition":false},{"m_ignoreReferenceStartTime":false,"m_minutes":0,"m_seconds":32,"m_startHour":0,"m_startMinute":0,"m_useAlarm":true,"disableLogging":false,"m_SIGUID":-9050416507675238679,"m_classType":"RegularIntervalTrigger","m_constraintList":[{"m_externalPower":false,"m_powerConnectedOptions":[true,true,true],"disableLogging":false,"m_SIGUID":-6029441548626236214,"m_classType":"ExternalPowerConstraint","m_constraintList":[],"m_isDisabled":false,"m_isOrCondition":false}],"m_isDisabled":false,"m_isOrCondition":false}]},"macroExportVersion":1}



<hr style="width:50%;float:left;">
<u>Tasker.psk.xml</u>- Also requires "Curr Track" from <a href="https://ry3yr.github.io/tasker.zip">here</a> which will chreate the Trackinfo to be send on every Poweramp track change<br>
&lt;TaskerData sr="" dvi="1" tv="4.9u4m"&gt;
	&lt;Task sr="task13"&gt;
		&lt;cdate&gt;1766436427918&lt;/cdate&gt;
		&lt;edate&gt;1766436443750&lt;/edate&gt;
		&lt;id&gt;13&lt;/id&gt;
		&lt;nme&gt;TrackAudioPlayerSend&lt;/nme&gt;
		&lt;Action sr="act0" ve="7"&gt;
			&lt;code&gt;118&lt;/code&gt;
			&lt;Str sr="arg0" ve="3"&gt;https&#58;//alcea-wisteria.de/PHP/0demo/2025-12-22-DeviceNAppCtrl/%5BAndroid%5D_Poweramp%E2%80%90%28Tasker%29%2820251222%29/save_track.php?track=%Trackinfo&lt;/Str&gt;
			&lt;Str sr="arg1" ve="3"/&gt;
			&lt;Str sr="arg2" ve="3"/&gt;
			&lt;Str sr="arg3" ve="3"/&gt;
			&lt;Str sr="arg4" ve="3"/&gt;
			&lt;Int sr="arg5" val="10"/&gt;
			&lt;Str sr="arg6" ve="3"/&gt;
			&lt;Str sr="arg7" ve="3"/&gt;
			&lt;Int sr="arg8" val="0"/&gt;
		&lt;/Action&gt;
	&lt;/Task&gt;
&lt;/TaskerData&gt;
<!---Tasker tsk.xml end -->
<hr></pre></details>




    <style>
        .player-window {
            width: 300px;
            background: #c0c0c0;
            border: 2px solid;
            border-top-color: #dfdfdf;
            border-left-color: #dfdfdf;
            border-right-color: #808080;
            border-bottom-color: #808080;
            box-shadow: 3px 3px 10px rgba(0,0,0,0.5);
        }
        
        .title-bar {
            background: linear-gradient(90deg, #000080, #1084d0);
            color: white;
            padding: 3px 5px;
            font-size: 11px;
            font-weight: bold;
            border-bottom: 2px solid #c0c0c0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .title-text {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .window-controls {
            display: flex;
            gap: 2px;
        }
        
        .control-btn-small {
            width: 16px;
            height: 14px;
            background: #c0c0c0;
            border: 1px solid;
            border-top-color: #dfdfdf;
            border-left-color: #dfdfdf;
            border-right-color: #808080;
            border-bottom-color: #808080;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            padding: 0;
        }
        
        .control-btn-small:active {
            border-top-color: #808080;
            border-left-color: #808080;
            border-right-color: #dfdfdf;
            border-bottom-color: #dfdfdf;
        }
        
        .now-playing {
            background: white;
            border: 2px inset;
            height: 60px;
            margin: 10px;
            padding: 8px;
            overflow: hidden;
            position: relative;
        }
        
        .song-title {
            font-size: 13px;
            font-weight: bold;
            color: #000;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 4px;
        }
        
        .song-album {
            font-size: 11px;
            color: #404040;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 4px;
        }
        
        .song-time {
            font-size: 10px;
            color: #808080;
            position: absolute;
            bottom: 8px;
            right: 8px;
        }
        
        .no-song {
            font-size: 12px;
            color: #808080;
            font-style: italic;
            text-align: center;
            line-height: 44px;
        }
        
        .transport-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 4px;
            padding: 10px;
            background: #c0c0c0;
            border-top: 2px solid #808080;
        }
        
        .transport-btn {
            width: 50px;
            height: 50px;
            background: #c0c0c0;
            border: 2px outset;
            border-top-color: #dfdfdf;
            border-left-color: #dfdfdf;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }
        
        .transport-btn:active {
            border: 2px inset;
            border-top-color: #808080;
            border-left-color: #808080;
        }
        
        .play-btn {
            width: 60px;
            background: #00a000;
            color: white;
            font-size: 12px;
            flex-direction: column;
            gap: 2px;
        }
        
        .play-btn:active {
            background: #008000;
        }
        
        .play-text {
            font-size: 10px;
            margin-top: 2px;
        }
        
        .status-bar {
            background: #c0c0c0;
            border-top: 2px solid #808080;
            padding: 3px 6px;
            font-size: 11px;
            color: #000;
            height: 18px;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }
        
        .marquee {
            display: inline-block;
            white-space: nowrap;
            padding-left: 100%;
            animation: marquee 10s linear infinite;
        }
        
        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }
        
        .marquee:hover {
            animation-play-state: paused;
        }
        
        .command-hint {
            font-size: 9px;
            color: #404040;
            text-align: center;
            margin-top: 2px;
        }
    </style>
</head>
<body>
    <div class="player-window">
        <div class="title-bar">
            <div class="title-text">
                <span>üéµ</span>
                Audio Player Remote
            </div>
            <div class="window-controls">
                <button class="control-btn-small" title="Minimize">_</button>
                <button class="control-btn-small" title="Maximize">‚ñ°</button>
                <button class="control-btn-small" title="Close" onclick="window.close()">X</button>
            </div>
        </div>
        
        <div class="now-playing">
            <div class="no-song" id="noSong">No song playing</div>
            <div class="song-info" id="songInfo" style="display: none;">
                <div class="song-title marquee" id="songTitle"></div>
                <div class="song-album marquee" id="songAlbum"></div>
                <div class="song-time" id="songTime"></div>
            </div>
        </div>
        
        <div class="transport-controls">
            <button class="transport-btn" onclick="sendCommand(7)" title="Previous Album (7)">
                &lt;&lt;
                <div class="command-hint">(7)</div>
            </button>
            
            <button class="transport-btn" onclick="sendCommand(5)" title="Previous Song (5)">
                &lt;
                <div class="command-hint">(5)</div>
            </button>
            
            <button class="transport-btn play-btn" onclick="sendCommand(1)" id="playPauseBtn" title="Play/Pause (1)">
                ‚ñ∂
                <div class="play-text" id="playText">PLAY</div>
                <div class="command-hint">(1)</div>
            </button>
            
            <button class="transport-btn" onclick="sendCommand(4)" title="Next Song (4)">
                &gt;
                <div class="command-hint">(4)</div>
            </button>
            
            <button class="transport-btn" onclick="sendCommand(6)" title="Next Album (6)">
                &gt;&gt;
                <div class="command-hint">(6)</div>
            </button>
        </div>
        
        <div class="status-bar" id="status">
            Ready
        </div>
    </div>

    <script>
        const API_ENDPOINT = 'commandprocess.php';
        const NOW_PLAYING_FILE = 'currently_playing.txt';
        
function parseNowPlayingLine(line) {
    if (!line || line.trim() === '') return null;
    const match = line.match(/^"(\d{14})"_"(.*?)"\s*-\s*"(.*?)"$/);
    if (match) {
        const [, timestamp, title, album] = match;
        const hour = timestamp.substring(8, 10);
        const minute = timestamp.substring(10, 12);
        const day = timestamp.substring(6, 8);
        const month = timestamp.substring(4, 6);
        const formattedTime = `${hour}:${minute} ${day}/${month}`;
        return {
            timestamp: formattedTime,
            title: title.trim(),
            album: album.trim() || ""
        };
    }
    
    return null;
}
        
        async function loadNowPlaying() {
            const noSongElement = document.getElementById('noSong');
            const songInfoElement = document.getElementById('songInfo');
            const songTitleElement = document.getElementById('songTitle');
            const songAlbumElement = document.getElementById('songAlbum');
            const songTimeElement = document.getElementById('songTime');
            
            try {
                // Cache bust with timestamp
                const response = await fetch(NOW_PLAYING_FILE + '?t=' + Date.now());
                
                if (response.ok) {
                    const text = await response.text();
                    const lines = text.trim().split('\n');
                    //const latestLine = lines[lines.length - 1]; //Gets last line
                    const latestLine = lines[0];  // Gets FIRST line (NEWEST/TOPMOST entry)
                    
                    const songInfo = parseNowPlayingLine(latestLine);
                    
                    if (songInfo) {
                        songTitleElement.textContent = songInfo.title;
                        songAlbumElement.textContent = songInfo.album;
                        songTimeElement.textContent = songInfo.timestamp;
                        
                        noSongElement.style.display = 'none';
                        songInfoElement.style.display = 'block';
                        
                        // Adjust marquee speed based on text length
                        const titleLength = songInfo.title.length;
                        const albumLength = songInfo.album.length;
                        const titleSpeed = Math.max(8, titleLength / 4);
                        const albumSpeed = Math.max(8, albumLength / 4);
                        
                        songTitleElement.style.animationDuration = `${titleSpeed}s`;
                        songAlbumElement.style.animationDuration = `${albumSpeed}s`;
                        
                        updateStatus(`Playing: ${songInfo.title.substring(0, 30)}...`);
                    } else {
                        noSongElement.style.display = 'block';
                        songInfoElement.style.display = 'none';
                        noSongElement.textContent = 'No song playing';
                        updateStatus('Stopped');
                    }
                } else {
                    noSongElement.style.display = 'block';
                    songInfoElement.style.display = 'none';
                    noSongElement.textContent = 'File not found';
                    updateStatus('Error loading file');
                }
            } catch (error) {
                noSongElement.style.display = 'block';
                songInfoElement.style.display = 'none';
                noSongElement.textContent = 'Error loading';
                updateStatus('Connection error');
            }
        }
        
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }
        
        async function sendCommand(commandNumber) {
            updateStatus(`Sending command ${commandNumber}...`);
            
            try {
                const intentString = `am broadcast "intent:#Intent;action=com.maxmpz.audioplayer.API_COMMAND;package=com.maxmpz.audioplayer;i.cmd=${commandNumber};end"`;
                const response = await fetch(`${API_ENDPOINT}?command=${encodeURIComponent(intentString)}`);
                
                if (response.ok) {
                    // Update play/pause button for command 1
                    if (commandNumber === 1) {
                        const playBtn = document.getElementById('playPauseBtn');
                        const playText = document.getElementById('playText');
                        const symbol = playBtn.innerHTML.charAt(0);
                        
                        if (symbol === '‚ñ∂') {
                            playBtn.innerHTML = '‚è∏<div class="play-text" id="playText">PAUSE</div><div class="command-hint">(1)</div>';
                            playText.textContent = 'PAUSE';
                        } else {
                            playBtn.innerHTML = '‚ñ∂<div class="play-text" id="playText">PLAY</div><div class="command-hint">(1)</div>';
                            playText.textContent = 'PLAY';
                        }
                    }
                    
                    updateStatus(`Command ${commandNumber} sent`);
                    
                    // Refresh now playing after a short delay
                    setTimeout(loadNowPlaying, 300);
                } else {
                    updateStatus('Error sending command');
                }
            } catch (error) {
                updateStatus('Network error');
            }
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (event) => {
            // Prevent default for space to avoid scrolling
            if (event.key === ' ') {
                event.preventDefault();
            }
            
            switch(event.key) {
                case '1': case ' ': sendCommand(1); break;
                case '4': case 'ArrowRight': sendCommand(4); break;
                case '5': case 'ArrowLeft': sendCommand(5); break;
                case '6': case 'ArrowUp': sendCommand(6); break;
                case '7': case 'ArrowDown': sendCommand(7); break;
            }
        });
        
        // Load on startup
        loadNowPlaying();
        
        // Auto-refresh every 3 seconds
        setInterval(loadNowPlaying, 3000);
    </script>
</body>
</html>


run.sh
--
#!/bin/bash
URL="https://alcea-wisteria.de/PHP/0demo/2025-12-22-DeviceNAppCtrl/%5BAndroid%5D_Poweramp%E2%80%90%28Tasker%29%2820251222%29/commands.txt"
echo "Fetching commands from: $URL"
first_line=$(curl -s "$URL" | head -n 1)
if [ -z "$first_line" ]; then
    echo "Error: Could not fetch or file is empty"
    exit 1
fi
echo "First line: $first_line"
command="${first_line:17}"
echo "Executing command: $command"
eval "$command"
exit_code=$?
if [ $exit_code -eq 0 ]; then
    echo "Command executed successfully"
    delete_url="https://alcea-wisteria.de/PHP/0demo/2025-12-22-DeviceNAppCtrl/%5BAndroid%5D_Poweramp%E2%80%90%28Tasker%29%2820251222%29/commandprocess.php?delete=ok"
    echo "Making GET request to: $delete_url"
    delete_response=$(curl -s "$delete_url")
    curl_exit_code=$?
    if [ $curl_exit_code -eq 0 ]; then
        echo "Delete request sent successfully"
        echo "Response: $delete_response"
    else
        echo "Warning: Failed to send delete request (curl exit code: $curl_exit_code)"
    fi
else
    echo "Error executing command"
    exit 1
fi

save_track.php
--
<?php
// commandprocess.php - Updated to handle both command execution and track logging

// Configuration
$TRACK_FILE = 'currently_playing.txt';
$MAX_FILE_LINES = 50; // Keep only last 50 tracks to prevent file from growing too large

// Handle track logging via GET parameter
if (isset($_GET['track'])) {
    $track = $_GET['track'];
    
    // Clean the input (remove any trailing/leading whitespace)
    $track = trim($track);
    
    if (!empty($track)) {
        // Generate timestamp in format YYYYMMDDHHMMSS
        $timestamp = date('YmdHis');
        
        // Format: "20250209143022"_"Song Title" - "Album Name"
        // The incoming track should already be in the format: "Song Title" - "Album Name"
        // or just "Song Title" if no album
        
        // Parse the incoming track string
        $formattedTrack = "\"{$timestamp}\"_";
        
        // Check if track contains album separator " - "
        if (strpos($track, ' - ') !== false) {
            // Split into title and album
            $parts = explode(' - ', $track, 2);
            $title = trim($parts[0]);
            $album = isset($parts[1]) ? trim($parts[1]) : '';
            
            // Ensure both parts are quoted
            $title = trim($title, '"\'');
            $album = trim($album, '"\'');
            
            $formattedTrack .= "\"{$title}\" - \"{$album}\"";
        } else {
            // No album, just title
            $title = trim($track, '"\'');
            $formattedTrack .= "\"{$title}\" - \"\"";
        }
        
        // Read existing content
        $lines = [];
        if (file_exists($TRACK_FILE)) {
            $lines = file($TRACK_FILE, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
        }
        
        // Prepend new track
        array_unshift($lines, $formattedTrack);
        if (count($lines) > $MAX_FILE_LINES) {
            $lines = array_slice($lines, 0, $MAX_FILE_LINES);
        }
        if (file_put_contents($TRACK_FILE, implode(PHP_EOL, $lines) . PHP_EOL)) {
            echo "Track logged: {$formattedTrack}";
        } else {
            http_response_code(500);
            echo "Error writing to file";
        }
        exit;
    }
}

// Original command execution logic from your bash script
if (isset($_GET['command'])) {
    $command = $_GET['command'];
    
    // Execute the command (assuming this is running in an environment with ADB/shell access)
    exec($command, $output, $return_var);
    
    if ($return_var === 0) {
        echo "Command executed successfully";
    } else {
        http_response_code(500);
        echo "Error executing command";
    }
    exit;
}

// Optional: Handle delete request if needed
if (isset($_GET['delete']) && $_GET['delete'] === 'ok') {
    // Your original delete logic would go here
    echo "Delete request received";
    exit;
}

// If no parameters provided, show usage
echo "Usage: 
- Log track: ?track=\"Song Title\" - \"Album Name\"
- Send command: ?command=am+broadcast+...
- Delete: ?delete=ok";
?>




LineageOS Samsung Parser
-----------------------

<?php

libxml_use_internal_errors(true);

// Fetch the devices page
$html = file_get_contents('https://wiki.lineageos.org/devices/');

$dom = new DOMDocument();
$dom->loadHTML($html);

$xpath = new DOMXPath($dom);

/**
 * 1. Get the Samsung devices container
 */
$devicesDiv = $xpath->query(
    "//div[contains(concat(' ', normalize-space(@class), ' '), ' devices ')][@data-vendor='samsung']"
);

if ($devicesDiv->length === 0) {
    die('Samsung devices div not found');
}

/**
 * 2. Get all device items inside it
 */
$items = $xpath->query(
    ".//div[contains(concat(' ', normalize-space(@class), ' '), ' item ')]",
    $devicesDiv->item(0)
);

$samsungDevices = [];

foreach ($items as $item) {
    $nameNode = $xpath->query(".//span[@class='devicename']", $item)->item(0);
    $linkNode = $xpath->query(".//a[@href]", $item)->item(0);
    $imageNode = $xpath->query(".//img", $item)->item(0);

    if ($nameNode && $linkNode && $imageNode) {
        $deviceName = trim($nameNode->textContent);
        $deviceUrl = 'https://wiki.lineageos.org' . $linkNode->getAttribute('href');
        $deviceImageUrl = 'https://wiki.lineageos.org' . $imageNode->getAttribute('src'); // Prepend the base URL
        $codename = $xpath->query(".//span[@class='codename']", $item)->item(0)->textContent;

        // Construct install URL
        $installUrl = $deviceUrl . '/install';

        // Store device info along with install details link and image URL
        $samsungDevices[] = [
            'name' => $deviceName,
            'url'  => $deviceUrl,
            'install_url' => $installUrl,
            'image_url' => $deviceImageUrl
        ];
    }
}

// Check for device query parameter
$deviceFilterValue = isset($_GET['device']) ? htmlspecialchars($_GET['device']) : '';

?>
<!DOCTYPE html>
<html>
<head>
    <title>Samsung Devices - LineageOS</title>
    <style>
        .device-container {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .filter-container {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }
        .filter-input {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .filter-input:focus {
            outline: none;
            border-color: #007cba;
            box-shadow: 0 0 0 1px #007cba;
        }
        .device-item {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .device-image {
            width: 50px;
            height: 50px;
            margin-right: 10px;
            object-fit: contain;
        }
        .no-results {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }
        .results-count {
            margin-top: 10px;
            color: #666;
            font-size: 14px;
        }
        .query-hint {
            margin-top: 5px;
            font-size: 12px;
            color: #666;
        }
        .query-hint a {
            color: #007cba;
            text-decoration: none;
        }
        .query-hint a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="filter-container">
        <h2>Samsung Devices with LineageOS Support</h2>
        <input type="text" 
               id="deviceFilter" 
               class="filter-input" 
               placeholder="Type to filter devices by name (e.g., Galaxy, Note, S9, etc.)"
               value="<?php echo $deviceFilterValue; ?>"
               onkeyup="filterDevices()">
        <div id="resultsCount" class="results-count"></div>
        <div class="query-hint">
            <?php if (!empty($deviceFilterValue)): ?>
                Filtered by query string: "<?php echo $deviceFilterValue; ?>" | 
                <a href="<?php echo strtok($_SERVER['REQUEST_URI'], '?'); ?>">Clear filter</a>
            <?php endif; ?>
        </div>
    </div>

    <div id="devicesList">
        <?php foreach ($samsungDevices as $device): ?>
            <div class="device-container" data-device-name="<?php echo htmlspecialchars(strtolower($device['name'])); ?>">
                <div class="device-item">
                    <img src="<?php echo $device['image_url']; ?>" 
                         alt="<?php echo htmlspecialchars($device['name']); ?>" 
                         class="device-image">
                    <a href="<?php echo $device['url']; ?>" target="_blank">
                        <?php echo htmlspecialchars($device['name']); ?>
                    </a>
                </div>
                
                <details onclick="loadIframe('iframe_<?php echo urlencode($device['name']); ?>', '<?php echo $device['install_url']; ?>')">
                    <summary>Installation Instructions</summary>
                    <iframe id="iframe_<?php echo urlencode($device['name']); ?>" 
                            width="100%" 
                            height="600" 
                            frameborder="0" 
                            src="about:blank"
                            style="border: 1px solid #ddd; border-radius: 4px; margin-top: 10px;">
                        Your browser does not support iframes.
                    </iframe>
                </details>
            </div>
        <?php endforeach; ?>
    </div>

    <script>
        function loadIframe(id, url) {
            var iframe = document.getElementById(id);
            if (iframe && iframe.src === 'about:blank') {
                iframe.src = url;
            }
        }

        function filterDevices() {
            var input = document.getElementById('deviceFilter');
            var filter = input.value.toLowerCase();
            var devices = document.getElementsByClassName('device-container');
            var visibleCount = 0;
            
            for (var i = 0; i < devices.length; i++) {
                var deviceName = devices[i].getAttribute('data-device-name');
                if (deviceName.indexOf(filter) > -1) {
                    devices[i].style.display = '';
                    visibleCount++;
                } else {
                    devices[i].style.display = 'none';
                }
            }
            
            // Update results count
            var resultsCount = document.getElementById('resultsCount');
            resultsCount.textContent = visibleCount + ' of ' + devices.length + ' devices shown';
            
            // Show no results message
            var noResultsMsg = document.getElementById('noResultsMessage');
            if (visibleCount === 0 && filter.length > 0) {
                if (!noResultsMsg) {
                    noResultsMsg = document.createElement('div');
                    noResultsMsg.id = 'noResultsMessage';
                    noResultsMsg.className = 'no-results';
                    noResultsMsg.textContent = 'No devices found matching "' + filter + '"';
                    document.getElementById('devicesList').appendChild(noResultsMsg);
                }
            } else if (noResultsMsg) {
                noResultsMsg.remove();
            }
        }
        
        // Initialize page with filter if query parameter exists
        document.addEventListener('DOMContentLoaded', function() {
            var devices = document.getElementsByClassName('device-container');
            var deviceFilter = document.getElementById('deviceFilter');
            
            // Update results count
            document.getElementById('resultsCount').textContent = devices.length + ' devices found';
            
            // Apply filter if query parameter exists
            var filterValue = deviceFilter.value;
            if (filterValue) {
                filterDevices();
                
                // Optionally scroll to first visible device
                setTimeout(function() {
                    var firstVisible = document.querySelector('.device-container[style=""]');
                    if (firstVisible) {
                        firstVisible.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }
                }, 100);
            }
        });
    </script>
</body>
</html>


File backup tool (here: data_akkoma.json)
------------------------------
<a target="_blank" href="https://alcea-wisteria.de/z_files/acwsbackup/" style=color:blue>MRGNCYCKUP</a>


<?php

// Define the URL to download
$url = 'https://alceawis.de/other/extra/scripts/fakesocialmedia/0ld/data_akkoma.json';

// Define the directory to save the file
$dir = 'akkoma_data';

// Check if the directory exists, if not, create it
if (!is_dir($dir)) {
    mkdir($dir, 0777, true);
}

// Get the current timestamp
$timestamp = date('Y-m-d-H-i-s');

// Define the filename with timestamp
$filename = $timestamp . '-data_akkoma.json';

// Full path where the file will be saved
$filepath = $dir . '/' . $filename;

// Download the file content
$file_content = file_get_contents($url);

// Check if the content was fetched successfully
if ($file_content === false) {
    die('Error downloading the file.');
}

// Save the content to the specified file
file_put_contents($filepath, $file_content);

// Check the size of the downloaded file
$file_size = filesize($filepath);

// Only keep the file if it's larger than 300KB
if ($file_size < 300 * 1024) {
    unlink($filepath); // Delete the file if it's smaller than 300KB
    echo "File discarded as it is smaller than 300KB.";
    exit;
}

// Check the total size of the directory
$total_size = 0;
$files = glob($dir . '/*');
foreach ($files as $file) {
    $total_size += filesize($file);
}

// If the total size exceeds 10MB (10 * 1024 * 1024 bytes), clean up old files
if ($total_size > 10 * 1024 * 1024) {
    // Sort files by modification time (oldest first)
    usort($files, function ($a, $b) {
        return filemtime($a) - filemtime($b);
    });

    // Delete old files until the total size is under 5MB (5 * 1024 * 1024 bytes)
    foreach ($files as $file) {
        if ($total_size <= 5 * 1024 * 1024) break; // Stop if under 5MB
        if (is_file($file)) {
            $total_size -= filesize($file);
            unlink($file); // Delete old file
        }
    }
}

echo "File saved as: $filepath";

?>


Fedi post metrics
----------

<?php
// Configuration for instances
$instances = [
    'akkoma' => ['domain' => 'alceawis.com', 'api_key' => '123', 'type' => 'akkoma'],
    'mastodon1' => ['domain' => 'mastodon.social', 'api_key' => '123', 'type' => 'mastodon'],
    'mastodon2' => ['domain' => 'mas.to', 'api_key' => '123', 'type' => 'mastodon']
];

if (!isset($_GET['url']) || empty($_GET['url'])) {
    die("?url=POST_URL");
}

$originalUrl = $_GET['url'];

// Fetch ActivityPub JSON and follow redirects
function fetchActivityPubJson($url) {
    $ch = curl_init($url . '.json');
    curl_setopt_array($ch, [
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_FOLLOWLOCATION => true,
        CURLOPT_MAXREDIRS => 5,
        CURLOPT_TIMEOUT => 10,
        CURLOPT_USERAGENT => 'Fediverse Analyzer',
        CURLOPT_HTTPHEADER => ['Accept: application/activity+json'],
    ]);
    $response = curl_exec($ch);
    $finalUrl = curl_getinfo($ch, CURLINFO_EFFECTIVE_URL);
    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    curl_close($ch);
    
    if ($httpCode === 200) {
        $data = json_decode($response, true);
        if ($data && isset($data['id'])) {
            return [
                'data' => $data,
                'final_url' => $finalUrl,
                'redirected' => ($finalUrl !== $url)
            ];
        }
    }
    return null;
}

// API request
function makeApiRequest($url, $apiKey = null) {
    $ch = curl_init();
    $headers = ['Accept: application/json'];
    if ($apiKey && $apiKey !== 'public') $headers[] = 'Authorization: Bearer ' . $apiKey;
    
    curl_setopt_array($ch, [
        CURLOPT_URL => $url,
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_HTTPHEADER => $headers,
        CURLOPT_TIMEOUT => 10,
    ]);
    $response = curl_exec($ch);
    curl_close($ch);
    return json_decode($response, true);
}

// Get full handle from user data
function getFullHandle($userData, $currentInstance) {
    // Always use the acct field - it contains @user@instance for remote users
    $acct = $userData['acct'] ?? '';
    
    // If acct doesn't contain @, it's a local user, add instance
    if (strpos($acct, '@') === false) {
        return $acct . '@' . $currentInstance;
    }
    
    return $acct;
}

// Create unique reply ID for deduplication - ONLY author + timestamp
function getReplyUniqueId($authorHandle, $timestamp) {
    // Just use author handle and timestamp (rounded to minute to handle small variations)
    $timestampRounded = $timestamp ? date('Y-m-d H:i', strtotime($timestamp)) : '';
    return md5($authorHandle . '|' . $timestampRounded);
}

// Get data with redirect tracking
$activityResult = fetchActivityPubJson($originalUrl);
if (!$activityResult) die("<div class='error'>No ActivityPub data found</div>");

$activityData = $activityResult['data'];
$finalUrl = $activityResult['final_url'];
$redirected = $activityResult['redirected'];
$originalDomain = parse_url($originalUrl, PHP_URL_HOST);

$postUrl = $activityData['url'] ?? $activityData['id'] ?? $finalUrl;
$urlParts = parse_url($postUrl);
$finalDomain = $urlParts['host'];
$pathParts = explode('/', trim($urlParts['path'], '/'));
$postId = end($pathParts);

// Global storage for deduplication (for totals only)
$globalUsers = []; // full handle => true
$globalLikes = []; // full handle => true  
$globalBoosts = []; // full handle => true
$globalReplies = []; // unique reply ID => true

// Track what's unique to remote instances
$remoteOnlyStats = [
    'likes' => 0,
    'boosts' => 0,
    'replies' => 0
];

// Results per instance
$instanceResults = [];

// Function to check an instance
function checkInstance($domain, $postId, $postUrl, $instanceType = 'remote', $apiKey = null) {
    global $globalUsers, $globalLikes, $globalBoosts, $globalReplies, $remoteOnlyStats;
    
    $instanceData = [
        'name' => $domain,
        'type' => $instanceType,
        'likes' => [],
        'boosts' => [],
        'replies' => [],
        'success' => false
    ];
    
    $baseUrl = "https://{$domain}";
    
    // Try direct access first (no auth)
    $postApi = "{$baseUrl}/api/v1/statuses/{$postId}";
    $postData = makeApiRequest($postApi, 'public');
    
    if ($postData && !isset($postData['error'])) {
        $instanceData['success'] = true;
        
        // Get likes
        $likes = makeApiRequest("{$baseUrl}/api/v1/statuses/{$postId}/favourited_by", 'public');
        if ($likes && !isset($likes['error'])) {
            foreach ($likes as $user) {
                $fullHandle = getFullHandle($user, $domain);
                $instanceData['likes'][$fullHandle] = [
                    'full_handle' => $fullHandle,
                    'username' => $user['acct'],
                    'display_name' => $user['display_name'] ?? $user['acct'],
                    'avatar' => $user['avatar'] ?? '',
                    'instance' => $domain
                ];
                
                // Track for global totals
                if (!isset($globalLikes[$fullHandle])) {
                    $globalLikes[$fullHandle] = true;
                    if ($instanceType === 'remote') $remoteOnlyStats['likes']++;
                }
                $globalUsers[$fullHandle] = true;
            }
        }
        
        // Get boosts
        $boosts = makeApiRequest("{$baseUrl}/api/v1/statuses/{$postId}/reblogged_by", 'public');
        if ($boosts && !isset($boosts['error'])) {
            foreach ($boosts as $user) {
                $fullHandle = getFullHandle($user, $domain);
                $instanceData['boosts'][$fullHandle] = [
                    'full_handle' => $fullHandle,
                    'username' => $user['acct'],
                    'display_name' => $user['display_name'] ?? $user['acct'],
                    'avatar' => $user['avatar'] ?? '',
                    'instance' => $domain
                ];
                
                // Track for global totals
                if (!isset($globalBoosts[$fullHandle])) {
                    $globalBoosts[$fullHandle] = true;
                    if ($instanceType === 'remote') $remoteOnlyStats['boosts']++;
                }
                $globalUsers[$fullHandle] = true;
            }
        }
        
        // Get replies
        $context = makeApiRequest("{$baseUrl}/api/v1/statuses/{$postId}/context", 'public');
        if ($context && isset($context['descendants'])) {
            foreach ($context['descendants'] as $reply) {
                $authorHandle = getFullHandle($reply['account'], $domain);
                $replyData = [
                    'id' => $reply['id'],
                    'author' => $authorHandle,
                    'content' => strip_tags($reply['content']),
                    'created_at' => $reply['created_at'] ?? ''
                ];
                $replyUniqueId = getReplyUniqueId($authorHandle, $replyData['created_at']);
                
                $instanceData['replies'][$replyUniqueId] = $replyData;
                
                // Track for global totals
                if (!isset($globalReplies[$replyUniqueId])) {
                    $globalReplies[$replyUniqueId] = true;
                    if ($instanceType === 'remote') $remoteOnlyStats['replies']++;
                }
                $globalUsers[$authorHandle] = true;
            }
        }
    } else {
        // If public access fails and we have an API key, try with auth
        if ($apiKey) {
            $postData = makeApiRequest($postApi, $apiKey);
            
            if ($postData && !isset($postData['error'])) {
                $instanceData['success'] = true;
                
                // Get likes with auth
                $likes = makeApiRequest("{$baseUrl}/api/v1/statuses/{$postId}/favourited_by", $apiKey);
                if ($likes) {
                    foreach ($likes as $user) {
                        $fullHandle = getFullHandle($user, $domain);
                        $instanceData['likes'][$fullHandle] = [
                            'full_handle' => $fullHandle,
                            'username' => $user['acct'],
                            'display_name' => $user['display_name'] ?? $user['acct'],
                            'avatar' => $user['avatar'] ?? '',
                            'instance' => $domain
                        ];
                        
                        if (!isset($globalLikes[$fullHandle])) {
                            $globalLikes[$fullHandle] = true;
                            if ($instanceType === 'remote') $remoteOnlyStats['likes']++;
                        }
                        $globalUsers[$fullHandle] = true;
                    }
                }
                
                // Get boosts with auth
                $boosts = makeApiRequest("{$baseUrl}/api/v1/statuses/{$postId}/reblogged_by", $apiKey);
                if ($boosts) {
                    foreach ($boosts as $user) {
                        $fullHandle = getFullHandle($user, $domain);
                        $instanceData['boosts'][$fullHandle] = [
                            'full_handle' => $fullHandle,
                            'username' => $user['acct'],
                            'display_name' => $user['display_name'] ?? $user['acct'],
                            'avatar' => $user['avatar'] ?? '',
                            'instance' => $domain
                        ];
                        
                        if (!isset($globalBoosts[$fullHandle])) {
                            $globalBoosts[$fullHandle] = true;
                            if ($instanceType === 'remote') $remoteOnlyStats['boosts']++;
                        }
                        $globalUsers[$fullHandle] = true;
                    }
                }
                
                // Get replies with auth
                $context = makeApiRequest("{$baseUrl}/api/v1/statuses/{$postId}/context", $apiKey);
                if ($context && isset($context['descendants'])) {
                    foreach ($context['descendants'] as $reply) {
                        $authorHandle = getFullHandle($reply['account'], $domain);
                        $replyData = [
                            'id' => $reply['id'],
                            'author' => $authorHandle,
                            'content' => strip_tags($reply['content']),
                            'created_at' => $reply['created_at'] ?? ''
                        ];
                        $replyUniqueId = getReplyUniqueId($authorHandle, $replyData['created_at']);
                        
                        $instanceData['replies'][$replyUniqueId] = $replyData;
                        
                        if (!isset($globalReplies[$replyUniqueId])) {
                            $globalReplies[$replyUniqueId] = true;
                            if ($instanceType === 'remote') $remoteOnlyStats['replies']++;
                        }
                        $globalUsers[$authorHandle] = true;
                    }
                }
            }
        }
    }
    
    return $instanceData;
}

// 1. Check final domain (home instance)
$instanceResults[$finalDomain] = checkInstance($finalDomain, $postId, $postUrl, 'home');

// 2. Check original domain if different (especially for redirects like woof.tech)
if ($redirected && $originalDomain !== $finalDomain) {
    // Try to find API key for original domain
    $originalApiKey = null;
    foreach ($instances as $config) {
        if ($config['domain'] === $originalDomain) {
            $originalApiKey = $config['api_key'];
            break;
        }
    }
    
    // Try to extract post ID from original URL
    $originalPathParts = explode('/', trim(parse_url($originalUrl, PHP_URL_PATH), '/'));
    $originalPostId = end($originalPathParts);
    
    if ($originalPostId) {
        $instanceResults[$originalDomain] = checkInstance($originalDomain, $originalPostId, $originalUrl, 'redirect_source', $originalApiKey);
    }
}

// 3. Check other configured instances
foreach ($instances as $config) {
    $domain = $config['domain'];
    
    // Skip if already checked (final domain or original domain)
    if (isset($instanceResults[$domain]) || $domain === $finalDomain || $domain === $originalDomain) {
        continue;
    }
    
    // For other instances, we need to search for the post first
    $searchUrl = "https://{$domain}/api/v2/search?q=" . urlencode($postUrl) . "&resolve=true&limit=1";
    $searchResult = makeApiRequest($searchUrl, $config['api_key']);
    
    if ($searchResult && isset($searchResult['statuses'][0]['id'])) {
        $remoteId = $searchResult['statuses'][0]['id'];
        $instanceResults[$domain] = checkInstance($domain, $remoteId, $postUrl, 'remote', $config['api_key']);
    } else {
        // Mark as not found
        $instanceResults[$domain] = [
            'name' => $domain,
            'type' => 'remote',
            'likes' => [],
            'boosts' => [],
            'replies' => [],
            'success' => false
        ];
    }
}

// Calculate totals with proper deduplication
$totalLikes = count($globalLikes);
$totalBoosts = count($globalBoosts);
$totalReplies = count($globalReplies);
$totalUsers = count($globalUsers);
?>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Fedi Stats</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #f5f7fa; 
            padding: 15px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .compact-view {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 15px;
        }
        
        .url-display {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
            word-break: break-all;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .redirect-note {
            font-size: 12px;
            color: #666;
            padding: 5px 10px;
            background: #e8f4fd;
            border-radius: 6px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            text-align: center;
        }
        
        .stat-card {
            padding: 15px 10px;
            border-radius: 8px;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: transform 0.2s;
            position: relative;
        }
        
        .stat-card:hover { transform: translateY(-2px); }
        
        .stat-icon { font-size: 24px; margin-bottom: 5px; }
        .stat-count { 
            font-size: 28px; 
            font-weight: 700; 
            line-height: 1;
            margin-bottom: 3px;
        }
        .stat-label { 
            font-size: 12px; 
            color: #666; 
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .unique-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff6b6b;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .like-card { background: linear-gradient(135deg, #fff5f5, #ffeaea); border: 1px solid #ffcccc; }
        .boost-card { background: linear-gradient(135deg, #f0f9ff, #e6f7ff); border: 1px solid #b3e0ff; }
        .reply-card { background: linear-gradient(135deg, #f9f7ff, #f0eeff); border: 1px solid #d6ccff; }
        .user-card { background: linear-gradient(135deg, #f0fff4, #e6ffed); border: 1px solid #b3ffcc; }
        
        details {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-top: 15px;
        }
        
        summary {
            padding: 15px 20px;
            background: #2c3e50;
            color: white;
            font-weight: 600;
            cursor: pointer;
            list-style: none;
            position: relative;
            font-size: 14px;
        }
        
        summary::after {
            content: '‚ñº';
            position: absolute;
            right: 20px;
            font-size: 12px;
            transition: transform 0.2s;
        }
        
        details[open] summary::after { transform: rotate(180deg); }
        summary::-webkit-details-marker { display: none; }
        
        .details-content {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .instance-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .instance-section:last-child { border-bottom: none; }
        
        .instance-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .instance-icon {
            font-size: 20px;
        }
        
        .instance-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 16px;
        }
        
        .instance-badge {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 500;
        }
        
        .badge-home {
            background: #3498db;
            color: white;
        }
        
        .badge-redirect {
            background: #9b59b6;
            color: white;
        }
        
        .badge-remote {
            background: #2ecc71;
            color: white;
        }
        
        .instance-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            font-size: 14px;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            flex-wrap: wrap;
        }
        
        .instance-count {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 70px;
        }
        
        .count-number {
            font-size: 24px;
            font-weight: 700;
            line-height: 1;
        }
        
        .count-label {
            font-size: 12px;
            color: #666;
        }
        
        .category-section {
            margin-bottom: 20px;
        }
        
        .category-title {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            font-size: 15px;
            font-weight: 600;
            color: #2c3e50;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
        
        .category-icon {
            font-size: 18px;
        }
        
        .user-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
        }
        
        .user-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #3498db;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #ddd;
            object-fit: cover;
        }
        
        .user-info {
            flex: 1;
            min-width: 0;
        }
        
        .user-display-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 2px;
            font-size: 14px;
        }
        
        .user-handle {
            font-size: 12px;
            color: #666;
            margin-bottom: 2px;
            font-family: monospace;
        }
        
        .user-instance {
            font-size: 11px;
            color: #888;
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 10px;
            display: inline-block;
        }
        
        .reply-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .reply-item {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #9b59b6;
        }
        
        .reply-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        
        .reply-author {
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }
        
        .reply-handle {
            font-size: 12px;
            color: #666;
            font-family: monospace;
            margin-left: 5px;
        }
        
        .reply-time {
            font-size: 11px;
            color: #888;
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 10px;
        }
        
        .reply-content {
            font-size: 14px;
            line-height: 1.4;
            color: #333;
        }
        
        .no-data {
            color: #95a5a6;
            font-style: italic;
            font-size: 14px;
            padding: 20px;
            text-align: center;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px dashed #ddd;
        }
        
        .deduplication-note {
            background: #e8f4fd;
            border: 1px solid #b3e0ff;
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
            font-size: 12px;
            color: #2c3e50;
        }
        
        .total-summary {
            font-size: 12px;
            color: #666;
            text-align: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .dedup-info {
            font-size: 11px;
            color: #888;
            margin-top: 5px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="compact-view">
        <div class="url-display">
            üìé <?php echo htmlspecialchars($postUrl); ?>
            <?php if($redirected && $originalDomain !== $finalDomain): ?>
                <div class="redirect-note">
                    üîÄ Redirected from: <?php echo htmlspecialchars($originalUrl); ?>
                </div>
            <?php endif; ?>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card like-card">
                <?php if($remoteOnlyStats['likes'] > 0): ?>
                    <div class="unique-badge">+<?php echo $remoteOnlyStats['likes']; ?></div>
                <?php endif; ?>
                <div class="stat-icon">‚ù§Ô∏è</div>
                <div class="stat-count"><?php echo $totalLikes; ?></div>
                <div class="stat-label">Likes</div>
            </div>
            
            <div class="stat-card boost-card">
                <?php if($remoteOnlyStats['boosts'] > 0): ?>
                    <div class="unique-badge">+<?php echo $remoteOnlyStats['boosts']; ?></div>
                <?php endif; ?>
                <div class="stat-icon">üîÅ</div>
                <div class="stat-count"><?php echo $totalBoosts; ?></div>
                <div class="stat-label">Boosts</div>
            </div>
            
            <div class="stat-card reply-card">
                <?php if($remoteOnlyStats['replies'] > 0): ?>
                    <div class="unique-badge">+<?php echo $remoteOnlyStats['replies']; ?></div>
                <?php endif; ?>
                <div class="stat-icon">üí¨</div>
                <div class="stat-count"><?php echo $totalReplies; ?></div>
                <div class="stat-label">Replies</div>
                <div class="dedup-info">by @user + time</div>
            </div>
            
            <div class="stat-card user-card">
                <div class="stat-icon">üë•</div>
                <div class="stat-count"><?php echo $totalUsers; ?></div>
                <div class="stat-label">Unique Users</div>
            </div>
        </div>
        
        <?php if($remoteOnlyStats['likes'] > 0 || $remoteOnlyStats['boosts'] > 0 || $remoteOnlyStats['replies'] > 0): ?>
            <div class="total-summary">
                <span>‚ú® <?php echo $totalLikes; ?> likes, <?php echo $totalBoosts; ?> boosts, <?php echo $totalReplies; ?> replies total (deduplicated across instances)</span>
            </div>
        <?php endif; ?>
    </div>
    
    <details>
        <summary>üìä Detailed Breakdown</summary>
        <div class="details-content">
            
            <div class="deduplication-note">
                <strong>Note:</strong> Global totals are deduplicated across instances. Replies are deduplicated by @user@handle + timestamp. Each instance shows its own counts below.
            </div>
            
            <?php foreach($instanceResults as $domain => $instance): 
                $likeCount = count($instance['likes']);
                $boostCount = count($instance['boosts']);
                $replyCount = count($instance['replies']);
                
                // Skip instances that failed
                if (!$instance['success'] && $likeCount == 0 && $boostCount == 0 && $replyCount == 0) continue;
            ?>
                <div class="instance-section">
                    <div class="instance-header">
                        <span class="instance-icon">
                            <?php if($instance['type'] === 'home'): ?>üè†<?php elseif($instance['type'] === 'redirect_source'): ?>üîÄ<?php else: ?>üåê<?php endif; ?>
                        </span>
                        <span class="instance-name"><?php echo $domain; ?></span>
                        <span class="instance-badge <?php 
                            if($instance['type'] === 'home') echo 'badge-home';
                            elseif($instance['type'] === 'redirect_source') echo 'badge-redirect';
                            else echo 'badge-remote';
                        ?>">
                            <?php 
                                if($instance['type'] === 'home') echo 'Home';
                                elseif($instance['type'] === 'redirect_source') echo 'Redirect Source';
                                else echo 'Remote';
                            ?>
                        </span>
                    </div>
                    
                    <?php if($instance['success']): ?>
                        <div class="instance-stats">
                            <div class="instance-count">
                                <div class="count-number"><?php echo $likeCount; ?></div>
                                <div class="count-label">‚ù§Ô∏è Likes</div>
                            </div>
                            <div class="instance-count">
                                <div class="count-number"><?php echo $boostCount; ?></div>
                                <div class="count-label">üîÅ Boosts</div>
                            </div>
                            <div class="instance-count">
                                <div class="count-number"><?php echo $replyCount; ?></div>
                                <div class="count-label">üí¨ Replies</div>
                            </div>
                        </div>
                        
                        <!-- Likes -->
                        <?php if($likeCount > 0): ?>
                            <div class="category-section">
                                <div class="category-title">
                                    <span class="category-icon">‚ù§Ô∏è</span>
                                    <span>Likes (<?php echo $likeCount; ?>)</span>
                                </div>
                                <div class="user-list">
                                    <?php foreach($instance['likes'] as $user): ?>
                                        <div class="user-item">
                                            <?php if(!empty($user['avatar'])): ?>
                                                <img src="<?php echo htmlspecialchars($user['avatar']); ?>" class="user-avatar" alt="">
                                            <?php else: ?>
                                                <div class="user-avatar"></div>
                                            <?php endif; ?>
                                            <div class="user-info">
                                                <div class="user-display-name"><?php echo htmlspecialchars($user['display_name']); ?></div>
                                                <div class="user-handle">@<?php echo htmlspecialchars($user['full_handle']); ?></div>
                                                <span class="user-instance"><?php echo $domain; ?></span>
                                            </div>
                                        </div>
                                    <?php endforeach; ?>
                                </div>
                            </div>
                        <?php endif; ?>
                        
                        <!-- Boosts -->
                        <?php if($boostCount > 0): ?>
                            <div class="category-section">
                                <div class="category-title">
                                    <span class="category-icon">üîÅ</span>
                                    <span>Boosts (<?php echo $boostCount; ?>)</span>
                                </div>
                                <div class="user-list">
                                    <?php foreach($instance['boosts'] as $user): ?>
                                        <div class="user-item">
                                            <?php if(!empty($user['avatar'])): ?>
                                                <img src="<?php echo htmlspecialchars($user['avatar']); ?>" class="user-avatar" alt="">
                                            <?php else: ?>
                                                <div class="user-avatar"></div>
                                            <?php endif; ?>
                                            <div class="user-info">
                                                <div class="user-display-name"><?php echo htmlspecialchars($user['display_name']); ?></div>
                                                <div class="user-handle">@<?php echo htmlspecialchars($user['full_handle']); ?></div>
                                                <span class="user-instance"><?php echo $domain; ?></span>
                                            </div>
                                        </div>
                                    <?php endforeach; ?>
                                </div>
                            </div>
                        <?php endif; ?>
                        
                        <!-- Replies -->
                        <?php if($replyCount > 0): ?>
                            <div class="category-section">
                                <div class="category-title">
                                    <span class="category-icon">üí¨</span>
                                    <span>Replies (<?php echo $replyCount; ?>)</span>
                                </div>
                                <div class="reply-list">
                                    <?php foreach($instance['replies'] as $reply): ?>
                                        <div class="reply-item">
                                            <div class="reply-header">
                                                <span class="reply-author"><?php 
                                                    $authorHandle = $reply['author'];
                                                    $authorParts = explode('@', $authorHandle);
                                                    $authorName = $authorParts[0] ?? $authorHandle;
                                                    echo htmlspecialchars($authorName);
                                                ?></span>
                                                <span class="reply-handle">@<?php echo htmlspecialchars($reply['author']); ?></span>
                                                <?php if($reply['created_at']): ?>
                                                    <span class="reply-time"><?php echo date('M j, H:i', strtotime($reply['created_at'])); ?></span>
                                                <?php endif; ?>
                                            </div>
                                            <div class="reply-content"><?php echo htmlspecialchars($reply['content']); ?></div>
                                        </div>
                                    <?php endforeach; ?>
                                </div>
                            </div>
                        <?php endif; ?>
                        
                    <?php else: ?>
                        <div class="no-data">Could not access this instance or post not found</div>
                    <?php endif; ?>
                </div>
            <?php endforeach; ?>
            
        </div>
    </details>
</body>
</html>

html file writer
----------------------


<?php
// Pre-fill from query string, but only act when form is submitted
$sourcepath = $_GET['path'] ?? '';
$printstart = $_GET['printstart'] ?? '';
$content = '';
$message = '';

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $sourcepath = $_POST['sourcepath'] ?? '';
    $printstart = $_POST['printstart'] ?? '';
    $content = $_POST['content'] ?? '';

    if ($sourcepath && file_exists($sourcepath)) {
        $fileContent = file_get_contents($sourcepath);

        // Find marker position
        $pos = strpos($fileContent, $printstart);

        if ($pos !== false) {
            // Insert content right after the marker
            $newContent = substr($fileContent, 0, $pos + strlen($printstart))
                        . $content
                        . substr($fileContent, $pos + strlen($printstart));

            // Write back to the file
            file_put_contents($sourcepath, $newContent);
            $message = "‚úÖ Content successfully inserted into '$sourcepath'.";
        } else {
            $message = "‚ùå Marker '$printstart' not found in file.";
        }
    } else {
        $message = "‚ùå File not found or invalid path.";
    }
}
?>

<!DOCTYPE html>
<html>
<head>
    <title>Insert Content into File</title>
    <meta charset="utf-8">
</head>
<body>
    <h2>Insert Content into File</h2>
    <?php if ($message): ?>
        <p><strong><?= htmlspecialchars($message) ?></strong></p>
    <?php endif; ?>

    <form method="post">
        <label>Source Path:</label><br>
        <input type="text" name="sourcepath" size="80"
               value="<?= htmlspecialchars($sourcepath) ?>"><br><br>

        <label>Print Start Marker:</label><br>
        <input type="text" name="printstart" size="80"
               value="<?= htmlspecialchars($printstart) ?>"><br><br>

        <label>Content to Insert:</label><br>
        <textarea name="content" rows="10" cols="80"><?= htmlspecialchars($content) ?></textarea><br><br>

        <input type="submit" value="Insert Content">
    </form>
</body>
</html>



Steam Wishlist / PriceDropCheck
-------------------------------

checkprices.php
--
<?php
// Price Comparison Script for Steam Games
define('DEFAULT_STEAM_API_KEY', 'YOUR_STEAM_API_KEY');

// Function to extract app ID from URL
function extractAppIdFromUrl($url) {
    preg_match('/\/app\/(\d+)\//', $url, $matches);
    return $matches[1] ?? null;
}

// Function to fetch current price from Steam API
function fetchCurrentPrice($appId, $cc = 'EUR', $lang = 'en') {
    $apiKey = DEFAULT_STEAM_API_KEY;
    $url = "https://store.steampowered.com/api/appdetails?appids={$appId}&cc={$cc}&l={$lang}&key={$apiKey}";
    
    $context = stream_context_create([
        'http' => [
            'timeout' => 15,
            'header' => "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36\r\n"
        ]
    ]);
    
    $response = @file_get_contents($url, false, $context);
    $data = json_decode($response, true);

    if (isset($data[$appId]['data'])) {
        $gameData = $data[$appId]['data'];
        
        if (isset($gameData['price_overview'])) {
            return [
                'final_formatted' => $gameData['price_overview']['final_formatted'],
                'final' => $gameData['price_overview']['final'],
                'discount_percent' => $gameData['price_overview']['discount_percent'],
                'initial_formatted' => $gameData['price_overview']['initial_formatted'],
                'initial' => $gameData['price_overview']['initial']
            ];
        } elseif (isset($gameData['is_free']) && $gameData['is_free']) {
            return [
                'final_formatted' => 'Free',
                'final' => 0,
                'discount_percent' => 0,
                'initial_formatted' => 'Free',
                'initial' => 0
            ];
        }
    }
    
    return null;
}

// Function to convert price string to numeric value
function priceToNumeric($priceString) {
    if ($priceString === 'Free') return 0;
    
    // Remove currency symbols and commas, keep only numbers and decimal separator
    $cleanPrice = preg_replace('/[^\d,\.]/', '', $priceString);
    
    // Handle European format (comma as decimal separator)
    if (strpos($cleanPrice, ',') !== false && strpos($cleanPrice, '.') !== false) {
        // If both comma and dot exist, comma is likely decimal separator
        $cleanPrice = str_replace('.', '', $cleanPrice); // Remove thousand separators
        $cleanPrice = str_replace(',', '.', $cleanPrice); // Convert comma to decimal point
    } elseif (strpos($cleanPrice, ',') !== false) {
        // Only comma exists - check if it's decimal or thousand separator
        $parts = explode(',', $cleanPrice);
        if (strlen(end($parts)) === 2) {
            // Last part is 2 digits, likely decimal
            $cleanPrice = str_replace(',', '.', $cleanPrice);
        } else {
            // Comma as thousand separator
            $cleanPrice = str_replace(',', '', $cleanPrice);
        }
    }
    
    return floatval($cleanPrice);
}

// Function to compare prices and detect drops
function comparePrices($storedPrice, $currentPrice) {
    $storedNumeric = priceToNumeric($storedPrice);
    $currentNumeric = priceToNumeric($currentPrice['final_formatted']);
    
    if ($storedNumeric === 0 && $currentNumeric === 0) {
        return ['status' => 'same', 'change' => 0, 'percent' => 0];
    }
    
    if ($storedNumeric > $currentNumeric) {
        $change = $storedNumeric - $currentNumeric;
        $percent = ($change / $storedNumeric) * 100;
        return [
            'status' => 'drop',
            'change' => $change,
            'percent' => round($percent, 1),
            'old_price' => $storedPrice,
            'new_price' => $currentPrice['final_formatted']
        ];
    } elseif ($storedNumeric < $currentNumeric) {
        $change = $currentNumeric - $storedNumeric;
        $percent = ($change / $storedNumeric) * 100;
        return [
            'status' => 'increase',
            'change' => $change,
            'percent' => round($percent, 1),
            'old_price' => $storedPrice,
            'new_price' => $currentPrice['final_formatted']
        ];
    } else {
        return ['status' => 'same', 'change' => 0, 'percent' => 0];
    }
}

// Function to format currency
function formatCurrency($amount, $currency = 'EUR') {
    $symbols = ['EUR' => '‚Ç¨', 'USD' => '$', 'GBP' => '¬£'];
    $symbol = $symbols[$currency] ?? $currency;
    
    return number_format($amount, 2, ',', '.') . $symbol;
}

// Main execution
$jsonFile = 'games_data.json';
$results = [];

if (file_exists($jsonFile)) {
    $data = json_decode(file_get_contents($jsonFile), true);
    
    if (!empty($data)) {
        echo "<!DOCTYPE html>
        <html lang='en'>
        <head>
            <meta charset='UTF-8'>
            <title>Steam Price Checker</title>
            <style>
                body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
                .container { max-width: 1200px; margin: 0 auto; }
                .game-card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
                .price-drop { background: #e7ffe7; border-left: 4px solid #00ba07; }
                .price-increase { background: #ffe7e7; border-left: 4px solid #ba0000; }
                .no-change { background: #f0f0f0; border-left: 4px solid #666; }
                .error { background: #fffae7; border-left: 4px solid #baa300; }
                .price-badge { padding: 3px 8px; border-radius: 3px; font-weight: bold; }
                .drop { background: #00ba07; color: white; }
                .increase { background: #ba0000; color: white; }
                .same { background: #666; color: white; }
                .stats { background: #e7f3ff; padding: 15px; margin: 20px 0; border-radius: 5px; }
                .loading { color: #666; font-style: italic; }
                h1 { color: #333; }
                .game-title { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
                .price-comparison { font-size: 16px; margin: 5px 0; }
                .discount { color: #00ba07; font-weight: bold; }
                .last-checked { font-size: 12px; color: #666; }
            </style>
        </head>
        <body>
            <div class='container'>
                <h1>Steam Price Checker</h1>
                <div class='stats'>
                    <strong>Checking prices for " . count($data) . " games...</strong>
                    <p>Currency: EUR | Last updated: " . date('Y-m-d H:i:s') . "</p>
                </div>";
        
        $totalGames = count($data);
        $priceDrops = 0;
        $priceIncreases = 0;
        $noChanges = 0;
        $errors = 0;
        
        foreach ($data as $index => $game) {
            echo "<div class='game-card loading' id='game-{$index}'>";
            echo "Checking: <strong>{$game['title']}</strong>...";
            echo "</div>";
            
            // Flush output to show progress
            flush();
            ob_flush();
            
            $appId = extractAppIdFromUrl($game['url']);
            $currentPrice = fetchCurrentPrice($appId, 'EUR', 'en');
            
            if ($currentPrice) {
                $comparison = comparePrices($game['price'], $currentPrice);
                
                $statusClass = $comparison['status'] . '-change';
                if ($comparison['status'] === 'drop') $priceDrops++;
                elseif ($comparison['status'] === 'increase') $priceIncreases++;
                else $noChanges++;
                
                echo "<script>document.getElementById('game-{$index}').outerHTML = " . json_encode("
                    <div class='game-card {$statusClass}'>
                        <div class='game-title'>{$game['title']}</div>
                        <div class='price-comparison'>
                            Stored: {$game['price']} ‚Üí Current: {$currentPrice['final_formatted']}
                            " . ($comparison['status'] !== 'same' ? 
                                "<span class='price-badge {$comparison['status']}'>" . 
                                strtoupper($comparison['status']) . " " . 
                                ($comparison['percent'] > 0 ? formatCurrency($comparison['change']) . " ({$comparison['percent']}%)" : '') . 
                                "</span>" : '') . "
                        </div>
                        " . ($currentPrice['discount_percent'] > 0 ? 
                            "<div class='discount'>üè∑Ô∏è Currently {$currentPrice['discount_percent']}% off (Original: {$currentPrice['initial_formatted']})</div>" : '') . "
                        <div class='last-checked'>Last checked in database: {$game['date']}</div>
                        <div><small><a href='{$game['url']}' target='_blank'>View on Steam</a></small></div>
                    </div>
                ") . ";</script>";
                
                flush();
                ob_flush();
                
            } else {
                $errors++;
                echo "<script>document.getElementById('game-{$index}').outerHTML = " . json_encode("
                    <div class='game-card error'>
                        <div class='game-title'>{$game['title']}</div>
                        <div>‚ùå Could not fetch current price</div>
                        <div class='last-checked'>Stored price: {$game['price']} | Last checked: {$game['date']}</div>
                    </div>
                ") . ";</script>";
                
                flush();
                ob_flush();
            }
            
            // Small delay to avoid hitting rate limits
            usleep(500000); // 0.5 second delay
        }
        
        // Final statistics
        echo "<div class='stats'>
                <h3>Summary</h3>
                <p>Total Games: {$totalGames}</p>
                <p style='color: #00ba07;'>Price Drops: {$priceDrops}</p>
                <p style='color: #ba0000;'>Price Increases: {$priceIncreases}</p>
                <p style='color: #666;'>No Changes: {$noChanges}</p>
                <p style='color: #baa300;'>Errors: {$errors}</p>
            </div>";
        
        echo "</div></body></html>";
        
    } else {
        echo "<p>No game data found in the JSON file.</p>";
    }
} else {
    echo "<p>JSON file not found: {$jsonFile}</p>";
}
?>

addtolist.php
--
<?php
// Default Steam API Key (replace with your own or leave blank)
define('DEFAULT_STEAM_API_KEY', 'YOUR_STEAM_API_KEY');

// Function to extract the last part of the URL path (the game title)
function extractTitleFromUrl($url) {
    $parts = parse_url($url);
    $path = rtrim($parts['path'], '/');
    $segments = explode('/', $path);
    return end($segments);
}

// Function to decode Unicode escape sequences in price
function decodeUnicode($string) {
    return preg_replace_callback('/\\\u([a-fA-F0-9]{4})/', function ($matches) {
        return mb_convert_encoding(pack('H*', $matches[1]), 'UTF-8', 'UCS-2BE');
    }, $string);
}

// Function to fetch Steam Deck compatibility data
function fetchSteamDeckCompatibility($appId) {
    $urlDeck = "https://store.steampowered.com/saleaction/ajaxgetdeckappcompatibilityreport?nAppID={$appId}";
    $deckJson = @file_get_contents($urlDeck);

    if ($deckJson) {
        $deckData = json_decode($deckJson, true);
        if (json_last_error() === JSON_ERROR_NONE) {
            $deckCompatibility = 'Not Available';
            $deckResult = '';

            if (isset($deckData['results']['resolved_items'][0])) {
                $resolvedItem = $deckData['results']['resolved_items'][0];
                $deckCompatibility = $resolvedItem['loc_token'] ?? 'Not Available';
            }

            return [
                'deck_compat' => $deckCompatibility,
                'deck_result' => $deckResult
            ];
        }
    }

    return [
        'deck_compat' => 'Not Available',
        'deck_result' => 'No Result Data'
    ];
}

// Function to format bytes into human-readable format (MB/GB)
function formatFileSize($bytes) {
    if (!is_numeric($bytes) || $bytes <= 0) return 'Size Not Available';
    if ($bytes >= 1073741824) {
        return number_format($bytes / 1073741824, 1) . ' GB';
    } elseif ($bytes >= 1048576) {
        return number_format($bytes / 1048576, 1) . ' MB';
    } elseif ($bytes >= 1024) {
        return number_format($bytes / 1024, 1) . ' KB';
    } else {
        return $bytes . ' bytes';
    }
}

// NEW: Improved function to fetch filesize with better error handling and reliable sources
function fetchFileSize($appId) {
    $filesize = 'Size Not Available';
    
    // Method 1: Try SteamDB API first (most reliable for file sizes)
    $steamDbUrl = "https://steamdb.info/api/GetAppSize/?appid={$appId}";
    $context = stream_context_create([
        'http' => [
            'timeout' => 10,
            'header' => "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36\r\n"
        ]
    ]);
    
    $steamDbResponse = @file_get_contents($steamDbUrl, false, $context);
    
    if ($steamDbResponse !== false) {
        $steamDbData = json_decode($steamDbResponse, true);
        if (isset($steamDbData['success']) && $steamDbData['success'] && isset($steamDbData['data']['size'])) {
            $size = $steamDbData['data']['size'];
            if ($size > 0) {
                return formatFileSize($size);
            }
        }
    }
    
    // Method 2: Try Steam API with multiple size fields
    $apiUrl = "https://store.steampowered.com/api/appdetails?appids={$appId}";
    $response = @file_get_contents($apiUrl, false, $context);
    
    if ($response !== false) {
        $data = json_decode($response, true);
        
        if (isset($data[$appId]['data'])) {
            $gameData = $data[$appId]['data'];
            
            // Check multiple possible size fields
            $sizeFields = ['size_on_disk', 'content_size', 'package_size', 'install_size'];
            foreach ($sizeFields as $field) {
                if (isset($gameData[$field]) && $gameData[$field] > 0) {
                    return formatFileSize($gameData[$field]);
                }
            }
            
            // Check for PC requirements which might contain size info
            if (isset($gameData['pc_requirements']['minimum'])) {
                $requirements = $gameData['pc_requirements']['minimum'];
                if (preg_match('/(\d+(?:\.\d+)?)\s*GB|(\d+(?:\.\d+)?)\s*gigabyte/i', $requirements, $matches)) {
                    $size = $matches[1] ?: $matches[2];
                    if ($size > 0) {
                        return number_format(floatval($size), 1) . ' GB';
                    }
                }
                if (preg_match('/(\d+(?:\.\d+)?)\s*MB|(\d+(?:\.\d+)?)\s*megabyte/i', $requirements, $matches)) {
                    $size = $matches[1] ?: $matches[2];
                    if ($size > 0) {
                        return number_format(floatval($size), 1) . ' MB';
                    }
                }
            }
        }
    }
    
    // Method 3: Try scraping the store page for size information
    $storeUrl = "https://store.steampowered.com/app/{$appId}/";
    $storePage = @file_get_contents($storeUrl, false, $context);
    
    if ($storePage !== false) {
        // Look for size patterns in system requirements
        $sizePatterns = [
            '/(\d+(?:\.\d+)?)\s*GB.*storage/i',
            '/(\d+(?:\.\d+)?)\s*GB.*space/i',
            '/(\d+(?:\.\d+)?)\s*gigabyte/i',
            '/(\d+(?:\.\d+)?)\s*MB.*storage/i',
            '/(\d+(?:\.\d+)?)\s*MB.*space/i',
            '/(\d+(?:\.\d+)?)\s*megabyte/i',
            '/storage.*?(\d+(?:\.\d+)?)\s*GB/i',
            '/space.*?(\d+(?:\.\d+)?)\s*GB/i'
        ];
        
        foreach ($sizePatterns as $pattern) {
            if (preg_match($pattern, $storePage, $matches)) {
                $size = floatval($matches[1]);
                if ($size > 0) {
                    if (stripos($pattern, 'GB') !== false || stripos($pattern, 'gigabyte') !== false) {
                        return number_format($size, 1) . ' GB';
                    } else {
                        // Convert MB to GB if it's a large number
                        if ($size > 1000) {
                            return number_format($size / 1024, 1) . ' GB';
                        }
                        return number_format($size, 1) . ' MB';
                    }
                }
            }
        }
    }
    
    return $filesize;
}

// Function to get price and filesize using Steam API
function fetchGameDetailsFromSteamApi($appId, $apiKey, $cc = 'USD', $lang = 'en') {
    $url = "https://store.steampowered.com/api/appdetails?appids={$appId}&cc={$cc}&l={$lang}&key={$apiKey}";
    $context = stream_context_create([
        'http' => [
            'timeout' => 15,
            'header' => "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36\r\n"
        ]
    ]);
    
    $response = @file_get_contents($url, false, $context);
    $data = json_decode($response, true);

    $price = 'Price Not Available';
    $filesize = fetchFileSize($appId); // Use our improved filesize function

    if (isset($data[$appId]['data'])) {
        $gameData = $data[$appId]['data'];

        // Get price
        if (isset($gameData['price_overview'])) {
            $price = decodeUnicode($gameData['price_overview']['final_formatted']);
        } elseif (isset($gameData['is_free']) && $gameData['is_free']) {
            $price = 'Free';
        }
    }

    return [
        'price' => $price,
        'filesize' => $filesize
    ];
}

// Function to check if the URL already exists in the JSON data
function isDuplicate($url, $data) {
    foreach ($data as $item) {
        if ($item['url'] === $url) {
            return true;
        }
    }
    return false;
}

// Handle form submission
if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['url'])) {
    $url = trim($_POST['url']);
    
    if (filter_var($url, FILTER_VALIDATE_URL)) {
        $title = extractTitleFromUrl($url);

        // Extract the app ID from the URL
        preg_match('/\/app\/(\d+)\//', $url, $matches);
        $appId = $matches[1] ?? null;

        if ($appId) {
            $apiKey = isset($_GET['api_key']) ? $_GET['api_key'] : DEFAULT_STEAM_API_KEY;
            $cc = isset($_POST['currency']) ? $_POST['currency'] : 'USD';
            $lang = isset($_POST['language']) ? $_POST['language'] : 'en';

            // Fetch data
            $gameDetails = fetchGameDetailsFromSteamApi($appId, $apiKey, $cc, $lang);
            $deckDetails = fetchSteamDeckCompatibility($appId);

            $currentDate = date('Y-m-d H:i:s');
            $gameData = [
                'url' => $url,
                'title' => $title,
                'price' => $gameDetails['price'],
                'steamDeckCompatibility' => $deckDetails['deck_compat'],
                'filesize' => $gameDetails['filesize'],
                'deck_result' => $deckDetails['deck_result'],
                'date' => $currentDate
            ];

            $jsonFile = 'games_data.json';
            $data = file_exists($jsonFile) ? json_decode(file_get_contents($jsonFile), true) : [];

            if (!isDuplicate($url, $data)) {
                $data[] = $gameData;
                file_put_contents($jsonFile, json_encode($data, JSON_PRETTY_PRINT));
                echo "<div class='success'><p>Data for <strong>{$title}</strong> has been added to the JSON file.</p>";
                echo "<p>Price: <strong>{$gameDetails['price']}</strong> | Size: <strong>{$gameDetails['filesize']}</strong> | Deck Compatibility: <strong>{$deckDetails['deck_compat']}</strong></p></div>";
            } else {
                echo "<div class='warning'><p>Data for <strong>{$title}</strong> already exists. No duplicate added.</p></div>";
            }
        } else {
            echo "<div class='error'><p>Could not extract App ID from the URL.</p></div>";
        }
    } else {
        echo "<div class='error'><p>Invalid URL. Please enter a valid URL.</p></div>";
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Steam Game Logger</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        form { margin: 20px 0; padding: 20px; border: 1px solid #ddd; background: #f9f9f9; border-radius: 5px; }
        label { display: inline-block; width: 150px; margin-right: 10px; font-weight: bold; }
        input[type="text"] { padding: 8px; margin: 5px 0; border: 1px solid #ccc; border-radius: 3px; }
        button { padding: 10px 20px; background: #007cba; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 16px; }
        button:hover { background: #005a87; }
        .info { background: #e7f3ff; padding: 15px; margin: 15px 0; border-left: 4px solid #007cba; border-radius: 3px; }
        .success { background: #e7ffe7; padding: 15px; margin: 15px 0; border-left: 4px solid #00ba07; border-radius: 3px; }
        .warning { background: #fffae7; padding: 15px; margin: 15px 0; border-left: 4px solid #baa300; border-radius: 3px; }
        .error { background: #ffe7e7; padding: 15px; margin: 15px 0; border-left: 4px solid #ba0000; border-radius: 3px; }
        .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Steam Game Logger</h1>
    
    <div class="info">
        <strong>Improved Filesize Detection:</strong><br>
        ‚Ä¢ Primary: SteamDB API (most reliable)<br>
        ‚Ä¢ Secondary: Steam API with multiple size fields<br>
        ‚Ä¢ Fallback: Store page system requirements parsing<br>
        ‚Ä¢ Better timeout handling and user agents
    </div>
    
    <form method="POST">
        <div>
            <label for="currency">Currency Code:</label>
            <input type="text" name="currency" id="currency" value="EUR" style="width: 100px;">
            <small>(e.g., USD, EUR, GBP)</small>
        </div>
        <div>
            <label for="language">Language:</label>
            <input type="text" name="language" id="language" value="en" style="width: 100px;">
            <small>(e.g., en, fr, de)</small>
        </div>
        <div>
            <label for="url">Steam Game URL:</label>
            <input type="text" name="url" id="url" placeholder="https://store.steampowered.com/app/2124490/SILENT_HILL_2/" required style="width: 500px;">
        </div>
        <div>
            <button type="submit">Add Game to List</button>
        </div>
    </form>
    
    <?php
    // Debug info - show recent entries
    $jsonFile = 'games_data.json';
    if (file_exists($jsonFile)) {
        $data = json_decode(file_get_contents($jsonFile), true);
        if (!empty($data)) {
            echo "<div class='info'>";
            echo "<h3>Recent Entries:</h3>";
            $recent = array_slice($data, -3); // Show last 3 entries
            foreach ($recent as $entry) {
                echo "<p><strong>{$entry['title']}</strong> - Price: {$entry['price']} - Size: {$entry['filesize']} - Deck: {$entry['steamDeckCompatibility']}</p>";
            }
            echo "</div>";
        }
    }
    ?>
</body>
</html>

NintendoNews parser (exclude ninteverything )
--------------


<?php
function fetch_url_content($url) {
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
    curl_setopt($ch, CURLOPT_USERAGENT, 'Mozilla/5.0');
    $html = curl_exec($ch);
    $http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    curl_close($ch);
    return ($http_code === 200) ? $html : false;
}

function normalize_image_url($url, $base_url) {
    $url = trim($url);
    if ($url === '' || strpos($url, '...') !== false) {
        return 'https://via.placeholder.com/150x80?text=No+Image';
    }
    if (preg_match('#^https?://#i', $url)) return $url;
    $parsed = parse_url($base_url);
    $host = $parsed['scheme'].'://'.$parsed['host'];
    if (isset($parsed['port'])) $host .= ':'.$parsed['port'];
    if ($url[0] !== '/') $url = '/'.$url;
    return $host.$url;
}

function parse_articles_regex($html, $base_url, $blocked_domains) {
    $articles = [];
    $pattern = '#<div\s+class=["\']item[^"\']*["\'][^>]*>.*?<img[^>]*src=["\']([^"\']+)["\'][^>]*>.*?<h2[^>]*class=["\']heading[^"\']*["\'][^>]*>\s*<a[^>]*href=["\']([^"\']+)["\'][^>]*>(.*?)</a>.*?(<p[^>]*class=["\']summary[^"\']*["\']>(.*?)</p>)?.*?data-timestamp=["\']([^"\']+)["\']#si';

    if (preg_match_all($pattern, $html, $matches, PREG_SET_ORDER)) {
        foreach ($matches as $m) {
            $link = trim($m[2]);
            $blocked = false;
            foreach ($blocked_domains as $d) {
                if (stripos($link, $d) !== false) { $blocked = true; break; }
            }
            if ($blocked) continue;

            $host = parse_url($link, PHP_URL_HOST);
            $badge = strtoupper(preg_replace('/^www\./','',$host));

            $articles[] = [
                'image' => normalize_image_url($m[1], $base_url),
                'link' => $link,
                'title' => trim(htmlspecialchars_decode($m[3])),
                'excerpt' => isset($m[5]) ? trim(htmlspecialchars_decode($m[5])) : '',
                'badge' => $badge,
                'date' => isset($m[6]) ? $m[6] : ''
            ];
        }
    }

    return $articles;
}

$base_url = 'https://nintendonews.com/news';
$blocked_domains = ['nintendolife.de','nintendoeverything.com'];
$per_page = 10;

$page_param = isset($_GET['page']) ? max(1,intval($_GET['page'])) : 1;
$autopage = isset($_GET['autopage']);

$url = $base_url . '?page=' . $page_param;
$html = fetch_url_content($url);
$all_articles = $html ? parse_articles_regex($html, $base_url, $blocked_domains) : [];

$total_articles = count($all_articles);
$total_pages = 100;
$current_page = $page_param;
$articles_to_show = $all_articles;

if ($autopage && isset($_GET['ajax'])) {
    header('Content-Type: application/json');
    echo json_encode([
        'articles' => $articles_to_show,
        'current' => $current_page,
        'total' => $total_pages
    ]);
    exit;
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nintendo News</title>
<style>
body{font-family:Arial,sans-serif;}
.article{position:relative;border:1px solid #ccc;margin-bottom:10px;padding:15px;border-radius:8px;display:flex;gap:15px;}
.article img{max-width:150px;border-radius:4px;}
.badge{position:absolute;bottom:5px;right:10px;font-size:11px;color:#666;background:#f2f2f2;padding:2px 6px;border-radius:3px;}
.date{position:absolute;top:5px;left:10px;font-size:11px;color:#333;background:#fff;padding:2px 6px;border-radius:3px;border:1px solid #ccc;}
#page-indicator{position:fixed;bottom:10px;right:10px;font-size:12px;color:#444;background:#eee;padding:2px 6px;border-radius:4px;}
</style>
</head>
<body>
<h1>Latest Nintendo News</h1>
<ul id="article-list" style="list-style:none;padding:0;">
<?php foreach($articles_to_show as $a): ?>
<li class="article">
  <div class="date"><?=htmlspecialchars($a['date'])?></div>
  <div><img src="<?=htmlspecialchars($a['image'])?>" alt="<?=htmlspecialchars($a['title'])?>"></div>
  <div>
    <h3><a href="<?=htmlspecialchars($a['link'])?>" target="_blank"><?=htmlspecialchars($a['title'])?></a></h3>
    <p><?=htmlspecialchars($a['excerpt'])?></p>
  </div>
  <span class="badge"><?=htmlspecialchars($a['badge'])?></span>
</li>
<?php endforeach; ?>
</ul>

<div id="page-indicator">Page <?=$current_page?></div>

<script>
let currentPage = <?=$current_page?>;
let loading = false;
const indicator = document.getElementById('page-indicator');
const list = document.getElementById('article-list');

window.addEventListener('scroll', async () => {
    if (loading) return;
    if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 100) {
        loading = true;
        const next = currentPage + 1;
        const resp = await fetch(`?autopage=1&page=${next}&ajax=1`);
        const data = await resp.json();
        if (data.articles.length === 0) return;
        data.articles.forEach(a => {
            const li = document.createElement('li');
            li.className = 'article';
            li.innerHTML = `
                <div class="date">${a.date}</div>
                <div><img src="${a.image}" alt="${a.title}"></div>
                <div>
                    <h3><a href="${a.link}" target="_blank">${a.title}</a></h3>
                    <p>${a.excerpt}</p>
                </div>
                <span class="badge">${a.badge}</span>`;
            list.appendChild(li);
        });
        currentPage = next;
        indicator.textContent = `Page ${currentPage}`;
        loading = false;
    }
});
</script>
</body>
</html>


Fedi is Missing
------------------------

filereport.php
--
<?php
// Handle the form submission and processing
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Get the Fediverse URL from the POST request
    $fediverse_url = trim($_POST['fediverse_url']);

    // Validate the URL (basic validation)
    if (!filter_var($fediverse_url, FILTER_VALIDATE_URL)) {
        die("Invalid URL.");
    }

    // Parse the URL
    $parsed_url = parse_url($fediverse_url);
    if (!isset($parsed_url['host'])) {
        die("Invalid URL structure.");
    }
    
    $domain = $parsed_url['host'];
    $path = $parsed_url['path'];
    
    // Extract username from different URL formats
    $username = null;
    $status_id = null;
    
    // Pattern for Mastodon/Pleroma/Akkoma post URLs: /@user/123456
    if (preg_match('#^/(@[^/]+)/(\d+)$#', $path, $matches)) {
        $username = $matches[1];
        $status_id = $matches[2];
    } 
    // Pattern for user profile URLs: /@user
    else if (preg_match('#^/(@[^/]+)$#', $path, $matches)) {
        $username = $matches[1];
    }
    // Pattern for Pleroma/Akkoma notice URLs: /notice/ABC123
    else if (preg_match('#^/notice/([^/]+)$#', $path, $matches)) {
        $status_id = $matches[1];
    }
    // Pattern for Akkoma objects: /objects/ABC123
    else if (preg_match('#^/objects/([^/]+)$#', $path, $matches)) {
        $status_id = $matches[1];
    }
    // Pattern for Akkoma users: /users/username
    else if (preg_match('#^/users/([^/]+)$#', $path, $matches)) {
        $username = '@' . $matches[1];
    }
    else {
        die("Unsupported URL format: $path");
    }
    
    // Configure HTTP context
    $context = stream_context_create([
        'http' => [
            'timeout' => 15,
            'header' => "User-Agent: FediversePostFetcher/1.0\r\nAccept: application/json\r\n"
        ],
        'ssl' => [
            'verify_peer' => false,
            'verify_peer_name' => false
        ]
    ]);
    
    // If we have a status ID but no username, fetch the post to get the username
    if ($status_id && !$username) {
        // Try different API endpoints for different platforms
        $api_urls = [
            "https://$domain/api/v1/statuses/$status_id", // Mastodon/Pleroma standard
            "https://$domain/objects/$status_id", // Akkoma alternative
        ];
        
        $post_data = null;
        foreach ($api_urls as $api_url) {
            $response = @file_get_contents($api_url, false, $context);
            if ($response !== false) {
                $post_data = json_decode($response, true);
                if ($post_data) break;
            }
        }
        
        if (!$post_data) {
            die("Error fetching post data from the server.");
        }
        
        // Extract username from post data - ensure we get the full @user@domain format
        if (isset($post_data['account']['acct'])) {
            $acct = $post_data['account']['acct'];
            // Check if the acct already contains a domain
            if (strpos($acct, '@') === false) {
                // If not, add the domain
                $username = '@' . $acct . '@' . $domain;
            } else {
                $username = '@' . $acct;
            }
        } else if (isset($post_data['account']['username'])) {
            $acct = $post_data['account']['username'];
            // Try to get the full acct (username@domain) if possible
            if (isset($post_data['account']['url'])) {
                $account_url = parse_url($post_data['account']['url']);
                if (isset($account_url['host']) && $account_url['host'] !== $domain) {
                    $username = '@' . $acct . '@' . $account_url['host'];
                } else {
                    $username = '@' . $acct . '@' . $domain;
                }
            } else {
                $username = '@' . $acct . '@' . $domain;
            }
        } else {
            die("Unable to extract user information from post.");
        }
    } else if ($username) {
        // If we already have a username from the URL, ensure it's in the full @user@domain format
        $username_parts = explode('@', $username);
        if (count($username_parts) === 2) {
            // Only username part is present, add domain
            $username = $username . '@' . $domain;
        }
    }
    
    // Now get the user's latest post using the username
    // Extract just the username part without @ for lookup
    $lookup_username = substr($username, 1); // Remove the leading @
    $lookup_username_parts = explode('@', $lookup_username);
    $local_username = $lookup_username_parts[0];
    
    // Try different lookup endpoints
    $lookup_urls = [
        "https://$domain/api/v1/accounts/lookup?acct=" . urlencode($lookup_username), // Standard
        "https://$domain/users/" . urlencode($local_username) . ".json", // Akkoma alternative
    ];
    
    $account_data = null;
    foreach ($lookup_urls as $lookup_url) {
        $response = @file_get_contents($lookup_url, false, $context);
        if ($response !== false) {
            $account_data = json_decode($response, true);
            if ($account_data) break;
        }
    }
    
    $user_id = null;
    $user_acct = $lookup_username; // Default to the full username we already have
    
    if ($account_data) {
        if (isset($account_data['id'])) {
            $user_id = $account_data['id'];
        }
        // Get the proper account identifier
        if (isset($account_data['acct'])) {
            $acct = $account_data['acct'];
            // Check if the acct already contains a domain
            if (strpos($acct, '@') === false) {
                // If not, add the domain
                $user_acct = $acct . '@' . $domain;
            } else {
                $user_acct = $acct;
            }
        }
    }
    
    $latest_post_url = null;
    $created_at = null;
    
    // If we couldn't get user ID through lookup, try to get statuses directly
    if (!$user_id) {
        // Try different statuses endpoints
        $statuses_urls = [
            "https://$domain/users/$local_username/outbox?page=true&limit=1", // ActivityPub
            "https://$domain/api/v1/accounts/$local_username/statuses?limit=1", // Mastodon API
            "https://$domain/@$local_username.json?limit=1", // Alternative
        ];
        
        $statuses = null;
        foreach ($statuses_urls as $statuses_url) {
            $response = @file_get_contents($statuses_url, false, $context);
            if ($response !== false) {
                $data = json_decode($response, true);
                
                // Handle different response formats
                if (isset($data['orderedItems'])) {
                    // ActivityPub format
                    if (!empty($data['orderedItems']) && isset($data['orderedItems'][0]['published'])) {
                        $created_at = $data['orderedItems'][0]['published'];
                        if (isset($data['orderedItems'][0]['id'])) {
                            $latest_post_url = $data['orderedItems'][0]['id'];
                        }
                        $statuses = [['created_at' => $created_at]];
                        break;
                    }
                } else if (is_array($data) && !empty($data) && isset($data[0]['created_at'])) {
                    // Standard API format
                    $statuses = $data;
                    $created_at = $data[0]['created_at'];
                    if (isset($data[0]['url'])) {
                        $latest_post_url = $data[0]['url'];
                    }
                    break;
                }
            }
        }
        
        if (!$statuses || empty($statuses)) {
            die("No posts found for the user.");
        }
    } else {
        // Get statuses using the user ID
        $statuses_url = "https://$domain/api/v1/accounts/$user_id/statuses?limit=1";
        $response = @file_get_contents($statuses_url, false, $context);
        
        if ($response === false) {
            die("Error fetching user's latest post.");
        }
        
        $statuses = json_decode($response, true);
        if (empty($statuses)) {
            die("No posts found for the user.");
        }
        
        $created_at = $statuses[0]['created_at'];
        if (isset($statuses[0]['url'])) {
            $latest_post_url = $statuses[0]['url'];
        }
    }
    
    // If we don't have a post URL, try to construct one
    if (!$latest_post_url && isset($statuses[0]['id'])) {
        $post_id = $statuses[0]['id'];
        $latest_post_url = "https://$domain/@$user_acct/$post_id";
    }
    
    // Format the date to yyyymmdd
    $date = date('Ymd', strtotime($created_at));

    // Prepare the data for saving to the JSON file
    $entry = [
        'username' => "@$user_acct",
        'date' => $date,
        'post_url' => $latest_post_url
    ];

    // Load the existing JSON data
    $filename = 'fedimissing.json';
    $json_data = [];
    if (file_exists($filename)) {
        $json_content = file_get_contents($filename);
        if ($json_content !== false) {
            $json_data = json_decode($json_content, true);
        }
        if (!is_array($json_data)) {
            $json_data = [];
        }
    }

    // Check if the user already exists
    $user_exists = false;
    foreach ($json_data as $existing_entry) {
        if ($existing_entry['username'] === "@$user_acct") {
            $user_exists = true;
            break;
        }
    }
    
    if ($user_exists) {
        die("User @$user_acct already exists in the JSON file.");
    }

    // Prepend the new entry to the array
    array_unshift($json_data, $entry);

    // Save the updated data back to the JSON file
    if (file_put_contents($filename, json_encode($json_data, JSON_PRETTY_PRINT))) {
        echo "Latest post date saved successfully: @$user_acct $date";
        if ($latest_post_url) {
            echo "<br>Post URL: <a href='$latest_post_url' target='_blank'>$latest_post_url</a>";
        }
    } else {
        echo "Error saving to JSON file. Please check file permissions.";
    }
} else {
    // Display the HTML form
    ?>
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Fediverse Post Fetcher</title>
        <style>
            body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
            form { margin-top: 20px; }
            input[type="text"] { width: 100%; padding: 8px; margin: 8px 0; }
            button { padding: 10px 20px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
            button:hover { background-color: #45a049; }
            .error { color: red; }
            .success { color: green; }
        </style>
    </head>
    <body>
        <h1>Fetch Latest Post From Fediverse User</h1>
        <p>This tool will always get the date of the user's NEWEST post, regardless of which post URL you provide.</p>
        <form action="" method="POST">
            <label for="fediverse_url">Enter Fediverse URL:</label>
            <input type="text" id="fediverse_url" name="fediverse_url" placeholder="e.g., https://mastodon.social/@user or https://example.com/notice/ABC123" required>
            <button type="submit">Get Newest Post Date</button>
        </form>
        <p>Supported formats:
            <ul>
                <li>https://mastodon.social/@username</li>
                <li>https://instance.tld/@username/1234567890 (any post URL)</li>
                <li>https://instance.tld/notice/ABC123 (Pleroma/Akkoma)</li>
                <li>https://instance.tld/objects/ABC123 (Akkoma)</li>
                <li>https://instance.tld/users/username (Akkoma)</li>
            </ul>
        </p>
        <p class="error">Note: Some instances may have API limitations or require authentication.</p>
    </body>
    </html>
    <?php
}
?>

index.html
--
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fediverse Missing Posts</title>
<style>
  :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  body{margin:16px;background:#f7f7fb;color:#111}
  .container{max-width:880px;margin:0 auto}
  h1{font-size:18px;margin:0 0 12px}
  .row{display:flex;align-items:flex-start;background:#fff;border:1px solid #e3e6ee;padding:12px;border-radius:8px;margin-bottom:12px;box-shadow:0 1px 0 rgba(0,0,0,0.02)}
  .pfp{flex:0 0 48px;height:48px;width:48px;border-radius:50%;overflow:hidden;background:#ddd;margin-right:12px}
  .pfp img{width:100%;height:100%;object-fit:cover;display:block}
  .meta{font-size:14px;margin-bottom:8px;color:#333}
  .meta .username{font-weight:600}
  .meta .missing{color:#b33}
  .content{font-size:14px;color:#222;line-height:1.45}
  a.open{display:inline-block;margin-top:8px;text-decoration:none;padding:6px 10px;border-radius:6px;border:1px solid #cfd6e8;background:#f2f6ff;font-size:13px;color:#123}
  .error{color:#a00;font-weight:600}
</style>
</head>
<body>
<div class="container">
  <h1>Fediverse Missing Posts</h1>
  <div id="list"></div>
</div>

<script>
async function loadItems(){
  const url = "fedimissing.json?cb=" + Date.now();
  const res = await fetch(url, {cache: "no-store"});
  if(!res.ok) throw new Error("Could not load " + url);
  return res.json();
}

function parseYYYYMMDD(yyyymmdd){
  if(typeof yyyymmdd !== 'string' || yyyymmdd.length !== 8) return null;
  const y = Number(yyyymmdd.slice(0,4));
  const m = Number(yyyymmdd.slice(4,6)) - 1;
  const d = Number(yyyymmdd.slice(6,8));
  return new Date(Date.UTC(y,m,d));
}

function daysBetween(dateA, dateB){
  const msPerDay = 24*60*60*1000;
  const a = Date.UTC(dateA.getUTCFullYear(), dateA.getUTCMonth(), dateA.getUTCDate());
  const b = Date.UTC(dateB.getUTCFullYear(), dateB.getUTCMonth(), dateB.getUTCDate());
  return Math.floor((b - a)/msPerDay);
}

function sanitizeHtml(html){
  html = html.replace(/<(script|iframe|object|embed)[^>]*>[\s\S]*?<\/\1>/gi, '');
  html = html.replace(/\son\w+=(?:'[^']*'|"[^"]*"|[^\s>]+)/gi, '');
  html = html.replace(/(href|src)\s*=\s*(['"]?)\s*javascript:[^'">]*\2/gi, '$1="#"');
  return html;
}

async function fetchPostContent(postUrl){
  try {
    const url = new URL(postUrl);
    const pathParts = url.pathname.split('/').filter(Boolean);
    const statusId = pathParts[pathParts.length - 1];
    if(/^\d+$/.test(statusId)){
      const apiUrl = `${url.origin}/api/v1/statuses/${statusId}`;
      const res = await fetch(apiUrl);
      if(res.ok){
        const data = await res.json();
        return { html: sanitizeHtml(data.content || ""), avatar: data.account?.avatar_static || null };
      }
    }
    return null;
  } catch(e){
    return null;
  }
}

async function main(){
  const listEl = document.getElementById('list');
  const items = await loadItems();
  const now = new Date();

  for(const item of items){
    const sinceDate = parseYYYYMMDD(item.date);
    let days = sinceDate ? daysBetween(sinceDate, now) : "?";

    const row = document.createElement("div");
    row.className = "row";

    const pfp = document.createElement("div");
    pfp.className = "pfp";
    row.appendChild(pfp);

    const info = document.createElement("div");
    info.style.flex = "1";
    row.appendChild(info);

    const meta = document.createElement("div");
    meta.className = "meta";
    meta.innerHTML = `<span class="username">${item.username}</span> - <span class="missing">missing since ${days} days</span>`;
    info.appendChild(meta);

    const contentDiv = document.createElement("div");
    contentDiv.className = "content";
    contentDiv.textContent = "Loading post content...";
    info.appendChild(contentDiv);

    const link = document.createElement("a");
    link.href = item.post_url;
    link.textContent = "Open Post";
    link.className = "open";
    link.target = "_blank";
    info.appendChild(link);

    listEl.appendChild(row);

    const result = await fetchPostContent(item.post_url);
    if(result && result.html){
      contentDiv.innerHTML = result.html;
      if(result.avatar){
        const img = document.createElement("img");
        img.src = result.avatar;
        img.alt = item.username;
        pfp.appendChild(img);
      }
    } else {
      contentDiv.innerHTML = `<span class="error">Could not fetch content.</span>`;
    }
  }
}

main().catch(err=>{
  document.getElementById('list').innerHTML = `<div class="error">Error: ${err.message}</div>`;
});
</script>
</body>
</html>


post.php
--
<?php
header('Content-Type: text/plain');

// Get query parameters
$instanceUrl = $_GET['instanceurl'] ?? '';
$apiKey = $_GET['apikey'] ?? '';
$oldPostUrl = $_GET['oldposturl'] ?? '';

// Validate required parameters
if (empty($instanceUrl) || empty($apiKey)) {
    http_response_code(400);
    echo "Error: instanceurl and apikey parameters are required";
    exit;
}

// Load JSON data
$jsonFile = 'fedimissing.json';
if (!file_exists($jsonFile)) {
    http_response_code(404);
    echo "Error: fedimissing.json not found";
    exit;
}

$jsonData = file_get_contents($jsonFile);
$missingPersons = json_decode($jsonData, true);

if ($missingPersons === null) {
    http_response_code(500);
    echo "Error: Invalid JSON format";
    exit;
}

// Generate HTML content
$htmlContent = '<a href="https://alcea-wisteria.de/PHP/0demo/2024-03-07-FediTools/2025-09-10-FediIsMissing/">Missing Fedi person:</a> <a target="_blank" href="https://alcea-wisteria.de/PHP/0demo/2024-03-07-FediTools/2025-09-10-FediIsMissing/updatereport.php" style=color:blue>(update)</a><hr>';

foreach ($missingPersons as $person) {
    $username = htmlspecialchars($person['username']);
    $postUrl = htmlspecialchars($person['post_url']);
    $date = $person['date'];
    
    // Calculate days missing
    $today = new DateTime();
    $missingDate = DateTime::createFromFormat('Ymd', $date);
    
    if ($missingDate) {
        $interval = $today->diff($missingDate);
        $daysMissing = $interval->days;
        $daysText = $daysMissing == 1 ? 'day' : 'days';
    } else {
        $daysMissing = 'unknown';
        $daysText = 'days';
    }
    
    $htmlContent .= "<a href=\"$postUrl\">$username</a> - $daysMissing $daysText missing<br>";
}

// Prepare API request
$apiEndpoint = rtrim($instanceUrl, '/') . '/api/v1/statuses';

$postData = [
    'status' => $htmlContent,
    'content_type' => 'text/html',
    'visibility' => 'public'
];

// Headers for Akkoma API
$headers = [
    'Authorization: Bearer ' . $apiKey,
    'Content-Type: application/json'
];

// Initialize cURL
$ch = curl_init();

if (!empty($oldPostUrl)) {
    // Edit existing post - extract status ID from URL
    $urlParts = parse_url($oldPostUrl);
    $pathParts = explode('/', trim($urlParts['path'], '/'));
    $statusId = end($pathParts);
    
    curl_setopt_array($ch, [
        CURLOPT_URL => $apiEndpoint . '/' . $statusId,
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_CUSTOMREQUEST => 'PUT',
        CURLOPT_POSTFIELDS => json_encode($postData),
        CURLOPT_HTTPHEADER => $headers
    ]);
    
    $action = "editing";
} else {
    // Create new post
    curl_setopt_array($ch, [
        CURLOPT_URL => $apiEndpoint,
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_POST => true,
        CURLOPT_POSTFIELDS => json_encode($postData),
        CURLOPT_HTTPHEADER => $headers
    ]);
    
    $action = "posting";
}

// Execute API request
$response = curl_exec($ch);
$httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);

if (curl_error($ch)) {
    http_response_code(500);
    echo "Error: cURL error - " . curl_error($ch);
    curl_close($ch);
    exit;
}

curl_close($ch);

// Handle response
if ($httpCode >= 200 && $httpCode < 300) {
    $responseData = json_decode($response, true);
    $postUrl = $responseData['url'] ?? $oldPostUrl;
    
    echo "Successfully $action post: " . $postUrl . "\n";
    echo "Generated content:\n\n";
    echo $htmlContent;
} else {
    http_response_code($httpCode);
    echo "Error: API returned status code $httpCode\n";
    echo "Response: " . $response;
}
?>


updatereport.php
--
<?php
// This script checks the JSON file for existing users and updates their newest post date + URL if newer ones exist.

$filename = 'fedimissing.json';

// Ensure file exists
if (!file_exists($filename)) {
    die("JSON file not found: $filename");
}

// Load JSON
$json_content = file_get_contents($filename);
if ($json_content === false) {
    die("Error reading JSON file.");
}

$json_data = json_decode($json_content, true);
if (!is_array($json_data)) {
    die("Invalid JSON format.");
}

// Configure HTTP context
$context = stream_context_create([
    'http' => [
        'timeout' => 15,
        'header' => "User-Agent: FediversePostUpdater/1.0\r\nAccept: application/json\r\n"
    ],
    'ssl' => [
        'verify_peer' => false,
        'verify_peer_name' => false
    ]
]);

// Iterate over all entries
foreach ($json_data as &$entry) {
    $username = $entry['username']; // e.g. @user@domain
    $parts = explode('@', $username);

    if (count($parts) < 3) {
        echo "Skipping invalid username format: $username<br>";
        continue;
    }

    $local_user = $parts[1];
    $domain = $parts[2];

    // Look up account to get ID
    $lookup_urls = [
        "https://$domain/api/v1/accounts/lookup?acct=" . urlencode("$local_user@$domain"),
        "https://$domain/users/" . urlencode($local_user) . ".json",
    ];

    $account_data = null;
    foreach ($lookup_urls as $lookup_url) {
        $response = @file_get_contents($lookup_url, false, $context);
        if ($response !== false) {
            $account_data = json_decode($response, true);
            if ($account_data) break;
        }
    }

    $user_id = null;
    if ($account_data && isset($account_data['id'])) {
        $user_id = $account_data['id'];
    }

    $latest_post_url = null;
    $created_at = null;

    if ($user_id) {
        // Get statuses by user ID
        $statuses_url = "https://$domain/api/v1/accounts/$user_id/statuses?limit=1";
        $response = @file_get_contents($statuses_url, false, $context);
        if ($response !== false) {
            $statuses = json_decode($response, true);
            if (is_array($statuses) && !empty($statuses)) {
                $created_at = $statuses[0]['created_at'];
                if (isset($statuses[0]['url'])) {
                    $latest_post_url = $statuses[0]['url'];
                }
            }
        }
    }

    if (!$created_at) {
        echo "No posts found for $username<br>";
        continue;
    }

    // Format date
    $date = date('Ymd', strtotime($created_at));

    // Only update if date is newer
    if ($date > $entry['date']) {
        $entry['date'] = $date;
        $entry['post_url'] = $latest_post_url;
        echo "Updated $username ‚Üí $date ($latest_post_url)<br>";
    } else {
        echo "No new posts for $username (latest: {$entry['date']})<br>";
    }
}

// Save updated JSON
if (file_put_contents($filename, json_encode($json_data, JSON_PRETTY_PRINT))) {
    echo "<br>JSON file updated successfully.";
} else {
    echo "<br>Error saving JSON file. Check permissions.";
}
?>


Fedi Follow List Creator
----------------

index.html
--
<a target="_blank" href="saveuser.php" style=color:blue>adduser</a><br><hr>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fediverse Posts Browser</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f8fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e1e8ed;
        }
        
        h1 {
            color: #2b90d9;
            margin-bottom: 10px;
        }
        
        .search-container {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
        }
        
        #search {
            padding: 12px 15px;
            width: 100%;
            max-width: 500px;
            border: 1px solid #e1e8ed;
            border-radius: 50px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s;
        }
        
        #search:focus {
            border-color: #2b90d9;
            box-shadow: 0 0 0 2px rgba(43, 144, 217, 0.2);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e1e8ed;
        }
        
        th {
            background-color: #f5f8fa;
            color: #657786;
            font-weight: 600;
        }
        
        tr:hover {
            background-color: #f5f8fa;
        }
        
        .user-cell {
            display: flex;
            align-items: center;
        }
        
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            flex-shrink: 0;
            object-fit: cover;
        }
        
        .user-info {
            display: flex;
            flex-direction: column;
        }
        
        .username {
            font-weight: 600;
            color: #2b90d9;
        }
        
        .domain {
            color: #657786;
            font-size: 0.9rem;
        }
        
        .post-link {
            color: #2b90d9;
            text-decoration: none;
            font-weight: 500;
        }
        
        .post-link:hover {
            text-decoration: underline;
        }
        
        .date {
            color: #657786;
        }
        
        .no-results {
            text-align: center;
            padding: 30px;
            color: #657786;
            font-style: italic;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            color: #657786;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            th:nth-child(3), td:nth-child(3) {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Fediverse Posts Browser</h1>
            <p>Browse recent posts from the Fediverse</p>
        </header>
        
        <div class="search-container">
            <input type="text" id="search" placeholder="Search users, domains, or posts...">
        </div>
        
        <table>
            <thead>
                <tr>
                    <th>User</th>
                    <th>Post URL</th>
                    <th>Date Added</th>
                </tr>
            </thead>
            <tbody id="posts-table">
                <!-- Table content will be generated by JavaScript -->
            </tbody>
        </table>
        
        <footer>
            <p>Data loaded from fediusers.json | Displaying <span id="post-count">0</span> posts</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Fetch JSON data
            fetch('fediusers.json')
                .then(response => response.json())
                .then(data => {
                    displayPosts(data);
                    setupSearch(data);
                })
                .catch(error => {
                    console.error('Error loading JSON data:', error);
                    document.getElementById('posts-table').innerHTML = 
                        '<tr><td colspan="3" class="no-results">Error loading data. Please check if fediusers.json exists.</td></tr>';
                });

            function displayPosts(posts) {
                const tableBody = document.getElementById('posts-table');
                const postCount = document.getElementById('post-count');
                
                if (posts.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="3" class="no-results">No posts found</td></tr>';
                    postCount.textContent = '0';
                    return;
                }
                
                let tableHTML = '';
                
                posts.forEach(post => {
                    const [user, domain] = post.user.split('@');
                    
                    tableHTML += `
                        <tr>
                            <td>
                                <div class="user-cell">
                                    <img src="${post.pfp}" alt="${user}" class="avatar">
                                    <div class="user-info">
                                        <span class="username">${user}</span>
                                        <span class="domain">@${domain}</span>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <a href="https://alcea-wisteria.de/PHP/0demo/2023-08-15-JSFiddle-Clone/htmls/2025-08-24-Find-actual-Fedi-posts.html?url=${post.url}" class="post-link" target="_blank">${post.url}</a>
                            </td>
                            <td class="date">${post.added}</td>
                        </tr>
                    `;
                });
                
                tableBody.innerHTML = tableHTML;
                postCount.textContent = posts.length;
            }

            function setupSearch(posts) {
                const searchInput = document.getElementById('search');
                
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    
                    if (searchTerm === '') {
                        displayPosts(posts);
                        return;
                    }
                    
                    const filteredPosts = posts.filter(post => {
                        return (
                            post.user.toLowerCase().includes(searchTerm) ||
                            post.url.toLowerCase().includes(searchTerm) ||
                            post.added.toLowerCase().includes(searchTerm)
                        );
                    });
                    
                    displayPosts(filteredPosts);
                });
            }
        });
    </script>
</body>
</html>


saveuser.php
--
<?php
// Handle form submission
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['url'])) {
    $url = trim($_POST['url']);
    $result = processFediverseUrl($url);
}

function processFediverseUrl($url) {
    // Parse the URL
    $parsedUrl = parse_url($url);
    if (!$parsedUrl || !isset($parsedUrl['host'])) {
        return ['success' => false, 'message' => 'Invalid URL format'];
    }

    $domain = $parsedUrl['host'];
    $username = null;

    // Check if it's a direct @user@domain style URL (like Mastodon)
    if (preg_match('#/@([^/@]+)(?:@[^/]+)?/(?:posts/)?\d+#', $parsedUrl['path'] ?? '', $matches)) {
        $username = $matches[1];
    } 
    // Check for notice/status IDs (like Pleroma/Akkoma)
    else if (preg_match('#/notice/([^/?]+)#', $parsedUrl['path'] ?? '', $matches)) {
        $statusId = $matches[1];
        $username = resolveUsernameFromNotice($domain, $statusId);
        
        if (!$username) {
            // Prompt for username if resolution fails
            if (isset($_POST['username']) && !empty($_POST['username'])) {
                $username = $_POST['username'];
            } else {
                return [
                    'success' => false, 
                    'needs_username' => true,
                    'url' => $url,
                    'domain' => $domain,
                    'message' => 'Could not resolve username automatically. Please enter it below.'
                ];
            }
        }
    } else {
        return ['success' => false, 'message' => 'URL format not recognized: ' . ($parsedUrl['path'] ?? 'no path')];
    }

    // Try to fetch profile picture
    $pfpUrl = null;
    if (!isset($_POST['pfp_url'])) {
        $pfpUrl = fetchProfilePicture($domain, $username);
    } else if (!empty($_POST['pfp_url'])) {
        $pfpUrl = $_POST['pfp_url'];
    }
    
    // If we couldn't get the pfp URL and it wasn't provided, prompt for it
    if (!$pfpUrl && !isset($_POST['pfp_url'])) {
        return [
            'success' => false, 
            'needs_pfp' => true,
            'url' => $url,
            'domain' => $domain,
            'username' => $username,
            'message' => 'Could not fetch profile picture automatically. Please enter the URL below.'
        ];
    }

    // Save to JSON
    $userIdentifier = "$username@$domain";
    $success = saveToJson($userIdentifier, $url, $pfpUrl);
    
    if ($success) {
        return ['success' => true, 'user' => $userIdentifier, 'url' => $url, 'pfp' => $pfpUrl];
    } else {
        return ['success' => false, 'message' => 'Failed to save to JSON file'];
    }
}

function resolveUsernameFromNotice($domain, $statusId) {
    // Try to fetch the status information using ActivityPub or Mastodon API
    $apiUrl = "https://$domain/api/v1/statuses/$statusId";
    
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $apiUrl);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_TIMEOUT, 5);
    curl_setopt($ch, CURLOPT_USERAGENT, 'Fediverse-User-Resolver/1.0');
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
    
    $response = curl_exec($ch);
    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    curl_close($ch);
    
    if ($httpCode === 200 && $response) {
        $data = json_decode($response, true);
        if (isset($data['account']['acct'])) {
            return $data['account']['acct'];
        }
        if (isset($data['account']['username'])) {
            return $data['account']['username'];
        }
    }
    
    return null;
}

function fetchProfilePicture($domain, $username) {
    // Try to fetch user information using Mastodon API
    $apiUrl = "https://$domain/api/v1/accounts/lookup?acct=$username";
    
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $apiUrl);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_TIMEOUT, 5);
    curl_setopt($ch, CURLOPT_USERAGENT, 'Fediverse-User-Resolver/1.0');
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
    
    $response = curl_exec($ch);
    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    curl_close($ch);
    
    if ($httpCode === 200 && $response) {
        $data = json_decode($response, true);
        if (isset($data['avatar'])) {
            return $data['avatar'];
        }
    }
    
    return null;
}

function saveToJson($userIdentifier, $url, $pfpUrl) {
    $filename = 'fediusers.json';
    $data = [];
    
    // Read existing data if file exists
    if (file_exists($filename)) {
        $existingData = file_get_contents($filename);
        if ($existingData) {
            $data = json_decode($existingData, true) ?: [];
        }
    }
    
    // Check if this user already exists
    $exists = false;
    foreach ($data as $entry) {
        if ($entry['user'] === $userIdentifier) {
            $exists = true;
            break;
        }
    }
    
    // Add new entry if it doesn't exist
    if (!$exists) {
        $data[] = [
            'user' => $userIdentifier,
            'url' => $url,
            'pfp' => $pfpUrl,
            'added' => date('Y-m-d H:i:s')
        ];
        
        // Write back to file
        $json = json_encode($data, JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES);
        return file_put_contents($filename, $json) !== false;
    }
    
    return true; // Already exists, consider it a success
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fediverse User Saver</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        input[type="text"], input[type="url"] { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .alert { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .pfp-preview { max-width: 100px; max-height: 100px; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>Fediverse User Saver</h1>
    
    <?php if (isset($result)): ?>
        <?php if ($result['success']): ?>
            <div class="alert success">
                Successfully saved: <?php echo htmlspecialchars($result['user']); ?>
                <?php if (!empty($result['pfp'])): ?>
                    <div><img src="<?php echo htmlspecialchars($result['pfp']); ?>" alt="Profile picture" class="pfp-preview"></div>
                <?php endif; ?>
            </div>
        <?php elseif (isset($result['needs_username']) && $result['needs_username']): ?>
            <div class="alert info">
                <?php echo htmlspecialchars($result['message']); ?>
            </div>
            <form method="POST">
                <input type="hidden" name="url" value="<?php echo htmlspecialchars($result['url']); ?>">
                <div class="form-group">
                    <label for="username">Username:</label>
                    <input type="text" id="username" name="username" required 
                           placeholder="Enter username (without @domain)">
                </div>
                <button type="submit">Save User</button>
            </form>
        <?php elseif (isset($result['needs_pfp']) && $result['needs_pfp']): ?>
            <div class="alert info">
                <?php echo htmlspecialchars($result['message']); ?>
            </div>
            <form method="POST">
                <input type="hidden" name="url" value="<?php echo htmlspecialchars($result['url']); ?>">
                <input type="hidden" name="username" value="<?php echo htmlspecialchars($result['username']); ?>">
                <div class="form-group">
                    <label for="pfp_url">Profile Picture URL:</label>
                    <input type="url" id="pfp_url" name="pfp_url" 
                           placeholder="https://example.com/profile-picture.jpg">
                </div>
                <button type="submit">Save User</button>
            </form>
        <?php else: ?>
            <div class="alert error">
                Error: <?php echo htmlspecialchars($result['message']); ?>
            </div>
        <?php endif; ?>
    <?php endif; ?>
    
    <form method="POST">
        <div class="form-group">
            <label for="url">Fediverse Post URL:</label>
            <input type="url" id="url" name="url" required 
                   placeholder="https://mastodon.example/@user/123456 or https://instance.example/notice/ABC123"
                   value="<?php echo isset($_POST['url']) ? htmlspecialchars($_POST['url']) : ''; ?>">
        </div>
        <button type="submit">Process URL</button>
    </form>
    
    <p>Supported formats:</p>
    <ul>
        <li>Mastodon: https://mastodon.example/@username/123456789</li>
        <li>Pleroma/Akkoma: https://instance.example/notice/ABC123DEF456</li>
    </ul>
</body>
</html>

fediusers.json
--
[
    {
        "user": "alcea@alceawis.com",
        "url": "https://alceawis.com/notice/AxWUaYZukUOVrhcSrQ",
        "pfp": "https://alceawis.com/uploads/7ec207e13c920294e202c8007828db61de0e0e72fa3dd8f0dc6e94783d38a4c5.png",
        "added": "2025-08-25 09:17:58"
    },
    {
        "user": "Samb@mastodon.gamedev.place",
        "url": "https://mastodon.gamedev.place/@Samb/112933762886991797",
        "pfp": "https://cdn.masto.host/mastodongamedevplace/accounts/avatars/109/270/815/057/921/135/original/8e1fecc5ec4ed0c6.jpg",
        "added": "2025-08-25 09:18:09"
    },
    {
        "user": "dr_muesli@woof.tech",
        "url": "https://woof.tech/@dr_muesli/115056046900787616",
        "pfp": "https://cdn.woof.tech/accounts/avatars/113/820/856/641/199/543/original/f17907d049782ede.png",
        "added": "2025-08-25 09:18:15"
    }
]


EmojiShorthandDownloader (Zip & single dld)
----------------------

<button id="save-list-btn" style="margin-top: 10px;">üíæ Save Emoji List</button>

<script>
document.getElementById('save-list-btn').addEventListener('click', function () {
    const instanceInput = document.getElementById('instance');
    const domain = instanceInput ? instanceInput.value.trim() : 'emojis';

    if (!domain) {
        alert("Please enter a valid instance domain first.");
        return;
    }

    // Get all emojis in the grid
    const emojis = document.querySelectorAll('.emoji-item');

    if (!emojis.length) {
        alert("No emojis found to save.");
        return;
    }

    let lines = [];

    emojis.forEach(emojiItem => {
        const shortcodeElem = emojiItem.querySelector('small');
        const imgElem = emojiItem.querySelector('img');

        if (shortcodeElem && imgElem) {
            const shortcode = shortcodeElem.textContent.replace(/:/g, '').trim();
            const url = imgElem.getAttribute('src');
            lines.push(`${shortcode} ${url}`);
        }
    });

    const blob = new Blob([lines.join('\n')], { type: 'text/plain' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `${domain}.txt`;
    a.style.display = 'none';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
});
</script>
<?php
// Enable error reporting for debugging
ini_set('display_errors', 1);
error_reporting(E_ALL);

// Function to fetch content via cURL
function fetch_via_curl($url) {
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
    curl_setopt($ch, CURLOPT_USERAGENT, 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36');
    $output = curl_exec($ch);
    curl_close($ch);
    return $output;
}

// Function to fetch emojis from the given instance URL
function fetch_emojis($instance) {
    // Try fetching from Emojos API
    $url = "https://emojos.in/$instance";
    $html = fetch_via_curl($url);

    // If the first request fails, try fetching from the Mastodon-compatible endpoint
    if (!$html) {
        $url = "https://$instance/api/v1/custom_emojis";
        $html = fetch_via_curl($url);
        
        // If it's JSON (Mastodon API), parse it
        if ($html && ($data = json_decode($html, true))) {
            $emojis = [];
            foreach ($data as $emoji) {
                $emojis[] = [
                    'url' => $emoji['url'],
                    'shortcode' => $emoji['shortcode']
                ];
            }
            return $emojis;
        }
    }

    // If still no content, return null
    if (!$html) {
        return null;
    }

    // Use DOMDocument to parse the HTML and extract emoji data
    $dom = new DOMDocument();
    @$dom->loadHTML($html);

    $emojis = [];
    $emojiElements = $dom->getElementsByTagName('div');

    foreach ($emojiElements as $element) {
        $imgElement = $element->getElementsByTagName('img');
        $ddElement = $element->getElementsByTagName('dd');

        // Check if we have the necessary elements
        if ($imgElement->length > 0 && $ddElement->length > 0) {
            $url = $imgElement->item(0)->getAttribute('src');
            $shortcode = trim($ddElement->item(0)->nodeValue);

            $emojis[] = ['url' => $url, 'shortcode' => $shortcode];
        }
    }

    return $emojis;
}

// Function to download and cache emoji
function cache_emoji($url, $shortcode) {
    $extension = pathinfo(parse_url($url, PHP_URL_PATH), PATHINFO_EXTENSION);
    if (empty($extension)) {
        $extension = 'png'; // default extension
    }
    
    $filename = preg_replace('/[^a-zA-Z0-9_-]/', '', $shortcode) . '.' . $extension;
    $cache_dir = __DIR__ . '/emoji_cache/';
    
    if (!file_exists($cache_dir)) {
        mkdir($cache_dir, 0755, true);
    }
    
    $cache_path = $cache_dir . $filename;
    
    // If not cached or cache is older than 1 day
    if (!file_exists($cache_path) || (time() - filemtime($cache_path) > 86400)) {
        $image_data = fetch_via_curl($url);
        if ($image_data) {
            file_put_contents($cache_path, $image_data);
        }
    }
    
    if (file_exists($cache_path)) {
        return [
            'path' => $cache_path,
            'filename' => $filename,
            'mime' => mime_content_type($cache_path)
        ];
    }
    
    return false;
}

$filtered = [];
$error = '';
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Handle emoji download
    if (isset($_POST['download_single'])) {
        $url = $_POST['url'];
        $shortcode = $_POST['shortcode'];
        
        $cached = cache_emoji($url, $shortcode);
        if ($cached) {
            header('Content-Type: ' . $cached['mime']);
            header('Content-Disposition: attachment; filename="' . $cached['filename'] . '"');
            readfile($cached['path']);
            exit;
        } else {
            header("HTTP/1.0 404 Not Found");
            echo "Failed to download emoji";
            exit;
        }
    }
    
    // Handle ZIP download
    if (isset($_POST['download_all'])) {
        $instance = $_POST['instance'];
        $keyword = $_POST['keyword'];
        
        // Fetch emojis again to ensure we have fresh data
        $emojis = fetch_emojis($instance);
        if ($emojis !== null) {
            $filtered = [];
            foreach ($emojis as $emoji) {
                if (empty($keyword) || stripos($emoji['shortcode'], $keyword) !== false) {
                    $filtered[] = $emoji;
                }
            }
        }
        
        if (!empty($filtered)) {
            $zip = new ZipArchive();
            $zip_filename = 'emojis_' . time() . '.zip';
            $zip_path = sys_get_temp_dir() . '/' . $zip_filename;
            
            if ($zip->open($zip_path, ZipArchive::CREATE) === TRUE) {
                foreach ($filtered as $emoji) {
                    $cached = cache_emoji($emoji['url'], $emoji['shortcode']);
                    if ($cached) {
                        $zip->addFile($cached['path'], $cached['filename']);
                    }
                }
                $zip->close();
                
                header('Content-Type: application/zip');
                header('Content-Disposition: attachment; filename="' . $zip_filename . '"');
                header('Content-Length: ' . filesize($zip_path));
                readfile($zip_path);
                unlink($zip_path);
                exit;
            }
        }
        
        header("HTTP/1.0 404 Not Found");
        echo "Failed to create ZIP file";
        exit;
    }

    // Handle the form submission for searching
    $instance = isset($_POST['instance']) ? trim($_POST['instance']) : '';
    $keyword = isset($_POST['keyword']) ? trim($_POST['keyword']) : '';

    if (empty($instance)) {
        $error = "Instance URL is required.";
    } else {
        // Fetch emojis from the instance URL
        $emojis = fetch_emojis($instance);
        if ($emojis === null) {
            $error = "Failed to fetch from $instance";
        } else {
            // Filter emojis by keyword
            foreach ($emojis as $emoji) {
                if (empty($keyword) || stripos($emoji['shortcode'], $keyword) !== false) {
                    $filtered[] = $emoji;
                }
            }
        }
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji Fetcher</title>
    <style>
        .download-link {
            cursor: pointer;
            color: blue;
            text-decoration: underline;
        }
        .download-link:hover {
            color: darkblue;
        }
        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .emoji-item {
            text-align: center;
        }
        .download-form {
            display: inline;
        }
    </style>
</head>
<body>

<h2>Emoji Fetcher</h2>

<!-- Display errors if any -->
<?php if ($error): ?>
    <p style="color: red;"><?= htmlspecialchars($error) ?></p>
<?php endif; ?>

<!-- Form to get instance URL and keyword -->
<form method="POST">
    <label for="instance">Instance URL (e.g. blahaj.zone):</label><br>
    <input type="text" name="instance" id="instance" required value="<?= isset($_POST['instance']) ? htmlspecialchars($_POST['instance']) : '' ?>"><br><br>

    <label for="keyword">Keyword:</label><br>
    <input type="text" name="keyword" id="keyword" value="<?= isset($_POST['keyword']) ? htmlspecialchars($_POST['keyword']) : '' ?>"><br><br>

    <button type="submit">Submit</button>
</form>

<?php if ($_SERVER['REQUEST_METHOD'] === 'POST' && $filtered): ?>
    <h3>Matched Emojis (<?= count($filtered) ?>)</h3>
    
    <form method="POST" class="download-form">
        <input type="hidden" name="download_all" value="1">
        <input type="hidden" name="instance" value="<?= htmlspecialchars($_POST['instance']) ?>">
        <input type="hidden" name="keyword" value="<?= htmlspecialchars($_POST['keyword']) ?>">
        <button type="submit" style="margin-bottom: 15px; padding: 8px 15px; background: #4CAF50; color: white; text-decoration: none; border-radius: 4px; border: none; cursor: pointer;">
            Download All as ZIP
        </button>
    </form>
    
    <div class="emoji-grid">
        <?php foreach ($filtered as $emoji): ?>
            <div class="emoji-item">
                <img src="<?= htmlspecialchars($emoji['url']) ?>" alt="<?= htmlspecialchars($emoji['shortcode']) ?>" width="64" height="64"><br>
                <small>:<?= htmlspecialchars($emoji['shortcode']) ?>:</small><br>
                <form method="POST" class="download-form">
                    <input type="hidden" name="download_single" value="1">
                    <input type="hidden" name="url" value="<?= htmlspecialchars($emoji['url']) ?>">
                    <input type="hidden" name="shortcode" value="<?= htmlspecialchars($emoji['shortcode']) ?>">
                    <button type="submit" style="background: none; border: none; color: blue; text-decoration: underline; cursor: pointer;">
                        Download
                    </button>
                </form>
            </div>
        <?php endforeach; ?>
    </div>
<?php endif; ?>

</body>
</html>


Pixiv fetch user artwork stats (via api)
---------------------

singlefetch.php
--
<?php
// Default URL base
$defaultBaseUrl = "https://www.pixiv.net/artworks/";

// Get ?url= parameter if exists
$inputUrl = $_GET['url'] ?? null;
$artworkId = null;

// Extract artwork ID (number at end) from given URL or fallback
if ($inputUrl) {
    if (preg_match('#/(\d+)(?:[/?]|$)#', $inputUrl, $matches)) {
        $artworkId = $matches[1];
    }
}

// Fallback to default artwork if no ID found
$artworkId = $artworkId ?? "127908186";

/**
 * Fetch Pixiv Artwork Data via API
 */
function fetchPixivData($illust_id) {
    $apiUrl = "https://www.pixiv.net/ajax/illust/{$illust_id}";
    
    $ch = curl_init();
    curl_setopt_array($ch, [
        CURLOPT_URL            => $apiUrl,
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_HTTPHEADER     => [
            'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36',
            'Referer: https://www.pixiv.net/',
            // Uncomment if accessing private/NSFW works (replace XXX with your PHPSESSID):
            // 'Cookie: PHPSESSID=XXX;',
        ],
        CURLOPT_ENCODING       => 'gzip',
        CURLOPT_SSL_VERIFYPEER => false, // Disable if SSL issues occur
    ]);
    
    $response = curl_exec($ch);
    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    curl_close($ch);
    
    if ($httpCode !== 200) {
        return ['error' => true, 'message' => "HTTP {$httpCode} - API request failed"];
    }
    
    return json_decode($response, true);
}

// Fetch artwork data
$artworkData = fetchPixivData($artworkId);

// Handle errors
if (isset($artworkData['error']) && $artworkData['error']) {
    die("Error: " . ($artworkData['message'] ?? 'Failed to fetch artwork'));
}

// Extract data
$title = $artworkData['body']['title'] ?? 'No Title';
$imageUrl = $artworkData['body']['urls']['original'] ?? $artworkData['body']['urls']['regular'] ?? null;
$views = $artworkData['body']['viewCount'] ?? 0;
$bookmarks = $artworkData['body']['bookmarkCount'] ?? 0;
$likes = $artworkData['body']['likeCount'] ?? 0;
$comments = $artworkData['body']['commentCount'] ?? 0;
$artworkUrl = $defaultBaseUrl . $artworkId;
echo '<br><a href="' . htmlspecialchars($artworkUrl) . '" target="_blank">' 
     . htmlspecialchars($title) . '</a> ';

if ($imageUrl) {
    $proxyImageUrl = "https://i.pixiv.re/" . basename($imageUrl);
    echo '<a href="' . htmlspecialchars($imageUrl) . '" target="_blank">'
         . '<img src="' . htmlspecialchars($proxyImageUrl) . '" alt="preview" style="height:20px;"></a> ';
}

echo sprintf(
    'Views: %s | Bookmarks: %s | Likes: %s | Comments: %s',
    htmlspecialchars($views),
    htmlspecialchars($bookmarks),
    htmlspecialchars($likes),
    htmlspecialchars($comments)
);
?>


fetchfive.php
--
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Fix perennialte.ch links
  document.querySelectorAll('a[href^="https://pixiv.perennialte.ch"]').forEach(link => {
    link.href = link.href.replace("https://pixiv.perennialte.ch", "https://pixiv.net");
  });
});
</script>

<?php
// User navigation (optional, can be customized)
echo '<a href="?userId=115969453" style="color:blue">Cea</a> ';
echo '<a target="_blank" href="?userId=75406576" style="color:blue">Alcea</a>';
echo '<a target="_blank" href="https://pixivfe-docs.pages.dev/instance-list/#clearnet" style="color:gray">PixivFE instances</a><hr>';

/**
 * Gets the latest 5 artwork IDs from Pixiv user profile
 */
function getPixivArtworkIds($userId, $limit = 5) {
    $apiUrl = "https://www.pixiv.net/ajax/user/{$userId}/profile/all";
    
    $context = stream_context_create([
        'http' => [
            'header' => "User-Agent: Mozilla/5.0\r\nReferer: https://www.pixiv.net/"
        ],
        'ssl' => [
            'verify_peer' => false
        ]
    ]);
    
    $response = @file_get_contents($apiUrl, false, $context);
    if (!$response) return [];
    
    $data = json_decode($response, true);
    if (empty($data['body']['illusts'])) return [];
    
    // Get the most recent artwork IDs
    $artworkIds = array_keys($data['body']['illusts']);
    
    return array_slice($artworkIds, 0, $limit);
}

// Configuration: Default userId to Alcea's if not specified
$userId = $_GET['userId'] ?? '75406576';  // Default: Alcea

// Get the latest 5 artwork IDs
$artworkIds = getPixivArtworkIds($userId, 5);

// Loop through artwork IDs and fetch their data via the custom URL
foreach ($artworkIds as $artworkId) {
    // Generate the full URL to fetch the artwork
    $singlefetchUrl = "https://alceawis.de/other/extra/fetchdata/singlefetch.php?url=" . urlencode("https://www.pixiv.net/artworks/{$artworkId}");
    
    // Fetch the output from the generated URL
    $output = @file_get_contents($singlefetchUrl, false, stream_context_create([
        'http' => ['timeout' => 5]
    ]));
    
    // Display the result or an error message if loading failed
    echo $output ?: "Failed to load artwork: {$artworkId}<br>";
}
?>



Pixiv image gallery
------------------

<?php
function getPixivUserArt($userId, $random, $page = 1) {
    $apiUrl = "https://www.pixiv.net/ajax/user/{$userId}/profile/all?useid={$userId}";

    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $apiUrl);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_HEADER, false);
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
    curl_setopt($ch, CURLOPT_HTTPHEADER, array(
        'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36',
        'Referer: https://www.pixiv.net/'
    ));

    $response = curl_exec($ch);
    curl_close($ch);
    $data = json_decode($response, true);

    if (isset($data['body']['illusts'])) {
        $artworkIds = array_keys($data['body']['illusts']);
        $totalArtworks = count($artworkIds);
        $itemsPerPage = 5;
        $totalPages = ceil($totalArtworks / $itemsPerPage);
        $page = max(1, min($page, $totalPages));
        
        // Calculate start and end positions for current page
        $start = ($page - 1) * $itemsPerPage;
        $currentArtworkIds = array_slice($artworkIds, $start, $itemsPerPage);
        
        // Display navigation buttons
        echo "<div class='navigation' style='text-align: center; margin: 20px 0;'>";
        if ($page > 1) {
            echo "<button onclick='loadPage(".($page - 1).")' style='margin: 0 10px;'>&lt;&lt; Previous</button>";
        }
        echo "<span>Page {$page} of {$totalPages}</span>";
        if ($page < $totalPages) {
            echo "<button onclick='loadPage(".($page + 1).")' style='margin: 0 10px;'>Next &gt;&gt;</button>";
        }
        echo "</div>";
        
        // Start container for inline artworks
        echo "<div class='artworks-container' style='white-space: nowrap; text-align: center; margin: 0 auto; max-width: 100%; overflow: hidden;'>";
        
        // Display current batch of artworks in one line
        foreach ($currentArtworkIds as $artId) {
            $artLink = "https://www.pixiv.net/artworks/{$artId}";
            $artImageUrl = "https://embed.pixiv.net/artwork.php?illust_id={$artId}";
            
            // Fetch details only for the current artwork
            $html = @file_get_contents($artLink);
            $artTitle = "Untitled";
            
            if ($html !== false) {
                $dom = new DOMDocument();
                @$dom->loadHTML($html);
                $titleTag = $dom->getElementsByTagName('title')->item(0);
                $artTitle = $titleTag ? $titleTag->textContent : "Untitled";
                $artTitle = rtrim($artTitle, ' - pixiv');
            }
            
            echo "<div class='artwork-item' style='display: inline-block; width: 20%; min-width: 180px; margin: 0; padding: 5px; box-sizing: border-box; vertical-align: top;'>";
            $safeTitle = htmlspecialchars(addslashes($artTitle), ENT_QUOTES);
$safeImageUrl = htmlspecialchars($artImageUrl, ENT_QUOTES);
echo "<img src='{$safeImageUrl}' alt='{$safeTitle}' title='{$safeTitle}' style='max-width: 100%; width: 100%; height: auto; cursor: pointer; border: 1px solid #eee;' onclick='openModal(\"{$safeImageUrl}\", \"{$safeTitle}\")'>";
            echo "<div class='artwork-title' style='white-space: normal; word-wrap: break-word; font-size: 12px; margin-top: 5px; height: 40px; overflow: hidden;'>";
            echo "<a href='{$artLink}' target='_blank' style='text-decoration: none; color: #0066cc;'>{$artTitle}</a>";
            echo "</div>";
            echo "</div>";
        }
        
        echo "</div>"; // Close artworks-container
        
        // Display navigation buttons again at bottom
        echo "<div class='navigation' style='text-align: center; margin: 20px 0;'>";
        if ($page > 1) {
            echo "<button onclick='loadPage(".($page - 1).")' style='margin: 0 10px;'>&lt;&lt; Previous</button>";
        }
        echo "<span>Page {$page} of {$totalPages}</span>";
        if ($page < $totalPages) {
            echo "<button onclick='loadPage(".($page + 1).")' style='margin: 0 10px;'>Next &gt;&gt;</button>";
        }
        echo "</div>";
        
        // Display total count
        echo "<div id='linkCount' style='text-align: center;'>Total artworks: {$totalArtworks}</div>";
        
        // Display all links in details section
        echo "<details style='margin: 20px; text-align: center;'>";
        echo "<summary style='cursor: pointer;'>Click to view all artwork links</summary>";
        echo "<pre style='white-space: pre-wrap; text-align: left; background: #f5f5f5; padding: 10px; border-radius: 5px;'>";
        foreach ($artworkIds as $artId) {
            echo "https://www.pixiv.net/artworks/{$artId}\n";
        }
        echo "</pre>";
        echo "</details>";
    } else {
        echo "<div style='text-align: center;'>No artworks found for the given user.</div>";
    }
}

// Get parameters from URL
$userId = isset($_GET['userId']) ? $_GET['userId'] : '75406576'; // Default user ID
$random = isset($_GET['random']);
$page = isset($_GET['page']) ? intval($_GET['page']) : 1;

// Add user ID input form
echo '<div style="margin: 20px; text-align: center;">';
echo '<form method="get" action="">';
echo 'Pixiv User ID: <input type="text" name="userId" value="'.$userId.'" placeholder="Enter Pixiv User ID" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">';
echo '<input type="submit" value="Load Artworks" style="padding: 8px 16px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">';
echo '<input type="hidden" name="page" value="1">';
echo '</form>';
echo '</div>';

// Display artworks
getPixivUserArt($userId, $random, $page);
?>

<!-- Modal Structure -->
<div id="myModal" class="modal">
    <span class="close" onclick="closeModal()">&times;</span>
    <img class="modal-content" id="modalImg">
    <div id="imgTitle" style="color: white; text-align: center; padding: 10px;"></div>
</div>

<script>
// Function to load a specific page
function loadPage(page) {
    const urlParams = new URLSearchParams(window.location.search);
    urlParams.set('page', page);
    window.location.search = urlParams.toString();
}

// Function to open modal with image and title
function openModal(imageUrl, title) {
    document.getElementById("modalImg").src = imageUrl;
    document.getElementById("imgTitle").innerText = title;
    document.getElementById("myModal").style.display = "block";
}

// Function to close the modal
function closeModal() {
    document.getElementById("myModal").style.display = "none";
}

// Close modal when clicking outside
window.onclick = function(event) {
    if (event.target == document.getElementById("myModal")) {
        closeModal();
    }
}
</script>

<style>
/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255,255,255,0.9); 
}

.modal-content {
    display: block;
    margin: 5% auto;
    max-width: 80%;
    max-height: 80%;
    background-color: white; 
}

.close {
    position: absolute;
    top: 20px;
    right: 35px;
    color: white;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
}

/* Navigation buttons */
.navigation button {
    padding: 8px 16px;
    background-color: #f0f0f0;
    border: 1px solid #ddd;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.navigation button:hover {
    background-color: #e0e0e0;
}

.navigation span {
    margin: 0 15px;
    font-weight: bold;
}

/* Artwork items */
.artwork-item {
    transition: transform 0.2s;
}

.artwork-item:hover {
    transform: scale(1.02);
}

.artwork-title a:hover {
    text-decoration: underline;
}
</style>

Uptime Checker
--------------------

check.php
--

<?php
$domains = [
    'alceawis.de' => ['mode' => 'response_code'],
    'alceawis.com' => ['mode' => 'file_check'],
    'alcea-wisteria.de' => ['mode' => 'response_code']
];

// cURL request with timeout and response code check
function curlGetResponseCode($url, $timeout = 30) {
    $ch = curl_init($url);
    curl_setopt_array($ch, [
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_HEADER => true,
        CURLOPT_NOBODY => true,
        CURLOPT_TIMEOUT => $timeout,
        CURLOPT_SSL_VERIFYPEER => false,
        CURLOPT_SSL_VERIFYHOST => false,
    ]);

    curl_exec($ch);
    $responseCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    $error       = curl_errno($ch);
    curl_close($ch);

    // Timeout or other error? Treat as 404
    if ($error) {
        return 404;
    }

    return $responseCode ?: 404;
}

function checkFileExistence($url, $filename) {
    $fullUrl = $url . '/' . $filename;
    $responseCode = curlGetResponseCode($fullUrl, 30);
    return $responseCode === 200;
}

foreach ($domains as $domain => $config) {
    $date = date('Y-m-d H:i:s');
    $mode = $config['mode'];
    $responseData = [
        'date' => $date,
        'mode' => $mode,
        'domainname' => $domain,
        'response_code' => 0
    ];

    if ($mode === 'file_check') {
        $exists = checkFileExistence("https://$domain", 'favicon.png') ||
                  checkFileExistence("https://$domain", 'index.html');
        $responseData['response_code'] = $exists ? 200 : 404;
    }

    if ($mode === 'response_code') {
        $responseData['response_code'] = curlGetResponseCode("https://$domain", 30);
    }

    $filename = "$domain.json";
    $existingData = [];

    if (file_exists($filename)) {
        $json = file_get_contents($filename);
        $decoded = json_decode($json, true);
        if (is_array($decoded) && array_keys($decoded) === range(0, count($decoded) - 1)) {
            $existingData = $decoded;
        }
    }

    $existingData[] = $responseData;
    file_put_contents($filename, json_encode($existingData, JSON_PRETTY_PRINT));
    echo "Test result for $domain saved/updated in $filename\n";
}
?>


status.html
--
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Domain Uptime Monitor</title>
<style>
  body {
    font-family: sans-serif;
    background: #f8f9fa;
    margin: 2rem;
  }
  h1 {
    text-align: center;
    color: #28a745;
  }
  .service {
    background: white;
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    box-shadow: 0 0 8px rgba(0,0,0,0.05);
  }
  .service-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }
  .service-name {
    font-size: 1.2rem;
    font-weight: bold;
  }
  .status {
    font-weight: bold;
    padding: 0.2rem 0.6rem;
    border-radius: 4px;
  }
  .status.up { color: #28a745; }
  .status.down { color: #dc3545; }
  .bar {
    display: flex;
    flex-wrap: wrap;
    gap: 2px;
  }
  .bar-block {
    width: 10px;
    height: 20px;
    border-radius: 2px;
    background: #ccc;
    cursor: pointer;
  }
  .bar-block.up { background: #28a745; }
  .bar-block.down { background: #dc3545; }
  .uptime {
    margin-top: 0.5rem;
    font-size: 0.9rem;
    color: #333;
  }
  .popup {
    position: absolute;
    background: white;
    border: 1px solid #ccc;
    padding: 0.5rem;
    border-radius: 4px;
    font-size: 0.85rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    display: none;
    z-index: 1000;
  }
</style>
</head>
<body>
<h1><u>Domain Uptime </u>"<a target="_blank" href="https://alceawis.de/other/extra/scripts/fakesocialmedia/commentload.html?number=5000&text=When you don%27t want to ge"  style=color:#28a745>Monitor</a>" <a href="http://127.0.0.1:8080/2025-08-04-UptimeCheck/sync.php" target="_blank" style=color:lightgrey>Sync</a>
</h1>
<div id="container"></div>
<div id="popup" class="popup"></div>
<script>
    const domainFiles = [
      'alceawis.de.json',
      'alceawis.com.json',
      'alcea-wisteria.de.json'
    ];

    function statusLabel(code) {
      return code === 200 ? 'UP' : 'DOWN';
    }

    function getStatusClass(code) {
      return code === 200 ? 'up' : 'down';
    }

    function getDateOnly(datetime) {
      return datetime.split(' ')[0];
    }

    // Unique per day (latest per day kept)
    function filterUniquePerDay(entries) {
      const map = new Map();
      for (let entry of [...entries].reverse()) {
        const day = getDateOnly(entry.date);
        if (!map.has(day)) {
          map.set(day, entry);
        }
      }
      return Array.from(map.values()).reverse(); // Oldest to newest
    }

    async function loadDomainData(filename) {
      try {
        const res = await fetch(filename, {
          headers: {
            'Cache-Control': 'no-store', // Prevent caching of the request
          }
        });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        return Array.isArray(data) ? data : [];
      } catch(err) {
        console.error(`Error loading ${filename}:`, err);
        return [];
      }
    }

    function renderService(domain, entries) {
      const filtered = filterUniquePerDay(entries); // Unique daily entries
      const upCount = filtered.filter(e => e.response_code === 200).length;
      const total = filtered.length;
      const uptimePercent = total ? ((upCount / total) * 100).toFixed(3) : '0.000';
      const status = upCount === total ? 'Operational' : 'Issues';
      const statusClass = upCount === total ? 'up' : 'down';

      const service = document.createElement('div');
      service.className = 'service';
      service.innerHTML = `
        <div class="service-header">
          <div class="service-name">${domain}</div>
          <div class="status ${statusClass}">${status} (${uptimePercent}%)</div>
        </div>
        <div class="bar"></div>
        <div class="uptime">${total} day(s) monitored</div>
      `;

      const bar = service.querySelector('.bar');

      const recentEntries = filtered.slice(-80).reverse(); // last 80, newest first
      recentEntries.forEach(e => {
        const block = document.createElement('div');
        block.className = `bar-block ${getStatusClass(e.response_code)}`;
        block.title = `${e.date}: ${statusLabel(e.response_code)}`;
        block.dataset.details = JSON.stringify(e);
        block.addEventListener('click', (evt) => {
          showPopup(evt, e);
        });
        bar.appendChild(block);
      });

      document.getElementById('container').appendChild(service);
    }

    function showPopup(evt, entry) {
      const popup = document.getElementById('popup');
      popup.innerHTML = `
        <strong>${entry.domainname}</strong><br/>
        Date: ${entry.date}<br/>
        Response Code: ${entry.response_code}<br/>
        Status: ${statusLabel(entry.response_code)}<br/>
        Mode: ${entry.mode}
      `;
      popup.style.display = 'block';
      popup.style.left = evt.pageX + 10 + 'px';
      popup.style.top = evt.pageY + 10 + 'px';
    }

    document.addEventListener('click', e => {
      if (!e.target.classList.contains('bar-block')) {
        document.getElementById('popup').style.display = 'none';
      }
    });

    async function init() {
      for (const file of domainFiles) {
        const data = await loadDomainData(file);
        if (data.length) {
          const domain = file.replace('.json','');
          renderService(domain, data);
        }
      }
    }

    init();
</script>
</body>
</html>


sync.php
--

<?php

// Array containing server details
$servers = [
    [
        'host' => 'ftp.alcea-wisteria.de',
        'user' => 'add@alcea-wisteria.de',
        'pass' => '', // Replace with actual password
        'remoteDir' => 'PHP/0demo/2025-08-04-UptimeCheck',
        'localDir' => '/storage/emulated/0/pws/www/2025-08-04-UptimeCheck',
        'successMessage' => 'Successfully uploaded to alcea-wisteria.de'
    ],
    [
        'host' => 'ftp.alceawis.de',
        'user' => 'add@alceawis.de',
        'pass' => '', // Replace with actual password
        'remoteDir' => 'alceawis.de/other/extra/fetchdata/2025-08-04-UptimeCheck',
        'localDir' => '/storage/emulated/0/pws/www/2025-08-04-UptimeCheck',
        'successMessage' => 'Successfully uploaded to alceawis.de'
    ]
];

// Files to be uploaded
$files = [
    'alceawis.com.json',
    'alceawis.de.json',
    'alcea-wisteria.de.json'
];

foreach ($servers as $server) {
    foreach ($files as $file) {
        $localFile = "{$server['localDir']}/$file";
        $remoteFile = "{$server['remoteDir']}/$file";

        // Check if local file exists
        if (!file_exists($localFile)) {
            echo "Local file not found: $localFile\n";
            continue;
        }

        // Open local file
        $fp = fopen($localFile, 'r');
        if (!$fp) {
            echo "Failed to open local file: $localFile\n";
            continue;
        }

        // Initialize cURL session
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, "ftp://{$server['host']}/$remoteFile");
        curl_setopt($ch, CURLOPT_USERPWD, "{$server['user']}:{$server['pass']}");
        curl_setopt($ch, CURLOPT_UPLOAD, true);
        curl_setopt($ch, CURLOPT_INFILE, $fp);
        curl_setopt($ch, CURLOPT_INFILESIZE, filesize($localFile));
        curl_setopt($ch, CURLOPT_VERBOSE, true); // Optional: shows transfer details

        // Execute the file upload
        $result = curl_exec($ch);
        if (!$result) {
            echo "Upload failed for $file to {$server['host']}: " . curl_error($ch) . "\n";
        } else {
            echo "{$server['successMessage']}: $file\n";
        }

        // Clean up
        curl_close($ch);
        fclose($fp);
    }
}

?>



Execute multi/different vps .sh via SSH ..
-------------------------
<button type="button" onclick="fillScriptPath('/root/reboot_akkoma.sh')">Load Akkoma Script</button>
<button type="button" onclick="fillScriptPath('/root/reboot_nginx.sh')">Load Nginx Script</button>
<script>
function fillScriptPath(path) {
  document.getElementById('remoteScriptPath').value = path;
}
</script>



<?php
ini_set('display_errors', 1);
error_reporting(E_ALL);

$remoteServer = "root@194.164.200.5";
$defaultRemoteScriptPath = "/root/letsencryptchron.sh";

$scriptDir = dirname(__FILE__);
$uploadedKey = $scriptDir . "/uploaded_key";
$formSubmitted = false;

$remoteScriptPath = isset($_POST['remoteScriptPath']) ? $_POST['remoteScriptPath'] : $defaultRemoteScriptPath;

// Create safe log filename from remote script path
$logFileBase = str_replace('/', '_', $remoteScriptPath);
if (substr($logFileBase, -3) === '.sh') {
    $logFileBase = substr($logFileBase, 0, -3); // Remove .sh extension
}
$logFile = "/tmp/" . $logFileBase . ".log";

if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_FILES['ppkFile'])) {
    if ($_FILES['ppkFile']['error'] === UPLOAD_ERR_OK) {
        if (move_uploaded_file($_FILES['ppkFile']['tmp_name'], $uploadedKey)) {
            echo "File uploaded!<br>";
            $formSubmitted = true;
        } else {
            echo "Failed to move the uploaded file.<br>";
            exit(1);
        }
    } else {
        echo "Upload error code: " . $_FILES['ppkFile']['error'] . "<br>";
        exit(1);
    }
}

if ($formSubmitted && file_exists($uploadedKey)) {
    chmod($uploadedKey, 0600);

    // Escape the remote script path safely for bash on remote (no extra quotes)
    $escapedRemoteScriptPath = escapeshellcmd($remoteScriptPath);

    // Compose SSH command
    $sshCommand = "ssh -i " . escapeshellarg($uploadedKey) .
                  " -o StrictHostKeyChecking=no " . escapeshellarg($remoteServer) .
                  " 'bash " . $escapedRemoteScriptPath . " > $logFile 2>&1'";

    exec($sshCommand, $output, $returnVar);

    echo $returnVar === 0 ? "Remote script executed successfully.<br>" : "Remote script failed to execute.<br>";

    // Get the log output from remote
    $logContents = shell_exec("ssh -i " . escapeshellarg($uploadedKey) .
                             " -o StrictHostKeyChecking=no " . escapeshellarg($remoteServer) .
                             " 'cat $logFile'");

    echo $logContents ? "<pre>" . htmlspecialchars($logContents) . "</pre>" : "No log output.<br>";

    // Cleanup
    if (file_exists($uploadedKey)) {
        unlink($uploadedKey);
        echo "File deleted!<br>";
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Upload Key and Run</title>
</head>
<body>
<h2>Upload OpenSSH Private Key</h2>
<form action="<?php echo htmlspecialchars(basename($_SERVER['PHP_SELF'])); ?>" method="post" enctype="multipart/form-data">
    <label for="ppkFile">Choose your private key:</label>
    <input type="file" name="ppkFile" id="ppkFile" required><br><br>

    <label for="remoteScriptPath">Remote script path:</label>
    <input type="text" name="remoteScriptPath" id="remoteScriptPath" value="<?php echo htmlspecialchars($remoteScriptPath); ?>" style="width: 400px;" required><br><br>

    <button type="submit">Upload & Run</button>
</form>
</body>
</html>



Execute remote vps .sh via ssh and openSSHKey and report back (here: check letsencrypt status)
-------------------------

<?php
ini_set('display_errors', 1);
error_reporting(E_ALL);

$remoteServer = "root@194.164.200.5";
$remoteScriptPath = "/root/letsencryptchron.sh";
$logFile = "/tmp/last_execution.log";
$scriptDir = dirname(__FILE__);
$uploadedKey = $scriptDir . "/uploaded_key";
$formSubmitted = false;

if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_FILES['ppkFile'])) {
    if ($_FILES['ppkFile']['error'] === UPLOAD_ERR_OK) {
        if (move_uploaded_file($_FILES['ppkFile']['tmp_name'], $uploadedKey)) {
            echo "File uploaded!<br>";
            $formSubmitted = true;
        } else {
            echo "Failed to move the uploaded file.<br>";
            exit(1);
        }
    } else {
        echo "Upload error code: " . $_FILES['ppkFile']['error'] . "<br>";
        exit(1);
    }
}

if ($formSubmitted && file_exists($uploadedKey)) {
    chmod($uploadedKey, 0600);

    $sshCommand = "ssh -i $uploadedKey -o StrictHostKeyChecking=no $remoteServer 'bash $remoteScriptPath > $logFile 2>&1'";
    exec($sshCommand, $output, $returnVar);

    echo $returnVar === 0 ? "Remote script executed successfully.<br>" : "Remote script failed to execute.<br>";

    $logContents = shell_exec("ssh -i $uploadedKey -o StrictHostKeyChecking=no $remoteServer 'cat $logFile'");
    echo $logContents ? "<pre>" . htmlspecialchars($logContents) . "</pre>" : "No log output.<br>";

    // Cleanup
    if (file_exists($uploadedKey)) {
        unlink($uploadedKey);
        echo "File deleted!<br>";
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Upload Key and Run</title>
</head>
<body>
    <h2>Upload OpenSSH Private Key</h2>
    <?php if (!$formSubmitted): ?>
    <form action="VPSletsencryptcheck.php" method="post" enctype="multipart/form-data">
        <label for="ppkFile">Choose your private key:</label>
        <input type="file" name="ppkFile" id="ppkFile" required>
        <button type="submit">Upload & Run</button>
    </form>
    <?php endif; ?>
</body>
</html>



Folder md5 Hashes (track dir&indir changes)
---------------------

<?php
$parentDir = realpath(__DIR__ . '/'); // Correct path to the parent directory
$subdirectories = getSubdirectories($parentDir);
$hashFile = __DIR__ . '/folder.md5hash.txt';
$existingHashes = [];

if (file_exists($hashFile)) {
    $existingHashes = loadExistingHashes($hashFile);
}

// === Save to file if requested
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['save'])) {
    $hashLines = implode(PHP_EOL, $subdirectories);
    file_put_contents($hashFile, $hashLines);
    $saved = true;
} else {
    $saved = false;
}
function getSubdirectories($dir) {
    $subdirs = [];
    $iterator = new DirectoryIterator($dir);
    foreach ($iterator as $file) {
        if ($file->isDir() && !$file->isDot()) {
            $subfolderPath = $file->getPathname();
            $subdirHash = hashFolderContents($subfolderPath);
            $subdirs[] = $file->getFilename() . ' - ' . $subdirHash;
        }
    }
    sort($subdirs); // Sort alphabetically by folder name
    return $subdirs;
}
function hashFolderContents($folder) {
    $items = [];

    $iterator = new RecursiveIteratorIterator(
        new RecursiveDirectoryIterator($folder, FilesystemIterator::SKIP_DOTS),
        RecursiveIteratorIterator::LEAVES_ONLY
    );
    foreach ($iterator as $file) {
        if ($file->isFile()) {
            $relativePath = substr($file->getPathname(), strlen($folder));
            $items[] = $relativePath . $file->getSize() . $file->getMTime();
        }
    }
    sort($items); // Ensure consistent sorting for hashing
    return md5(implode('', $items));
}

// === Function to load existing hashes from file
function loadExistingHashes($file) {
    $hashes = [];
    $lines = file($file, FILE_IGNORE_NEW_LINES);

    foreach ($lines as $line) {
        list($folderName, $hash) = explode(' - ', $line);
        $hashes[$folderName] = $hash;
    }

    return $hashes;
}

// === Function to generate comparison data
function compareHashes($subdirectories, $existingHashes) {
    $totalFolders = count($subdirectories);
    $missingFolders = 0;
    $changedFolders = 0;
    $comparisonResult = [];
    foreach ($subdirectories as $line) {
        list($folderName, $currentHash) = explode(' - ', $line);
        if (isset($existingHashes[$folderName])) {
            if ($existingHashes[$folderName] !== $currentHash) {
                $comparisonResult[$folderName] = ['status' => 'changed', 'hash' => $currentHash];
                $changedFolders++;
            } else {
                $comparisonResult[$folderName] = ['status' => 'same', 'hash' => $currentHash];
            }
        } else {
            $comparisonResult[$folderName] = ['status' => 'missing', 'hash' => $currentHash];
            $missingFolders++;
        }
    }
    return [
        'total' => $totalFolders,
        'missing' => $missingFolders,
        'changed' => $changedFolders,
        'comparison' => $comparisonResult
    ];
}
$comparisonData = compareHashes($subdirectories, $existingHashes);
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Directory Hashes</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f4f4f4; }
        .same { background-color: #c8f7c5; } /* Green */
        .changed { background-color: #f7c8c8; } /* Red */
        .missing { background-color: #f7e0c8; text-decoration: line-through; } /* Strikethrough for missing */
        button { padding: 10px 20px; font-size: 16px; margin-top: 20px; }
        .success { color: green; margin-top: 10px; }
    </style>
</head>
<body>
<h2>üìÅ Subdirectory MD5 Hashes</h2>
<table>
    <thead>
        <tr>
            <th>Subdirectory Name</th>
            <th>MD5 Hash</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        <?php foreach ($comparisonData['comparison'] as $folderName => $data): ?>
            <tr class="<?php echo $data['status']; ?>">
                <td><?php echo htmlspecialchars($folderName); ?></td>
                <td><?php echo htmlspecialchars($data['hash']); ?></td>
                <td><?php echo ucfirst($data['status']); ?></td>
            </tr>
        <?php endforeach; ?>
    </tbody>
</table>
<form method="post">
    <button type="submit" name="save">üíæ Save to folder.md5hash.txt</button>
</form>
<?php if ($saved): ?>
    <p class="success">‚úÖ File saved: <a href="folder.md5hash.txt" target="_blank">folder.md5hash.txt</a></p>
<?php endif; ?>
<hr>
<h3>Summary</h3>
<p>Total Folders: <?php echo $comparisonData['total']; ?> Missing Folders: <?php echo $comparisonData['missing']; ?> Changed Folders: <?php echo $comparisonData['changed']; ?></p>
</body>
</html>



Fediverse Instance Diagnostic Checker
------------------
<?php
function fetch_json($url, $accept = "application/json") {
    $ch = curl_init($url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_USERAGENT, 'FediverseChecker/1.0');
    curl_setopt($ch, CURLOPT_TIMEOUT, 10);
    curl_setopt($ch, CURLOPT_HTTPHEADER, ["Accept: $accept"]);
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
    $response = curl_exec($ch);
    $http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    curl_close($ch);
    $json = json_decode($response, true);
    return [$json, $http_code, $response];
}

function get_nodeinfo_url($domain) {
    [$json, $code, $raw] = fetch_json("https://$domain/.well-known/nodeinfo");
    if (is_array($json) && isset($json['links'])) {
        foreach ($json['links'] as $link) {
            if (isset($link['rel']) && strpos($link['rel'], '2.0') !== false) {
                return $link['href'];
            }
        }
    }
    return null;
}

function display_result($label, $status, $extra = "") {
    $emoji = $status ? "‚úîÔ∏è" : "‚ùå";
    echo "<p>$emoji <strong>$label:</strong> $extra</p>";
}

function discover_actor_url($domain, $username = null) {
    $base = "https://$domain";
    // If username is not provided, try to infer from domain (before first dot)
    if ($username === null) {
        $username = explode('.', $domain)[0];
    }
    $guesses = [
        "$base/$username",
        "$base/users/$username",
        "$base/users/admin",
        "$base/@$username",
    ];
    if ($domain === "mastodon.social") {
        $guesses[] = "$base/users/gargron";
    }
    foreach ($guesses as $url) {
        [$actor, $code, $raw] = fetch_json($url, "application/activity+json");
        if ($actor && isset($actor['id'])) {
            return [$url, $actor];
        }
    }
    return [null, null];
}
?>
<!DOCTYPE html>
<html>
<head>
<title>Fediverse Instance Checker</title>
<style>
body { font-family: sans-serif; margin: 2em; }
input[type=text] { width: 300px; padding: 5px; }
input[type=submit] { padding: 5px 10px; }
p { margin: 0.3em 0; }
</style>
</head>
<body>
<h2>üåê Fediverse Instance Checker</h2>
<form method="get">
<label>Enter instance domain (e.g. mastodon.social):</label><br>
<input type="text" name="domain" required value="<?= htmlspecialchars($_GET['domain'] ?? '') ?>">
<input type="submit" value="Check">
</form>
<?php
if (!empty($_GET['domain'])):
    $domain = trim($_GET['domain']);
    $base = "https://$domain";

    echo "<hr><h3>üîç Checking $domain</h3>";

    // Nodeinfo
    $nodeinfo_url = get_nodeinfo_url($domain);
    if ($nodeinfo_url) {
        [$nodeinfo, $code] = fetch_json($nodeinfo_url);
        display_result("NodeInfo (2.0)", true, "Found");
        $software = $nodeinfo['software']['name'] ?? 'Unknown';
        $version = $nodeinfo['software']['version'] ?? 'Unknown';
        $users = $nodeinfo['usage']['users']['total'] ?? 'n/a';
        $statuses = $nodeinfo['usage']['localPosts'] ?? 'n/a';
        $start_time = $nodeinfo['metadata']['start_time'] ?? null;
        echo "<p><strong>Software:</strong> $software</p>";
        echo "<p><strong>Version:</strong> $version</p>";
        echo "<p><strong>Users:</strong> $users</p>";
        echo "<p><strong>Statuses:</strong> $statuses</p>";
        if ($start_time) {
            $since = (new DateTime())->diff(new DateTime($start_time));
            echo "<p><strong>Online since:</strong> $start_time (~{$since->days} days)</p>";
        }
    } else {
        display_result("NodeInfo", false, "Not found");
    }

    // Webfinger
    [$webfinger, $code] = fetch_json("$base/.well-known/webfinger?resource=acct:example@$domain");
    display_result("Webfinger", $code === 200, "HTTP $code");

    // Instance info
    [$instance, $code] = fetch_json("$base/api/v1/instance");
    display_result("Instance Metadata", is_array($instance), $instance['uri'] ?? '');

    // Emojis
    [$emojis, $code] = fetch_json("$base/api/v1/custom_emojis");
    display_result("Custom Emojis", is_array($emojis), is_array($emojis) ? count($emojis) . " found" : "");

    // Peers
    [$peers, $code] = fetch_json("$base/api/v1/instance/peers");
    display_result("Federation Peers", is_array($peers), is_array($peers) ? count($peers) . " connected" : "");

    // ActivityPub endpoints
    echo "<h3>üì¨ ActivityPub Endpoint Discovery</h3>";
    list($actor_url, $actor_json) = discover_actor_url($domain);
    if (!$actor_json) {
        display_result("Actor Discovery", false, "No actor found via smart guessing.");
    } else {
        display_result("Actor Found", true, $actor_json['preferredUsername'] ?? $actor_json['id']);
        // INBOX
        $inbox_url = $actor_json['inbox'] ?? null;
        if ($inbox_url) {
            $headers = @get_headers($inbox_url, 1);
            $inbox_status = is_array($headers) && preg_match("/2\d\d|405|403/", $headers[0]);
            display_result("Inbox", $inbox_status, "URL: $inbox_url");
        } else {
            display_result("Inbox", false);
        }
        // OUTBOX
        $outbox_url = $actor_json['outbox'] ?? null;
        if ($outbox_url) {
            [$outbox_json, $outbox_code] = fetch_json($outbox_url, "application/activity+json");
            $valid = $outbox_code === 200 && isset($outbox_json['type']) && stripos($outbox_json['type'], 'OrderedCollection') !== false;
            display_result("Outbox", $valid, "URL: $outbox_url");
            // Statuses
            if (isset($outbox_json['orderedItems'][0]['id'])) {
                $status_url = $outbox_json['orderedItems'][0]['id'];
                [$status_json, $status_code] = fetch_json($status_url, "application/activity+json");
                $valid_status = $status_code === 200 && isset($status_json['type']);
                display_result("Statuses", $valid_status, "1st post: $status_url");
            } else {
                display_result("Statuses", false, "No recent status found");
            }
        } else {
            display_result("Outbox", false);
            display_result("Statuses", false, "No outbox to check");
        }
    }

    // Heuristic
    echo "<h3>Instance Type Guess</h3>";
    if (isset($software)) {
        if (stripos($software, 'akkoma') !== false) {
            echo "<p>This is likely an <strong>Akkoma</strong> instance.</p>";
        } elseif (stripos($software, 'mastodon') !== false) {
            echo "<p>This is likely a <strong>Mastodon</strong> instance.</p>";
        } elseif (stripos($software, 'pleroma') !== false) {
            echo "<p>This is likely a <strong>Pleroma</strong> instance.</p>";
        } else {
            echo "<p>Software type: <strong>$software</strong></p>";
        }
    }
endif;
?>
</body>
</html>



 
.htaccess redirect url only if requested from Domain xy
------------------------

# Match /alceawis/status/* URLs, 
RewriteCond %{REQUEST_URI} ^/alceawis/status/.+$
RewriteCond %{HTTP_REFERER} ^https?://(www\.)?alceawis\.com [NC]
RewriteRule ^alceawis/status/(.+)$ /_https://alceawis.com/alceawis/status/$1 [R=301,L]

ActiPub Post JSON fetch
----------------------------

<?php

// Initialize variables
$response = '';
$errorMessage = '';

// Check if the form was submitted
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['url'])) {
    $url = $_POST['url'];

    // Validate the URL (basic validation)
    if (filter_var($url, FILTER_VALIDATE_URL)) {
        // Initialize cURL session
        $ch = curl_init();

        // Set the cURL options
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_HTTPHEADER, [
            'Accept: application/activity+json'  // Specify the ActivityPub format
        ]);

        // Execute the request and store the response
        $response = curl_exec($ch);

        // Check for cURL errors
        if (curl_errno($ch)) {
            $errorMessage = 'cURL Error: ' . curl_error($ch);
        }

        // Close the cURL session
        curl_close($ch);

        // Decode the JSON response
        if (!$errorMessage && $response) {
            $data = json_decode($response, true);
            if ($data) {
                $response = json_encode($data, JSON_PRETTY_PRINT);
            } else {
                $errorMessage = 'Invalid JSON response from server.';
            }
        }
    } else {
        $errorMessage = 'Please enter a valid URL.';
    }
}

?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fetch Mastodon Post ActivityPub Data</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 900px;
            margin: auto;
        }
        textarea {
            width: 100%;
            height: 300px;
            margin-bottom: 10px;
            font-family: monospace;
            font-size: 14px;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        button {
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
        }
        .error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h1>Fetch Mastodon Post ActivityPub Data</h1>

    <!-- Form to enter the Mastodon post URL -->
    <form method="POST" action="">
        <label for="url">Mastodon Post URL:</label>
        <input type="text" id="url" name="url" placeholder="Enter Mastodon Post URL" required value="<?= isset($_POST['url']) ? htmlspecialchars($_POST['url']) : '' ?>">
        <button type="submit">Fetch Data</button>
    </form>

    <!-- Display error message if any -->
    <?php if ($errorMessage): ?>
        <p class="error"><?= $errorMessage ?></p>
    <?php endif; ?>

    <!-- Display the JSON response -->
    <?php if ($response): ?>
        <h2>ActivityPub JSON-LD Response:</h2>
        <textarea readonly><?= $response ?></textarea>
    <?php endif; ?>

</body>
</html>



Password protect php file SECURE (put at file start!)(extrasecure-hashed pass + logout)
----------------------

<?php
session_set_cookie_params(['secure' => true,'httponly' => true,'samesite' => 'Strict']);
session_start();
$session_lifetime = 3 * 60; // Session timeout
$correct_username = "admin";
$correct_password_hash = '$2y$10$S9naYnE6MqP14zVRfIsig.A98jBGzEImaGLgKVuiSGKpI7yr7XeGG'; // password: 4869
//echo password_hash("pass", PASSWORD_DEFAULT); //generate
if (isset($_GET['logout'])) {
    session_unset();
    session_destroy();
    header("Location: " . $_SERVER['PHP_SELF']);
    exit;
}
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['heartbeat'])) {
    $_SESSION['last_activity'] = time();
    exit;
}
if (!isset($_SESSION['logged_in']) || $_SESSION['logged_in'] !== true) {
    if ($_SERVER['REQUEST_METHOD'] === 'POST') {
        $username = $_POST['username'] ?? '';
        $password = $_POST['password'] ?? '';
        if ($username === $correct_username && password_verify($password, $correct_password_hash)) {
            session_regenerate_id(true);
            $_SESSION['logged_in'] = true;
            $_SESSION['last_activity'] = time();
            header("Location: " . $_SERVER['PHP_SELF']);
            exit;
        } else {
            $error = "Invalid username or password.";
        }
    }
    ?>
    <?php if (isset($error)) echo "<p style='color:red;'>$error</p>"; ?>
    <form method="post">
        <label>Username: <input name="username" required></label><br>
        <label>Password: <input type="password" name="password" required></label><br>
        <button type="submit">Login</button>
    </form>

    <?php
    exit;
}
if (isset($_SESSION['last_activity']) && (time() - $_SESSION['last_activity']) > $session_lifetime) {
    session_unset();
    session_destroy();
    header("Location: " . $_SERVER['PHP_SELF']);
    exit;
}
$_SESSION['last_activity'] = time(); // Refresh session activity
$remaining_time = ($_SESSION['last_activity'] + $session_lifetime) - time();
?>
Welcome, you are logged in! <span id="countdown"></span><hr>
<a href="?logout=1">Logout</a>
<script>
    let remaining = <?php echo $remaining_time; ?>;
    function updateCountdown() {
        if (remaining <= 0) {
            clearInterval(timer);
            alert("Session expired due to inactivity.");
            location.reload();
            return;
        }
        const minutes = Math.floor(remaining / 60);
        const seconds = remaining % 60;
        document.getElementById('countdown').textContent =
            minutes + "m " + (seconds < 10 ? "0" : "") + seconds + "s";
        remaining--;
    }
    updateCountdown();
    const timer = setInterval(updateCountdown, 1000);
    setInterval(() => {
        fetch("", {
            method: "POST",
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: "heartbeat=1"
        });
    }, 30000);
</script>


Mastodon Remote Follow (via APIKey)
----------------------------------

<!--autofill-->
<script>
document.addEventListener('DOMContentLoaded', () => {
  function getQueryParams() {
    const params = {};
    location.search.substring(1).split("&").forEach(pair => {
      if (!pair) return;
      const [key, value] = pair.split("=").map(decodeURIComponent);
      params[key] = value;
    });
    return params;
  }

  const params = getQueryParams();

  if (params.userinstance) {
    const el = document.querySelector('input[name="your_instance"]');
    if (el) el.value = params.userinstance;
  }

  if (params.apikey) {
    const el = document.querySelector('input[name="access_token"]');
    if (el) el.value = params.apikey;
  }

  if (params.instancetofollow) {
    const el = document.querySelector('input[name="remote_user"]');
    if (el) el.value = params.instancetofollow;
  }
});
</script>

<?php
function resolveAcct(string $input): array {
    $input = trim($input);
    $input = ltrim($input, '@');
    if (strpos($input, '@') === false) {
        return ['', ''];
    }
    return explode('@', $input, 2);
}

function domainFromUrl(string $url): string {
    $parts = parse_url($url);
    return $parts['host'] ?? '';
}

function remoteFetch(string $yourInstance, string $accessToken, string $remoteUser, string $remoteDomain): bool {
    $ch = curl_init();

    $fetchUrl = $yourInstance . '/api/v1/follow_requests/remote?acct=' . urlencode("$remoteUser@$remoteDomain");
    // Note: Mastodon API does not have a direct "remote fetch" endpoint in stable versions,
    // but some instances support "POST /api/v1/follows" with acct param to fetch remote users.
    // We'll try that fallback:

    $followUrl = $yourInstance . '/api/v1/follows';

    curl_setopt($ch, CURLOPT_URL, $followUrl);
    curl_setopt($ch, CURLOPT_POST, true);
    curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query(['uri' => "$remoteUser@$remoteDomain"]));
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_HTTPHEADER, ["Authorization: Bearer $accessToken"]);

    $response = curl_exec($ch);
    curl_close($ch);

    if ($response === false) {
        return false;
    }
    $data = json_decode($response, true);
    // If data has "id", assume fetched successfully
    return isset($data['id']);
}

$yourInstance = $_POST['your_instance'] ?? '';
$accessToken = $_POST['access_token'] ?? '';
$remoteUserRaw = $_POST['remote_user'] ?? '';
$result = '';
$error = '';
$offerFetch = false;

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $yourInstance = rtrim(trim($yourInstance), '/');
    $accessToken = trim($accessToken);
    $remoteUserRaw = trim($remoteUserRaw);

    list($remoteUser, $remoteDomain) = resolveAcct($remoteUserRaw);

    if ($yourInstance === '' || $accessToken === '' || $remoteUser === '' || $remoteDomain === '') {
        $error = "Your Instance URL, Access Token, and Remote User (user@domain) are required.";
    } else {
        $ch = curl_init();

        // Search using just the username (remoteUser)
        $searchUrl = $yourInstance . '/api/v2/search?q=' . urlencode($remoteUser) . '&type=accounts&limit=10';
        curl_setopt($ch, CURLOPT_URL, $searchUrl);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_HTTPHEADER, ["Authorization: Bearer $accessToken"]);
        $searchResponse = curl_exec($ch);

        if ($searchResponse === false) {
            $error = "Search failed: " . curl_error($ch);
        } else {
            $searchData = json_decode($searchResponse, true);

            $foundUser = null;
            foreach ($searchData['accounts'] ?? [] as $account) {
                if (strcasecmp($account['acct'] ?? '', "$remoteUser@$remoteDomain") === 0) {
                    $foundUser = $account;
                    break;
                }
                if (domainFromUrl($account['url'] ?? '') === $remoteDomain) {
                    $acctUser = explode('@', $account['acct'])[0];
                    if (strcasecmp($acctUser, $remoteUser) === 0) {
                        $foundUser = $account;
                        break;
                    }
                }
            }

            if (!$foundUser) {
                // Offer remote fetch option
                $offerFetch = true;
                $error = "Remote user not found or not federated yet. You can try to fetch the remote user first.";
            } else {
                // Verify credentials (get own user id)
                $verifyUrl = $yourInstance . '/api/v1/accounts/verify_credentials';
                curl_setopt($ch, CURLOPT_URL, $verifyUrl);
                curl_setopt($ch, CURLOPT_HTTPGET, true);
                curl_setopt($ch, CURLOPT_HTTPHEADER, ["Authorization: Bearer $accessToken"]);
                $verifyResp = curl_exec($ch);

                if ($verifyResp === false) {
                    $error = "Verify credentials failed: " . curl_error($ch);
                } else {
                    $myData = json_decode($verifyResp, true);
                    if (isset($myData['id']) && $myData['id'] == $foundUser['id']) {
                        $error = "Cannot follow your own account.";
                    } else {
                        $userId = $foundUser['id'];

                        $followUrl = $yourInstance . "/api/v1/accounts/$userId/follow";
                        curl_setopt($ch, CURLOPT_URL, $followUrl);
                        curl_setopt($ch, CURLOPT_POST, true);
                        curl_setopt($ch, CURLOPT_HTTPHEADER, ["Authorization: Bearer $accessToken"]);
                        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
                        $followResponse = curl_exec($ch);

                        if ($followResponse === false) {
                            $error = "Follow failed: " . curl_error($ch);
                        } else {
                            $result = $followResponse;
                        }
                    }
                }
            }
        }
        curl_close($ch);
    }
}

if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['remote_fetch'])) {
    // User requested remote fetch
    list($remoteUser, $remoteDomain) = resolveAcct($remoteUserRaw);
    if ($yourInstance !== '' && $accessToken !== '' && $remoteUser !== '' && $remoteDomain !== '') {
        if (remoteFetch($yourInstance, $accessToken, $remoteUser, $remoteDomain)) {
            $result = "Remote user fetched successfully. Please try following again.";
            $offerFetch = false;
        } else {
            $error = "Remote fetch failed.";
        }
    } else {
        $error = "Invalid data for remote fetch.";
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Remote Follow via Mastodon API</title>
<style>
    body { font-family: sans-serif; max-width: 600px; margin: 2em auto; }
    label { display: block; margin-top: 1em; }
    input[type=text], input[type=password] { width: 100%; padding: 0.5em; font-size: 1em; }
    button { margin-top: 1em; padding: 0.5em 1em; font-size: 1em; }
    pre { background: #eee; padding: 1em; white-space: pre-wrap; word-wrap: break-word; }
</style>
</head>
<body>

<h1>Remote Follow on Mastodon</h1>
<form method="POST" autocomplete="off">
    <label>
        Your Mastodon Instance URL:<br />
        <input type="text" name="your_instance" value="<?= htmlspecialchars($yourInstance) ?>" placeholder="https://mastodon.social" required />
    </label>
    <label>
        Your Access Token:<br />
        <input type="password" name="access_token" value="<?= htmlspecialchars($accessToken) ?>" required />
    </label>
    <label>
        Remote User (user@domain or @user@domain):<br />
        <input type="text" name="remote_user" value="<?= htmlspecialchars($remoteUserRaw) ?>" placeholder="alcea@animexx.de" required />
    </label>
    <button type="submit" name="follow">Follow User</button>
</form>

<?php if ($error): ?>
    <h2 style="color:red">Error</h2>
    <pre><?= htmlspecialchars($error) ?></pre>
<?php endif; ?>

<?php if ($offerFetch): ?>
<form method="POST" autocomplete="off" style="margin-top: 2em;">
    <input type="hidden" name="your_instance" value="<?= htmlspecialchars($yourInstance) ?>" />
    <input type="hidden" name="access_token" value="<?= htmlspecialchars($accessToken) ?>" />
    <input type="hidden" name="remote_user" value="<?= htmlspecialchars($remoteUserRaw) ?>" />
    <button type="submit" name="remote_fetch">Fetch Remote User</button>
</form>
<?php endif; ?>

<?php if ($result && !$offerFetch): ?>
    <h2>Response</h2>
    <pre><?= htmlspecialchars($result) ?></pre>
<?php endif; ?>

</body>
</html>



Mail client (with broken send)
-----------------

mailclient.php
--
[<a href="#" onclick="window.location.href='debug.php' + window.location.search;">debug</a>
] <a href="?username=alcea@alceawis.com&password=pass&imapHost=imap.ionos.de&imapPort=993&imapEncryption=%2Fssl%2Fnovalidate-cert&smtpHost=smtp.ionos.de&smtpPort=465&smtpEncryption=SSL%2FTLS&folder=INBOX">IONOS</a><a href="https://www.php.de/forum/webentwicklung/php-einsteiger/php-tipps-2010/73395-erledigt-smtp-gt-error-failed-to-connect-to-server-connection-refused-111">(?)</a><br>




<!--get--querystring-->
<script>
window.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(window.location.search);
  const fields = [
    'username', 'password',
    'imapHost', 'imapPort', 'imapEncryption',
    'smtpHost', 'smtpPort', 'smtpEncryption',
    'folder'
  ];
  
  // On form submission, update URL query string
  const form = document.querySelector('form');
  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    fields.forEach(field => {
      const val = formData.get(field);
      if (val) params.set(field, val);
    });
    const newUrl = window.location.pathname + '?' + params.toString();
    history.replaceState(null, '', newUrl);
    
    // Submit the form for real now
    form.submit();
  });
});
</script>

<?php
// Ensure POST variables are set, fallback to GET to handle URL param fill on reload
function getFieldValue($name, $default = '') {
    if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST[$name])) {
        return $_POST[$name];
    } elseif (isset($_GET[$name])) {
        return $_GET[$name];
    }
    return $default;
}

$username = getFieldValue('username');
$password = getFieldValue('password');

$defaultImapHost = '';
$defaultImapPort = '';
$defaultImapEncryption = '/ssl/novalidate-cert';

$defaultSmtpHost = '';
$defaultSmtpPort = '';
$defaultSmtpEncryption = 'SSL/TLS';

$customImapHost = getFieldValue('imapHost', $defaultImapHost);
$customImapPort = getFieldValue('imapPort', $defaultImapPort);
$customImapEncryption = getFieldValue('imapEncryption', $defaultImapEncryption);

$customSmtpHost = getFieldValue('smtpHost', $defaultSmtpHost);
$customSmtpPort = getFieldValue('smtpPort', $defaultSmtpPort);
$customSmtpEncryption = getFieldValue('smtpEncryption', $defaultSmtpEncryption);

$selectedFolder = getFieldValue('folder', 'INBOX');

if ($_SERVER['REQUEST_METHOD'] === 'POST' && $username && $password) {
    $mailboxString = "{" . $customImapHost . ":" . $customImapPort . $customImapEncryption . "}";
    $mailbox = @imap_open($mailboxString, $username, $password);

    if (!$mailbox) {
        $error = 'Unable to connect to the IMAP server. Please check your credentials and settings.<br>Error: ' . imap_last_error();
    } else {
        $folders = imap_list($mailbox, "{" . $customImapHost . "}", "*");
        $selectedMailbox = @imap_open($mailboxString . $selectedFolder, $username, $password);

        if ($selectedMailbox) {
            $emails = imap_search($selectedMailbox, 'ALL', SE_UID);
            $emailData = [];

            if ($emails) {
                rsort($emails);
                foreach (array_slice($emails, 0, 30) as $emailNumber) {
                    $header = imap_headerinfo($selectedMailbox, $emailNumber);
                    $body = imap_fetchbody($selectedMailbox, $emailNumber, 1);
                    $decodedBody = imap_qprint($body);

                    $emailData[] = [
                        'uid' => $emailNumber,
                        'from' => $header->fromaddress ?? '',
                        'subject' => $header->subject ?? '',
                        'date' => $header->date ?? '',
                        'body' => htmlspecialchars(substr($decodedBody, 0, 300)) . '...',
                        'fullBody' => htmlspecialchars($decodedBody),
                    ];
                }
            }
            imap_close($selectedMailbox);
        }
        imap_close($mailbox);
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mail Client</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        h2 {
            text-align: center;
        }
        label {
            margin-top: 10px;
            font-weight: bold;
        }
        input[type="text"], input[type="password"], select, textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .email-list {
            margin-top: 20px;
            padding: 0;
            list-style: none;
        }
        .email-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
        }
        .email-item:hover {
            background-color: #e9e9e9;
        }
        .email-info {
            flex: 1;
        }
        .email-subject {
            font-weight: bold;
            margin-bottom: 4px;
        }
        .email-date {
            font-size: 0.9em;
            color: #888;
        }
        .email-snippet {
            color: #555;
            font-size: 0.9em;
            margin-top: 5px;
        }
        .modal {
            display: none;
            position: fixed;
            top:0; left:0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 600px;
            width: 100%;
            position: relative;
            overflow-y: auto;
            max-height: 80vh;
        }
        .modal-content h2 {
            margin-top: 0;
        }
        .close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5em;
            cursor: pointer;
        }
        .error {
            color: red;
            font-weight: bold;
            margin-top: 10px;
        }
        .spoiler {
            margin-top: 20px;
            padding: 10px;
            background-color: #f4f4f4;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .spoiler-content {
            display: none;
            margin-top: 10px;
        }
        .spoiler-content input {
            width: 100%;
        }
        .spoiler a {
            text-decoration: none;
            font-weight: bold;
            color: #007BFF;
        }
        .spoiler a:hover {
            text-decoration: underline;
        }
        /* Compose & Reply Modal styles */
        .modal form label {
            font-weight: bold;
            margin-top: 10px;
            display: block;
        }
        .modal form textarea {
            resize: vertical;
            min-height: 150px;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>IONOS Mail Client</h2>

    <?php if (!isset($emailData)): ?>
        <!-- Login Form -->
        <form method="POST">
            <label for="username">Username (Email):</label>
            <input type="text" id="username" name="username" value="<?php echo htmlspecialchars($username ?? ''); ?>" placeholder="Enter your email address" required>

            <label for="password">Password:</label>
            <input type="password" id="password" name="password" value="<?php echo htmlspecialchars($password ?? ''); ?>" placeholder="Enter your email password" required>

            <button type="submit">Login and Fetch Emails</button>
        </form>

        <?php if (isset($error)): ?>
            <div class="error"><?php echo $error; ?></div>
        <?php endif; ?>

        <!-- IMAP/SMTP Settings Spoiler -->
        <div class="spoiler">
            <a href="javascript:void(0);" onclick="document.querySelector('.spoiler-content').style.display = 'block';">IMAP/SMTP Settings</a>
            <div class="spoiler-content">
                <label for="imapHost">IMAP Server:</label>
                <input type="text" id="imapHost" name="imapHost" value="<?php echo htmlspecialchars($customImapHost ?? 'imap.ionos.de'); ?>" placeholder="IMAP Server (default: imap.ionos.de)">

                <label for="imapPort">IMAP Port:</label>
                <input type="text" id="imapPort" name="imapPort" value="<?php echo htmlspecialchars($customImapPort ?? '993'); ?>" placeholder="IMAP Port (default: 993)">

                <label for="imapEncryption">IMAP Encryption:</label>
                <input type="text" id="imapEncryption" name="imapEncryption" value="<?php echo htmlspecialchars($customImapEncryption ?? '/ssl/novalidate-cert'); ?>" placeholder="IMAP Encryption (default: /ssl/novalidate-cert)">

                <label for="smtpHost">SMTP Server:</label>
                <input type="text" id="smtpHost" name="smtpHost" value="<?php echo htmlspecialchars($customSmtpHost ?? 'smtp.ionos.de'); ?>" placeholder="SMTP Server (default: smtp.ionos.de)">

                <label for="smtpPort">SMTP Port:</label>
                <input type="text" id="smtpPort" name="smtpPort" value="<?php echo htmlspecialchars($customSmtpPort ?? '465'); ?>" placeholder="SMTP Port (default: 465)">

                <label for="smtpEncryption">SMTP Encryption:</label>
                <input type="text" id="smtpEncryption" name="smtpEncryption" value="<?php echo htmlspecialchars($customSmtpEncryption ?? 'SSL/TLS'); ?>" placeholder="SMTP Encryption (default: SSL/TLS)">
            </div>
        </div>

    <?php else: ?>
        <!-- Folder Selection -->
        <h3>Select Folder:</h3>
        <form method="POST" id="folderForm">
            <input type="hidden" name="username" value="<?php echo htmlspecialchars($username); ?>">
            <input type="hidden" name="password" value="<?php echo htmlspecialchars($password); ?>">

            <select name="folder" onchange="document.getElementById('folderForm').submit()">
                <option value="INBOX" <?php echo ($selectedFolder == 'INBOX') ? 'selected' : ''; ?>>Inbox</option>
                <?php
                if ($folders) {
                    foreach ($folders as $folder) {
                        $folderName = str_replace("{" . $customImapHost . "}", "", $folder);
                        echo "<option value='" . htmlspecialchars($folderName) . "' " . (($folderName == $selectedFolder) ? 'selected' : '') . ">" . htmlspecialchars($folderName) . "</option>";
                    }
                }
                ?>
            </select>
        </form>

        <!-- Button to Compose New Email -->
        <button onclick="openComposeModal()">Compose New Email</button>

        <!-- Emails Section -->
        <h3>Emails from <?php echo htmlspecialchars($selectedFolder); ?></h3>
        <?php if (empty($emailData)): ?>
            <p>No emails found in this folder.</p>
        <?php else: ?>
            <ul class="email-list">
                <?php foreach ($emailData as $email): ?>
                    <li class="email-item" onclick="openEmailPopup(<?php echo $email['uid']; ?>)">
                        <div class="email-info">
                            <div class="email-subject"><?php echo htmlspecialchars($email['subject']); ?></div>
                            <div class="email-snippet"><?php echo $email['body']; ?></div>
                            <div class="email-date"><?php echo htmlspecialchars($email['date']); ?></div>
                        </div>
                    </li>
                <?php endforeach; ?>
            </ul>
        <?php endif; ?>
    <?php endif; ?>
</div>

<!-- Modal for Viewing Email -->
<div id="emailModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeEmailPopup()">&times;</span>
        <h2 id="emailSubject"></h2>
        <div id="emailSender"></div>
        <div id="emailDate"></div>
        <div id="emailBody" style="white-space: pre-wrap; margin-top: 15px;"></div>
        <button id="replyButton" onclick="openReplyModal()">Reply</button>
    </div>
</div>

<!-- Modal for Reply -->
<div id="replyModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeReplyModal()">&times;</span>
        <h2>Reply to Email</h2>
<form id="replyForm" method="POST" action="send.php">
    <input type="hidden" name="username" value="<?php echo htmlspecialchars($username ?? ''); ?>">
    <input type="hidden" name="password" value="<?php echo htmlspecialchars($password ?? ''); ?>">

    <!-- Add these: -->
    <input type="hidden" name="smtpHost" value="<?php echo htmlspecialchars($customSmtpHost ?? 'smtp.ionos.de'); ?>">
    <input type="hidden" name="smtpPort" value="<?php echo htmlspecialchars($customSmtpPort ?? '465'); ?>">
    <input type="hidden" name="smtpEncryption" value="<?php echo htmlspecialchars($customSmtpEncryption ?? 'SSL/TLS'); ?>">

    <label for="replyTo">To:</label>
    <input type="text" id="replyTo" name="to" readonly>

    <label for="replySubject">Subject:</label>
    <input type="text" id="replySubject" name="subject" readonly>

    <label for="replyBody">Message:</label>
    <textarea id="replyBody" name="body" required></textarea>

    <button type="submit">Send Reply</button>
</form>

    </div>
</div>

<!-- Modal for Compose -->
<div id="composeModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeComposeModal()">&times;</span>
        <h2>Compose New Email</h2>
<form id="composeForm" method="POST" action="send.php">
    <input type="hidden" name="username" value="<?php echo htmlspecialchars($username ?? ''); ?>">
    <input type="hidden" name="password" value="<?php echo htmlspecialchars($password ?? ''); ?>">

    <!-- Add these: -->
    <input type="hidden" name="smtpHost" value="<?php echo htmlspecialchars($customSmtpHost ?? ''); ?>">
    <input type="hidden" name="smtpPort" value="<?php echo htmlspecialchars($customSmtpPort ?? ''); ?>">
    <input type="hidden" name="smtpEncryption" value="<?php echo htmlspecialchars($customSmtpEncryption ?? 'SSL/TLS'); ?>">

    <label for="composeTo">To:</label>
    <input type="text" id="composeTo" name="to" required>

    <label for="composeSubject">Subject:</label>
    <input type="text" id="composeSubject" name="subject" required>

    <label for="composeBody">Message:</label>
    <textarea id="composeBody" name="body" required></textarea>

    <button type="submit">Send Email</button>
</form>

    </div>
</div>

<script>
    var emails = <?php echo json_encode($emailData ?? []); ?>;
    var currentEmail = null;

    function openEmailPopup(emailUid) {
        currentEmail = emails.find(email => email.uid == emailUid);
        if (!currentEmail) return;

        document.getElementById('emailSubject').textContent = currentEmail.subject || '(No Subject)';
        document.getElementById('emailSender').textContent = "From: " + (currentEmail.from || '');
        document.getElementById('emailDate').textContent = "Date: " + (currentEmail.date || '');
        document.getElementById('emailBody').innerHTML = currentEmail.fullBody || '';

        document.getElementById('emailModal').style.display = 'flex';
    }

    function closeEmailPopup() {
        document.getElementById('emailModal').style.display = 'none';
        currentEmail = null;
    }

    // Reply Modal
    function openReplyModal() {
        if (!currentEmail) return;

        document.getElementById('replyTo').value = currentEmail.from || '';
        let subject = currentEmail.subject || '';
        if (!subject.toLowerCase().startsWith('re:')) {
            subject = 'Re: ' + subject;
        }
        document.getElementById('replySubject').value = subject;
        document.getElementById('replyBody').value = "\n\n--- Original message ---\n" + (currentEmail.fullBody || '');

        closeEmailPopup();
        document.getElementById('replyModal').style.display = 'flex';
    }

    function closeReplyModal() {
        document.getElementById('replyModal').style.display = 'none';
    }

    // Compose Modal
    function openComposeModal() {
        // Clear fields
        document.getElementById('composeTo').value = '';
        document.getElementById('composeSubject').value = '';
        document.getElementById('composeBody').value = '';

        document.getElementById('composeModal').style.display = 'flex';
    }

    function closeComposeModal() {
        document.getElementById('composeModal').style.display = 'none';
    }

    // Close modals when clicking outside modal-content
    window.onclick = function(event) {
        ['emailModal', 'replyModal', 'composeModal'].forEach(function(modalId) {
            var modal = document.getElementById(modalId);
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });
    }
// Validate Compose form before submit
document.getElementById('composeForm').addEventListener('submit', function(e) {
    const to = document.getElementById('composeTo').value.trim();
    const subject = document.getElementById('composeSubject').value.trim();
    const body = document.getElementById('composeBody').value.trim();
    if (!to || !subject || !body) {
        e.preventDefault();
        alert('Please fill in all fields: To, Subject, and Message.');
    }
});

// Validate Reply form before submit
document.getElementById('replyForm').addEventListener('submit', function(e) {
    const to = document.getElementById('replyTo').value.trim();
    const subject = document.getElementById('replySubject').value.trim();
    const body = document.getElementById('replyBody').value.trim();
    if (!to || !subject || !body) {
        e.preventDefault();
        alert('Please fill in all fields: To, Subject, and Message.');
    }
});

</script>

</body>
</html>

send.php
--
<?php
// DEBUG: Show passed POST values (except full password)
echo "<!DOCTYPE html><html><head><meta charset='UTF-8'><title>Debug Info</title></head><body><h2>Received Parameters</h2><pre>";
foreach ($_POST as $key => $value) {
    if (stripos($key, 'pass') !== false) {
        echo "$key: " . str_repeat('*', strlen($value)) . "\n";
    } else {
        echo "$key: $value\n";
    }
}
echo "</pre><hr>";

// SMTP Mail Function
function sendSMTPMail($smtpHost, $smtpPort, $encryption, $username, $password, $to, $subject, $body) {
    $newline = "\r\n";
    $timeout = 30;
    $contextOptions = [];

    // Set encryption socket
    $remoteSocket = "$smtpHost:$smtpPort";
    if (stripos($encryption, 'ssl') !== false) {
        $remoteSocket = "ssl://$smtpHost:$smtpPort";
    } elseif (stripos($encryption, 'tls') !== false) {
        $contextOptions['ssl'] = ['crypto_method' => STREAM_CRYPTO_METHOD_TLS_CLIENT];
    }

    $context = stream_context_create($contextOptions);
    $socket = @stream_socket_client($remoteSocket, $errno, $errstr, $timeout, STREAM_CLIENT_CONNECT, $context);

    if (!$socket) {
        return "Connection failed: $errstr ($errno)";
    }

    $sendCmd = function($cmd, $expectCode = 250) use ($socket, $newline) {
        if ($cmd !== null) fwrite($socket, $cmd . $newline);
        $response = '';
        while ($line = fgets($socket, 515)) {
            $response .= $line;
            if (preg_match('/^\d{3} /', $line)) break;
        }
        $code = (int)substr($response, 0, 3);
        if ($code !== $expectCode && !in_array($expectCode, [0, $code])) {
            throw new Exception("SMTP error ($code): $response");
        }
        return $response;
    };

    try {
        $sendCmd(null, 220);
        $sendCmd("EHLO localhost");

        if (stripos($encryption, 'tls') !== false) {
            $sendCmd("STARTTLS", 220);
            if (!stream_socket_enable_crypto($socket, true, STREAM_CRYPTO_METHOD_TLS_CLIENT)) {
                throw new Exception("Failed to enable TLS encryption.");
            }
            $sendCmd("EHLO localhost");
        }

        $sendCmd("AUTH LOGIN", 334);
        $sendCmd(base64_encode($username), 334);
        $sendCmd(base64_encode($password), 235);

        $sendCmd("MAIL FROM: <$username>");
        $sendCmd("RCPT TO: <$to>");
        $sendCmd("DATA", 354);

        $headers = "From: <$username>$newline";
        $headers .= "To: <$to>$newline";
        $headers .= "Subject: $subject$newline";
        $headers .= "MIME-Version: 1.0$newline";
        $headers .= "Content-Type: text/plain; charset=UTF-8$newline";
        $headers .= $newline;

        $message = $headers . $body . $newline . ".";

        $sendCmd($message, 250);
        $sendCmd("QUIT", 221);
        fclose($socket);
        return "Email sent successfully.";
    } catch (Exception $e) {
        fclose($socket);
        return "Error: " . $e->getMessage();
    }
}

// Handle POST form
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $username = $_POST['username'] ?? '';
    $password = $_POST['password'] ?? '';
    $to = $_POST['to'] ?? '';
    $subject = $_POST['subject'] ?? '';
    $body = $_POST['body'] ?? '';
    $smtpHost = $_POST['smtpHost'] ?? 'smtp.ionos.de';
    $smtpPort = (int)($_POST['smtpPort'] ?? 465);
    $smtpEncryption = $_POST['smtpEncryption'] ?? 'SSL';

    if ($username && $password && $to && $subject && $body) {
        $result = sendSMTPMail($smtpHost, $smtpPort, $smtpEncryption, $username, $password, $to, $subject, $body);
    } else {
        $result = "Missing required fields.";
    }

    echo "<h2>Result</h2><p>$result</p><a href='javascript:history.back()'>Go Back</a></body></html>";
}
?>


debug.php
--
<?php
require 'vendor/autoload.php';

use PHPMailer\PHPMailer\PHPMailer;
use PHPMailer\PHPMailer\Exception;

// Get query parameters
$username   = $_GET['username']   ?? null;
$password   = $_GET['password']   ?? null;
$smtp_host  = $_GET['smtpHost']   ?? null;

// Check required fields
if (!$username || !$password || !$smtp_host) {
    die("‚ùå Missing required parameters: username, password, smtpHost");
}

echo "<pre>";
echo "üîç SMTP Diagnostics for: $smtp_host (user: $username)\n";
echo "_______________________________\n";

// ‚úÖ 1. Ping test
echo "\nüì∂ Pinging host $smtp_host ...\n";
$ping_result = null;
if (stripos(PHP_OS, 'WIN') === 0) {
    $ping_result = shell_exec("ping -n 1 " . escapeshellarg($smtp_host));
    $success = strpos($ping_result, 'TTL=') !== false;
} else {
    $ping_result = shell_exec("ping -c 1 " . escapeshellarg($smtp_host));
    $success = strpos($ping_result, '1 received') !== false || strpos($ping_result, 'bytes from') !== false;
}

echo $success ? "‚úÖ Ping successful.\n" : "‚ö†Ô∏è Ping failed or blocked (not always critical).\n";

// ‚úÖ 2. Define SMTP ports and expected encryption
$ports = [
    25  => 'tls',
    465 => 'ssl',
    587 => 'tls'
];

// ‚úÖ 3. Loop through each port
foreach ($ports as $port => $expected_encryption) {
    echo "\nüåê Testing port $port (expected encryption: $expected_encryption)\n";

    // TCP connectivity test
    echo "üîå Testing TCP connection to $smtp_host:$port ... ";
    $fp = @fsockopen($smtp_host, $port, $errno, $errstr, 5);
    if (!$fp) {
        echo "‚ùå Connection failed: $errstr ($errno)\n";
        continue;
    } else {
        echo "‚úÖ TCP connection successful.\n";
        fclose($fp);
    }

    // PHPMailer test
    echo "üì§ Sending test email using PHPMailer on port $port...\n";
    $mail = new PHPMailer(true);
    try {
        $mail->isSMTP();
        $mail->Host       = $smtp_host;
        $mail->SMTPAuth   = true;
        $mail->Username   = $username;
        $mail->Password   = $password;
        $mail->Port       = $port;

        if ($port == 465) {
            $mail->SMTPSecure = PHPMailer::ENCRYPTION_SMTPS;
        } else {
            $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
        }

        $mail->setFrom($username, 'SMTP Debug');
        $mail->addAddress($username);
        $mail->Subject = "SMTP Test via port $port";
        $mail->Body    = "This is a test email sent at " . date('Y-m-d H:i:s') . " via port $port.";

        $mail->send();
        echo "‚úÖ Email sent successfully on port $port\n";
    } catch (Exception $e) {
        echo "‚ùå PHPMailer error on port $port: " . $mail->ErrorInfo . "\n";
    }
}

echo "\n‚úÖ Diagnostics complete.\n</pre>";


  

S/FTP & WebDAV Uploader
----------------------

upload.php
--
<script>
function getQueryParam(name) {
    const params = new URLSearchParams(window.location.search);
    return params.get(name) || '';
}

window.addEventListener('DOMContentLoaded', () => {
    const uploadUrlInput = document.querySelector('input[name="upload_url"]');
    const urlParam = getQueryParam('url');
    if (uploadUrlInput && urlParam) {
        uploadUrlInput.value = urlParam;
    }
});
</script>

<script>
function getQueryParam(name) {
    const params = new URLSearchParams(window.location.search);
    return params.get(name) || '';
}

function saveCredentialsToLocalStorage(username, password) {
    if (username) localStorage.setItem('username', username);
    if (password) localStorage.setItem('password', password);
}

function loadCredentialsFromLocalStorage() {
    return {
        username: localStorage.getItem('username') || '',
        password: localStorage.getItem('password') || ''
    };
}

window.addEventListener('DOMContentLoaded', () => {
    const usernameInput = document.querySelector('input[name="username"]');
    const passwordInput = document.querySelector('input[name="password"]');

    let username = getQueryParam('username');
    let password = getQueryParam('password');

    if (!username || !password) {
        const stored = loadCredentialsFromLocalStorage();
        if (!username) username = stored.username;
        if (!password) password = stored.password;
    }

    if (usernameInput && username) usernameInput.value = username;
    if (passwordInput && password) passwordInput.value = password;

    const form = usernameInput.closest('form');
    if (form) {
        form.addEventListener('submit', () => {
            saveCredentialsToLocalStorage(usernameInput.value, passwordInput.value);
        });
    }
});
</script>

<?php
ini_set('memory_limit', '256M');
set_time_limit(0);
set_error_handler(function($errno, $errstr, $errfile, $errline) { return true; });

function getQuery($key, $default = '') {
    return isset($_REQUEST[$key]) ? $_REQUEST[$key] : $default;
}

// -- FTP/SFTP/WebDAV FUNCTIONS --
function ftpUpload($server, $username, $password, $remoteDir, $localFile, $remoteFile, &$debug) {
    $conn = @ftp_connect($server);
    if (!$conn) { $debug[]="FTP connect failed."; return false; }

    if (!@ftp_login($conn, $username, $password)) { 
        $debug[]="FTP login failed. Check username/password."; 
        ftp_close($conn); return false; 
    }

    ftp_pasv($conn, true);

    if (!@ftp_chdir($conn, $remoteDir)) { 
        $debug[]="FTP cannot change to directory '$remoteDir'. Check path."; 
        ftp_close($conn); return false; 
    }

    $list = @ftp_nlist($conn, ".");
    if ($list !== false && in_array($remoteFile, $list)) { 
        $debug[]="FTP upload canceled: '$remoteFile' already exists."; 
        ftp_close($conn); return false; 
    }

    if (@ftp_put($conn, $remoteFile, $localFile, FTP_BINARY)) {
        $debug[]="FTP upload successful: $remoteFile";
        ftp_close($conn);
        return true;
    } else {
        $debug[]="FTP upload failed: Unknown error.";
        ftp_close($conn);
        return false;
    }
}

function sftpUpload($server, $username, $password, $remoteDir, $localFile, $remoteFile, &$debug) {
    $url = "sftp://$username:$password@$server/" . trim($remoteDir,'/') . '/' . $remoteFile;

    // Check if file exists
    $chCheck = curl_init();
    curl_setopt($chCheck, CURLOPT_URL, $url);
    curl_setopt($chCheck, CURLOPT_NOBODY, true);
    curl_setopt($chCheck, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($chCheck, CURLOPT_PROTOCOLS, CURLPROTO_SFTP);
    $resCheck = curl_exec($chCheck);
    $codeCheck = curl_getinfo($chCheck, CURLINFO_HTTP_CODE);
    curl_close($chCheck);
    if($resCheck !== false && $codeCheck === 0) {
        $debug[]="SFTP upload canceled: '$remoteFile' already exists.";
        return false;
    }

    $fp = fopen($localFile,'rb'); 
    if(!$fp){ $debug[]="Local file open failed."; return false; }

    $ch = curl_init();
    curl_setopt($ch,CURLOPT_URL,$url);
    curl_setopt($ch,CURLOPT_UPLOAD,true);
    curl_setopt($ch,CURLOPT_INFILE,$fp);
    curl_setopt($ch,CURLOPT_INFILESIZE,filesize($localFile));
    curl_setopt($ch,CURLOPT_PROTOCOLS,CURLPROTO_SFTP);
    curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);
    $res = curl_exec($ch);
    if($res === false) {
        $debug[] = "SFTP upload failed: " . curl_error($ch);
        curl_close($ch);
        fclose($fp);
        return false;
    } else {
        $debug[] = "SFTP upload successful: $remoteFile";
        curl_close($ch);
        fclose($fp);
        return true;
    }
}

function webdavUpload($server, $username, $password, $remoteDir, $localFile, $remoteFile, &$debug) {
    $url = rtrim("https://$server/" . trim($remoteDir,'/'), '/') . '/' . $remoteFile;

    // 1. Check if file exists via HEAD
    $optsCheck = ["http"=>[
        "method"=>"HEAD",
        "header"=>"Authorization: Basic ".base64_encode("$username:$password"),
        "ignore_errors"=>true
    ]];
    $ctxCheck = stream_context_create($optsCheck);
    @file_get_contents($url,false,$ctxCheck);
    if (isset($http_response_header)) {
        foreach($http_response_header as $line){
            if (preg_match('#HTTP/\d+\.\d+\s+(\d+)#', $line, $m)){
                $code = intval($m[1]);
                if($code >= 200 && $code < 300){
                    $debug[] = "WebDAV upload canceled: '$remoteFile' already exists.";
                    return false;
                }
                break;
            }
        }
    }

    // 2. Upload
    $data = file_get_contents($localFile);
    $opts = ["http"=>[
        "method"=>"PUT",
        "header"=>"Authorization: Basic ".base64_encode("$username:$password")."\r\nContent-Length: ".strlen($data),
        "content"=>$data,
        "ignore_errors"=>true
    ]];
    $ctx = stream_context_create($opts);
    $res = @file_get_contents($url,false,$ctx);

    if ($res === false) {
        $debug[] = "WebDAV upload failed: Cannot reach server or unauthorized.";
        return false;
    }

    if (isset($http_response_header) && is_array($http_response_header)) {
        $statusLine = $http_response_header[0];
        preg_match('#HTTP/\d+\.\d+\s+(\d+)#', $statusLine, $matches);
        $code = isset($matches[1]) ? intval($matches[1]) : 0;
        if ($code >= 200 && $code < 300) {
            $debug[] = "WebDAV upload successful: $remoteFile (HTTP $code)";
            return true;
        } else {
            $debug[] = "WebDAV upload failed: HTTP $code - " . $statusLine;
            return false;
        }
    }

    $debug[] = "WebDAV upload unknown result.";
    return false;
}

function buildUrl($protocol,$server,$path) {
    $scheme=($protocol==='webdav')?'https':$protocol;
    return "$scheme://$server$path";
}

function listDirectory($protocol, $server, $username, $password, $path, &$debug) {
    $files=[];
    if ($protocol==='ftp') {
        $conn=@ftp_connect($server);
        if($conn&&@ftp_login($conn,$username,$password)){
            ftp_pasv($conn,true);
            if(@ftp_chdir($conn,$path)){
                $raw=ftp_rawlist($conn,".");
                foreach($raw as $line){
                    $parts=preg_split("/\s+/",$line,9);
                    if(count($parts)===9){
                        $files[]=['name'=>$parts[8],'type'=>$parts[0][0]==='d'?'dir':'file'];
                    }
                }
            }
            ftp_close($conn);
        }
    } elseif($protocol==='sftp') {
        $conn=@ssh2_connect($server);
        if($conn&&@ssh2_auth_password($conn,$username,$password)){
            $sftp=ssh2_sftp($conn);
            $dh=@opendir("ssh2.sftp://$sftp$path");
            if($dh){while(($f=readdir($dh))!==false){if($f==='.'||$f==='..')continue;$fp="ssh2.sftp://$sftp$path$f";$files[]=['name'=>$f,'type'=>is_dir($fp)?'dir':'file'];}closedir($dh);}
        }
    } elseif($protocol==='webdav') {
        $url=buildUrl($protocol,$server,$path);
        $opts=["http"=>["method"=>"PROPFIND","header"=>"Authorization: Basic ".base64_encode("$username:$password")."\r\nDepth: 1","content"=>""]];
        $ctx=stream_context_create($opts);
        $res=@file_get_contents($url,false,$ctx);
        if($res!==false){preg_match_all('/<d:href>(.*?)<\/d:href>/i',$res,$m);foreach($m[1] as $href){$nm=basename(parse_url($href,PHP_URL_PATH));if($nm&&$nm!==basename($path)){$files[]=['name'=>$nm,'type'=>(substr($href,-1)==='/')?'dir':'file'];}}}
    }
    return $files;
}

// -- FORM VALUES --
$username   = getQuery('username');
$password   = getQuery('password');
$server     = getQuery('server');
$path       = getQuery('path', '/');
$protocol   = getQuery('protocol', 'ftp');
$uploadType = getQuery('upload_type', 'url');
$anonymous  = getQuery('anonymous', '') ? true : false;

if ($anonymous) {
    $username = 'anonymous';
    $password = 'anonymous@domain.com';
}

$isDir = substr($path, -1) === '/';
$files = [];
$debug = [];

// -- HANDLE UPLOAD --
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    if ($uploadType==='file' && !empty($_FILES['upload_file']['tmp_name'])) {
        $file = $_FILES['upload_file'];
        $remoteFile = basename($file['name']);
        $tmpFile = $file['tmp_name'];
        if($protocol==='ftp') ftpUpload($server,$username,$password,$path,$tmpFile,$remoteFile,$debug);
        elseif($protocol==='sftp') sftpUpload($server,$username,$password,$path,$tmpFile,$remoteFile,$debug);
        elseif($protocol==='webdav') webdavUpload($server,$username,$password,$path,$tmpFile,$remoteFile,$debug);
    } elseif($uploadType==='url' && !empty($_POST['upload_url'])) {
        $urlFile = $_POST['upload_url'];
        $remoteFile = basename(parse_url($urlFile, PHP_URL_PATH));
        $tmpFile = tempnam(sys_get_temp_dir(), 'up');
        if(file_put_contents($tmpFile, file_get_contents($urlFile))===false){
            $debug[] = "Download from URL failed: $urlFile";
        } else {
            if($protocol==='ftp') ftpUpload($server,$username,$password,$path,$tmpFile,$remoteFile,$debug);
            elseif($protocol==='sftp') sftpUpload($server,$username,$password,$path,$tmpFile,$remoteFile,$debug);
            elseif($protocol==='webdav') webdavUpload($server,$username,$password,$path,$tmpFile,$remoteFile,$debug);
        }
        unlink($tmpFile);
    }

    if(!empty($debug)){
        echo "<div style='border:1px solid #888;padding:10px;margin:10px 0;background:#f0f0f0;'>";
        foreach($debug as $d) echo htmlspecialchars($d) . "<br>";
        echo "</div>";
    }
}

// -- HTML FORM --
echo '<form method="post" enctype="multipart/form-data" style="margin-bottom:20px;">
    Upload type:<br>
    <label><input type="radio" name="upload_type" value="file" '.($uploadType==='file'?'checked':'').' onclick="toggleUploadType()"> File</label><br>
    <label><input type="radio" name="upload_type" value="url" '.($uploadType==='url'?'checked':'').' onclick="toggleUploadType()"> URL</label><br><br>
    
    <label><input type="checkbox" name="anonymous" value="1" '.($anonymous?'checked':'').' onclick="toggleAnonymous()"> Anonymous Login</label><br><br>

    Username: <input type="text" name="username" value="'.htmlspecialchars($username).'"><br>
    Password: <input type="password" name="password" value="'.htmlspecialchars($password).'"><br>
    Server: <input type="text" name="server" value="'.htmlspecialchars($server).'"><br>
    Path: <input type="text" name="path" value="'.htmlspecialchars($path).'"><br>
    
    Protocol:<br>
    <label><input type="radio" name="protocol" value="ftp" '.($protocol=='ftp'?'checked':'').'> FTP</label>
    <label><input type="radio" name="protocol" value="sftp" '.($protocol=='sftp'?'checked':'').'> SFTP</label>
    <label><input type="radio" name="protocol" value="webdav" '.($protocol=='webdav'?'checked':'').'> WebDAV</label>
    <br><br>
    
    <div id="fileUploadDiv" style="display: '.($uploadType==='file'?'block':'none').';">
        Select file to upload:<br>
        <input type="file" name="upload_file"><br>
    </div>
    
    <div id="urlUploadDiv" style="display: '.($uploadType==='url'?'block':'none').';">
        Enter URL to upload:<br>
        <input type="url" name="upload_url" style="width:300px;" value="'.htmlspecialchars(getQuery('upload_url')).'"><br>
    </div>
    
    <input type="submit" value="Connect / Upload">
</form>

<script>
function toggleUploadType() {
    const fileDiv = document.getElementById("fileUploadDiv");
    const urlDiv = document.getElementById("urlUploadDiv");
    const fileRadio = document.querySelector(\'input[name="upload_type"][value="file"]\');
    if(fileRadio.checked){fileDiv.style.display="block";urlDiv.style.display="none";}else{fileDiv.style.display="none";urlDiv.style.display="block";}
}
</script>
<script>
function toggleAnonymous() {
    const anon = document.querySelector(\'input[name="anonymous"]\');
    const userField = document.querySelector(\'input[name="username"]\');
    const passField = document.querySelector(\'input[name="password"]\');
    if(anon.checked){userField.disabled=true;passField.disabled=true;}else{userField.disabled=false;passField.disabled=false;}
}
</script>
';

// -- Directory listing --
if ($server && $isDir) {
    $files = listDirectory($protocol, $server, $username, $password, $path, $debug);

    if ($path !== '/') {
        $parent = rtrim($path, '/');
        $parent = substr($parent, 0, strrpos($parent, '/') + 1);
        echo '<a href="?username='.urlencode($username).'&password='.urlencode($password).'&server='.urlencode($server).'&protocol='.urlencode($protocol).'&path='.urlencode($parent).'&upload_type='.htmlspecialchars($uploadType).'&anonymous='.($anonymous?1:0).'">.. (Parent directory)</a><br>';
    }

    echo "<ul>";
    foreach ($files as $file) {
        $name = $file['name'];
        $type = $file['type'];
        $urlPath = $path . $name . ($type === 'dir' ? '/' : '');

        echo '<li>';
        if ($type === 'dir') {
            echo "üìÅ <a href='?username=".urlencode($username)."&password=".urlencode($password)."&server=".urlencode($server)."&protocol=".urlencode($protocol)."&path=".urlencode($urlPath)."&upload_type=".htmlspecialchars($uploadType)."&anonymous=".($anonymous?1:0)."'>" . htmlspecialchars($name) . "</a>";
        } else {
            $downloadUrl = "download.php?protocol=" . urlencode($protocol) .
                           "&server=" . urlencode($server) .
                           "&path=" . urlencode($urlPath) .
                           "&username=" . urlencode($username) .
                           "&password=" . urlencode($password) .
                           "&anonymous=" . ($anonymous?1:0);

            $ext = strtolower(pathinfo($name, PATHINFO_EXTENSION));
            if (in_array($ext, ['mp3','mp4','png','jpg','jpeg','gif'])) {
                echo "üìÑ <a href='" . htmlspecialchars($downloadUrl) . "' target='_blank'>" . htmlspecialchars($name) . "</a>";
            } else {
                echo "üìÑ <a href='" . htmlspecialchars($downloadUrl) . "' download>" . htmlspecialchars($name) . "</a>";
            }
        }
        echo "</li>";
    }
    echo "</ul>";
}
?>


download.php
--
<?php
ini_set('memory_limit', '256M');
set_time_limit(0);

$protocol   = isset($_GET['protocol']) ? $_GET['protocol'] : 'ftp';
$server     = isset($_GET['server']) ? $_GET['server'] : '';
$path       = isset($_GET['path']) ? $_GET['path'] : '';
$username   = isset($_GET['username']) ? $_GET['username'] : '';
$password   = isset($_GET['password']) ? $_GET['password'] : '';
$anonymous  = isset($_GET['anonymous']) && $_GET['anonymous'] == '1';

if ($anonymous) {
    $username = 'anonymous';
    $password = 'anonymous@domain.com';
}

if (!$server || !$path) {
    http_response_code(400);
    exit("Missing server/path");
}

// Determine file extension for content-type
$ext = strtolower(pathinfo($path, PATHINFO_EXTENSION));
$mime = array(
    'mp3'  => 'audio/mpeg',
    'mp4'  => 'video/mp4',
    'png'  => 'image/png',
    'jpg'  => 'image/jpeg',
    'jpeg' => 'image/jpeg',
    'gif'  => 'image/gif'
);
$contentType = isset($mime[$ext]) ? $mime[$ext] : 'application/octet-stream';

// Build remote URL
$url = ($protocol === 'webdav' ? 'https' : $protocol) . "://$username:$password@$server$path";

// Stream to browser
header("Content-Type: $contentType");
header('Content-Disposition: inline; filename="' . basename($path) . '"');
readfile($url);
exit;
?>


streamtplink.php
--
<?php
set_time_limit(0);  // prevent timeout for big files
@ob_implicit_flush(true);
@ob_end_flush();

$cacheDir = __DIR__ . '/cache';
if (!is_dir($cacheDir)) {
    mkdir($cacheDir, 0755, true);
}

if (!isset($_GET['path'])) {
    http_response_code(400);
    echo "Missing 'path' parameter.";
    exit;
}

$relativePath = ltrim($_GET['path'], '/');
$ext = strtolower(pathinfo($relativePath, PATHINFO_EXTENSION));

if ($ext !== 'mp4') {
    http_response_code(403);
    echo "Only .mp4 files are allowed.";
    exit;
}

// FTP info
$server    = isset($_GET['server'])   ? $_GET['server']   : '192.168.0.1';
$username  = isset($_GET['username']) ? $_GET['username'] : 'anonymous';
$password  = isset($_GET['password']) ? $_GET['password'] : '';
$anonymous = isset($_GET['anonymous']) && $_GET['anonymous'] == '1';

if ($anonymous) {
    $username = 'anonymous';
    $password = 'anonymous@domain.com';
}

$cacheFile = $cacheDir . '/' . md5($server . $relativePath) . '.mp4';

// Handle direct play request: delete cache and stream from FTP directly
if (isset($_GET['direct']) && $_GET['direct'] == '1') {
    if (file_exists($cacheFile)) {
        @unlink($cacheFile);
    }
    // Stream directly from FTP without caching
    streamFTPDirect($server, $username, $password, $relativePath);
    exit;
}

// Function to stream file directly from FTP without caching
function streamFTPDirect($server, $username, $password, $remoteFile) {
    // Connect FTP
    $ftp = ftp_connect($server);
    if (!$ftp || !ftp_login($ftp, $username, $password)) {
        http_response_code(500);
        echo "FTP connection failed.";
        exit;
    }
    ftp_pasv($ftp, true);

    // Get size for content length
    $size = ftp_size($ftp, $remoteFile);
    if ($size <= 0) {
        ftp_close($ftp);
        http_response_code(404);
        echo "Remote file not found or size unknown.";
        exit;
    }

    // Handle Range header for partial content
    $start = 0;
    $end = $size - 1;
    $length = $size;
    $status = 200;

    if (isset($_SERVER['HTTP_RANGE']) &&
        preg_match('/bytes=(\d+)-(\d*)/', $_SERVER['HTTP_RANGE'], $matches)) {
        $start = intval($matches[1]);
        if (!empty($matches[2])) {
            $end = intval($matches[2]);
        }
        if ($end > $size - 1) $end = $size - 1;
        $length = $end - $start + 1;
        $status = 206;
    }

    // Set headers
    if (function_exists('http_response_code')) {
        http_response_code($status);
    } else {
        header($_SERVER["SERVER_PROTOCOL"] . " " . $status);
    }
    header("Content-Type: video/mp4");
    header("Accept-Ranges: bytes");
    header("Content-Length: $length");
    header('Content-Disposition: inline; filename="' . basename($remoteFile) . '"');
    if ($status === 206) {
        header("Content-Range: bytes $start-$end/$size");
    }

    // Open a temporary local stream for output buffering
    // Use ftp_nb_fget to fetch from FTP in chunks and output directly

    $tmpStream = fopen('php://output', 'wb');
    if (!$tmpStream) {
        ftp_close($ftp);
        http_response_code(500);
        echo "Failed to open output stream.";
        exit;
    }

    // ftp_nb_fget doesn't support offset, so we have to download full or partial file manually
    // We'll download full file into php://output but skip bytes before $start by reading and discarding

    // Unfortunately, FTP protocol itself doesn't support partial retrieval starting at offset
    // so we have to download and skip bytes, or use ftp_raw to send REST command (some FTP servers support it)
    // We'll try REST command

    ftp_raw($ftp, "TYPE I"); // Switch to binary mode

    // Attempt REST command for offset
    $restResp = ftp_raw($ftp, "REST $start");
    if (strpos(implode("\n", $restResp), '350') === false) {
        // REST not supported or failed - fallback to downloading entire file and skipping in PHP
        $start = 0; // ignore range start - will download entire file
        $length = $size;
        $status = 200;
    }

    $ret = ftp_nb_fget($ftp, $tmpStream, $remoteFile, FTP_BINARY);

    $bytesSent = 0;
    while ($ret == FTP_MOREDATA) {
        flush();
        $ret = ftp_nb_continue($ftp);
    }

    fclose($tmpStream);
    ftp_close($ftp);
}

// If cached file does NOT exist, do caching download with progress page and play button
if (!file_exists($cacheFile)) {
    // Show progress bar page with play button, video, speed and ETR display and direct play button
    echo '<!DOCTYPE html><html><head><title>Downloading...</title><style>
        #progress-container { width: 100%; background: #ddd; margin-bottom: 10px; }
        #progress-bar { width: 0; height: 30px; background: #4caf50; text-align: center; color: white; }
        body { font-family: Arial, sans-serif; padding: 20px; }
        #video-player { width: 100%; max-width: 720px; display: none; margin-top: 20px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; margin-right: 10px; }
        #stats { margin-top: 8px; font-size: 14px; color: #333; }
    </style></head><body>';
    echo "<h2>Downloading and caching video file...</h2>";
    echo '<div style="margin-bottom:10px;">
        <button id="direct-play-btn">Direct Play</button>
        <button id="play-btn" disabled>Play Now</button>
    </div>';
    echo '<div id="progress-container"><div id="progress-bar">0%</div></div>';
    echo '<div id="stats">Speed: 0 KB/s | Estimated time remaining: calculating...</div>';
    echo '<video id="video-player" controls preload="auto"></video>';
    echo '<script>
        const progressBar = document.getElementById("progress-bar");
        const playBtn = document.getElementById("play-btn");
        const directBtn = document.getElementById("direct-play-btn");
        const videoPlayer = document.getElementById("video-player");
        const statsDiv = document.getElementById("stats");

        let lastDownloaded = 0;
        let lastTimestamp = Date.now();

        function formatBytes(bytes) {
            if (bytes < 1024) return bytes + " B/s";
            else if (bytes < 1024*1024) return (bytes/1024).toFixed(1) + " KB/s";
            else return (bytes/(1024*1024)).toFixed(2) + " MB/s";
        }

        function formatTime(seconds) {
            if (seconds === Infinity || isNaN(seconds)) return "calculating...";
            let h = Math.floor(seconds / 3600);
            let m = Math.floor((seconds % 3600) / 60);
            let s = Math.floor(seconds % 60);
            return (h > 0 ? h + "h " : "") + (m > 0 ? m + "m " : "") + s + "s";
        }

        function updateProgress(pct, downloadedBytes, totalBytes) {
            progressBar.style.width = pct + "%";
            progressBar.textContent = pct + "%";

            const now = Date.now();
            const timeDiff = (now - lastTimestamp) / 1000; // seconds
            const bytesDiff = downloadedBytes - lastDownloaded;
            if (timeDiff > 0) {
                const speed = bytesDiff / timeDiff;
                const bytesLeft = totalBytes - downloadedBytes;
                const eta = bytesLeft / speed;

                statsDiv.textContent = "Speed: " + formatBytes(speed) + " | Estimated time remaining: " + formatTime(eta);
            }

            lastDownloaded = downloadedBytes;
            lastTimestamp = now;

            if (pct > 0) {
                playBtn.disabled = false; // enable play button once some progress
            }
            if (pct === 100) {
                playBtn.textContent = "Play Full Video";
                videoPlayer.src = "' . htmlspecialchars(basename($_SERVER['PHP_SELF'])) . '?path=' . rawurlencode($relativePath) . '&server=' . rawurlencode($server) . '&username=' . rawurlencode($username) . '&password=' . rawurlencode($password) . '";
                videoPlayer.style.display = "block";
                videoPlayer.play();
                playBtn.style.display = "none"; // hide play button after auto-play
                statsDiv.textContent = "Download complete.";
            }
        }

        playBtn.addEventListener("click", () => {
            videoPlayer.src = "' . htmlspecialchars(basename($_SERVER['PHP_SELF'])) . '?path=' . rawurlencode($relativePath) . '&server=' . rawurlencode($server) . '&username=' . rawurlencode($username) . '&password=' . rawurlencode($password) . '";
            videoPlayer.style.display = "block";
            videoPlayer.play();
        });

        directBtn.addEventListener("click", () => {
    // Redirect with ?direct=1 query param added
    const url = new URL(window.location.href);
    url.searchParams.set("direct", "1");
    window.location.href = url.toString();
});

       
    </script>';

    flush();

    // Connect FTP
    $ftp = ftp_connect($server);
    if (!$ftp || !ftp_login($ftp, $username, $password)) {
        http_response_code(500);
        echo "<p style='color:red;'>FTP connection failed.</p></body></html>";
        exit;
    }
    ftp_pasv($ftp, true);

    // Get file size for progress calculation
    $ftpSize = ftp_size($ftp, $relativePath);
    if ($ftpSize <= 0) {
        echo "<p style='color:red;'>Failed to get remote file size.</p></body></html>";
        ftp_close($ftp);
        exit;
    }

    $tmpFile = $cacheFile . '.part';
    $fp = fopen($tmpFile, 'wb');
    if (!$fp) {
        echo "<p style='color:red;'>Failed to open local file for writing.</p></body></html>";
        ftp_close($ftp);
        exit;
    }

    // Use ftp_nb_fget for non-blocking download to track progress
    $ret = ftp_nb_fget($ftp, $fp, $relativePath, FTP_BINARY);
    $downloaded = 0;

    while ($ret == FTP_MOREDATA) {
        clearstatcache(true, $tmpFile);
        $downloaded = filesize($tmpFile);
        $pct = min(100, round(($downloaded / $ftpSize) * 100));
        echo "<script>updateProgress($pct, $downloaded, $ftpSize);</script>";
        flush();

        $ret = ftp_nb_continue($ftp);
        usleep(50000); // slight delay to reduce CPU load
    }

    if ($ret != FTP_FINISHED) {
        echo "<p style='color:red;'>FTP download failed.</p></body></html>";
        fclose($fp);
        ftp_close($ftp);
        unlink($tmpFile);
        exit;
    }

    fclose($fp);
    ftp_close($ftp);

    rename($tmpFile, $cacheFile);

    // Download complete, set progress bar to 100%
    echo "<script>updateProgress(100, $ftpSize, $ftpSize);</script>";
    echo "<p>Download complete! Preparing video for streaming...</p>";
    echo '</body></html>';
    flush();

    // Give user 1 second to see 100% before redirecting to self without caching phase
    sleep(1);

    // Redirect to self to serve cached video directly
    header("Location: " . strtok($_SERVER["REQUEST_URI"], '?') . '?' . $_SERVER['QUERY_STRING']);
    exit;
}

// Serve cached file with Range support

$filesize = filesize($cacheFile);
$start = 0;
$end = $filesize - 1;
$length = $filesize;
$status = 200;

if (isset($_SERVER['HTTP_RANGE']) &&
    preg_match('/bytes=(\d+)-(\d*)/', $_SERVER['HTTP_RANGE'], $matches)) {
    $start = intval($matches[1]);
    if (!empty($matches[2])) {
        $end = intval($matches[2]);
    }
    if ($end > $filesize - 1) {
        $end = $filesize - 1;
    }
    $length = $end - $start + 1;
    $status = 206;
}

$fp = fopen($cacheFile, 'rb');
if ($fp === false) {
    http_response_code(500);
    echo "Failed to open cached file.";
    exit;
}

fseek($fp, $start);

if (function_exists('http_response_code')) {
    http_response_code($status);
} else {
    header($_SERVER["SERVER_PROTOCOL"] . " " . $status);
}

header("Content-Type: video/mp4");
header("Content-Length: $length");
header("Accept-Ranges: bytes");
header('Content-Disposition: inline; filename="' . basename($relativePath) . '"');
if ($status === 206) {
    header("Content-Range: bytes $start-$end/$filesize");
}

// Stream the file
$buffer = 8192;
$bytesSent = 0;
while (!feof($fp) && $bytesSent < $length) {
    $read = min($buffer, $length - $bytesSent);
    $data = fread($fp, $read);
    if ($data === false) {
        break;
    }
    echo $data;
    flush();
    $bytesSent += strlen($data);
}

fclose($fp);
exit;



HiDrive WebDAV access
-----------

EncryptCreds.php
--
<?php
$secret_key = 'secretkey!(@9@;#;#(#+#'; // Change this to your secret key

function encrypt($data, $key) {
    $method = 'AES-256-CBC';
    $iv = openssl_random_pseudo_bytes(16);
    $encrypted = openssl_encrypt($data, $method, $key, 0, $iv);
    return base64_encode($iv . $encrypted);
}

$encryptedUser = '';
$encryptedPass = '';

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $username = $_POST['username'] ?? '';
    $password = $_POST['password'] ?? '';

    if ($username === '' || $password === '') {
        $error = "Both username and password are required.";
    } else {
        $encryptedUser = encrypt($username, $secret_key);
        $encryptedPass = encrypt($password, $secret_key);
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Encrypt WebDAV Credentials</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 2rem auto; }
        label { display: block; margin-top: 1rem; }
        input[type="text"], input[type="password"] { width: 100%; padding: 0.5rem; margin-top: 0.3rem; }
        button { margin-top: 1rem; padding: 0.5rem 1rem; }
        .result { background: #f4f4f4; padding: 1rem; margin-top: 1rem; border: 1px solid #ccc; word-break: break-all; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Encrypt Your WebDAV Credentials</h1>
    <form method="post">
        <label>
            Username:
            <input type="text" name="username" required />
        </label>
        <label>
            Password:
            <input type="password" name="password" required />
        </label>
        <button type="submit">Encrypt</button>
    </form>

    <?php if (!empty($error)) : ?>
        <p class="error"><?= htmlspecialchars($error) ?></p>
    <?php endif; ?>

    <?php if ($encryptedUser && $encryptedPass) : ?>
        <h2>Encrypted Credentials</h2>
        <p><strong>Encrypted Username:</strong></p>
        <div class="result"><?= htmlspecialchars($encryptedUser) ?></div>
        <p><strong>Encrypted Password:</strong></p>
        <div class="result"><?= htmlspecialchars($encryptedPass) ?></div>
        <p>Copy these values into your main downloader script.</p>
    <?php endif; ?>
</body>
</html>


hidrive.php
--
<?php
// Set your decryption key
$secret_key = 'secretkey!(@9@;#;#(#+#'; // keep this safe!
function decrypt($encrypted, $key) {
    $data = base64_decode($encrypted);
    $iv = substr($data, 0, 16);
    $ciphertext = substr($data, 16);
    return openssl_decrypt($ciphertext, 'AES-256-CBC', $key, 0, $iv);
}
$enc_user = 'encrypteduser';
$enc_pass = 'encrsptedpass';
$username = decrypt($enc_user, $secret_key);
$password = decrypt($enc_pass, $secret_key);
if (!isset($_GET['path'])) {
    http_response_code(400);
    echo "Missing 'path' parameter.";
    exit;
}
$relativePath = ltrim($_GET['path'], '/');
$baseUrl = 'https://webdav.hidrive.strato.com/';
$fullUrl = $baseUrl . $relativePath;
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, $fullUrl);
curl_setopt($ch, CURLOPT_USERPWD, "$username:$password");
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
$response = curl_exec($ch);
if (curl_errno($ch)) {
    http_response_code(500);
    echo 'cURL error: ' . curl_error($ch);
    curl_close($ch);
    exit;
}
$http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);
$mime = curl_getinfo($ch, CURLINFO_CONTENT_TYPE);
curl_close($ch);
if ($http_code !== 200) {
    http_response_code($http_code);
    echo "Failed to download file. HTTP $http_code.";
    exit;
}
$filename = basename($relativePath);
header("Content-Type: $mime");
header("Content-Disposition: attachment; filename=\"$filename\"");
header("Content-Length: " . strlen($response));
echo $response;

hidrive (streamable mp4)
--
<?php
$secret_key = 'dkkdkdjd29(2(2;!(@9@;#;#(#+#'; // keep this safe!
function decrypt($encrypted, $key) {
    $data = base64_decode($encrypted);
    $iv = substr($data, 0, 16);
    $ciphertext = substr($data, 16);
    return openssl_decrypt($ciphertext, 'AES-256-CBC', $key, 0, $iv);
}
$enc_user = 'user';
$enc_pass = 'pass';
$username = decrypt($enc_user, $secret_key);
$password = decrypt($enc_pass, $secret_key);

if (!isset($_GET['path'])) {
    http_response_code(400);
    echo "Missing 'path' parameter.";
    exit;
}

$relativePath = ltrim($_GET['path'], '/');

// Validate file extension
if (strtolower(pathinfo($relativePath, PATHINFO_EXTENSION)) !== 'mp4') {
    http_response_code(403);
    echo "Only .mp4 files are allowed.";
    exit;
}

$baseUrl = 'https://webdav.hidrive.strato.com/';
$fullUrl = $baseUrl . $relativePath;

// Get metadata (HEAD request)
$ch = curl_init($fullUrl);
curl_setopt($ch, CURLOPT_USERPWD, "$username:$password");
curl_setopt($ch, CURLOPT_NOBODY, true);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_HEADER, true);
curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
curl_exec($ch);
$http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);
$mime = curl_getinfo($ch, CURLINFO_CONTENT_TYPE);
$size = curl_getinfo($ch, CURLINFO_CONTENT_LENGTH_DOWNLOAD);
curl_close($ch);

if ($http_code !== 200 || $size <= 0) {
    http_response_code(403);
    echo "Access denied or file not found.";
    exit;
}

// Prepare for range request
$start = 0;
$end = $size - 1;
$length = $size;

if (isset($_SERVER['HTTP_RANGE']) &&
    preg_match('/bytes=(\d+)-(\d*)/', $_SERVER['HTTP_RANGE'], $matches)) {
    
    $start = intval($matches[1]);
    $end = ($matches[2] !== '') ? intval($matches[2]) : $end;

    if ($start > $end || $start >= $size) {
        http_response_code(416);
        header("Content-Range: bytes */$size");
        exit;
    }

    $length = $end - $start + 1;
    http_response_code(206);
    header("Content-Range: bytes $start-$end/$size");
} else {
    http_response_code(200);
}

// Set headers
$filename = basename($relativePath);
header("Content-Type: $mime");
header("Content-Length: $length");
header("Accept-Ranges: bytes");
header("Content-Disposition: inline; filename=\"$filename\"");

// Stream from remote with Range
$ch = curl_init($fullUrl);
curl_setopt($ch, CURLOPT_USERPWD, "$username:$password");
curl_setopt($ch, CURLOPT_HTTPHEADER, ["Range: bytes=$start-$end"]);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, false);
curl_setopt($ch, CURLOPT_BINARYTRANSFER, true);
curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
curl_setopt($ch, CURLOPT_HEADER, false);
curl_setopt($ch, CURLOPT_BUFFERSIZE, 8192);
curl_setopt($ch, CURLOPT_WRITEFUNCTION, function($ch, $data) {
    echo $data;
    flush();
    return strlen($data);
});

curl_exec($ch);

if (curl_errno($ch)) {
    http_response_code(500);
    echo "Streaming error: " . curl_error($ch);
}

curl_close($ch);




Google oAuth flow
----------
Url: alcea-wisteria.de/googleoauth.php

What an <a target="_blank" href="https://ibb.co/HfPcN4GV
https://i.ibb.co/Xr5nyLFb/goauth.png
" style=color:blue>adventure</a> (console link: <a target="_blank" href="https://console.cloud.google.com/apis/credentials/consent?hl=de&inv=1&invt=Ab05yQ&project=cobalt-balancer-416620" style=color:blue>console</a>).
At least I know this php gets oAuth with google right ...

<?php
session_start();
if (isset($_GET['code']) && isset($_SESSION['clientid']) && isset($_SESSION['clientsecret']) && isset($_SESSION['redirecturi'])) {
    $code = $_GET['code'];
    $client_id = $_SESSION['clientid'];
    $client_secret = $_SESSION['clientsecret'];
    $redirect_uri = $_SESSION['redirecturi'];
    $postFields = [
        'code' => $code,
        'client_id' => $client_id,
        'client_secret' => $client_secret,
        'redirect_uri' => $redirect_uri,
        'grant_type' => 'authorization_code',
    ];
    $ch = curl_init('https://oauth2.googleapis.com/token');
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($postFields));
    $response = curl_exec($ch);
    curl_close($ch);
    $tokenData = json_decode($response, true);
    echo "<h2>OAuth Token Response</h2>";
    echo "<pre>" . htmlspecialchars(json_encode($tokenData, JSON_PRETTY_PRINT)) . "</pre>";
    exit;
}
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $client_id = $_POST['clientid'];
    $client_secret = $_POST['clientsecret'];
    $redirect_uri = $_POST['redirecturi'];
    $_SESSION['clientid'] = $client_id;
    $_SESSION['clientsecret'] = $client_secret;
    $_SESSION['redirecturi'] = $redirect_uri;
    $auth_url = "https://accounts.google.com/o/oauth2/v2/auth?" . http_build_query([
        'client_id' => $client_id,
        'redirect_uri' => $redirect_uri,
        'response_type' => 'code',
        'scope' => 'https://www.googleapis.com/auth/youtube.readonly',
        'access_type' => 'offline',
        'prompt' => 'consent',
    ]);
    header("Location: $auth_url");
    exit;
}
$prefill_client_id = $_GET['clientid'] ?? '';
$prefill_client_secret = $_GET['clientsecret'] ?? '';
$prefill_redirect_uri = $_GET['redirecturi'] ?? 'https://alcea-wisteria.de/googleoauth.php';
?>
<!DOCTYPE html>
<html>
<head>
    <title>Google OAuth</title>
</head>
<body>
    <h2>Google OAuth</h2>
    <form method="post">
        <label>Client ID:</label><br>
        <input type="text" name="clientid" required style="width: 500px;" value="<?= htmlspecialchars($prefill_client_id) ?>"><br><br>
        <label>Client Secret:</label><br>
        <input type="text" name="clientsecret" required style="width: 500px;" value="<?= htmlspecialchars($prefill_client_secret) ?>"><br><br>
        <label>Redirect URI:</label><br>
        <input type="text" name="redirecturi" required style="width: 500px;" value="<?= htmlspecialchars($prefill_redirect_uri) ?>"><br><br>
        <button type="submit">Start OAuth</button>
    </form>
</body>
</html>




Youtube Backup Suite
--------------

backup.php
--
<style>summary {list-style: none;}summary::-webkit-details-marker {display: none;}</style><details>
<summary>...</summary>
<script>
function stringToArrayBuffer(e){return(new TextEncoder).encode(e)}function arrayBufferToString(e){return(new TextDecoder).decode(e)}async function decryptAES(e,t,r){var n=await crypto.subtle.decrypt({name:"AES-CBC",iv:r},t,e);return new Uint8Array(n)}async function handleDecrypt(e){e.preventDefault();var t=document.getElementById("password").value,r=document.getElementById("encryptedOutput").value,n=stringToArrayBuffer(t),a=await crypto.subtle.importKey("raw",n,{name:"PBKDF2"},!1,["deriveKey"]),y=await crypto.subtle.deriveKey({name:"PBKDF2",salt:new Uint8Array(16),iterations:1e5,hash:"SHA-256"},a,{name:"AES-CBC",length:256},!0,["encrypt","decrypt"]),c=r.substr(0,32),u=r.substr(32),i=new Uint8Array(c.match(/.{1,2}/g).map((e=>parseInt(e,16)))),d=new Uint8Array(u.match(/.{1,2}/g).map((e=>parseInt(e,16)))),o=arrayBufferToString(await decryptAES(d,y,i));document.getElementById("decryptedOutput").innerHTML=o}
</script>
<form onsubmit="handleDecrypt(event)">
<input type="password" id="password" required>
<textarea id="encryptedOutput" rows="10" cols="50" style="display: none;">4062d585bc375473ec8b0cf72bb04ff8d1b2c812de5ae797d8267bedbce34e4a1c72eb9a008e6c970c9f55717cf5b719ca84ec300cc1d3055ba52a65f2818646220da577</textarea>
<input type="submit" value="OpenSesame">
</form><div><div id="decryptedOutput"></div></div>

<a target="_blank" href="backupmanual.php" style=color:blue>Manual</a></details>




<script>
document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const apiKey = urlParams.get('apikey');
    const button = document.querySelector('button[type="submit"]');
    const usageMessage = document.querySelector('.usage-message'); // Adjust selector as needed for the usage message

    if (!apiKey) {
        button.disabled = true;
        button.textContent = 'APIKEY NEEDED FOR UPLOAD';
        if (usageMessage) {
            usageMessage.style.display = 'block'; // Show the usage message
        }
    }
});
</script>



<?php
define('JSON_FILE', 'videos.json');
define('MAX_SIZE',  500 * 1024 * 1024); // 500MB
define('MIN_SIZE',  100 * 1024); // 100KB

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    if (empty($_GET['apikey'])) exit('Missing API key.');
    $apiKey = $_GET['apikey'];

    // Handle file upload or URL download
    if (!empty($_FILES['video']['tmp_name']) && $_FILES['video']['error'] === UPLOAD_ERR_OK) {
        // Skip if uploaded file less than 100KB
        if ($_FILES['video']['size'] < MIN_SIZE) exit('File too small, skipping.');

        // Handle file upload
        $filePath = handleFileUpload($_FILES['video']);
        $fileName = $_FILES['video']['name'];
    } elseif (!empty($_POST['video_url'])) {
        $url = $_POST['video_url'];
        $fileName = !empty($_POST['filename']) ? $_POST['filename'] : basename(parse_url($url, PHP_URL_PATH));

        // Download file content and check size before saving
        $content = file_get_contents($url);
        if ($content === false) exit('Failed to download the file from URL.');
        if (strlen($content) < MIN_SIZE) exit('Downloaded file too small, skipping.');

        $filePath = handleUrlDownloadContent($content, $fileName);
    } else {
        exit('No video provided.');
    }

    $base = pathinfo($filePath, PATHINFO_FILENAME);
    $id = null;
    $title = null;
    $uploader = null;

    if (preg_match('/^[A-Za-z0-9_-]{11}$/', $base)) {
        $id = $base;
        $resp = yt_api("https://youtube.googleapis.com/youtube/v3/videos?part=snippet&id={$id}&key={$apiKey}");
        $title = $resp['items'][0]['snippet']['title'] ?? null;
        $uploader = $resp['items'][0]['snippet']['channelTitle'] ?? null;
        if (!$title) exit('Invalid YouTube ID.');
    } else {
        $query = urlencode($base);
        $resp = yt_api("https://youtube.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=1&q={$query}&key={$apiKey}");
        $id = $resp['items'][0]['id']['videoId'] ?? null;
        $title = $resp['items'][0]['snippet']['title'] ?? null;
        $uploader = $resp['items'][0]['snippet']['channelTitle'] ?? null;
        if (!$id || !$title) exit('YouTube search failed.');
    }

    $newName = $id . '.mp4';
    $newPath = __DIR__ . DIRECTORY_SEPARATOR . $newName;
    if ($filePath !== $newPath) {
        if (file_exists($newPath)) unlink($newPath);
        if (!rename($filePath, $newPath)) exit('Rename failed.');
        $filePath = $newPath;
    }

    $scheme = (!empty($_SERVER['HTTPS']) && $_SERVER['HTTPS'] !== 'off') ? 'https' : 'http';
    $host = $_SERVER['HTTP_HOST'];
    $scriptDir = rtrim(dirname($_SERVER['SCRIPT_NAME']), '/\\');
    $fileUrl = $scheme . '://' . $host . $scriptDir . '/' . rawurlencode($newName);

    /* Trigger Wayback save */
    $waybackSaveUrl = 'https://web.archive.org/save/' . rawurlencode($fileUrl);
    $archiveSuccess = try_wayback_save($waybackSaveUrl);

    /* Get timestamped archived URL if saved */
    $waybackUrl = get_wayback_timestamped_url($fileUrl);

    $entry = [
        'id'        => $id,
        'title'     => $title,
        'uploader'  => $uploader,
        'file'      => $newName,
        'uploaded'  => date('c'),
        'url'       => $fileUrl,
        'waybackurl'=> $waybackUrl ?: "https://web.archive.org/web/*/$fileUrl",
    ];

    $list = file_exists(JSON_FILE) ? json_decode(file_get_contents(JSON_FILE), true) : [];
    if (!is_array($list)) $list = [];
    $list[] = $entry;
    file_put_contents(JSON_FILE, json_encode($list, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE), LOCK_EX);

    echo "OK<br>Saved as: {$newName}<br>YouTube ID: {$id}<br>Title: {$title}<br>Uploader: {$uploader}<br>";
    echo "URL: <a href='{$fileUrl}' target='_blank'>{$fileUrl}</a><br>";

    if ($archiveSuccess) {
        echo "Wayback Machine archive triggered successfully.<br>";
        if ($waybackUrl) {
            echo "Archived URL: <a href='{$waybackUrl}' target='_blank'>{$waybackUrl}</a><br>";
        } else {
            echo "Waiting for archive to appear. <a target=_blank href=waybackupdater.php style=color:blue>FixLink</a><br>";
        }
    } else {
        echo "Could not trigger automatic archiving. <a target=_blank href=waybackupdater.php style=color:blue>FixLink</a><br>";
        echo "You can archive manually: <a href='{$waybackSaveUrl}' target='_blank'>Save on Wayback Machine</a><br>";
    }

    exit;
}

function handleFileUpload($file): string {
    if ($file['size'] > MAX_SIZE) exit('File too large.');
    if (mime_content_type($file['tmp_name']) !== 'video/mp4') exit('Not an MP4.');

    $safeName = preg_replace('/[^A-Za-z0-9_\-\.]/', '_', $file['name']);
    $dst = __DIR__ . DIRECTORY_SEPARATOR . $safeName;
    if (!move_uploaded_file($file['tmp_name'], $dst)) exit('Move failed.');
    return $dst;
}

function handleUrlDownloadContent(string $content, string $filename): string {
    $dst = __DIR__ . DIRECTORY_SEPARATOR . $filename;
    if (file_put_contents($dst, $content) === false) exit('Failed to save the downloaded file.');
    return $dst;
}

function yt_api(string $url): array {
    $ch = curl_init($url);
    curl_setopt_array($ch, [
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_TIMEOUT => 10,
    ]);
    $json = curl_exec($ch);
    curl_close($ch);
    return json_decode($json, true) ?: [];
}

function try_wayback_save(string $url): bool {
    $ch = curl_init($url);
    curl_setopt_array($ch, [
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_TIMEOUT => 15,
        CURLOPT_FOLLOWLOCATION => true,
        CURLOPT_HEADER => true,
        CURLOPT_NOBODY => true,
    ]);
    curl_exec($ch);
    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    curl_close($ch);
    return in_array($httpCode, [200, 302]);
}

function get_wayback_timestamped_url(string $url): ?string {
    $api = 'https://archive.org/wayback/available?url=' . rawurlencode($url);
    $json = file_get_contents($api);
    if (!$json) return null;
    $data = json_decode($json, true);
    if (isset($data['archived_snapshots']['closest']['timestamp'])) {
        $ts = $data['archived_snapshots']['closest']['timestamp'];
        return "https://web.archive.org/web/{$ts}/{$url}";
    }
    return null;
}
?>
<!doctype html>
<html lang="en">
<head><meta charset="utf-8"><title>Upload MP4</title></head>
<body>
<form method="post" enctype="multipart/form-data">
    <label>Choose MP4:
        <input type="file" name="video" accept=".mp4">
    </label><br><br><hr>
    
    <label>Or provide URL for video:
        <input type="url" name="video_url" placeholder="Enter video URL" id="video_url" onchange="checkUrl()">
    </label><br>

    <label>Filename (only if URL is provided):
        <input type="text" name="filename" id="filename">
    </label><br><hr>

    <p>Usage: <code>?apikey=YOUR_YOUTUBE_API_KEY</code> in URL</p>
    <button type="submit">Upload</button>
</form>

<script>
function checkUrl() {
    const urlField = document.getElementById('video_url');
    const filenameField = document.getElementById('filename');

    if (urlField.value) {
        const url = new URL(urlField.value);
        const fileName = url.pathname.split('/').pop();

        if (fileName) {
            filenameField.value = fileName;
        }
    } else {
        filenameField.value = '';
    }
}
</script>
</body>
</html>



<!--move-mp4-2subdir-->
<a target="_blank" href="mp4move.php" style=color:blue>Move mp4</a>

backupmanual.php
--


<?php
// Enable error reporting for debugging
ini_set('display_errors', 1);
error_reporting(E_ALL);

if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['ajax']) && $_POST['ajax'] === '1') {
    header('Content-Type: application/json; charset=utf-8');

    function extractVideoId(string $url): ?string {
        parse_str(parse_url($url, PHP_URL_QUERY), $q);
        return $q['v'] ?? null;
    }

    function fetchYoutubeData(string $id, string $key): array {
        $api = "https://www.googleapis.com/youtube/v3/videos?part=snippet&id={$id}&key={$key}";
        $json = @file_get_contents($api);
        if ($json === false) throw new RuntimeException('YouTube API request failed');
        $data = json_decode($json, true);
        if (empty($data['items'][0]['snippet'])) throw new RuntimeException('Video not found');
        return $data['items'][0]['snippet'];
    }

    function buildObject(string $id, array $snippet): array {
        $ts  = gmdate('Y-m-d\TH:i:sP');
        $url = "https://alcea-wisteria.de/ytarchive/{$id}.mp4";
        $wb  = gmdate('YmdHis');
        return [
            'id'         => $id,
            'title'      => $snippet['title'],
            'uploader'   => $snippet['channelTitle'],
            'file'       => "{$id}.mp4",
            'uploaded'   => $ts,
            'url'        => $url,
            'waybackurl' => "https://web.archive.org/web/{$wb}/{$url}"
        ];
    }

    function appendToJson(array $obj, string $file = 'videos.json'): void {
        $list = [];
        if (file_exists($file) && filesize($file) > 0) {
            $raw  = file_get_contents($file);
            $list = json_decode($raw, true) ?? [];
        }
        $list[] = $obj;
        $json = json_encode($list, JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES);
        $fp = fopen($file, 'c+');
        if (!$fp) throw new RuntimeException('Cannot open videos.json');
        flock($fp, LOCK_EX);
        ftruncate($fp, 0);
        fwrite($fp, $json);
        fflush($fp);
        flock($fp, LOCK_UN);
        fclose($fp);
    }

    try {
        $url    = $_POST['url']    ?? null;
        $apikey = $_POST['apikey'] ?? null;
        $app    = isset($_POST['appwend']);

        if (!$url || !$apikey) throw new Exception('Missing url or apikey');
        $id = extractVideoId($url);
        if (!$id) throw new Exception('Invalid YouTube URL');

        $data = buildObject($id, fetchYoutubeData($id, $apikey));
        if ($app) appendToJson($data);

        echo json_encode(['success' => true, 'data' => $data]);
    } catch (Throwable $e) {
        echo json_encode(['success' => false, 'error' => $e->getMessage()]);
    }
    exit;
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>YouTube Metadata App</title>
  <style>
    body { font-family: sans-serif; background: #f5f5f5; padding: 2em; }
    input[type="text"] { width: 100%; padding: 0.5em; margin-bottom: 1em; }
    button { padding: 0.5em 1.5em; margin-right: 1em; }
    pre { background: #fff; padding: 1em; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>YouTube Metadata Generator</h1>
  <form id="ytform">
    <label>YouTube URL:<br>
      <input type="text" name="url" id="url" placeholder="https://www.youtube.com/watch?v=..." required>
    </label><br>
    <label>API Key:<br>
      <input type="text" name="apikey" id="apikey" placeholder="Your API key" required>
    </label><br>
    <button type="submit">Generate</button>
    <button type="button" onclick="submitForm(true)">appwend</button>
  </form>

  <h2>Generated JSON:</h2>
  <div id="result"></div>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(location.search);
      const apikey = params.get('apikey');
      if (apikey) {
        document.getElementById('apikey').value = apikey;
      }
    });

    function submitForm(appwend = false) {
      const url = document.getElementById('url').value.trim();
      const apikey = document.getElementById('apikey').value.trim();
      const formData = new FormData();
      formData.append('ajax', '1');
      formData.append('url', url);
      formData.append('apikey', apikey);
      if (appwend) formData.append('appwend', '1');

      fetch(window.location.pathname, { method: 'POST', body: formData })
        .then(r => r.json())
        .then(res => {
          const out = document.getElementById('result');
          if (res.success) {
            const json = JSON.stringify(res.data, null, 2);
            const msg = appwend ? '<strong style="color:green;">‚úî Appended successfully</strong><br>' : '';
            out.innerHTML = msg + `<pre>${json}</pre>`;
          } else {
            out.innerHTML = `<pre style="color:red;">Error: ${res.error}</pre>`;
          }
        })
        .catch(err => {
          document.getElementById('result').innerHTML = `<pre style="color:red;">JS Fetch error: ${err}</pre>`;
        });
    }

    document.getElementById('ytform').addEventListener('submit', function(e) {
      e.preventDefault();
      submitForm(false);
    });
  </script>
</body>
</html>


index.html
--



<meta charset="utf-8">
<!---live.ver--or--offline-ver-->
 <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #status { font-weight: bold; }
  </style>
<body>
  <p>URL: <code>https://alcea-wisteria.de/ytarchive/?limit=8&extendedsearch=true</code></p>
  <p>Status: <span id="status">Checking...</span></p>
  <script>
    const url = 'https://alcea-wisteria.de/PHP/0demo/2023-07-09-FetchMastodonAva/alcea/2024-08-29_alcea.png';
    const redirect = 'https://alcea-wisteria.de/ytarchive/?limit=8&extendedsearch=true';
    const statusEl = document.getElementById('status');
    function checkImage() {
      const img = new Image();
      img.onload = () => {
        statusEl.textContent = 'Online. Redirecting in 1.5 seconds...';
        statusEl.style.color = 'green';
        setTimeout(() => {
          window.location.href = redirect;
        }, 1500);
      };
      img.onerror = () => {
        statusEl.textContent = 'Offline (404).';
        statusEl.style.color = 'red';
      };
      img.src = url;
    }
    checkImage();
  </script>
<hr>


<a target="_blank" href="https://codeberg.org/alceawisteria/YoutubeArchiveSuite" style=color:lightgray>src</a>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Video Archive</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f5f7fa;
      margin: 0;
    }
    h1 {
      text-align: center;
      margin: 1rem 0;
    }
    #search-container {
      max-width: 600px;
      margin: 0 auto 1rem auto;
      padding: 0 1rem;
    }
    #search {
      width: 100%;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }
    #videos {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1rem;
      padding: 1rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    .card {
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
    }
    video {
      width: 100%;
      border-radius: 4px;
      margin-bottom: 0.5rem;
    }
    .card h3 {
      margin: 0 0 0.25rem 0;
      font-size: 1rem;
    }
    .card p {
      margin: 0 0 0.5rem 0;
      font-size: 0.875rem;
      color: #555;
    }
    .links a {
      font-size: 0.875rem;
      color: #0066cc;
      margin-right: 0.25rem;
      text-decoration: none;
    }
    .links a:hover {
      text-decoration: underline;
    }
    .direct-unreachable {
      color: red !important;
      pointer-events: none;
      cursor: default;
    }
    #error {
      text-align: center;
      color: red;
      font-weight: bold;
      margin-top: 1rem;
    }
    .toggle-src {
      margin-top: 0.5rem;
      padding: 0.4rem;
      font-size: 0.85rem;
      background: #eef;
      border: 1px solid #aac;
      border-radius: 4px;
      cursor: pointer;
    }
    .toggle-src:hover {
      background: #dde;
    }
  </style>
</head>
<body>
  <h1>Youtube Video Archive</h1>

  [<a target="_blank" href="backup.php" style=color:blue>‚¨ÜÔ∏èUpload</a>]  
  <a target="_blank" href="https://ry3yr.github.io/ytlist.html" style=color:blue>List</a> 
  [<a href="javascript:if(!window.location.href.includes('extendedsearch=true')){window.history.pushState({}, '', window.location.href + (window.location.href.includes('?') ? '&' : '?') + 'extendedsearch=true');}">Enable RealtimeSearch</a>]


    <style>
        body{font-family:Arial,sans-serif;margin:20px}.video-links{list-style-type:none;padding:0}.video-links li{margin:10px 0}.video-links a{text-decoration:none;color:#007bff;font-size:16px}.video-links a:hover{text-decoration:underline}
    </style>
<ul class="video-links" id="video-list"></ul>
    <script>
        async function fetchVideos() {
            try {
                const response = await fetch('videos.json?' + new Date().getTime());
                const videos = await response.json();
                //const latestVideos = videos.slice(0, 3);
                const latestVideos = videos.slice(-3);
                const videoList = document.getElementById('video-list');
                latestVideos.forEach(video => {
                    const listItem = document.createElement('li');
                    const link = document.createElement('a');
                    link.href = `?limit=8&extendedsearch=true&videoid=${video.id}`;
                    link.textContent = `${video.title}`;
                    listItem.appendChild(link);
                    videoList.appendChild(listItem);
                });
            } catch (error) {
                console.error("Error fetching videos:", error);
            }
        }
        fetchVideos();
    </script><hr>


  <div id="search-container">
    <input type="text" id="search" placeholder="Search videos by title, uploader, or ID..." />
  </div>

  <div style="text-align:center; margin: 1rem;">
    <button id="check-links">üîç Check Direct Links</button>
  </div>

  <div id="videos"></div>
  <div id="error"></div>

  <script>
    (async () => {
      const errorEl = document.getElementById('error');
      const videosEl = document.getElementById('videos');
      const searchInput = document.getElementById('search');
      const checkLinksButton = document.getElementById('check-links');

      // Helper: check if a URL is reachable
      async function isReachable(url) {
        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 5000);
          const res = await fetch(url, {
            method: 'GET',
            signal: controller.signal
          });
          clearTimeout(timeoutId);
          return res.ok || (res.status >= 300 && res.status < 400);
        } catch {
          return false;
        }
      }

      let videos = [];

      function renderVideos(list) {
  videosEl.innerHTML = '';
  for (const v of list) {
    const card = document.createElement('div');
    card.className = 'card';

    const videoId = `video-${v.id}`;

    const unreachableClass = v.directOk === false ? 'direct-unreachable' : '';
    const directAvailable = v.directOk === true;

    card.innerHTML = `
      <div class="video-container">
        <video id="${videoId}" src="${v.waybackurl}" controls preload="metadata"></video>
      </div>
      <h3>${v.title}</h3>
      <p>Uploader: ${v.uploader}</p>
      <p>ID: ${v.id ?? 'N/A'}</p>
      <p>Uploaded: ${new Date(v.uploaded).toLocaleString()}</p>
      <div class="links">
        <a href="${v.url}" target="_blank" class="direct-link ${unreachableClass}">Direct</a>
        <a href="${v.waybackurl}" target="_blank">Wayback</a><a target="_blank" href="waybackurlcheck.html?waybackurl=${v.waybackurl}" style=color:green>(?)</a>
        <a href="javascript:void(0);" class="youtube-link" data-id="${v.id}">YouTube</a>
        <a href="https://web.archive.org/web/2oe_/http://wayback-fakeurl.archive.org/yt/${v.id}" target="_blank" ><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT61taAw7gmjapOgSz2nugoCrazkCg42il25A&s" width=20px></a>
          <a href="https://preservetube.com/watch?v=${v.id}" target="_blank" ><img src="https://i.ibb.co/SXjxP6v6/Screenshot-20250625-224044-Brave.png" width=20px></a>
          <a href="https://alcea-wisteria.de/hidrive/hidrive.php?path=/public/ytarchive/${v.id}.mp4" target="_blank" ><img src="https://media.technologycounter.com/vendors/software-products/software-logo/hidrive.jpg" width=20px></a>
      </div>
      <button class="toggle-src" data-id="${v.id}">üîÅ Switch to Direct</button>
    `;

    videosEl.appendChild(card);

    const toggleBtn = card.querySelector('.toggle-src');
    const videoEl = card.querySelector('video');

    toggleBtn.addEventListener('click', () => {
      const currentSrc = videoEl.src;
      const usingWayback = currentSrc.includes(v.waybackurl);
      if (usingWayback) {
        if (v.directOk === false) {
          alert("Direct link not available or not yet checked.");
        } else {
          videoEl.src = v.url;
          toggleBtn.textContent = 'üîÅ Switch to Wayback';
        }
      } else {
        videoEl.src = v.waybackurl;
        toggleBtn.textContent = 'üîÅ Switch to Direct';
      }
    });
  }
}
try {
  // First attempt: relative to window.location.href
  let localUrl = new URL('videos.json', window.location.href);
  localUrl.searchParams.set('_', Date.now());
  let res = await fetch(localUrl.toString(), { cache: 'no-store' });

  // If the first attempt fails, try relative to the current directory (`./videos.json`)
  if (!res.ok) {
    localUrl = new URL('./videos.json', '.');
    localUrl.searchParams.set('_', Date.now());
    res = await fetch(localUrl.toString(), { cache: 'no-store' });

    if (!res.ok) throw new Error('Both local attempts failed');
  }

  videos = await res.json();
} catch {
        const res = await fetch('https://ry3yr.github.io/videos.json', { cache: 'no-store' });
        if (!res.ok) {
          errorEl.textContent = 'Failed to load videos from both sources.';
          return;
        }
        videos = await res.json();
      }

      // Apply query limit
      const params = new URLSearchParams(window.location.search);
      const limit = parseInt(params.get('limit'));
      const videoId = params.get('videoid');
      const limitedVideos = limit > 0 ? videos.slice(0, limit) : videos;
      searchInput.placeholder = `Search ${videos.length} videos...`;

      // Initial render (wayback only)
      renderVideos(limitedVideos);

      // Search filtering
      searchInput.addEventListener('input', () => {
        const query = searchInput.value.trim().toLowerCase();
        let filtered = videos;
        if (query) {
          filtered = videos.filter(v =>
            (v.title?.toLowerCase().includes(query)) ||
            (v.uploader?.toLowerCase().includes(query)) ||
            (v.id?.toString().toLowerCase().includes(query))
          );
        }
        if (limit > 0) {
          filtered = filtered.slice(0, limit);
        }
        renderVideos(filtered);
      });

      // Pre-fill search if videoid provided
      if (videoId) {
        searchInput.value = videoId;
        searchInput.dispatchEvent(new Event('input'));
      }

      // Check links button
      checkLinksButton.addEventListener('click', async () => {
        checkLinksButton.disabled = true;
        checkLinksButton.textContent = '‚è≥ Checking...';
        for (const v of videos) {
          v.directOk = await isReachable(v.url);
        }
        checkLinksButton.disabled = false;
        checkLinksButton.textContent = 'üîç Check Direct Links';
        renderVideos(videos);
      });

      // Extended search suggestions
      const isExtendedSearchActive = params.has('extendedsearch') || localStorage.getItem('extendedsearch') === 'true';
      if (isExtendedSearchActive) {
        localStorage.setItem('extendedsearch', 'true');
        const suggestionList = document.createElement('ul');
        Object.assign(suggestionList.style, {
          position: 'absolute',
          maxHeight: '300px',
          overflowY: 'auto',
          width: '100%',
          backgroundColor: '#fff',
          border: '1px solid #ccc',
          borderRadius: '6px',
          zIndex: '10',
          listStyle: 'none',
          padding: '0',
          margin: '0'
        });
        searchInput.parentElement.appendChild(suggestionList);

        searchInput.addEventListener('input', () => {
          const query = searchInput.value.trim().toLowerCase();
          suggestionList.innerHTML = '';
          if (query) {
            const filtered = videos.filter(v => v.title?.toLowerCase().includes(query));
            filtered.forEach(v => {
              const item = document.createElement('li');
              item.style.padding = '0.5rem';
              item.style.cursor = 'pointer';
              item.textContent = v.title;
              item.addEventListener('click', () => {
                searchInput.value = v.title;
                suggestionList.innerHTML = '';
                searchInput.dispatchEvent(new Event('input'));
              });
              suggestionList.appendChild(item);
            });
          }
        });

        searchInput.addEventListener('blur', () => {
          setTimeout(() => suggestionList.innerHTML = '', 200);
        });
      }
    })();

document.addEventListener('click', function(event) {
    if (event.target && event.target.classList.contains('youtube-link')) {
      const videoId = event.target.getAttribute('data-id');
      const videoContainer = event.target.closest('.card').querySelector('.video-container');
      
      // Create the YouTube embed iframe
      const iframe = document.createElement('iframe');
      iframe.width = '100%';
      iframe.height = '315';
      iframe.src = `https://www.youtube.com/embed/${videoId}`;
      iframe.frameBorder = '0';
      iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
      iframe.allowFullscreen = true;
      
      // Replace the existing video element with the iframe
      videoContainer.innerHTML = '';  // Clear existing video
      videoContainer.appendChild(iframe);
      
      // Optionally, change the "YouTube" link text to something else
      event.target.textContent = 'YouTube (Playing)';
      event.target.classList.add('playing');
    }
  });
  </script>
</body>
</html>



list.html
--
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Video Archive</title>
	<style>
		body {
			font-family: system-ui, sans-serif;
			background: #f5f7fa;
			margin: 0;
		}
		h1 {
			text-align: center;
			margin: 1rem 0;
		}
		#videos-table {
			width: 100%;
			border-collapse: collapse;
			margin: 1rem auto;
			max-width: 1200px;
		}
		#videos-table th, #videos-table td {
			border: 1px solid #ddd;
			padding: 8px;
			text-align: left;
		}
		#videos-table th {
			background-color: #f0f0f0;
		}
		.links a {
			font-size: 0.875rem;
			color: #0066cc;
			text-decoration: none;
		}
		.links a:hover {
			text-decoration: underline;
		}
	</style>
</head>
<body>
<h1>Video Archive</h1>
<table id="videos-table">
	<thead>
		<tr>
			<th>Title</th>
			<th>Uploader</th>
			<th>ID</th>
			<th>Uploaded</th>
			<th>Direct Link</th>
			<th>Wayback Link</th>
		</tr>
	</thead>
	<tbody id="videos"></tbody>
</table>

<script>
(async () => {
	const videosEl = document.getElementById('videos');

	// Fetch the videos.json
	try {
		const res = await fetch('videos.json');
		if (!res.ok) {
			throw new Error(`HTTP ${res.status} ${res.statusText}`);
		}

		const videos = await res.json();

		// Render videos in the table
		videos.forEach(v => {
			const row = document.createElement('tr');

			// Create a clickable link for the video title
			const videoLink = `<a href="https://m.youtube.com/watch?v=${v.id}" target="_blank">${v.title}</a>`;

			// Add the video details in table cells
			row.innerHTML = `
				<td>${videoLink}</td>
				<td>${v.uploader}</td>
				<td>${v.id ?? 'N/A'}</td>
				<td>${new Date(v.uploaded).toLocaleString()}</td>
				<td><a href="${v.url}">Direct</a></td>
				<td><a href="${v.waybackurl}">Wayback</a></td>
			`;

			// Append the row to the table body
			videosEl.appendChild(row);
		});
	} catch (e) {
		console.error('Failed to load videos:', e);
	}
})();
</script>
</body>
</html>


waybackupdater.php
--
<?php
define('JSON_FILE', 'videos.json');

function get_wayback_timestamped_url(string $url): ?string {
    $url = str_replace('\\/', '/', $url); // normalize slashes
    $api = 'https://archive.org/wayback/available?url=' . rawurlencode($url);
    $json = @file_get_contents($api);
    if (!$json) return null;
    $data = json_decode($json, true);
    if (isset($data['archived_snapshots']['closest']['timestamp'])) {
        $ts = $data['archived_snapshots']['closest']['timestamp'];
        return "https://web.archive.org/web/{$ts}/{$url}";
    }
    return null;
}

$list = json_decode(file_get_contents(JSON_FILE), true);
$updates = [];
$missing = [];

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    if (!empty($_POST['confirm'])) {
        // Apply selected automatic fixes
        foreach ($_POST['confirm'] as $idx) {
            $i = (int)$idx;
            $timestamped = get_wayback_timestamped_url($list[$i]['url']);
            if ($timestamped) {
                $list[$i]['waybackurl'] = $timestamped;
            }
        }
    }
    if (!empty($_POST['manual_fix'])) {
        // Apply manual fix
        foreach ($_POST['manual_fix'] as $idx => $new_url) {
            $i = (int)$idx;
            $new_url = trim($new_url);
            if ($new_url !== '') {
                $list[$i]['waybackurl'] = $new_url;
            }
        }
    }
    file_put_contents(JSON_FILE, json_encode($list, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE), LOCK_EX);
    echo "<p><strong>Updates saved successfully!</strong></p>";
}

// Prepare lists again for display
foreach ($list as $index => $entry) {
    if (!isset($entry['url'], $entry['waybackurl'])) continue;
    if (strpos($entry['waybackurl'], '*') === false) continue;

    $timestamped = get_wayback_timestamped_url($entry['url']);
    if ($timestamped) {
        $updates[] = [
            'index'    => $index,
            'title'    => $entry['title'] ?? '',
            'original' => $entry['waybackurl'],
            'updated'  => $timestamped,
        ];
    } else {
        $missing[] = [
            'index'    => $index,
            'title'    => $entry['title'] ?? '',
            'url'      => $entry['url'],
            'old_waybackurl' => $entry['waybackurl'],
        ];
    }
}
?>

<!DOCTYPE html>
<html>
<head>
    <title>Fix Wayback URLs</title>
</head>
<body>
<h1>Wayback URL Fixer</h1>

<?php if (empty($updates) && empty($missing)): ?>
    <p>No wildcard URLs found.</p>
<?php endif; ?>

<?php if (!empty($updates)): ?>
    <h2>Suggested Fixes</h2>
    <form method="post">
        <table border="1" cellpadding="6">
            <thead>
            <tr>
                <th>Select</th>
                <th>Title</th>
                <th>Original URL</th>
                <th>Suggested Fix</th>
            </tr>
            </thead>
            <tbody>
            <?php foreach ($updates as $u): ?>
                <tr>
                    <td><input type="checkbox" name="confirm[]" value="<?= htmlspecialchars($u['index']) ?>" checked></td>
                    <td><?= htmlspecialchars($u['title']) ?></td>
                    <td><a href="<?= htmlspecialchars($u['original']) ?>" target="_blank">Old</a></td>
                    <td><a href="<?= htmlspecialchars($u['updated']) ?>" target="_blank">New</a></td>
                </tr>
            <?php endforeach; ?>
            </tbody>
        </table>
        <br>
        <input type="submit" value="Apply Selected Fixes">
    </form>
<?php endif; ?>

<?php if (!empty($missing)): ?>
    <h2>No Archive Snapshot Found - Manual Fix</h2>
    <form method="post">
        <table border="1" cellpadding="6">
            <thead>
            <tr>
                <th>Title</th>
                <th>Manual Wayback URL</th>
                <th>Old Wayback URL</th>
            </tr>
            </thead>
            <tbody>
            <?php foreach ($missing as $m): ?>
                <tr>
                    <td><?= htmlspecialchars($m['title']) ?></td>
                    <td>
                        <input type="text" name="manual_fix[<?= htmlspecialchars($m['index']) ?>]" size="80" placeholder="Paste new wayback URL here">
                    </td>
                    <td><a href="<?= htmlspecialchars($m['old_waybackurl']) ?>" target="_blank"><?= htmlspecialchars($m['old_waybackurl']) ?></a></td>
                </tr>
            <?php endforeach; ?>
            </tbody>
        </table>
        <br>
        <input type="submit" value="Apply Manual Fixes">
    </form>
<?php endif; ?>

</body>
</html>


Reddit (oAuth) comment poster
---------------------------

config.php
--
<?php
define('CLIENT_ID', '');
define('CLIENT_SECRET', '');
define('REDIRECT_URI', 'https://alcea-wisteria.de/PHP//0demo/2025-04-05-SocialMediaMediaXtractor/2025-06-20-RedditCommentPoster/oauth.php');
define('USER_AGENT', 'RedditCommenter/1.0 by JadedDetail');


oauth.php
--
<?php
error_reporting(E_ALL);
ini_set('display_errors', 1);
session_start();

require_once 'config.php';

function debug_log($message) {
    error_log("[DEBUG] " . $message);
}

echo "<pre>POST:\n"; print_r($_POST);
echo "GET:\n"; print_r($_GET);
echo "</pre>";

$client_id = '';
$client_secret = '';

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $client_id = trim($_POST['client_id'] ?? '');
    $client_secret = trim($_POST['client_secret'] ?? '');
    $_SESSION['client_id'] = $client_id;
    $_SESSION['client_secret'] = $client_secret;
} else {
    if (empty($client_id) && isset($_SESSION['client_id'])) {
        $client_id = $_SESSION['client_id'];
    }
    if (empty($client_secret) && isset($_SESSION['client_secret'])) {
        $client_secret = $_SESSION['client_secret'];
    }
}

if ($client_id === '' && defined('CLIENT_ID')) {
    $client_id = CLIENT_ID;
}
if ($client_secret === '' && defined('CLIENT_SECRET')) {
    $client_secret = CLIENT_SECRET;
}

if (!defined('REDIRECT_URI') || !defined('USER_AGENT')) {
    echo "<h2>Config error</h2><p>REDIRECT_URI und USER_AGENT m√ºssen in config.php definiert sein.</p>";
    exit;
}

try {
    if (isset($_GET['error'])) {
        throw new Exception("OAuth error: " . htmlspecialchars($_GET['error']));
    }

    // OVERRIDE: If 'code' and 'state' exist, perform token exchange immediately,
    // regardless of client_id/client_secret form or other logic
    if (isset($_GET['code']) && isset($_GET['state'])) {
        if (!isset($_SESSION['oauth_state']) || $_GET['state'] !== $_SESSION['oauth_state']) {
            throw new Exception("Ung√ºltiger OAuth-State");
        }
        if ($client_id === '' || $client_secret === '') {
            throw new Exception("Client ID und Client Secret m√ºssen gesetzt sein, um Token zu tauschen.");
        }

        $code = $_GET['code'];
        $postData = http_build_query([
            'grant_type'   => 'authorization_code',
            'code'         => $code,
            'redirect_uri' => REDIRECT_URI,
        ]);

        $headers = [
            "Authorization: Basic " . base64_encode($client_id . ":" . $client_secret),
            "Content-Type: application/x-www-form-urlencoded",
            "User-Agent: " . USER_AGENT,
        ];

        $context = stream_context_create([
            'http' => [
                'method'  => 'POST',
                'header'  => implode("\r\n", $headers),
                'content' => $postData,
                'ignore_errors' => true,
            ]
        ]);

        $response = file_get_contents('https://www.reddit.com/api/v1/access_token', false, $context);

        if ($response === false) {
            throw new Exception("Fehler beim Abruf des Access Tokens");
        }

        $tokenData = json_decode($response, true);
        if (!isset($tokenData['access_token'])) {
            throw new Exception("Kein Access Token erhalten: " . $response);
        }

        echo "<h2>OAuth erfolgreich</h2>";
        echo "<p>Access Token: " . htmlspecialchars($tokenData['access_token']) . "</p>";
        exit;
    }

    // Standard behavior: if client_id or secret missing, show form
    if ($client_id === '' || $client_secret === '') {
        $prefill_client_id = isset($_GET['clientid']) ? htmlspecialchars($_GET['clientid']) : '';
        $prefill_client_secret = isset($_GET['clientsecret']) ? htmlspecialchars($_GET['clientsecret']) : '';
        ?>
        <!DOCTYPE html>
        <html><head><title>Reddit OAuth Client</title></head><body>
        <h2>Reddit OAuth Client Configuration</h2>
        <form method="POST" action="">
            <label>Client ID:</label><br>
            <input type="text" name="client_id" required value="<?php echo $prefill_client_id; ?>"><br><br>
            <label>Client Secret:</label><br>
            <input type="text" name="client_secret" required value="<?php echo $prefill_client_secret; ?>"><br><br>
            <input type="submit" value="Continue">
        </form>
        </body></html>
        <?php
        exit;
    }

    // Start OAuth authorization link flow
    $state = bin2hex(random_bytes(8));
    $_SESSION['oauth_state'] = $state;

    $params = [
        'client_id'     => $client_id,
        'response_type' => 'code',
        'state'         => $state,
        'redirect_uri'  => REDIRECT_URI,
        'duration'      => 'temporary',
        'scope'         => 'submit identity',
    ];

    $authUrl = "https://www.reddit.com/api/v1/authorize?" . http_build_query($params);

    echo "<h2>Authorization Parameters (Debug)</h2><pre>";
    echo "CLIENT_ID: " . htmlspecialchars($client_id) . "\n";
    echo "CLIENT_SECRET: " . htmlspecialchars($client_secret) . "\n";
    echo "REDIRECT_URI: " . htmlspecialchars(REDIRECT_URI) . "\n";
    echo "USER_AGENT: " . htmlspecialchars(USER_AGENT) . "\n";
    echo "STATE: " . htmlspecialchars($state) . "\n";
    echo "AUTH URL: " . $authUrl . "\n";
    echo "</pre>";
    echo "<p><a href=\"$authUrl\">Hier klicken, um zur Reddit-Autorisierung weiterzuleiten</a></p>";

} catch (Exception $e) {
    echo "<h2>Fehler w√§hrend OAuth</h2>";
    echo "<p>" . htmlspecialchars($e->getMessage()) . "</p>";
    echo "<pre>\$_GET:\n" . print_r($_GET, true) . "</pre>";
}


post.php
--
<details><summary>how to</summary>
1.) Goto https://www.reddit.com/prefs/apps<br>
2.) both about and redirect url link to https://yourdomain/../oauth.php<br>
3.) either use <a target="_blank" href="oauth.php?clientid=###&clientsecret=###" style=color:grey>oAuth</a> oauth.php?clientid=###&clientsecret=### or configure config.php<br>
=> will yield OauthAccess Token<br>
4.) use with poster.php
</details>
<hr>

<?php
const ACCESS_TOKEN_DEFAULT = 'YOUR_VALID_OAUTH_ACCESS_TOKEN_HERE';

function extractThingId($url) {
    if (preg_match('#/comments/([a-z0-9]+)/#i', $url, $m)) {
        if (preg_match('#/comments/[a-z0-9]+/[^/]+/([a-z0-9]+)/?#i', $url, $cm)) {
            return 't1_' . $cm[1]; // comment
        }
        return 't3_' . $m[1]; // post
    }
    return false;
}

function postComment($access_token, $thing_id, $text) {
    $postData = http_build_query([
        'thing_id' => $thing_id,
        'text' => $text,
    ]);

    $headers = [
        "Authorization: bearer $access_token",
        "User-Agent: PHP Reddit Comment Poster",
        "Content-Type: application/x-www-form-urlencoded",
    ];

    $opts = [
        'http' => [
            'method' => 'POST',
            'header' => implode("\r\n", $headers),
            'content' => $postData,
            'ignore_errors' => true,
        ],
    ];

    $response = file_get_contents('https://oauth.reddit.com/api/comment', false, stream_context_create($opts));
    return json_decode($response, true);
}

$error = null;
$success = null;

$pre_url = $_GET['url'] ?? '';
$pre_oauth = $_GET['oauth'] ?? '';

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $reddit_url = $_POST['url'] ?? '';
    $comment_text = $_POST['comment'] ?? '';
    $access_token = $_POST['oauth'] ?? ACCESS_TOKEN_DEFAULT;

    if (!$reddit_url || !$comment_text || !$access_token) {
        $error = "Please fill Reddit URL, comment, and OAuth token.";
    } else {
        $thing_id = extractThingId($reddit_url);
        if (!$thing_id) {
            $error = "Invalid Reddit URL format.";
        } else {
            $resp = postComment($access_token, $thing_id, $comment_text);
            if (!empty($resp['json']['errors'])) {
                $error = "Reddit API errors: " . json_encode($resp['json']['errors']);
            } else {
                if (!empty($resp['json']['data']['things'][0]['data']['id'])) {
                    $comment_id = $resp['json']['data']['things'][0]['data']['id'];
                    $success = "Comment posted successfully! ID: " . $comment_id;
                } elseif (!empty($resp['json']['data']['id'])) {
                    $success = "Comment posted successfully! ID: " . $resp['json']['data']['id'];
                } else {
                    $success = 'Comment posted successfully! <a target="_blank" href="' . htmlspecialchars($reddit_url) . '?sort=new" style="color:blue">link</a>';

                }
            }
        }
    }
} else {
    $reddit_url = $pre_url;
    $comment_text = '';
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Reddit Comment Poster</title>
<style>
body { font-family: Arial, sans-serif; max-width: 600px; margin: 2em auto; position: relative; }
label { display: block; margin-top: 1em; }
input, textarea { width: 100%; padding: 0.5em; margin-top: 0.25em; }
button { margin-top: 1em; padding: 0.75em 1.5em; font-size: 1em; }
.error { color: red; margin-top: 1em; }
.success { color: green; margin-top: 1em; }
#charCount {
  position: fixed;
  top: 10px;
  right: 10px;
  font-weight: bold;
  background: #eee;
  border: 1px solid #ccc;
  padding: 5px 10px;
  border-radius: 4px;
  font-family: monospace;
  user-select: none;
}
</style>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const urlParams = new URLSearchParams(window.location.search);
  const oauthQuery = urlParams.get("oauth");
  const oauthInput = document.querySelector('input[name="oauth"]');
  const commentTextarea = document.querySelector('textarea[name="comment"]');
  const charCountDiv = document.getElementById('charCount');
  const minChars = 10;

  if (oauthQuery) {
    oauthInput.value = oauthQuery;
    localStorage.setItem("redditoauth", oauthQuery);
  } else {
    const storedToken = localStorage.getItem("redditoauth");
    if (storedToken && oauthInput && !oauthInput.value) {
      oauthInput.value = storedToken;
    }
  }

  oauthInput.addEventListener("input", () => {
    localStorage.setItem("redditoauth", oauthInput.value);
  });

  function updateCharCount() {
    const len = commentTextarea.value.length;
    charCountDiv.textContent = `Chars: ${len} / min ${minChars}`;
    charCountDiv.style.color = (len < minChars) ? 'red' : 'green';
  }

  commentTextarea.addEventListener("input", updateCharCount);
  updateCharCount();

  const form = document.querySelector('form');
  form.addEventListener('submit', e => {
    if (commentTextarea.value.length < minChars) {
      e.preventDefault();
      alert(`Comment must be at least ${minChars} characters.`);
      commentTextarea.focus();
    }
  });
});
</script>
</head>
<body>
<h1>Reddit Comment Poster (OAuth token from query, localStorage, or manual)</h1>

<?php if ($error): ?>
  <div class="error"><?=htmlspecialchars($error)?></div>
<?php endif; ?>

<?php if ($success): ?>
  <div class="success"><?= $success ?></div>
<?php endif; ?>

<div id="charCount"></div>

<form method="post" action="">
  <label>
    Reddit URL (post or comment):
    <input type="url" name="url" required placeholder="https://www.reddit.com/..." value="<?=htmlspecialchars($reddit_url ?? '')?>" />
  </label>
  <label>
    Comment text:
    <textarea name="comment" rows="5" required><?=htmlspecialchars($comment_text ?? '')?></textarea>
  </label>

<button type="button" onclick="insertAtCursor()">Insert Link</button>
<script>
function insertAtCursor() {
    const textarea = document.querySelector('[name="comment"]');
    const textToInsert = "[title](https://link)";
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const text = textarea.value;
    textarea.value = text.slice(0, start) + textToInsert + text.slice(end);
    textarea.selectionStart = textarea.selectionEnd = start + textToInsert.length;
    textarea.focus();
}
</script>

  <label>
    OAuth Access Token:
    <input type="text" name="oauth" required value="" autocomplete="off" />
  </label>
  <button type="submit">Submit Comment</button>
</form>

<p><small>OAuth token autofills from ?oauth= or localStorage 'redditoauth'. Minimum comment length: 10 characters.</small></p>
</body>
</html>


Clipboard Relay
---------------

clip.php
--
<?php
if (isset($_POST['send'])) {
    $content = $_POST['send'];
    file_put_contents('clip.txt', $content);
}
exit;
?>


clipboard.html
--
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Clipboard Interface</title>
</head>
<body>
    <textarea id="textbox" name="textbox" rows="4" cols="50"></textarea><br>
   <button id="writeBtn" style="background-color: white; border: 1px solid black; padding: 1px 20px; font-size: 16px; cursor: pointer;">üíæWRITE</button>
<button id="readBtn" style="background-color: white; border: 1px solid black; padding: 1px 20px; font-size: 16px; cursor: pointer;">üì•READ</button>

    <script>
        document.getElementById('writeBtn').addEventListener('click', function () {
            const text = document.getElementById('textbox').value;

            fetch('clip.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'send=' + encodeURIComponent(text)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Write failed');
                }
                console.log('Text saved successfully');
            })
            .catch(error => console.error(error));
        });

        document.getElementById('readBtn').addEventListener('click', function () {
            fetch('clip.txt', { cache: 'no-cache' })
                .then(response => response.text())
                .then(data => {
                    document.getElementById('textbox').value = data;
                });
        });
    </script>
</body>
</html>



Subreddit & Post fetch
-----------------------


===subreddit=fetch.php===

<?php
function fetchRedditPosts($defaultSubreddit = 'deutschland', $limit = 10, $after = '') {
    // Check if a ?redditurl= is provided
    $subredditUrl = isset($_GET['redditurl']) ? $_GET['redditurl'] : "https://www.reddit.com/r/$defaultSubreddit/";

    // Extract subreddit from URL (supports URLs like https://www.reddit.com/r/deutschland/)
    if (preg_match('~reddit\.com/r/([^/]+)/?~', $subredditUrl, $matches)) {
        $subreddit = $matches[1];
    } else {
        echo "Invalid subreddit URL.";
        return;
    }

    $baseUrl = "https://www.reddit.com/r/$subreddit.json?limit=$limit";
    if (!empty($after)) {
        $baseUrl .= "&after=" . urlencode($after);
    }

    $ch = curl_init($baseUrl);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_USERAGENT, 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) RedditScraper/1.0');
    $response = curl_exec($ch);

    if (curl_errno($ch)) {
        echo 'Curl error: ' . curl_error($ch);
        curl_close($ch);
        return;
    }

    curl_close($ch);
    $json = json_decode($response, true);

    if (!isset($json['data']['children'])) {
        echo "No posts found or unexpected response format.";
        return;
    }

    foreach ($json['data']['children'] as $item) {
        $post = $item['data'];
        $title = htmlspecialchars($post['title'], ENT_QUOTES);
        $link = 'https://www.reddit.com' . $post['permalink'];
        $text = isset($post['selftext']) ? strip_tags($post['selftext']) : '';
        $snippet = mb_substr($text, 0, 150);

        // Image handling
        $image = '';
        if (!empty($post['preview']['images'][0]['source']['url'])) {
            $image = html_entity_decode($post['preview']['images'][0]['source']['url']);
        } elseif (preg_match('/\.(jpg|jpeg|png|gif)$/i', $post['url'])) {
            $image = $post['url'];
        }

        // Output
        echo "<h3><a href=\"$link\" target=\"_blank\">$title</a></h3>\n";
        echo "<a href=\"postfetch.php?url=$link\" style=\"font-size:1.2em\">&gt;&gt;</a><br>\n";
        if (!empty($image)) {
            echo "<img src=\"$image\" alt=\"Post image\" style=\"max-width:400px;\"><br>\n";
        }
        echo "<p>$snippet...</p>\n<hr>\n";
    }

    // Pagination
    if (!empty($json['data']['after'])) {
        $nextAfter = htmlspecialchars($json['data']['after'], ENT_QUOTES);
        $query = $_GET;
        $query['after'] = $nextAfter;
        $queryStr = http_build_query($query);
        echo "<a href=\"{$_SERVER['PHP_SELF']}?$queryStr\">Next Page ‚Üí</a>";
    }
}

// Get ?after from URL if set
$after = isset($_GET['after']) ? $_GET['after'] : '';
fetchRedditPosts('deutschland', 10, $after);
?>



=======postfetch.php====
<?php
header('Content-Type: text/html; charset=utf-8');

$userAgent = 'Mozilla/5.0 (reddit-fetch/1.0; +https://example.com)';

if (empty($_GET['url'])) {
    exit('Error: Missing "url" query parameter.');
}

$inputUrl = $_GET['url'];

// Remove trailing slash if exists
$inputUrl = rtrim($inputUrl, '/');

// Append '.json' if not already there
if (!str_ends_with($inputUrl, '.json')) {
    $jsonUrl = $inputUrl . '/.json';
} else {
    $jsonUrl = $inputUrl;
}

// Extract base URL for user/permalink links
$parsedUrl = parse_url($inputUrl);
if (!$parsedUrl || !isset($parsedUrl['scheme'], $parsedUrl['host'])) {
    exit('Error: Invalid URL structure.');
}
$baseUrl = $parsedUrl['scheme'] . '://' . $parsedUrl['host'];

// Fetch JSON
$ch = curl_init($jsonUrl);
curl_setopt_array($ch, [
    CURLOPT_RETURNTRANSFER => true,
    CURLOPT_USERAGENT => $userAgent,
    CURLOPT_FOLLOWLOCATION => true,
    CURLOPT_SSL_VERIFYPEER => true,
    CURLOPT_SSL_VERIFYHOST => 2,
]);
$response = curl_exec($ch);
if (curl_errno($ch)) {
    exit('cURL error: ' . curl_error($ch));
}
curl_close($ch);

$data = json_decode($response, true);
if (!$data || !isset($data[0]['data']['children'][0]['data'])) {
    exit('Error: Failed to fetch or parse Reddit data.');
}

$post = $data[0]['data']['children'][0]['data'];
$comments = $data[1]['data']['children'] ?? [];

function extract_images(array $post): array {
    $images = [];

    // Direct image URL in post url (jpg/png/gif)
    if (!empty($post['url']) && preg_match('~\.(jpe?g|png|gif)$~i', $post['url'])) {
        $images[] = html_entity_decode(str_replace('&amp;', '&', $post['url']));
    }

    // Preview images
    if (!empty($post['preview']['images'])) {
        foreach ($post['preview']['images'] as $img) {
            if (!empty($img['source']['url'])) {
                $url = html_entity_decode(str_replace('&amp;', '&', $img['source']['url']));
                if (!in_array($url, $images, true)) {
                    $images[] = $url;
                }
            }
        }
    }

    // Gallery images
    if (!empty($post['gallery_data']['items']) && !empty($post['media_metadata'])) {
        foreach ($post['gallery_data']['items'] as $item) {
            $mediaId = $item['media_id'] ?? null;
            if ($mediaId && !empty($post['media_metadata'][$mediaId]['s']['u'])) {
                $url = html_entity_decode(str_replace('&amp;', '&', $post['media_metadata'][$mediaId]['s']['u']));
                if (!in_array($url, $images, true)) {
                    $images[] = $url;
                }
            }
        }
    }

    return $images;
}

function render_comment(array $node, int $depth = 0, string $baseUrl = '', string $postPermalink = ''): void {
    if (($node['kind'] ?? '') !== 't1') return;
    $c = $node['data'];

    $author = htmlspecialchars($c['author']);
    $authorLink = '<a href="' . $baseUrl . '/user/' . $author . '" target="_blank" rel="noopener noreferrer">u/' . $author . '</a>';

    $commentId = $c['id'] ?? '';
    $commentPermalink = rtrim($baseUrl, '/') . $postPermalink . $commentId;

    echo '<div style="margin-left:' . ($depth * 20) . 'px; border-left: 2px solid #ccc; padding-left:10px; margin-top:10px;">';
    echo '<p><strong>' . $authorLink . '</strong> (' . intval($c['score']) . ' pts) ';
    echo '<a href="' . htmlspecialchars($commentPermalink) . '" target="_blank" rel="noopener noreferrer" style="font-weight:normal; font-size:0.85em; margin-left:10px;">[link]</a></p>';
    echo '<div>' . html_entity_decode($c['body_html'], ENT_QUOTES | ENT_HTML5) . '</div>';
    echo '</div>';

    if (!empty($c['replies']['data']['children'])) {
        foreach ($c['replies']['data']['children'] as $child) {
            render_comment($child, $depth + 1, $baseUrl, $postPermalink);
        }
    }
}

$images = extract_images($post);
?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title><?= htmlspecialchars($post['title']) ?></title>
<style>
body { font-family: Arial,sans-serif; max-width: 900px; margin: 30px auto; color: #222; }
h1 a { color: #0079d3; text-decoration: none; }
h1 a:hover { text-decoration: underline; }
img { max-width: 100%; height: auto; margin: 15px 0; }
a { color: #0079d3; text-decoration: none; }
a:hover { text-decoration: underline; }
.post-text { margin: 15px 0; line-height: 1.4em; }
</style>
</head>
<body>

<h1><a href="<?= htmlspecialchars($baseUrl . $post['permalink']) ?>" target="_blank" rel="noopener noreferrer">
    <?= htmlspecialchars($post['title']) ?></a></h1>

<p>Posted by 
<a href="<?= htmlspecialchars($baseUrl . '/user/' . $post['author']) ?>" target="_blank" rel="noopener noreferrer">u/<?= htmlspecialchars($post['author']) ?></a>
in 
<a href="<?= htmlspecialchars($baseUrl . '/r/' . $post['subreddit']) ?>" target="_blank" rel="noopener noreferrer">r/<?= htmlspecialchars($post['subreddit']) ?></a><br>
<?= date('F j, Y \a\t H:i', $post['created_utc']) ?> | <?= intval($post['score']) ?> points | <?= intval($post['num_comments']) ?> comments
</p>

<?php if (!empty($post['selftext_html'])): ?>
    <div class="post-text"><?= html_entity_decode($post['selftext_html'], ENT_QUOTES | ENT_HTML5) ?></div>
<?php elseif (!empty($post['selftext'])): ?>
    <div class="post-text"><?= nl2br(htmlspecialchars($post['selftext'])) ?></div>
<?php endif; ?>

<?php if ($images): ?>
<h2>Images</h2>
<?php foreach ($images as $img): ?>
    <img src="<?= htmlspecialchars($img) ?>" alt="Reddit image" />
<?php endforeach; ?>
<?php endif; ?>

<h2>Comments</h2>
<?php foreach ($comments as $comment): ?>
    <?php render_comment($comment, 0, $baseUrl, $post['permalink']); ?>
<?php endforeach; ?>

</body>
</html>



cPanel Dashboard
-----------------
<a target="_blank" href="https://cp179.sp-server.net:2083/cpsess5931309808/frontend/jupiter/api_tokens/index.html#/" style=color:blue>Get API Token</a><br>

<?php
/**
 * cPanel ‚ÄúALL‚ÄëDATA‚Äù Dashboard
 *
 * Fetches and displays the most common per‚Äëaccount data sets:
 *   ‚Ä¢ Domains
 *   ‚Ä¢ Email accounts (+quota / disk)
 *   ‚Ä¢ FTP accounts (+disk)
 *   ‚Ä¢ MySQL databases
 *   ‚Ä¢ Cron jobs
 *   ‚Ä¢ Disk / Bandwidth summary
 *
 * Requires a cPanel API¬†token with full UAPI + API¬†2 permissions.
 * Function names follow cPanel docs: DomainInfo::list_domains, Email::list_pops_with_disk,
 * Ftp::list_ftp_with_disk, Mysql::list_databases, Cron::listcron (API‚ÄØ2),
 * StatsBar::get_stats¬†(display=diskusage|bandwidthusage).¬†:contentReference[oaicite:0]{index=0}
 */

/* ====== CONFIGURE ME ====== */
$CPANEL_HOST = 'https://cp179.sp-server.net:2083';
$CPANEL_USER = isset($_GET['user']) ? trim($_GET['user']) : 'user';
$API_TOKEN   = isset($_GET['apitoken']) ? trim($_GET['apitoken']) : 'token';
$VERIFY_SSL  = true;                    // set true in production
/* =========================== */

/* -- low‚Äëlevel HTTP helper -- */
function cp_http($url, $user, $token, $verify)
{
    $ch = curl_init($url);
    curl_setopt_array($ch, [
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_HTTPHEADER     => ["Authorization: cpanel $user:$token"],
        CURLOPT_SSL_VERIFYPEER => $verify,
    ]);
    $raw = curl_exec($ch);
    $err = curl_error($ch);
    curl_close($ch);
    if ($err) { return ['error' => $err]; }
    $json = json_decode($raw, true);
    return $json ?: ['error' => 'Invalid JSON from cPanel'];
}

/* -- UAPI wrapper -- */
function uapi($host, $user, $token, $module, $func, $params = [], $verify = false)
{
    $qs  = $params ? ('?' . http_build_query($params)) : '';
    $url = "$host/execute/$module/$func$qs";
    return cp_http($url, $user, $token, $verify);
}

/* -- API¬†2 wrapper -- */
function api2($host, $user, $token, $module, $func, $params = [], $verify = false)
{
    $base = "$host/json-api/cpanel?cpanel_jsonapi_user=$user"
          . "&cpanel_jsonapi_apiversion=2"
          . "&cpanel_jsonapi_module=$module"
          . "&cpanel_jsonapi_func=$func";
    $url  = $params ? $base . '&' . http_build_query($params) : $base;
    return cp_http($url, $user, $token, $verify);
}

/* -- HTML table helper -- */
function table($records)
{
    if (empty($records) || !is_array($records)) { return '<em>No data</em>'; }
    // ensure we have a list of rows
    $records = array_values($records);
    $cols = array_keys($records[0]);
    $html = "<table><thead><tr>";
    foreach ($cols as $c) { $html .= "<th>" . htmlspecialchars($c) . "</th>"; }
    $html .= "</tr></thead><tbody>";
    foreach ($records as $row) {
        $html .= "<tr>";
        foreach ($cols as $c) {
            $val = $row[$c];
            if (is_array($val)) $val = json_encode($val);
            $html .= "<td>" . htmlspecialchars((string)$val) . "</td>";
        }
        $html .= "</tr>";
    }
    return $html . "</tbody></table>";
}

/* -- Fetch everything -- */
$domains   = uapi($CPANEL_HOST, $CPANEL_USER, $API_TOKEN, 'DomainInfo', 'list_domains',             [],             $VERIFY_SSL);
$emails    = uapi($CPANEL_HOST, $CPANEL_USER, $API_TOKEN, 'Email',      'list_pops_with_disk',     [],             $VERIFY_SSL);
$ftps      = uapi($CPANEL_HOST, $CPANEL_USER, $API_TOKEN, 'Ftp',        'list_ftp_with_disk',      [],             $VERIFY_SSL);
$databases = uapi($CPANEL_HOST, $CPANEL_USER, $API_TOKEN, 'Mysql',      'list_databases',          [],             $VERIFY_SSL);
$crons     = api2($CPANEL_HOST, $CPANEL_USER, $API_TOKEN, 'Cron',       'listcron',                [],             $VERIFY_SSL);
$stats     = uapi($CPANEL_HOST, $CPANEL_USER, $API_TOKEN, 'StatsBar',   'get_stats', ['display' => 'diskusage|bandwidthusage'], $VERIFY_SSL);

/* -- Build dashboard -- */
echo <<<HTML
<!DOCTYPE html><html><head>
<meta charset="utf-8"><title>cPanel Account Dashboard</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;margin:20px;}
h1{font-size:28px;margin-bottom:10px;}
h2{margin:30px 0 10px;}
table{border-collapse:collapse;width:100%;}
th,td{border:1px solid #ccc;padding:6px 8px;text-align:left;font-size:14px;}
th{background:#f0f0f0;}
em{color:#666;}
</style>
</head><body>
<h1>cPanel Account Dashboard</h1>
HTML;

/* -- Domains -- */
echo "<h2>Domains</h2>";
echo isset($domains['data']) ? table($domains['data']) : '<em>Error: '.htmlspecialchars(json_encode($domains)).'</em>';

/* -- Email Accounts -- */
echo "<h2>Email Accounts</h2>";
echo isset($emails['data']) ? table($emails['data']) : '<em>Error: '.htmlspecialchars(json_encode($emails)).'</em>';

/* -- FTP Accounts -- */
echo "<h2>FTP Accounts</h2>";
echo isset($ftps['data']) ? table($ftps['data']) : '<em>Error: '.htmlspecialchars(json_encode($ftps)).'</em>';

/* -- MySQL Databases -- */
echo "<h2>MySQL Databases</h2>";
echo isset($databases['data']) ? table($databases['data']) : '<em>Error: '.htmlspecialchars(json_encode($databases)).'</em>';

/* -- Cron Jobs -- */
echo "<h2>Cron Jobs</h2>";
echo isset($crons['cpanelresult']['data']) ? table($crons['cpanelresult']['data']) : '<em>Error: '.htmlspecialchars(json_encode($crons)).'</em>';

/* -- Disk / Bandwidth Summary -- */
echo "<h2>Disk &amp; Bandwidth Summary</h2>";
echo isset($stats['data']) ? table($stats['data']) : '<em>Error: '.htmlspecialchars(json_encode($stats)).'</em>';

echo "</body></html>";
?>




Perl (*perl/*pl) test suite (with debug capability)
------------------------------------

<?php
function list_perl_files($dir) {
    return array_filter(scandir($dir), function ($f) use ($dir) {
        return preg_match('/\.(pl|perl)$/', $f) && is_file($dir . DIRECTORY_SEPARATOR . $f);
    });
}

function check_perl_script($filename) {
    $results = [];
    $filepath = __DIR__ . DIRECTORY_SEPARATOR . $filename;

    if (!file_exists($filepath)) {
        $results['error'] = "File not found.";
        return $results;
    }

    $lines = file($filepath);
    $shebang = trim($lines[0] ?? '');
    $results['shebang'] = ($shebang === '#!/usr/bin/perl');

    $results['has_crlf'] = preg_match("/\r\n/", file_get_contents($filepath)) === 1;

    $interpreter = '/usr/bin/perl';
    $results['interpreter_exists'] = file_exists($interpreter) && is_executable($interpreter);

    $perms = substr(sprintf('%o', fileperms($filepath)), -3);
    $results['perm_ok'] = ($perms === '755');
    $results['perms'] = $perms;

    $uri = $_SERVER['REQUEST_URI'];
    $url = dirname($uri) . '/' . $filename;
    $full_url = (isset($_SERVER['HTTPS']) ? 'https://' : 'http://') . $_SERVER['HTTP_HOST'] . $url;

    $results['test_url'] = $full_url;

    return $results;
}

function check_htaccess_for_handlers($handlers = ['.perl', '.pl']) {
    $htaccess = __DIR__ . DIRECTORY_SEPARATOR . '.htaccess';
    if (!file_exists($htaccess)) return [];
    $content = file_get_contents($htaccess);
    $found = [];
    foreach ($handlers as $ext) {
        $found[$ext] = (strpos($content, "AddHandler cgi-script $ext") !== false);
    }
    return $found;
}

function add_htaccess_handlers(array $handlers) {
    $htaccess = __DIR__ . DIRECTORY_SEPARATOR . '.htaccess';
    $lines = [];

    if (file_exists($htaccess)) {
        $lines = file($htaccess, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
        // Remove existing AddHandler or Options lines for cgi-script
        $lines = array_filter($lines, function ($line) {
            $l = strtolower($line);
            return (strpos($l, 'addhandler cgi-script') === false && strpos($l, 'options +execcgi') === false);
        });
    }

    // Add needed lines
    $lines[] = 'Options +ExecCGI';
    foreach ($handlers as $ext) {
        $lines[] = "AddHandler cgi-script $ext";
    }

    $content = implode("\n", $lines) . "\n";

    return file_put_contents($htaccess, $content) !== false;
}

function get_perl_path() {
    $perl = trim(shell_exec('which perl'));
    return $perl ?: '/usr/bin/perl';
}

function create_minimal_test_script() {
    $filename = 'min_test.pl';
    $filepath = __DIR__ . DIRECTORY_SEPARATOR . $filename;
    $code = "#!/usr/bin/perl\nprint \"Content-type: text/plain\\n\\n\";\nprint \"Hello CGI\\n\";\n";
    file_put_contents($filepath, $code);
    chmod($filepath, 0755);
    return $filename;
}

function check_folder_permissions($dir) {
    $perms = substr(sprintf('%o', fileperms($dir)), -3);
    return $perms;
}

function safe_rename($old, $new) {
    $old_path = __DIR__ . DIRECTORY_SEPARATOR . $old;
    $new_path = __DIR__ . DIRECTORY_SEPARATOR . $new;
    if (!file_exists($old_path)) return "Original file does not exist.";
    if (file_exists($new_path)) return "Target file already exists.";
    if (!rename($old_path, $new_path)) return "Rename failed.";
    return true;
}

function run_perl_script($script) {
    $scriptPath = __DIR__ . DIRECTORY_SEPARATOR . $script;
    if (!file_exists($scriptPath) || !is_executable($scriptPath)) {
        return ['error' => "Script not found or not executable: $script"];
    }

    $descriptorspec = [
        0 => ["pipe", "r"],  // stdin
        1 => ["pipe", "w"],  // stdout
        2 => ["pipe", "w"]   // stderr
    ];

    $process = proc_open($scriptPath, $descriptorspec, $pipes);

    if (!is_resource($process)) {
        return ['error' => "Failed to start process"];
    }

    fclose($pipes[0]);

    $stdout = stream_get_contents($pipes[1]);
    fclose($pipes[1]);

    $stderr = stream_get_contents($pipes[2]);
    fclose($pipes[2]);

    $return_value = proc_close($process);

    return [
        'stdout' => $stdout,
        'stderr' => $stderr,
        'exit_code' => $return_value,
    ];
}

// Handle rename request
$rename_message = '';
if (isset($_POST['rename_from'], $_POST['rename_to'])) {
    $from = basename($_POST['rename_from']);
    $to = basename($_POST['rename_to']);
    $res = safe_rename($from, $to);
    if ($res === true) {
        header('Location: ?script=' . urlencode($to));
        exit;
    } else {
        $rename_message = $res;
    }
}

$selected = $_POST['script'] ?? $_GET['script'] ?? '';
$fix_htaccess = isset($_POST['fix_htaccess']);
$fix_handlers = [];
if (isset($_POST['fix_perl'])) $fix_handlers[] = '.perl';
if (isset($_POST['fix_pl'])) $fix_handlers[] = '.pl';

$run_script = isset($_POST['run_script']);

$check = $selected ? check_perl_script($selected) : null;
$htaccess_status = check_htaccess_for_handlers(['.perl', '.pl']);
$perl_path = get_perl_path();
$folder_perms = check_folder_permissions(__DIR__);
$min_script = create_minimal_test_script();
$min_script_url = (isset($_SERVER['HTTPS']) ? 'https://' : 'http://') . $_SERVER['HTTP_HOST'] . dirname($_SERVER['REQUEST_URI']) . '/' . $min_script;

$htaccess_updated = false;
if ($fix_htaccess && count($fix_handlers)) {
    $htaccess_updated = add_htaccess_handlers($fix_handlers);
    $htaccess_status = check_htaccess_for_handlers(['.perl', '.pl']);
}

$run_output = null;
if ($run_script && $selected) {
    $run_output = run_perl_script($selected);
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Enhanced Perl CGI Checker with Rename & Run</title>
</head>
<body>
<h2>Perl/CGI Executability & Environment Tester</h2>

<form method="post">
    <label>Select a .pl or .perl script:</label>
    <select name="script" required>
        <option value="">-- Choose a script --</option>
        <?php foreach (list_perl_files(__DIR__) as $file): ?>
            <option value="<?= htmlspecialchars($file) ?>" <?= ($file === $selected) ? 'selected' : '' ?>>
                <?= htmlspecialchars($file) ?>
            </option>
        <?php endforeach; ?>
    </select>
    <br><br>

    <label><input type="checkbox" name="fix_htaccess" value="1" <?= $htaccess_updated ? 'checked' : '' ?>> Update .htaccess</label><br>
    <label><input type="checkbox" name="fix_perl" value="1" <?= $htaccess_status['.perl'] ? 'checked disabled' : '' ?>> Enable CGI for <code>.perl</code> files <?= $htaccess_status['.perl'] ? '(Already enabled)' : '' ?></label><br>
    <label><input type="checkbox" name="fix_pl" value="1" <?= $htaccess_status['.pl'] ? 'checked disabled' : '' ?>> Enable CGI for <code>.pl</code> files <?= $htaccess_status['.pl'] ? '(Already enabled)' : '' ?></label><br><br>

    <button type="submit" name="run_checks" value="1">Run Checks</button>
    <?php if ($selected): ?>
        <button type="submit" name="run_script" value="1">Run Script</button>
    <?php endif; ?>
</form>

<?php if ($check): ?>
<pre>
Checking: <?= htmlspecialchars($selected) ?>

- Perl interpreter exists at:      <?= $perl_path ? "‚úÖ $perl_path" : "‚ùå Not found" ?>
- Script shebang is #!/usr/bin/perl: <?= $check['shebang'] ? "‚úÖ Yes" : "‚ùå No" ?>
- Line endings UNIX (LF only):    <?= !$check['has_crlf'] ? '‚úÖ Yes' : '‚ùå CRLF found' ?>
- File permissions 755:            <?= $check['perm_ok'] ? '‚úÖ Yes' : '‚ùå No (' . $check['perms'] . ')' ?>
- Folder permissions (current dir): <?= $folder_perms ?>

‚û°Ô∏è Try running in browser:
<?= $check['test_url'] ?>

<?php if (!$check['perm_ok']): ?>
‚ö†Ô∏è Fix permissions: <code>chmod 755 <?= escapeshellarg($selected) ?></code>
<?php endif; ?>

<?php if (!$check['shebang']): ?>
‚ö†Ô∏è Check your script's first line shebang; it must exactly be:
#!/usr/bin/perl
<?php endif; ?>

<?php if (!$check['interpreter_exists']): ?>
‚ö†Ô∏è Perl interpreter not found or not executable at /usr/bin/perl. Actual path:
<?= $perl_path ?>

<?php endif; ?>

<?php if (!$htaccess_status['.perl'] && !$htaccess_status['.pl']): ?>
‚ö†Ô∏è Your folder lacks .htaccess CGI handlers for .perl or .pl files.
Use the checkboxes above to add them automatically.
<?php endif; ?>

<?php if ($selected && preg_match('/\.perl$/i', $selected)): ?>
‚ö†Ô∏è Some hosts only allow CGI on .pl files. Consider renaming:
<code>mv <?= escapeshellarg($selected) ?> <?= escapeshellarg(preg_replace('/\.perl$/i', '.pl', $selected)) ?></code>

<form method="post" style="margin-top:10px;">
    <input type="hidden" name="rename_from" value="<?= htmlspecialchars($selected) ?>">
    <input type="hidden" name="rename_to" value="<?= htmlspecialchars(preg_replace('/\.perl$/i', '.pl', $selected)) ?>">
    <button type="submit">Rename <?= htmlspecialchars($selected) ?> to .pl</button>
</form>

<?php if ($rename_message): ?>
<p style="color:red;">Rename error: <?= htmlspecialchars($rename_message) ?></p>
<?php endif; ?>

<?php endif; ?>
</pre>
<?php endif; ?>

<?php if ($run_output): ?>
<hr>
<h3>Run Script Output (<?= htmlspecialchars($selected) ?>)</h3>
<p><strong>Exit Code:</strong> <?= $run_output['exit_code'] ?></p>
<h4>STDOUT:</h4>
<pre><?= htmlspecialchars($run_output['stdout']) ?></pre>
<h4>STDERR:</h4>
<pre><?= htmlspecialchars($run_output['stderr']) ?></pre>
<?php if (!empty($run_output['error'])): ?>
    <p style="color:red;">Error: <?= htmlspecialchars($run_output['error']) ?></p>
<?php endif; ?>
<?php endif; ?>

<hr>
<h3>Minimal CGI Test Script</h3>
<p>A minimal Perl CGI script named <code><?= $min_script ?></code> has been created in this folder.</p>
<p>Try running it in your browser: <a href="<?= htmlspecialchars($min_script_url) ?>" target="_blank"><?= htmlspecialchars($min_script_url) ?></a></p>

<hr>
<h3>Webserver error logs</h3>
<p>Check your webserver's error log files for details on 500 errors, e.g.:</p>
<ul>
    <li><code>/var/log/apache2/error.log</code> (Debian/Ubuntu)</li>
    <li><code>/var/log/httpd/error_log</code> (CentOS/RHEL)</li>
    <li>Or your hosting control panel logs</li>
</ul>

</body>
</html>




Pixiv Metadatafetch (2025)(using PixivFE)
-------------------------------------------

==fetch.php==

<?php
echo '<a href="?userId=115969453" style="color:blue">Cea</a> ';
echo '<a target="_blank" href="?userId=75406576" style="color:blue">Alcea</a><hr>';

function getPixivUserArt($userId, $random, $maxLinks = 4) {
    // Adjust API URL if userId query param exists
    $queryUserId = $_GET['userId'] ?? null;
    if ($queryUserId) {
        $apiUrl = "https://www.pixiv.net/ajax/user/{$queryUserId}/profile/all?useid={$queryUserId}";
    } else {
        $apiUrl = "https://www.pixiv.net/ajax/user/{$userId}/profile/all?useid={$userId}";
    }

    $options = [
        'http' => [
            'method' => 'GET',
            'header' => 'Referer: https://www.pixiv.net/'
        ],
        'ssl' => [
            'verify_peer' => false,
            'verify_peer_name' => false
        ]
    ];
    $context = stream_context_create($options);
    $response = @file_get_contents($apiUrl, false, $context);
    if (!$response) {
        echo "Failed to fetch user data.";
        return [];
    }

    $data = json_decode($response, true);
    if (isset($data['body']['illusts'])) {
        $artworks = $data['body']['illusts'];
        $pixivLinks = [];

        if ($random) {
            $randomArtId = array_rand($artworks);
            $pixivLinks[] = "https://www.pixiv.net/en/artworks/{$randomArtId}";
        } else {
            foreach (array_keys($artworks) as $artId) {
                $pixivLinks[] = "https://www.pixiv.net/en/artworks/{$artId}";
                if (count($pixivLinks) >= $maxLinks) break;
            }
        }
        return $pixivLinks;
    }

    echo "No artworks found for the given user.";
    return [];
}

$userId = $_GET['userId'] ?? '75406576';
$random = isset($_GET['random']);
$maxLinks = isset($_GET['max']) ? (int)$_GET['max'] : 4;

$pixivLinks = getPixivUserArt($userId, $random, $maxLinks);

foreach ($pixivLinks as $link) {
    $encodedUrl = urlencode($link);

    // Full absolute URL to singlefetch.php - change to your actual domain/path
    $singlefetchUrl = "https://alcea-wisteria.de/PHP//0demo/2024-03-14-PixivTools/2024-03-15-PixivFindLikesBookmarks/2025-05-25-PixivFE-approach/singlefetch.php?url=$encodedUrl";

    $context = stream_context_create([
        'http' => ['timeout' => 10]
    ]);
    $output = @file_get_contents($singlefetchUrl, false, $context);

    if ($output === false) {
        echo "<div>Failed to load: <a target='_blank' href='" . htmlspecialchars($link) . "'>" . htmlspecialchars($link) . "</a></div><br>";
    } else {
        echo $output . "<br>";
    }
}
?>

===singlefetch.php== 

<?php

// Default URL base
$defaultBaseUrl = "https://pixiv.perennialte.ch/artworks/";

// Get ?url= parameter if exists
$inputUrl = $_GET['url'] ?? null;
$artworkId = null;

// Extract artwork ID (number at end) from given URL or fallback
if ($inputUrl) {
    // Match last number in URL path
    if (preg_match('#/(\d+)(?:[/?]|$)#', $inputUrl, $matches)) {
        $artworkId = $matches[1];
    }
}

if ($artworkId) {
    $url = $defaultBaseUrl . $artworkId;
} else {
    // fallback default
    $url = $defaultBaseUrl . "127908186";
}

$ch = curl_init($url);
curl_setopt_array($ch, [
    CURLOPT_RETURNTRANSFER => true,
    CURLOPT_FOLLOWLOCATION => true,
    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_2TLS,
    CURLOPT_USERAGENT => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 Chrome/114.0.0.0 Safari/537.36',
    CURLOPT_HEADER => false,
    CURLOPT_SSL_VERIFYPEER => true,
    CURLOPT_SSL_VERIFYHOST => 2,
    CURLOPT_COOKIEJAR => '/tmp/cookies.txt',
    CURLOPT_COOKIEFILE => '/tmp/cookies.txt',
    CURLOPT_HTTPHEADER => [
        'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
        'Accept-Language: en-US,en;q=0.9',
        'Connection: keep-alive',
        'Referer: https://pixiv.perennialte.ch/',
    ],
]);

$html = curl_exec($ch);
$err = curl_error($ch);
$code = curl_getinfo($ch, CURLINFO_RESPONSE_CODE);
curl_close($ch);

if ($html === false || $err) {
    die("cURL error: $err");
}
if ($code !== 200) {
    die("Unexpected HTTP status code: $code");
}

$doc = new DOMDocument();
libxml_use_internal_errors(true);
$doc->loadHTML($html);
libxml_clear_errors();

$xpath = new DOMXPath($doc);

function getNextElementSibling($node) {
    do {
        $node = $node->nextSibling;
    } while ($node && $node->nodeType !== XML_ELEMENT_NODE);
    return $node;
}

// Extract page title
$title = $doc->getElementsByTagName('title')->item(0);
$titleText = $title ? trim($title->textContent) : 'No Title';

$imageUrl = null;
$img = $xpath->query('//div[contains(@class,"artwork-container")]//img')->item(0);
if (!$img) {
    $img = $xpath->query('//img')->item(0);
}
if ($img) {
    $imageUrl = $img->getAttribute('src');
}

$favoriteCount = null;
$favoriteSpan = $xpath->query('//span[contains(@class,"material-symbols-rounded-20") and normalize-space(text())="favorite"]')->item(0);
if ($favoriteSpan) {
    $nextSpan = getNextElementSibling($favoriteSpan);
    if ($nextSpan && strpos($nextSpan->getAttribute('class'), 'inline') !== false) {
        $favoriteCount = trim($nextSpan->textContent);
    }
}

$likeCount = null;
$likeSpan = $xpath->query('//span[contains(@class,"material-symbols-rounded-20") and normalize-space(text())="thumb_up"]')->item(0);
if ($likeSpan) {
    $nextSpan = getNextElementSibling($likeSpan);
    if ($nextSpan && strpos($nextSpan->getAttribute('class'), 'inline') !== false) {
        $likeCount = trim($nextSpan->textContent);
    }
}

echo '<a href="' . htmlspecialchars($url) . '" target="_blank">' . htmlspecialchars($titleText) . '</a> ';
if ($imageUrl) {
    echo '<a href="' . htmlspecialchars($imageUrl) . '" target="_blank"><img src="' . htmlspecialchars($imageUrl) . '" alt="img" style="height:20px;vertical-align:middle;"></a> ';
}
echo 'favs ' . htmlspecialchars($favoriteCount ?? 'N/A') . ' bookmarks ' . htmlspecialchars($likeCount ?? 'N/A');



LinkExtract
-------------

<?php
function getDomain($url) {
    $parsed = parse_url($url);
    return $parsed['host'] ?? '';
}

function extractInternalLinks($url) {
    $html = @file_get_contents($url);
    if ($html === false) {
        return ['error' => 'Failed to load URL content.'];
    }

    $domain = getDomain($url);
    $internalLinks = [];

    $dom = new DOMDocument();
    @$dom->loadHTML($html); // Suppress warnings for malformed HTML

    $xpath = new DOMXPath($dom);
    $links = $xpath->query('//a[@href]');

    foreach ($links as $link) {
        $href = $link->getAttribute('href');
        $href = trim($href);

        // Convert relative URLs to absolute
        $absoluteUrl = url_to_absolute($url, $href);
        if (getDomain($absoluteUrl) === $domain) {
            $internalLinks[] = $absoluteUrl;
        }
    }

    return array_unique($internalLinks);
}

function url_to_absolute($baseUrl, $relativeUrl) {
    // If already absolute
    if (parse_url($relativeUrl, PHP_URL_SCHEME) != '') return $relativeUrl;
    // Build from base
    return rtrim($baseUrl, '/') . '/' . ltrim($relativeUrl, '/');
}
?>

<!-- HTML form -->
<form method="POST">
    <input type="text" name="url" placeholder="Enter URL" size="50" required value="<?php echo isset($_POST['url']) ? htmlspecialchars($_POST['url']) : ''; ?>">
    <button type="submit">Extract Links</button>
</form>

<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST' && !empty($_POST['url'])) {
    $url = trim($_POST['url']);
    $links = extractInternalLinks($url);

    if (isset($links['error'])) {
        echo "<p>Error: " . htmlspecialchars($links['error']) . "</p>";
    } else {
        if (count($links) === 0) {
            echo "<p>No internal links found.</p>";
        } else {
            echo "<h3>Internal Links:</h3><ul>";
            foreach ($links as $link) {
                echo "<li><a href=\"$link\" target=\"_blank\">" . htmlspecialchars($link) . "</a></li>";
            }
            echo "</ul>";

            // Join URLs with the delimiter íê´ WITHOUT urlencoding
            $joinedUrls = implode("íê´", $links);
            // Escape for HTML attribute
            $joinedUrlsEscaped = htmlspecialchars($joinedUrls, ENT_QUOTES, 'UTF-8');

            echo <<<HTML
<form action="email_extract.php" method="GET" style="margin-top:20px;">
    <input type="hidden" name="urls" value="$joinedUrlsEscaped">
    <button type="submit">Send URLs to email_extract.php</button>
</form>
HTML;
        }
    }
}
?>

Mail Extract:
-------------
<?php
function normalizeObfuscatedEmails($content) {
    // Normalize common obfuscation patterns
    $patterns = [
        '/\s*\(?\[?at\]?\)?\s*/i' => '@',
        '/\s*\(?\[?dot\]?\)?\s*/i' => '.',
    ];
    return preg_replace(array_keys($patterns), array_values($patterns), $content);
}

function extractEmails($content) {
    // Normalize obfuscated formats first
    $normalized = normalizeObfuscatedEmails($content);

    // Extract email addresses
    preg_match_all('/[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}/i', $normalized, $matches);
    return array_unique($matches[0]);
}

function fetchPageContent($url) {
    $ch = curl_init();

    curl_setopt_array($ch, [
        CURLOPT_URL => $url,
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_USERAGENT => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:115.0) Gecko/20100101 Firefox/115.0',
        CURLOPT_FOLLOWLOCATION => true,
        CURLOPT_TIMEOUT => 10,
        CURLOPT_SSL_VERIFYPEER => false
    ]);

    $content = curl_exec($ch);
    $error = curl_error($ch);

    curl_close($ch);

    return $error ? false : $content;
}

$emails = [];
$errorUrls = [];

// Handle optional ?urls= parameter (URLs delimited by the special character "íê´")
$prefillUrls = '';
if (isset($_GET['urls'])) {
    // Replace delimiter with newlines for the textarea
    $prefillUrls = str_replace("íê´", "\n", $_GET['urls']);
}

if ($_SERVER['REQUEST_METHOD'] === 'POST' && !empty($_POST['urls'])) {
    $urls = explode("\n", trim($_POST['urls']));
    foreach ($urls as $url) {
        $url = trim($url);
        if (filter_var($url, FILTER_VALIDATE_URL)) {
            $content = fetchPageContent($url);
            if ($content !== false) {
                $foundEmails = extractEmails($content);
                $emails = array_merge($emails, $foundEmails);
            } else {
                $errorUrls[] = $url;
            }
        } else {
            $errorUrls[] = $url;
        }
    }
    $emails = array_unique($emails);
}
?>
<!DOCTYPE html>
<html>
<head>

</head>
<body>
    <h2>Email Extractor (Supports Obfuscation)</h2>
    <form method="post">
        <textarea name="urls" rows="10" cols="80" placeholder="Enter one URL per line"><?php
            if (isset($_POST['urls'])) {
                echo htmlspecialchars($_POST['urls']);
            } elseif (!empty($prefillUrls)) {
                echo htmlspecialchars($prefillUrls);
            }
        ?></textarea><br>
        <button type="submit">Extract Emails</button>
    </form>

    <?php if (!empty($emails)): ?>
        <h3>Found Emails:</h3>
        <ul>
            <?php foreach ($emails as $email): ?>
                <li><?php echo htmlspecialchars($email); ?></li>
            <?php endforeach; ?>
        </ul>
    <?php endif; ?>

    <?php if (!empty($errorUrls)): ?>
        <h3>Errors/Invalid URLs:</h3>
        <ul style="color:red;">
            <?php foreach ($errorUrls as $url): ?>
                <li><?php echo htmlspecialchars($url); ?></li>
            <?php endforeach; ?>
        </ul>
    <?php endif; ?>
</body>
</html>



Calendar with colored events n biweekly underline
------------------


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Full Year Calendar with Events</title>
  <style>
    body { margin: 20px; font-family: Arial, sans-serif; background: #f0f0f0; }
    .wrapper { display: flex; gap: 30px; align-items: flex-start; }
    .calendar-wrap { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 8px rgba(0,0,0,.1); }
    .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .calendar-header button { padding: 5px 10px; background: #2196f3; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
    .calendar-header span { font-size: 1.2em; font-weight: bold; }
    .days { display: grid; grid-template-columns: repeat(7, 40px); gap: 5px; justify-content: center; }
    .weekday { font-weight: bold; background: #eee; padding: 5px 0; border-radius: 4px; text-align: center; }
    .day { padding: 5px 0; border-radius: 4px; text-align: center; cursor: pointer; }
    .day.today { background: #2196f3; color: #fff; }
    .events-wrap { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 8px rgba(0,0,0,.1); width: 300px; max-height: 500px; overflow-y: auto; }
    .events-wrap h3 { margin-top: 0; }
    .date-group { margin-bottom: 12px; }
    .date-group h4 { margin: 0 0 4px; font-size: 1em; border-bottom: 1px solid #ddd; padding-bottom: 2px; }
    .event-item { margin-left: 10px; font-size: .9em; }
    details { margin-top: 12px; }
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,.4); display: none; justify-content: center; align-items: center; }
    .modal-content { background: #fff; padding: 20px; border-radius: 8px; position: relative; width: 260px; }
    #closeModal { position: absolute; top: 6px; right: 10px; cursor: pointer; font-size: 20px; }
    .modal-content input, .modal-content select { width: 100%; padding: 6px; margin: 6px 0; }
    .modal-content button { padding: 6px 12px; background: #2196f3; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
    #weekLegend div { margin-top: 4px; font-size: .85em; }
  </style>
</head>
<body>

<div class="wrapper">
  <!-- CALENDAR -->
  <div class="calendar-wrap">
    <div class="calendar-header">
      <button onclick="changeMonth(-1)">&laquo;</button>
      <span id="monthYear"></span>
      <button onclick="changeMonth(1)">&raquo;</button>
    </div>
    <div class="days" id="calendar"></div>
    <div id="weekLegend"></div>
  </div>

  <!-- EVENTS -->
  <div class="events-wrap">
    <h3>Events ‚Äì This Month</h3>
    <div id="eventsList"></div>
  </div>
</div>

<!-- ADD EVENT MODAL -->
<div id="eventModal" class="modal">
  <div class="modal-content">
    <span id="closeModal">&times;</span>
    <h3>Add Event</h3>
    <form id="eventForm">
      <p id="eventDateLabel"></p>
      <input type="time" id="eventTime" required step="1">
      <input type="text" id="eventText" placeholder="Event description" required>
      <label for="eventColor">Color:</label>
      <select id="eventColor" required>
        <option value="lightblue">Light Blue</option>
        <option value="lightgreen">Light Green</option>
        <option value="lightpink">Light Pink</option>
        <option value="lightyellow">Light Yellow</option>
        <option value="lightcoral">Light Coral</option>
        <option value="lavender">Lavender</option>
      </select>
      <button type="submit">Save</button>
    </form>
  </div>
</div>

<script>
let events = [], eventsByDate = {};
let today = new Date(), todayStr = today.toISOString().substring(0,10);
let currentMonth = today.getMonth(), currentYear = today.getFullYear();
let oddWeekColor = '', evenWeekColor = '', oddWeekDesc = '', evenWeekDesc = '';

const weekdays = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
const calendarEl = document.getElementById("calendar");
const monthYearEl = document.getElementById("monthYear");
const eventsListEl = document.getElementById("eventsList");

const modal = document.getElementById("eventModal");
const closeBtn = document.getElementById("closeModal");
const eventForm = document.getElementById("eventForm");
const dateLabel = document.getElementById("eventDateLabel");
const timeInput = document.getElementById("eventTime");
const textInput = document.getElementById("eventText");
const colorInput = document.getElementById("eventColor");
let selectedDateStr = '';

function getQueryParam(name) {
  const params = new URLSearchParams(window.location.search);
  return params.get(name);
}

function getISOWeek(d) {
  const date = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
  const dayNum = date.getUTCDay() || 7;
  date.setUTCDate(date.getUTCDate() + 4 - dayNum);
  const yearStart = new Date(Date.UTC(date.getUTCFullYear(), 0, 1));
  return Math.ceil((((date - yearStart) / 86400000) + 1) / 7);
}

async function loadWeeklyJSON() {
  const weeklyFile = getQueryParam('weekly') || 'weekly.json';
  try {
    const res = await fetch(weeklyFile, { cache: 'no-store' });
    if (!res.ok) throw new Error('File not found');
    const data = await res.json();

    if (data.kwuneven) {
      oddWeekColor = data.kwuneven.color || '';
      oddWeekDesc = data.kwuneven.description || '';
    } else {
      oddWeekColor = ''; oddWeekDesc = '';
    }
    if (data.kwevencolor) {
      evenWeekColor = data.kwevencolor.color || '';
      evenWeekDesc = data.kwevencolor.description || '';
    } else {
      evenWeekColor = ''; evenWeekDesc = '';
    }
    const legendEl = document.getElementById("weekLegend");
    legendEl.innerHTML = '';
    if (oddWeekColor) {
      legendEl.innerHTML += `<div><span style="display:inline-block;width:12px;height:12px;background:${oddWeekColor};border:1px solid #999;margin-right:5px;"></span>${oddWeekDesc}</div>`;
    }
    if (evenWeekColor) {
      legendEl.innerHTML += `<div><span style="display:inline-block;width:12px;height:12px;background:${evenWeekColor};border:1px solid #999;margin-right:5px;"></span>${evenWeekDesc}</div>`;
    }
  } catch (e) {
    // If file not found or malformed JSON, clear weekly colors/legend
    oddWeekColor = '';
    evenWeekColor = '';
    oddWeekDesc = '';
    evenWeekDesc = '';
    document.getElementById("weekLegend").innerHTML = '';
  }
}

async function loadEvents() {
  try {
    const res = await fetch('dates.json', { cache: 'no-store' });
    events = await res.json();
  } catch (e) { events = []; }
  eventsByDate = {};
  events.forEach(ev => {
    if (!eventsByDate[ev.date]) eventsByDate[ev.date] = [];
    eventsByDate[ev.date].push(ev);
  });
  events.forEach(arr => arr?.sort?.((a, b) => a.time.localeCompare(b.time)));
  events.sort((a,b)=>b.date===a.date ? b.time.localeCompare(a.time) : b.date.localeCompare(a.date));
}

function renderCalendar(month, year) {
  calendarEl.innerHTML = '';
  monthYearEl.textContent = `${monthNames[month]} ${year}`;
  weekdays.forEach(w => {
    const el = document.createElement('div');
    el.className = 'weekday';
    el.textContent = w;
    calendarEl.appendChild(el);
  });

  const firstDay = new Date(year, month, 1);
  const offset = (firstDay.getDay() + 6) % 7;
  for (let i = 0; i < offset; i++) calendarEl.appendChild(document.createElement('div'));

  const daysInMonth = new Date(year, month + 1, 0).getDate();
  for (let d = 1; d <= daysInMonth; d++) {
    const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const div = document.createElement('div');
    div.className = 'day';
    div.textContent = d;

    const dateObj = new Date(year, month, d);
    const isoWeek = getISOWeek(dateObj);
    const weekday = dateObj.getDay();
    if (weekday >= 1 && weekday <= 5) {
      const col = isoWeek % 2 === 0 ? evenWeekColor : oddWeekColor;
      if (col) {
        div.style.textDecoration = 'underline';
        div.style.textDecorationColor = col;
      }
    }

    if (dateStr === todayStr) div.classList.add('today');
    if (eventsByDate[dateStr]) {
      div.style.background = eventsByDate[dateStr][0].color || 'lightblue';
      div.style.color = '#000';
    }

    div.dataset.date = dateStr;
    div.addEventListener('click', openAddEvent);
    calendarEl.appendChild(div);
  }
}

function buildEventsList() {
  eventsListEl.innerHTML = '';
  const filtered = events.filter(ev => {
    const [y, m] = ev.date.split('-').map(Number);
    return y === currentYear && (m - 1) === currentMonth;
  });

  const upcoming = filtered.filter(ev => ev.date >= todayStr);
  const past = filtered.filter(ev => ev.date < todayStr);

  const addGroup = (parent, arr) => {
    let last = '';
    arr.forEach(ev => {
      if (ev.date !== last) {
        const g = document.createElement('div');
        g.className = 'date-group';
        const h = document.createElement('h4');
        h.textContent = ev.date;
        g.appendChild(h);
        parent.appendChild(g);
        last = ev.date;
      }
      const item = document.createElement('div');
      item.className = 'event-item';
      item.innerHTML = `<span style="display:inline-block;width:10px;height:10px;background:${ev.color};margin-right:4px;border:1px solid #999;border-radius:2px;"></span>
                        <strong>${ev.time.replace(/\./g,':')}</strong> ‚Äì ${ev.text}`;
      if (ev.date === todayStr) item.style.fontWeight = 'bold';
      parent.lastChild.appendChild(item);
    });
  };
  addGroup(eventsListEl, upcoming);
  if (past.length) {
    const det = document.createElement('details');
    det.innerHTML = '<summary>Past events</summary>';
    addGroup(det, past);
    eventsListEl.appendChild(det);
  }
}

function openAddEvent(e) {
  selectedDateStr = e.currentTarget.dataset.date;
  dateLabel.textContent = selectedDateStr;
  timeInput.value = new Date().toISOString().substr(11,8);
  textInput.value = '';
  colorInput.value = 'lightblue';
  modal.style.display = 'flex';
  textInput.focus();
}
closeBtn.onclick = () => modal.style.display = 'none';
window.onclick = e => { if (e.target === modal) modal.style.display = 'none'; };
eventForm.addEventListener('submit', e => {
  e.preventDefault();
  const qs = `process.php?date=${encodeURIComponent(selectedDateStr)}&time=${encodeURIComponent(timeInput.value.replace(/:/g, '.'))}&text=${encodeURIComponent(textInput.value.trim())}&color=${encodeURIComponent(colorInput.value.trim() || 'lightblue')}`;
  window.location.href = qs;
});

function changeMonth(offset) {
  currentMonth += offset;
  if (currentMonth < 0) { currentMonth = 11; currentYear--; }
  if (currentMonth > 11) { currentMonth = 0; currentYear++; }
  renderCalendar(currentMonth, currentYear);
  buildEventsList();
}

(async () => {
  await loadWeeklyJSON();
  await loadEvents();
  renderCalendar(currentMonth, currentYear);
  buildEventsList();
})();
</script>
</body>
</html>

<a href="?weekly=no.json" style=color:blue>
‚úñÔ∏èWeekly</a>


====process.php==
<?php
header('Content-Type: application/json');

$date  = $_GET['date'] ?? '';
$time  = $_GET['time'] ?? '';
$text  = $_GET['text'] ?? '';
$color = $_GET['color'] ?? 'lightblue';

if (!$date || !$time || !$text) {
    http_response_code(400);
    echo json_encode(["status" => "error", "message" => "Missing required parameters"]);
    exit;
}

$date  = preg_replace('/[^0-9\-]/', '', $date);
$time  = preg_replace('/[^0-9\.]/', '', $time);
$text  = strip_tags($text);
$color = strip_tags($color);

$newEvent = [
    "date"  => $date,
    "time"  => $time,
    "text"  => $text,
    "color" => $color
];

$jsonFile = 'dates.json';
$events = [];

if (file_exists($jsonFile)) {
    $data = file_get_contents($jsonFile);
    $events = json_decode($data, true);
    if (!is_array($events)) $events = [];
}

$events[] = $newEvent;

if (file_put_contents($jsonFile, json_encode($events, JSON_PRETTY_PRINT))) {
    echo json_encode(["status" => "success", "message" => "Event saved"]);
} else {
    http_response_code(500);
    echo json_encode(["status" => "error", "message" => "Could not write to file"]);
}




Webcomic Fetch
-------------------------



====fetch.php====

<?php
$images = [];
$small_images = [];
$page_title = '';
$submitted_url = '';

if (isset($_POST['url'])) {
    $submitted_url = trim($_POST['url']);
    $url = filter_var($submitted_url, FILTER_VALIDATE_URL);

    if ($url) {
        $parsed_url = parse_url($url);
        $base_host = $parsed_url['host'];

        $html = @file_get_contents($url);

        if ($html) {
            libxml_use_internal_errors(true);
            $doc = new DOMDocument();
            $doc->loadHTML($html);

            // Get page title
            $title_nodes = $doc->getElementsByTagName('title');
            if ($title_nodes->length > 0) {
                $page_title = $title_nodes->item(0)->nodeValue;
            }

            // Get image tags
            $tags = $doc->getElementsByTagName('img');
            foreach ($tags as $tag) {
                $src = $tag->getAttribute('src');
                if (!$src) continue;

                // Make relative URLs absolute
                if (parse_url($src, PHP_URL_SCHEME) === null) {
                    $src = rtrim($url, '/') . '/' . ltrim($src, '/');
                }

                $img_host = parse_url($src, PHP_URL_HOST);
                if (!$img_host || $img_host === $base_host) {
                    $size = @getimagesize($src);
                    if ($size) {
                        $img_data = [
                            'src' => $src,
                            'width' => $size[0],
                            'height' => $size[1],
                            'area' => $size[0] * $size[1]
                        ];

                        if ($size[0] >= 300) {
                            $images[] = $img_data;
                        } else {
                            $small_images[] = $img_data;
                        }
                    }
                }
            }

            // Sort both sets by resolution descending
            usort($images, fn($a, $b) => $b['area'] - $a['area']);
            usort($small_images, fn($a, $b) => $b['area'] - $a['area']);
        } else {
            echo "<p>‚ùå Failed to fetch content from the URL.</p>";
        }
    } else {
        echo "<p>‚ùå Invalid URL provided.</p>";
    }
}
?>

<form method="post" style="margin-bottom: 20px;">
    <label for="url">Enter a URL:</label><br>
    <input type="text" name="url" id="url" placeholder="https://example.com"
           style="width: 300px;" required value="<?= htmlspecialchars($submitted_url) ?>"><br><br>
    <button type="submit">Fetch Images</button>
</form>

<?php if (!empty($images) || !empty($small_images)): ?>
    <form method="get" action="process.php" id="imageForm">
        <div style="margin-bottom: 20px;">
            <label>Page URL:</label><br>
            <input type="text" name="url" style="width: 100%;"
                   value="<?= htmlspecialchars($submitted_url) ?>"><br><br>

            <label>Page Title:</label><br>
            <input type="text" name="title" style="width: 100%;"
                   value="<?= htmlspecialchars($page_title) ?>">
        </div>

        <h2>Internal Images (Sorted by Size):</h2>

        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
            <?php foreach ($images as $index => $img): ?>
                <div style="position: relative; text-align: center;">
                    <img src="<?= htmlspecialchars($img['src']) ?>"
                         alt="Image"
                         style="max-width: 200px; max-height: 200px; display: block;">
                    <input type="checkbox"
                           data-src="<?= htmlspecialchars($img['src']) ?>"
                           class="img-check"
                           style="position: absolute; bottom: 5px; right: 5px;">
                    <br><small><?= $img['width'] ?>√ó<?= $img['height'] ?></small>
                </div>
            <?php endforeach; ?>
        </div>

        <?php if (!empty($small_images)): ?>
            <details style="margin-top: 20px;">
                <summary>Show small images (width &lt; 300px)</summary>
                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
                    <?php foreach ($small_images as $img): ?>
                        <div style="position: relative; text-align: center;">
                            <img src="<?= htmlspecialchars($img['src']) ?>"
                                 alt="Image"
                                 style="max-width: 200px; max-height: 200px; display: block;">
                            <input type="checkbox"
                                   data-src="<?= htmlspecialchars($img['src']) ?>"
                                   class="img-check"
                                   style="position: absolute; bottom: 5px; right: 5px;">
                            <br><small><?= $img['width'] ?>√ó<?= $img['height'] ?></small>
                        </div>
                    <?php endforeach; ?>
                </div>
            </details>
        <?php endif; ?>

        <br><br>
        <button type="submit">Submit Selected Images</button>
    </form>

    <script>
        document.getElementById('imageForm').addEventListener('submit', function(e) {
            const checkboxes = document.querySelectorAll('.img-check');
            let count = 1;

            checkboxes.forEach(cb => {
                if (cb.checked) {
                    cb.setAttribute('name', 'img' + count);
                    cb.setAttribute('value', cb.getAttribute('data-src'));
                    count++;
                } else {
                    cb.removeAttribute('name'); // Do not submit unchecked
                }
            });
        });
    </script>
<?php endif; ?>


====process.php

<?php
// File where comics are stored
$filename = 'comic.json';

// Load existing data or initialize array
if (file_exists($filename)) {
    $json = file_get_contents($filename);
    $data = json_decode($json, true);
    if (!is_array($data)) $data = [];
} else {
    $data = [];
}

// Collect title and url
$title = isset($_GET['title']) ? trim($_GET['title']) : '';
$url   = isset($_GET['url'])   ? trim($_GET['url'])   : '';

if (!$title || !$url) {
    die("‚ùå Missing title or URL");
}

// Collect all img* keys (img1, img2, etc.)
$images = [];
foreach ($_GET as $key => $value) {
    if (preg_match('/^img\d+$/', $key)) {
        $images[] = $value;
    }
}

if (empty($images)) {
    die("‚ùå No images selected.");
}

// Build new entry
$new_entry = [
    'title'  => $title,
    'url'    => $url,
    'images' => $images
];

// Append to existing array
$data[] = $new_entry;

// Save back to file
file_put_contents($filename, json_encode($data, JSON_PRETTY_PRINT));

// Output success
echo "<h2>‚úÖ Comic saved!</h2>";
echo "<p><strong>Title:</strong> " . htmlspecialchars($title) . "</p>";
echo "<p><strong>URL:</strong> " . htmlspecialchars($url) . "</p>";
echo "<p><strong>Images:</strong></p><ul>";
foreach ($images as $img) {
    echo "<li><a href='" . htmlspecialchars($img) . "'>" . htmlspecialchars($img) . "</a></li>";
}
echo "</ul>";
?>


===render.html====

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Comic Viewer</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 800px;
      margin: auto;
      padding: 2em;
    }
    h2 a {
      text-decoration: none;
      color: #2a6df4;
    }
    img {
      max-width: 100%;
      display: block;
      margin: 1em 0;
      border: 1px solid #ccc;
    }
    .nav {
      display: flex;
      justify-content: space-between;
      margin-top: 2em;
    }
    .nav button {
      padding: 0.5em 1em;
      font-size: 1em;
    }
    .nav .center {
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <div id="viewer">
    <h2 id="title"></h2>
    <div id="images"></div>
    <div class="nav">
      <button id="prev">‚óÄ Prev</button>
      <button class="center" id="random">üé≤ Random</button>
      <button id="next">Next ‚ñ∂</button>
    </div>
  </div>

  <script>
    let comics = [];
    let index = 0;

    async function loadJSON() {
      const res = await fetch('comic.json');
      if (!res.ok) {
        document.getElementById('viewer').innerHTML = "<p>‚ùå Failed to load comic.json</p>";
        return;
      }
      comics = await res.json();
      if (!Array.isArray(comics) || comics.length === 0) {
        document.getElementById('viewer').innerHTML = "<p>‚ÑπÔ∏è No comics saved yet.</p>";
        return;
      }
      renderComic();
    }

    function renderComic() {
      const comic = comics[index];
      const title = document.getElementById('title');
      const images = document.getElementById('images');

      title.innerHTML = `<a href="${comic.url}" target="_blank">${comic.title}</a>`;
      images.innerHTML = '';

      comic.images.forEach(src => {
        const img = document.createElement('img');
        img.src = src;
        images.appendChild(img);
      });

      document.getElementById('prev').disabled = (index === 0);
      document.getElementById('next').disabled = (index === comics.length - 1);
    }

    document.getElementById('prev').addEventListener('click', () => {
      if (index > 0) {
        index--;
        renderComic();
      }
    });

    document.getElementById('next').addEventListener('click', () => {
      if (index < comics.length - 1) {
        index++;
        renderComic();
      }
    });

    document.getElementById('random').addEventListener('click', () => {
      if (comics.length <= 1) return;
      let newIndex;
      do {
        newIndex = Math.floor(Math.random() * comics.length);
      } while (newIndex === index && comics.length > 1);
      index = newIndex;
      renderComic();
    });

    loadJSON();
  </script>
</body>
</html>


_________________



Fetch all Stats for DA user
-------------------------------------------

<a target="_blank" href="fivefetch.php?user=aoikurayami1" style=color:lightgray>aoikurayami1</a><hr>
<?php
$user = isset($_GET['user']) && !empty($_GET['user']) ? $_GET['user'] : 'aoimatsuri';
$user = htmlspecialchars($user);
$url = "https://www.deviantart.com/" . urlencode($user);
$ch = curl_init($url);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_USERAGENT, 'Mozilla/5.0');
$html = curl_exec($ch);
curl_close($ch);
$dom = new DOMDocument();
libxml_use_internal_errors(true);
$dom->loadHTML($html);
libxml_clear_errors();
$xpath = new DOMXPath($dom);
$nodes = $xpath->query("//*[contains(text(), 'Watchers')]");
$counter = 0;
foreach ($nodes as $node) {
    echo "" . trim($node->textContent) . "\n";
    $counter++;
    if ($counter == 1) {
        break;
    }
}
?><br>
<?php
$user = isset($_GET['user']) ? $_GET['user'] : 'aoimatsuri';
$rssUrl = "https://backend.deviantart.com/rss.xml?type=deviation&q=by%3A{$user}+sort%3Atime+meta%3Aall";
$maxLinks = 5;
$xml = @simplexml_load_file($rssUrl);
if ($xml === false) {
    echo "Failed to load RSS feed.";
    exit;
}
function curl_get_contents($url) {
    $ch = curl_init($url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
    curl_setopt($ch, CURLOPT_USERAGENT, 'Mozilla/5.0'); // Required for DeviantArt
    $output = curl_exec($ch);
    if (curl_errno($ch)) {
        $output = "cURL error: " . curl_error($ch);
    }
    curl_close($ch);
    return $output;
}
echo "<style>
    body { font-family: Arial; }
    .entry { margin-bottom: 20px; }
    .entry a { font-weight: bold; color: #3366cc; }
    .fetched { margin-left: 10px; color: #444; }
</style>";
$count = 0;
foreach ($xml->channel->item as $item) {
    if ($count >= $maxLinks) break;
    $originalUrl = (string)$item->link;
    $encodedUrl = rawurlencode($originalUrl);
    $base = (isset($_SERVER['HTTPS']) ? "https" : "http") . "://" . $_SERVER['HTTP_HOST'];
    $fetchUrl = $base . dirname($_SERVER['PHP_SELF']) . "/singlefetch.php?url=$encodedUrl";
    $response = curl_get_contents($fetchUrl);
    echo "<div class='entry'>
            <!--<a href='$originalUrl' target='_blank'>$originalUrl</a>-->
            <div class='fetched'>$response</div>
          </div>";

    $count++;
}
?>



=======singlefetch.php==
<?php
// Check if the 'url' query string exists
$url = isset($_GET['url']) ? $_GET['url'] : 'https://www.deviantart.com/aoimatsuri/art/2025-04-11-Sleepy-1182078924';

$html = file_get_contents($url);
if ($html !== false) {
    // Use regex to extract the title
    preg_match('/<title>(.*?)<\/title>/', $html, $titleMatch);
    $pageTitle = isset($titleMatch[1]) ? $titleMatch[1] : 'No Title Found';

    // Remove " by aoimatsuri on DeviantArt"
    $pageTitle = preg_replace('/\s+by\s+[^ ]+\s+on\s+DeviantArt$/', '', $pageTitle);

    // Use regex to extract numbers within <span> tags
    preg_match_all('/<span>(\d+)<\/span>/', $html, $matches);
    
    // Ensure we have at least three numbers to display
    if (count($matches[1]) >= 3) {
        $lastThreeNumbers = array_slice($matches[1], -3);
        
        // Output with title and link, followed by labels
        echo "<a href=\"$url\" target=\"_blank\">$pageTitle</a>\n";
        echo "Favs: " . $lastThreeNumbers[0] . " ";
        echo "Comments: <span style='color: lightgray; opacity: 0.2; display: inline;'>" . $lastThreeNumbers[1] . "</span> ";  // Prevent line break by using 'inline' style
        echo "Views: " . $lastThreeNumbers[2] . "\n";
    } else {
        echo "Not enough numbers found.";
    }
} else {
    echo "Failed to retrieve content from the URL.";
}
?>




Reddit Media Extract
-------------------

<?php
function urlExists($url) {
    $headers = @get_headers($url, 1);
    return $headers && strpos($headers[0], '200') !== false;
}
$url = $_GET['url'] ?? null;
if (!$url) {
    die('No URL provided. Use ?url=https://example.com');
}
$options = [
    'http' => [
        'method' => 'GET',
        'header' => 'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:124.0) Gecko/20100101 Firefox/124.0'
    ]
];
$context = stream_context_create($options);
$htmlContent = @file_get_contents($url, false, $context);

if ($htmlContent === false) {
    die('Error fetching the webpage content.');
}
preg_match_all('/https?:\/\/[^"\s<>]+/i', $htmlContent, $matches);

$allUrls = $matches[0];
$mediaUrls = [];
foreach ($allUrls as $foundUrl) {
    $parsed = parse_url($foundUrl);
    if (isset($parsed['query'])) {
        parse_str($parsed['query'], $queryParams);
        if (isset($queryParams['url'])) {
            $decoded = urldecode($queryParams['url']);
            if (preg_match('/\.(png|jpe?g|mp4)$/i', $decoded)) {
                $mediaUrls[] = $decoded;
                continue;
            }
        }
    }
    if (preg_match('/\.(png|jpe?g|mp4)$/i', $foundUrl)) {
        $mediaUrls[] = $foundUrl;
    }
    if (preg_match('#(https://v\.redd\.it/[\w\d]+/)DASH_[\d]+\.mp4#i', $foundUrl, $dashMatch)) {
        $base = $dashMatch[1];
        $dash480 = $base . 'DASH_480.mp4';
        $dash240 = $base . 'DASH_240.mp4';

        if (urlExists($dash480)) {
            $mediaUrls[] = $dash480;
        }
        if (urlExists($dash240)) {
            $mediaUrls[] = $dash240;
        }
    }
}
foreach (array_unique($mediaUrls) as $mediaUrl) {
    echo htmlspecialchars($mediaUrl) . '<br><br>';
}
?>



Nintendo Direct ChartJS:
--------------------------------------


<?php

$url = "https://de.m.wikipedia.org/wiki/Nintendo_Direct";
$html = file_get_contents($url);

$dom = new DOMDocument;
libxml_use_internal_errors(true);
$dom->loadHTML($html);
libxml_clear_errors();

$xpath = new DOMXPath($dom);

$rows = $xpath->query("//table[contains(@class, 'wikitable')]/tbody/tr");

$data = [];

$germanMonths = [
    "Jan." => "January", "Feb." => "February", "M√§rz" => "March", "Apr." => "April",
    "Mai" => "May", "Juni" => "June", "Juli" => "July", "Aug." => "August",
    "Sep." => "September", "Okt." => "October", "Nov." => "November", "Dez." => "December"
];

$years = []; 

foreach ($rows as $row) {
    $cols = $row->getElementsByTagName('td');
    if ($cols->length >= 3) { 
        $title = trim($cols->item(0)->nodeValue); 
        $dateRaw = trim($cols->item(2)->nodeValue); 

        foreach ($germanMonths as $de => $en) {
            $dateRaw = str_replace($de, $en, $dateRaw);
        }

        $dateTime = DateTime::createFromFormat('d. F Y', $dateRaw);
        if ($dateTime) {
            $formattedDate = $dateTime->format('Y');
            $year = $dateTime->format('Y');
            $data[] = ['date' => $dateTime->format('Y-m-d'), 'title' => $title];

            if (!in_array($year, $years)) {
                $years[] = $year;
            }
        }
    }
}

$jsonData = json_encode($data);
$yearsJson = json_encode($years); 
?>

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nintendo Direct Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script> <!-- Annotation Plugin -->
</head>
<body>
    <canvas id="myChart" width="400" height="200"></canvas>

    <!-- Div to show the clicked event as a hyperlink -->
    <div id="eventDisplay" style="margin-top: 20px; font-size: 18px;"></div>

    <script>

        var dataFromPHP = <?php echo $jsonData; ?>;
        var years = <?php echo $yearsJson; ?>;

        var chartData = dataFromPHP.map(function(item, index) {
            let color = 'rgb(75, 192, 192)'; 

            if (item.title === "Nintendo Direct") {
                color = 'red'; 
            } else if (item.title === "Nintendo Direct Mini") {
                color = 'orange'; 
            }

            return {
                x: new Date(item.date),
                y: index + 1, 
                title: item.title,
                formattedDate: item.date,
                pointBackgroundColor: color,
                pointRadius: (color !== 'rgb(75, 192, 192)') ? 6 : 3 
            };
        });

        var verticalLines = years.map(year => ({
            type: 'line',
            mode: 'vertical',
            scaleID: 'x',
            value: new Date(`${year}-01-01`),
            borderColor: 'rgba(255, 0, 0, 0.5)',
            borderWidth: 2,
            label: {
                content: year,
                enabled: true,
                position: 'top'
            }
        }));

        var ctx = document.getElementById('myChart').getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'line',
            data: {
                datasets: [{
                    label: 'Nintendo Direct Events',
                    data: chartData,
                    borderColor: 'rgb(75, 192, 192)',
                    fill: false,
                    pointBackgroundColor: chartData.map(item => item.pointBackgroundColor), 
                    pointRadius: chartData.map(item => item.pointRadius) 
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Nintendo Direct Events'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(tooltipItem) {
                                return dataFromPHP[tooltipItem.dataIndex].title;
                            }
                        }
                    },
                    annotation: {
                        annotations: verticalLines 
                    }
                },
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: 'month'
                        },
                        title: {
                            display: true,
                            text: 'Date'
                        }
                    },
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Event Order'
                        }
                    }
                },
                onClick: function(event, elements) {
                    if (elements.length > 0) {
                        var index = elements[0].index;
                        var clickedEvent = chartData[index];

                        var youtubeSearchUrl = "https://www.youtube.com/results?search_query=" + 
                            encodeURIComponent(clickedEvent.formattedDate + " " + clickedEvent.title);

                        document.getElementById('eventDisplay').innerHTML = 
                            `You clicked: <a href="${youtubeSearchUrl}" target="_blank">${clickedEvent.title} (${clickedEvent.formattedDate})</a>`;
                    }
                }
            }
        });
    </script>
</body>
</html>

___________________


Website image extractor
-----------------------------

<?php
if (isset($_POST['url'])) {
    $url = $_POST['url'];

    // Initialize cURL to fetch the HTML content of the URL
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);
    curl_setopt($ch, CURLOPT_USERAGENT, "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36");
    $html = curl_exec($ch);
    curl_close($ch);

    if ($html !== false) {
        // Parse the HTML content
        $dom = new DOMDocument();
        libxml_use_internal_errors(true);  // Suppress warnings for invalid HTML
        $dom->loadHTML($html);
        libxml_clear_errors();

        // Find all image tags
        $images = $dom->getElementsByTagName('img');

        if ($images->length > 0) {
            echo "<h2>Embedded Images from the URL:</h2>";
            // Loop through all the image tags and display them
            foreach ($images as $image) {
                $src = $image->getAttribute('src');

                // If the image URL is relative, make it absolute
                if (strpos($src, 'http') === false) {
                    $parsedUrl = parse_url($url);
                    $src = $parsedUrl['scheme'] . '://' . $parsedUrl['host'] . '/' . ltrim($src, '/');
                }

                // Check if src is valid
                if (!empty($src)) {
                    // Display image
                    echo '<div style="margin: 20px; text-align: center;">';
                    echo '<img src="' . $src . '" alt="Embedded Image" style="max-width: 500px; margin: 10px; border: 2px solid #ddd; padding: 5px;">';
                    echo '</div>';
                }
            }
        } else {
            echo "No images found in the URL.";
        }
    } else {
        echo "Unable to fetch the content from the URL.";
    }
} else {
    echo "Please provide a URL.";
}
?>

<form method="POST">
    <label for="url">Enter URL:</label>
    <input type="text" name="url" id="url" required>
    <input type="submit" value="Fetch Images">
</form>

_________________


Poipiku Fetch image gallery
------------------------------------------

<?php
$url = 'https://poipiku.com/11331041/';
$ch = curl_init($url);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_USERAGENT, 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3');
$htmlContent = curl_exec($ch);
curl_close($ch);
if (!$htmlContent) {
    die('Error fetching the page content.');
}
$dom = new DOMDocument();
libxml_use_internal_errors(true);
$dom->loadHTML($htmlContent);
libxml_clear_errors();
$xpath = new DOMXPath($dom);
foreach ($xpath->query('//h2') as $h2) {
    $h2->parentNode->removeChild($h2);
}
$sectionNode = $xpath->query('//section[@id="IllustThumbList"]')->item(0);
if ($sectionNode === NULL) {
    die('The specified section was not found in the page.');
}
$baseUrl = 'https://poipiku.com';
$imageCount = 0;
$maxImages = 4;
$nodesToRemove = [];
foreach ($sectionNode->getElementsByTagName('a') as $a) {
    if ($imageCount >= $maxImages) {
        $nodesToRemove[] = $a;
        continue;
    }

    $href = $a->getAttribute('href');
    if (strpos($href, 'http') === false) {
        $a->setAttribute('href', $baseUrl . $href);
    }
    $a->setAttribute('target', '_blank');
    $style = $a->getAttribute('style');
    if (preg_match("/url\('\/\/(.*?)'\)/", $style, $matches)) {
        $relativeImageUrl = $matches[1];
        $absoluteImageUrl = 'https://' . $relativeImageUrl;
        $brTag = $dom->createElement('br');
        $imgTag = $dom->createElement('img');
        $imgTag->setAttribute('src', $absoluteImageUrl);
        $imgTag->setAttribute('alt', 'Thumbnail');
        $hrTag = $dom->createElement('hr');
        $fragment = $dom->createDocumentFragment();
        $fragment->appendChild($brTag);
        $fragment->appendChild($imgTag);
        $fragment->appendChild($hrTag);
        $a->parentNode->insertBefore($fragment, $a);
        $imageCount++;
    }
}
foreach ($nodesToRemove as $node) {
    $node->parentNode->removeChild($node);
}
$extractedHtml = $dom->saveHTML($sectionNode);
if ($imageCount > 0) {
    echo $extractedHtml;
}
?>

___________



Youtube fetch&check new videos (multichannel urls)
-----------------------------------



===checkchannels.php=== 
<a target="_blank" href="confirmnewvid.php" style="color:blue" 
   onclick="this.href=this.href+(this.href.includes('?') ? '&' : '?')+'apikey='+new URLSearchParams(window.location.search).get('apikey');">
   NewVideo?
</a><hr>
<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $apiKey = isset($_GET['apikey']) ? $_GET['apikey'] : '';
    $channelUrls = explode(',', $_POST['channelUrls']);
    $outputFile = 'ytlist.txt';
    file_put_contents($outputFile, '');
    function fetchNewestVideoRSS($channelUrl)
    {
        $rssUrl = "https://www.youtube.com/feeds/videos.xml?channel_id=" . extractChannelId($channelUrl);
        $rssContent = simplexml_load_file($rssUrl);
        if ($rssContent && isset($rssContent->entry)) {
            $videoTitle = $rssContent->entry[0]->title;
            $videoLink = $rssContent->entry[0]->link['href'];
            $publishedDate = $rssContent->entry[0]->published;
            return "{$channelUrl} - {$videoLink} {$publishedDate}";
        }
        return "{$channelUrl} - No videos found";
    }
    function extractChannelId($url)
    {
        if (preg_match('/\/channel\/([\w\-]+)/i', $url, $match)) {
            return $match[1];
        } elseif (preg_match('/@([\w\-]+)/i', $url, $match)) {
            return getChannelIdFromHandle($match[1]);
        }
        return '';
    }
    function getChannelIdFromHandle($handle)
    {
        $apiUrl = "https://www.googleapis.com/youtube/v3/channels?part=id&forUsername={$handle}&key=YOUR_API_KEY";
        $response = json_decode(file_get_contents($apiUrl), true);
        if (!empty($response['items'][0]['id'])) {
            return $response['items'][0]['id'];
        }
        return '';
    }
    foreach ($channelUrls as $channelUrl) {
        $result = fetchNewestVideoRSS(trim($channelUrl));
        file_put_contents($outputFile, $result . PHP_EOL, FILE_APPEND);
    }
    echo "Newest video data saved to ytlist.txt.";
    exit;
}
function getFullChannelUrl($url) {
    if (preg_match('/\/channel\/(UC[a-zA-Z0-9_-]{22})/', $url, $match)) {
        return "https://www.youtube.com/channel/" . $match[1];
    }
    if (preg_match('/@([\w\-]+)/i', $url, $match)) {
        $username = $match[1];
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, "https://m.youtube.com/@{$username}");
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);
        $html = curl_exec($ch);
        curl_close($ch);
        $pattern = '/"externalId":"(UC[a-zA-Z0-9_-]{22})"/';
        if (preg_match($pattern, $html, $matches)) {
            $channelID = $matches[1];
            return "https://www.youtube.com/channel/" . $channelID;
        } else {
            return "Channel ID not found for handle: @{$username}";
        }
    }
    if (preg_match('/\/c\/([\w\-]+)/i', $url, $match)) {
        $username = $match[1];
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, "https://m.youtube.com/c/{$username}");
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);
        $html = curl_exec($ch);
        curl_close($ch);
        $pattern = '/"externalId":"(UC[a-zA-Z0-9_-]{22})"/';
        if (preg_match($pattern, $html, $matches)) {
            // Extracted channelID
            $channelID = $matches[1];
            // Construct the full channel URL
            return "https://www.youtube.com/channel/" . $channelID;
        } else {
            return "Channel ID not found for handle: c/{$username}";
        }
    }
    return "Invalid YouTube URL";
}
$url = 'https://alceawis.de/UnderratedContent.html';
$html = file_get_contents($url);
if ($html === FALSE) {
    die('Error fetching the webpage content.');
}
$pattern = '/https:\/\/m\.youtube\.com\/(@[\w\-]+|channel\/[\w\-]+|c\/[\w\-]+)/i';
preg_match_all($pattern, $html, $matches);
if (!empty($matches[0])) {
    echo "<form method='POST'>";
    echo "Found YouTube links in order of appearance:<br>";
    $fullLinks = [];
    foreach ($matches[0] as $link) {
        $fullLink = getFullChannelUrl(trim($link));
        echo "{$fullLink}<br>";
        $fullLinks[] = $fullLink;
    }
    // Add a hidden input to store the full channel URLs
    echo "<input type='hidden' name='channelUrls' value='" . implode(',', $fullLinks) . "'>";
    // Add a button to fetch newest video details
    echo "<button type='submit'>Check for Newest Videos</button>";
    echo "</form>";
} else {
    echo "No matching YouTube links found.<br>";
}
?>


====confirmnewvid.php===

<?php
function getLatestVideoFromRSS($channelId) {
    $rssUrl = "https://www.youtube.com/feeds/videos.xml?channel_id=$channelId";
    $rssData = simplexml_load_file($rssUrl);
    if ($rssData) {
        $latestVideoUrl = (string)$rssData->entry[0]->link['href'];
        $videoTitle = (string)$rssData->entry[0]->title;
        return ['url' => $latestVideoUrl, 'title' => $videoTitle];
    }
    return null;
}
$ytListFile = 'ytlist.txt';
$lines = file($ytListFile, FILE_IGNORE_NEW_LINES);
foreach ($lines as $line) {
    // Split the line into channel URL, video URL, and timestamp
    preg_match('/(https:\/\/www\.youtube\.com\/channel\/[a-zA-Z0-9_-]+)\s-\s(https:\/\/www\.youtube\.com\/watch\?v=[a-zA-Z0-9_-]+)\s(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\+00:00)/', $line, $matches);
    if (count($matches) == 4) {
        $channelUrl = $matches[1];
        $videoUrl = $matches[2];
        $timestamp = $matches[3];
        preg_match('/channel\/([a-zA-Z0-9_-]+)/', $channelUrl, $channelMatches);
        $channelId = $channelMatches[1];
        $latestVideo = getLatestVideoFromRSS($channelId);
        if ($latestVideo) {
            $linkText = htmlspecialchars($latestVideo['title']); // Escape special HTML characters for the title
            $linkUrl = $latestVideo['url'];
            if ($linkUrl === $videoUrl) {
                // Gray and bold for "same"
                echo $line . " <span style='color: gray; font-weight: bold;'>same</span> <a href='$linkUrl' target='_blank'>$linkText</a><br>\n";
            } else {
                // Green and bold for "new"
                echo $line . " <span style='color: green; font-weight: bold;'>new</span> <a href='$linkUrl' target='_blank'>$linkText</a><br>\n";
            }
        } else {
            echo "Error retrieving RSS for channel: $channelUrl\n";
        }
    } else {
        echo "Invalid format in line: $line\n";
    }
}
?>



Poweramp track relay:
----------------------------------

https://alcea-wisteria.de/PHP/0demo/2025-01-11-InfoRelays/2025-01-11-CurrPlaying/Tasker.zip

====trackrelay.php=======
<?php
// Get the query string value
if (isset($_GET['track'])) {
    // Sanitize input to prevent injection attacks
    $track = htmlspecialchars($_GET['track']);
    
    // Get the current date and time
    $date = date('Y-m-d H:i:s');
    
    // Format the line to be written
    $newLine = "$date - $track" . PHP_EOL;
    
    // File path to write the data
    $file = 'tracks.txt';

    // Read the current contents of the file
    $currentContent = '';
    if (file_exists($file)) {
        $currentContent = file_get_contents($file);
    }
    
    // Prepend the new line to the existing content
    $updatedContent = $newLine . $currentContent;

    // Write the updated content back to the file
    if (file_put_contents($file, $updatedContent, LOCK_EX)) {
        echo "Track recorded successfully.";
    } else {
        echo "Failed to write to file.";
    }
} else {
    echo "No track parameter provided.";
}


====rendertrk.html=== 
<meta charset="utf-8">
    <div class="container">
    <div id="line-container" class="line-container">
        √∞≈∏≈Ω¬µ<a target="_blank" href="tracks.txt">
            Currently Playing</a>√∞≈∏≈Ω¬∂:
        <span id="line-content" class="loading">Loading...</span>
        <span id="yt-link" style="display:none;"> <a id="yt-search-link" target="_blank" href="#">Search on YouTube</a></span>
    </div></div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const url = 'https://alcea-wisteria.de/PHP/0demo/2025-01-11-InfoRelays/2025-01-11-CurrPlaying/tracks.txt';
        const lineContentElement = document.getElementById('line-content');
        const ytLinkElement = document.getElementById('yt-link');
        const ytSearchLink = document.getElementById('yt-search-link');
        fetch(url)
            .then(response => response.text())
            .then(data => {
                const firstLine = data.split(/\r?\n/)[0];
                if (firstLine) {
                    lineContentElement.textContent = firstLine;
                    const trackInfo = firstLine.split(' - ')[1];
                    if (trackInfo) {
                        ytSearchLink.href = `https://www.youtube.com/results?search_query=${encodeURIComponent(trackInfo)}`;
                        ytSearchLink.textContent = `√Ç¬ª`;
                        ytLinkElement.style.display = 'inline';
                    }
                } else {
                    lineContentElement.textContent = 'No content found.';
                }
                lineContentElement.classList.remove('loading');
            })
            .catch(error => {
                lineContentElement.textContent = 'Error loading content.';
                lineContentElement.classList.remove('loading');
                console.error('Fetch error:', error);
            });
    });
</script>


Password protect php file (put at file start!)
---------------------

<?php
$correct_username = "admin";
$correct_password = "pass";  // Use a strong password for production
session_start();
if (isset($_SESSION['logged_in']) && $_SESSION['logged_in'] === true) {
    echo "Welcome, you are logged in!<hr>";
} else {
    if ($_SERVER['REQUEST_METHOD'] == 'POST') {
        $username = $_POST['username'];
        $password = $_POST['password'];
        if ($username === $correct_username && $password === $correct_password) {
            $_SESSION['logged_in'] = true;
            echo "Login successful. Welcome!";
            header("Location: " . $_SERVER['PHP_SELF']);
            exit;
        } else {
            echo "Invalid username or password.<hr>";
        }
    }
    echo '<form method="post">
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" required><br>
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required><br>
            <button type="submit">Login</button>
          </form>';
    exit();
}
?>



Link parser\finder (via keyword) on page) + multilink downloader
-------------------------------------

======parser.php====


<a target="_blank" href="dld.php" style=color:blue>DLD</a><br>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keyword Link Finder</title>
</head>
<body>
    <h1>Keyword Link Finder</h1>
    <form method="POST">
        <label for="url">Enter URL:</label><br>
        <input type="url" id="url" name="url"><br><br>
        
        <label for="links">Or Enter Links (one per line):</label><br>
        <textarea id="links" name="links" rows="5" cols="50"></textarea><br><br>
        
        <label for="keyword">Enter Keyword:</label><br>
        <input type="text" id="keyword" name="keyword" required><br><br>

        <label for="nested">
            <input type="checkbox" id="nested" name="nested"> Search nested links
        </label><br><br>
        
        <button type="submit">Submit</button>
    </form>
    <br>
    <?php
    if ($_SERVER['REQUEST_METHOD'] == 'POST') {
        $url = filter_input(INPUT_POST, 'url', FILTER_SANITIZE_URL);
        $linksInput = filter_input(INPUT_POST, 'links', FILTER_SANITIZE_STRING);
        $keyword = filter_input(INPUT_POST, 'keyword', FILTER_SANITIZE_STRING);
        $nested = isset($_POST['nested']); // Check if "nested" checkbox is checked

        function resolveUrl($baseUrl, $relativeUrl) {
            $parsedBase = parse_url($baseUrl);
            $base = $parsedBase['scheme'] . '://' . $parsedBase['host'];
            if (isset($parsedBase['path'])) {
                $base .= rtrim(dirname($parsedBase['path']), '/') . '/';
            }

            if (!parse_url($relativeUrl, PHP_URL_SCHEME)) {
                if (strpos($relativeUrl, '/') === 0) {
                    return $parsedBase['scheme'] . '://' . $parsedBase['host'] . $relativeUrl;
                } else {
                    return $base . $relativeUrl;
                }
            }
            return $relativeUrl;
        }

        function findLinks($url, $keyword, $nested = false, $depth = 0) {
            $htmlContent = @file_get_contents($url);
            if ($htmlContent === false) {
                return [];
            }

            $dom = new DOMDocument;
            @$dom->loadHTML($htmlContent);

            $links = $dom->getElementsByTagName('a');
            $matchingLinks = [];

            foreach ($links as $link) {
                $href = $link->getAttribute('href');
                if ($href) {
                    $absoluteHref = resolveUrl($url, $href);
                    if (strpos($absoluteHref, $keyword) !== false) {
                        $matchingLinks[] = $absoluteHref;

                        // If nested search is enabled, fetch links from the matching page
                        if ($nested && $depth < 1) { // Limit depth to prevent infinite recursion
                            $matchingLinks = array_merge(
                                $matchingLinks,
                                findLinks($absoluteHref, $keyword, $nested, $depth + 1)
                            );
                        }
                    }
                }
            }

            return array_unique($matchingLinks);
        }

        // Determine which input to use
        $linksArray = [];
        if (!empty($linksInput)) {
            $linksArray = array_filter(array_map('trim', explode("\n", $linksInput)));
        } elseif (!empty($url) && filter_var($url, FILTER_VALIDATE_URL)) {
            $linksArray[] = $url;
        } else {
            echo "<p style='color:red;'>Please provide a valid URL or a list of links.</p>";
            exit;
        }

        $resultLinks = [];
        foreach ($linksArray as $link) {
            if (filter_var($link, FILTER_VALIDATE_URL)) {
                $resultLinks = array_merge($resultLinks, findLinks($link, $keyword, $nested));
            } else {
                echo "<p style='color:red;'>Invalid link: $link</p>";
            }
        }

        $resultLinks = array_unique($resultLinks);

        if (!empty($resultLinks)) {
            echo "<label for='result'>Matching Links:</label><br>";
            echo "<textarea id='result' rows='10' cols='80' readonly>";
            echo implode("\n", $resultLinks);
            echo "</textarea>";
        } else {
            echo "<p style='color:blue;'>No links found containing the keyword '$keyword'.</p>";
        }
    }
    ?>
</body>
</html>


=======dld.php=====

<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $links = explode("\n", trim($_POST['links']));
    $folderName = preg_replace('/[^a-zA-Z0-9_\-]/', '_', trim($_POST['folder_name'])); // Sanitize folder name

    if (!empty($folderName) && !empty($links)) {
        $folderPath = __DIR__ . DIRECTORY_SEPARATOR . $folderName;

        // Create folder if it doesn't exist or ensure it can be used
        if (!is_dir($folderPath)) {
            mkdir($folderPath, 0755, true);
        }

        foreach ($links as $link) {
            $link = trim($link);
            if (filter_var($link, FILTER_VALIDATE_URL)) { // Validate URL
                $fileName = basename(parse_url($link, PHP_URL_PATH)); // Extract file name from URL
                $fileName = preg_replace('/[^a-zA-Z0-9_\-\.]/', '_', $fileName); // Sanitize file name

                if ($fileName) {
                    $filePath = $folderPath . DIRECTORY_SEPARATOR . $fileName;

                    // Always overwrite files
                    file_put_contents($filePath, file_get_contents($link)); // Download file
                }
            }
        }

        // Display a link to the created folder
        echo "<p>Files downloaded to folder: <a href='$folderName' target='_blank'>$folderName</a></p>";
    } else {
        echo "<p>Please provide a valid folder name and at least one link.</p>";
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download Links</title>
</head>
<body>
    <form method="POST">
        <label for="links">Links (one per line):</label><br>
        <textarea name="links" id="links" rows="10" cols="50" required></textarea><br><br>
        <label for="folder_name">Folder Name:</label><br>
        <input type="text" name="folder_name" id="folder_name" required><br><br>
        <button type="submit">Submit</button>
    </form>
</body>
</html>

___________



Bruteforce 4 digit pin zip:
--------------------------

<?php
if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_FILES['zip_file'])) {
    // Check if file was uploaded without errors
    if ($_FILES['zip_file']['error'] === UPLOAD_ERR_OK) {
        $zipFile = $_FILES['zip_file']['tmp_name'];
        $zip = new ZipArchive;

        // Try to open the uploaded ZIP file
        if ($zip->open($zipFile) === TRUE) {
            echo "<h3>ZIP file opened successfully!</h3>";
            echo "Attempting to brute-force the password...<br>";

            $found = false;
            // Loop through password combinations from 0000 to 9999
            for ($i = 0; $i <= 9999; $i++) {
                $password = str_pad($i, 4, '0', STR_PAD_LEFT); // Format password to 4 digits (0000, 0001, ..., 9999)

                // Set the password and check if the ZIP can be opened with the current password
                if ($zip->setPassword($password)) {
                    // Try to read a file inside the ZIP to verify the password
                    if ($zip->getFromName($zip->getNameIndex(0))) { // Check if the first file inside the ZIP can be opened
                        echo "<b>Password found: $password</b><br>";
                        $found = true;

                        // Delete the ZIP file after successful password detection
                        unlink($zipFile);
                        echo "ZIP file deleted after finding the correct password.<br>";
                        break;
                    }
                }
            }

            if (!$found) {
                echo "Password not found after trying all combinations (0000 to 9999).<br>";
            }

            // Close the ZIP file after processing
            $zip->close();
        } else {
            echo "Failed to open the ZIP file. It might not be a valid ZIP file or is corrupted.<br>";
        }
    } else {
        echo "Error: Failed to upload the ZIP file. Please try again.<br>";
    }
} else {
    // Display the file upload form if no file has been uploaded
    ?>
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ZIP File Upload and Brute Force</title>
    </head>
    <body>
        <h1>Upload ZIP File for Brute Force Password Check</h1>
        <form action="" method="post" enctype="multipart/form-data">
            <label for="zip_file">Choose ZIP file:</label>
            <input type="file" name="zip_file" id="zip_file" required>
            <button type="submit">Upload and Try Passwords</button>
        </form>
    </body>
    </html>
    <?php
}
?>


_________________________

htaccess deny all access to html files, but still allow php files to write to them serverside
----------------------------------

<FilesMatch "\.(html)$">
    Require all denied
</FilesMatch>

____________________

VroidHub fetch model info (name image link)
----------------------------

===allmodelstats.php==

<?php
// Base URL to use for constructing full URLs
$base_url = 'https://hub.vroid.com';

// URL of the page to fetch
$url = $base_url . '/en/users/75406576';

// Define the HTTP context options
$options = array(
    'http' => array(
        'method' => 'GET',
        'header' => 'Referer: ' . $base_url . "\r\n"
    ),
    'ssl' => array(
        'verify_peer' => false,
        'verify_peer_name' => false
    )
);

// Create the stream context
$context = stream_context_create($options);

// Fetch the HTML content
$html = file_get_contents($url, false, $context);

// Check if we got the HTML content
if ($html === false) {
    die('Failed to retrieve HTML');
}

// Load HTML into DOMDocument
$doc = new DOMDocument();
libxml_use_internal_errors(true); // Suppress warnings for malformed HTML
$doc->loadHTML($html);
libxml_clear_errors();

// Use DOMXPath to query the document
$xpath = new DOMXPath($doc);

// Query to find all href attributes starting with /characters/
$nodes = $xpath->query('//a[starts-with(@href, "/characters/")]');

// Array to keep track of unique URLs
$unique_urls = array();

// Process nodes and store unique URLs
foreach ($nodes as $node) {
    // Construct full URL
    $full_url = $base_url . $node->getAttribute('href');
    
    // Add URL to the array if it's not already present
    if (!in_array($full_url, $unique_urls)) {
        $unique_urls[] = $full_url;
    }
}

// Parse the limit parameter from the URL
$limit = isset($_GET['limit']) ? (int)$_GET['limit'] : count($unique_urls);

// Ensure limit is positive and does not exceed the number of unique URLs
$limit = max(1, min($limit, count($unique_urls)));

// Slice the array to include only the number of items specified by the limit
$unique_urls = array_slice($unique_urls, 0, $limit);

// Display unique URLs and corresponding iframes
if (count($unique_urls) > 0) {
    echo "";
    foreach ($unique_urls as $url) {
        // Display the URL as a clickable link that opens in a new tab
        //echo '<a href="' . $url . '" target="_blank">' . $url . '</a><br>' . "\n";
        
        // Encode URL for use in query string
        $encoded_url = urlencode($url);
        
        // Display the iframe
        echo '<iframe src="singlemodelstats.php?vroidurl=' . $encoded_url . '" width="600" height="195" frameborder="0"></iframe><br><br>' . "\n";
    }
} else {
    echo "No unique character URLs found.\n";
}
?>


==singlemodelstats.php==

<?php
// Initialize cURL
$ch = curl_init();

// Check if the vroidurl query string is present
if (isset($_GET['vroidurl'])) {
    // Sanitize the input to prevent security issues
    $url = filter_var($_GET['vroidurl'], FILTER_SANITIZE_URL);
} else {
    // Default URL if vroidurl is not provided
    $url = "https://hub.vroid.com/en/characters/7345373191746796787/models/3685792491167474217";
}

// Set the URL to fetch
curl_setopt($ch, CURLOPT_URL, $url);

// Set the user agent to Firefox
curl_setopt($ch, CURLOPT_USERAGENT, "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:91.0) Gecko/20100101 Firefox/91.0");

// Set options to return the result as a string and to follow redirects
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);

// Execute the request
$response = curl_exec($ch);

// Check for cURL errors
if (curl_errno($ch)) {
    echo 'cURL error: ' . curl_error($ch);
} else {
    // Load the HTML into a DOMDocument object
    $dom = new DOMDocument();
    @$dom->loadHTML($response);

    // Create an XPath object for querying the DOM
    $xpath = new DOMXPath($dom);

    // Extract the title
    $title = $xpath->query('//title')->item(0)->nodeValue;

    // Extract the Open Graph image (or fallback to Twitter image if needed)
    $ogImage = $xpath->query('//meta[@property="og:image"]/@content')->item(0)->nodeValue;
    $twitterImage = $xpath->query('//meta[@name="twitter:image"]/@content')->item(0)->nodeValue;

    // Use the OG image or Twitter image
    $image = $ogImage ? $ogImage : $twitterImage;

    // Display the link with the title as the link text
    echo "<a href='$url' target='_blank'>$title</a><br>";

    // Display the image below the link, wrapped in an anchor tag
    if ($image) {
        echo "<a href='$url' target='_blank'><img src='$image' alt='$title Image' width=50%></a><br>";
    } else {
        echo "No image available.<br>";
    }
}

// Close the cURL session
curl_close($ch);
?>


__________________


Multi Feed RSS render
----------------------



=====index.html=====


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSS Feeds Manager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .feed-box {
            margin-bottom: 10px;
        }
        input[type="text"] {
            width: 80%;
            padding: 8px;
            margin-right: 10px;
        }
        button {
            padding: 8px;
            margin-right: 10px;
        }
        .feed-container {
            margin-top: 20px;
        }
        .feed-item {
            margin-bottom: 20px;
        }
        .feed-item img {
            max-width: 100%;
            height: auto;
        }
        .feed-item h3 {
            margin: 0;
        }
        .feed-item p {
            margin: 5px 0;
        }
        .feed-item a {
            color: #1a73e8;
            text-decoration: none;
        }
        .feed-item a:hover {
            text-decoration: underline;
        }
        h1.feed-url {
            font-size: 1.5em;
            color: #333;
        }
    </style>
</head>
<body>
    <h1>RSS Feeds Manager</h1>
    <div id="feeds-container"></div>
    <button onclick="addFeedBox()">Add Feed</button>
    <button onclick="saveFeeds()">Save Feeds</button>
    <button onclick="renderFeeds()">Render Feeds</button>

    <div id="feed-results" class="feed-container"></div>

    <script>
        // Utility function to get query parameters
        function getQueryParams() {
            const params = new URLSearchParams(window.location.search);
            const rssFeeds = [];
            let i = 1;

            while (params.has(`rss${i}`)) {
                rssFeeds.push(params.get(`rss${i}`));
                i++;
            }

            return rssFeeds;
        }

        // Load feeds from query strings or local storage when the page loads
        window.onload = function() {
            const queryFeeds = getQueryParams();

            if (queryFeeds.length > 0) {
                // Prefill with feeds from query strings
                queryFeeds.forEach(feed => addFeedBox(feed));
            } else {
                // Load feeds from local storage if no query strings found
                loadFeeds();
            }
        };

        // Add a new feed input box
        function addFeedBox(value = '') {
            const container = document.getElementById('feeds-container');
            const feedBox = document.createElement('div');
            feedBox.className = 'feed-box';
            const input = document.createElement('input');
            input.type = 'text';
            input.value = value;
            container.appendChild(feedBox);
            feedBox.appendChild(input);
        }

        // Save feeds to local storage
        function saveFeeds() {
            const feeds = [];
            const feedBoxes = document.querySelectorAll('.feed-box input[type="text"]');
            feedBoxes.forEach(box => {
                if (box.value.trim() !== '') {
                    feeds.push(box.value.trim());
                }
            });
            localStorage.setItem('rssFeeds', JSON.stringify(feeds));
            alert('Feeds saved!');
        }

        // Load feeds from local storage and populate input boxes
        function loadFeeds() {
            const savedFeeds = JSON.parse(localStorage.getItem('rssFeeds')) || [];
            savedFeeds.forEach(feed => addFeedBox(feed));
        }

        // Render the feeds by fetching them from feed.php
        function renderFeeds() {
            const feeds = JSON.parse(localStorage.getItem('rssFeeds')) || [];
            const feedResults = document.getElementById('feed-results');
            feedResults.innerHTML = '';  // Clear previous results

            feeds.forEach(feedUrl => {
                fetch(`feed.php?url=${encodeURIComponent(feedUrl)}`)
                    .then(response => response.json())
                    .then(data => {
                        // Create and display the feed URL as an <h1>
                        const feedHeader = document.createElement('h1');
                        feedHeader.className = 'feed-url';
                        feedHeader.textContent = `Feed: ${feedUrl}`;
                        feedResults.appendChild(feedHeader);

                        if (data && data.items && data.items.length > 0) {
                            data.items.slice(0, 10).forEach(item => {
                                const feedItem = document.createElement('div');
                                feedItem.className = 'feed-item';

                                const title = document.createElement('h3');
                                const link = document.createElement('a');
                                link.href = item.link;
                                link.target = '_blank';
                                link.textContent = item.title;
                                title.appendChild(link);

                                const date = document.createElement('p');
                                date.textContent = item.pubDate || 'No date available';

                                if (item.image) {
                                    const img = document.createElement('img');
                                    img.src = item.image;
                                    feedItem.appendChild(img);
                                }

                                feedItem.appendChild(title);
                                feedItem.appendChild(date);
                                feedResults.appendChild(feedItem);
                            });
                        } else {
                            const noItems = document.createElement('p');
                            noItems.textContent = `No items found for feed: ${feedUrl}`;
                            feedResults.appendChild(noItems);
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching feed:', error);
                        const errorMessage = document.createElement('p');
                        errorMessage.textContent = `Error fetching feed: ${feedUrl}`;
                        feedResults.appendChild(errorMessage);
                    });
            });
        }
    </script>
</body>
</html>


==feed.php===

<?php
if (isset($_GET['url'])) {
    $feedUrl = $_GET['url'];

    // Initialize a cURL session
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $feedUrl);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); // Disable SSL verification for demo purposes

    // Set a user-agent to mimic a browser request
    curl_setopt($ch, CURLOPT_USERAGENT, 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3');

    // Execute the request
    $response = curl_exec($ch);

    // Check for errors
    if(curl_errno($ch)) {
        echo json_encode(['error' => 'Error fetching the feed: ' . curl_error($ch)]);
        curl_close($ch);
        exit();
    }

    curl_close($ch);

    if ($response) {
        $rss = simplexml_load_string($response);

        if ($rss === false) {
            echo json_encode(['error' => 'Failed to parse the feed']);
            exit();
        }

        $feedData = [];

        // Determine whether this is a YouTube feed (Atom) or a standard RSS feed
        if ($rss->getName() === 'feed' && isset($rss->entry)) {
            // Handle YouTube (Atom) feed
            foreach ($rss->entry as $entry) {
                $namespaces = $entry->getNameSpaces(true);
                $media = $entry->children($namespaces['media']);

                $feedData[] = [
                    'title' => (string) $entry->title,
                    'link' => (string) $entry->link['href'],
                    'pubDate' => (string) $entry->published,
                    'image' => isset($media->group->thumbnail) ? (string) $media->group->thumbnail->attributes()->url : null,
                ];

                if (count($feedData) >= 10) {
                    break;
                }
            }
        } elseif (isset($rss->channel->item)) {
            // Handle standard RSS feed
            foreach ($rss->channel->item as $item) {
                $namespaces = $item->getNameSpaces(true);
                $mediaContent = null;

                // Check for media:content or other image tags
                if (isset($namespaces['media'])) {
                    $media = $item->children($namespaces['media']);
                    if (isset($media->content)) {
                        $mediaContent = (string) $media->content->attributes()->url;
                    }
                }

                // Handle cases where the image might be within an enclosure
                if (!$mediaContent && isset($item->enclosure)) {
                    $mediaContent = (string) $item->enclosure['url'];
                }

                $feedData[] = [
                    'title' => (string) $item->title,
                    'link' => (string) $item->link,
                    'pubDate' => (string) $item->pubDate,
                    'image' => $mediaContent,
                ];

                if (count($feedData) >= 10) {
                    break;
                }
            }
        }

        header('Content-Type: application/json');
        echo json_encode(['items' => $feedData]);
    } else {
        echo json_encode(['error' => 'Unable to fetch feed']);
    }
} else {
    echo json_encode(['error' => 'No URL provided']);
}
?>


_____________________


Request Tracker (v2024)
--------------



====index.html====


<!DOCTYPE html>
<html>
<head>
    <title>ArtRequest</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            //background-color: #f0f0f0;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .form-container {
            background-color: #ffffff;
            padding: 20px;
            //border-radius: 8px;
            //box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 100%;
        }
        .form-container h2 {
            margin-top: 0;
            //color: #333;
        }
        .form-container label {
            display: block;
            margin-bottom: 8px;
            //color: #555;
        }
        .form-container input[type="text"],
        .form-container textarea,
        .form-container input[type="file"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .form-container input[type="submit"] {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin-top: 10px;
            cursor: pointer;
            border-radius: 4px;
        }
        .form-container input[type="submit"]:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>

    <div class="form-container">
<details><summary>REQUESTS</summary><hr>
<object type="text/html" data="parsehtml.php" style="width:800px; height:100%"></object>
</details><br><br>



        <h2>Submit Form</h2>


        <form action="submit.php" method="post" enctype="multipart/form-data">
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" value="-">
            
            <label for="description">Description:</label>
            <textarea id="description" name="description" required></textarea>
            
            <label for="image">Upload Image:</label>
            <input type="file" id="image" name="image" accept="image/*" required>
            
            <input type="submit" value="Submit">
        </form>
    </div>
</body>
</html>



===parsehtml.php====

<!DOCTYPE html>
<html>
<head>
    <title>Requests</title>
    <style>
        table {
            width: 80%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        img {
            width: 50%;
        }
    </style>
</head>
<body>
<?php
$dir = opendir('.');
$htmlFiles = [];
while (($file = readdir($dir)) !== false) {
    // Check if the file is a .html file and does not contain "private"
    if (pathinfo($file, PATHINFO_EXTENSION) === 'html' && strpos($file, 'private') === false) {
        $htmlFiles[] = $file;
    }
}
closedir($dir);
function extractFields($filename) {
    $content = file_get_contents($filename);
    preg_match('/<h1>(.*?)<\/h1>/s', $content, $h1);
    preg_match('/<p>(.*?)<\/p>/s', $content, $p);
    preg_match('/<img src=[\'"](.*?)[\'"] alt=[\'"](.*?)[\'"]>/s', $content, $img);
    return [
        'h1' => $h1[1] ?? 'N/A',
        'p' => isset($p[1]) ? nl2br(htmlspecialchars($p[1])) : 'N/A',
        'img_src' => $img[1] ?? 'N/A',
        'img_alt' => $img[2] ?? 'N/A',
    ];
}
if (!empty($htmlFiles)) {
    echo '<table>';
    echo '<tr><th>Filename</th><th>Title</th><th>Description</th><th>Image Source</th></tr>';
    foreach ($htmlFiles as $file) {
        $fields = extractFields($file);
        echo '<tr>';
        echo '<td>' . htmlspecialchars($file) . '</td>';
        echo '<td>' . htmlspecialchars($fields['h1']) . '</td>';
        echo '<td>' . $fields['p'] . '</td>'; // Already escaped
        echo '<td><a href="' . htmlspecialchars($fields['img_src']) . '" target="_blank"><img src="' . htmlspecialchars($fields['img_src']) . '" alt="' . htmlspecialchars($fields['img_alt']) . '"></a></td>';
        //echo '<td>' . htmlspecialchars($fields['img_alt']) . '</td>';
        echo '</tr>';}
    echo '</table>';
} else {
    echo '<p>No HTML files found.</p>';
}
?>

====submit.php===

<?php
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $title = htmlspecialchars($_POST["title"]);
    $description = htmlspecialchars($_POST["description"]);
    $image = $_FILES["image"];
    
    // Handle image upload
    $uploadDirectory = "uploads/";
    if (!is_dir($uploadDirectory)) {
        mkdir($uploadDirectory, 0777, true);
    }
    
    $targetFile = $uploadDirectory . basename($image["name"]);
    $imageFileType = strtolower(pathinfo($targetFile, PATHINFO_EXTENSION));
    
    // Check if image file is an actual image or fake image
    $check = getimagesize($image["tmp_name"]);
    if ($check !== false) {
        if (move_uploaded_file($image["tmp_name"], $targetFile)) {
            $imagePath = $targetFile;
        } else {
            echo "Sorry, there was an error uploading your file.";
            exit;
        }
    } else {
        echo "File is not an image.";
        exit;
    }

    // Create HTML content
    $htmlContent = "
<!DOCTYPE html>
<html>
<head>
    <title>$title</title>
</head>
<body>
    <h1>$title</h1>
    <p>$description</p>
    <img src='$imagePath' alt='$title'>
</body>
</html>
";

    // Save the content to a file named with the current date and time
    $date = date("Ymd_His");
    $filename = "$date.html";
    $file = fopen($filename, "w");

    if ($file) {
        fwrite($file, $htmlContent);
        fclose($file);
        echo "File created: <a href='$filename'>$filename</a>";
    } else {
        echo "Unable to write to file.";
    }
}
?>

_____________________



Delete Mastodon Posts programatically
---------------------------------------
<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $apiBaseUrl = trim($_POST['instance_url']) . '/api/v1';
    $accessToken = trim($_POST['access_token']);
    $rateLimitDelay = 1; // Delay in seconds to avoid hitting rate limits
    $maxRequestsPerInterval = 300;
    $intervalSeconds = 300;

    function fetchStatuses($apiBaseUrl, $accessToken, $max_id = null) {
        $url = $apiBaseUrl . '/accounts/verify_credentials';
    
        $headers = [
            'Authorization: Bearer ' . $accessToken,
        ];
    
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
        $response = curl_exec($ch);
    
        if (curl_errno($ch)) {
            echo "Error fetching user info: " . curl_error($ch) . "<br>";
            curl_close($ch);
            return null;
        }
    
        curl_close($ch);
    
        $user = json_decode($response);
        if (!isset($user->id)) {
            echo "Failed to fetch user info.<br>";
            return null;
        }
    
        $url = $apiBaseUrl . "/accounts/{$user->id}/statuses?limit=40";
        if ($max_id) {
            $url .= "&max_id={$max_id}";
        }
    
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
        $response = curl_exec($ch);
    
        if (curl_errno($ch)) {
            echo "Error fetching statuses: " . curl_error($ch) . "<br>";
            curl_close($ch);
            return null;
        }
    
        curl_close($ch);
    
        return json_decode($response);
    }

    function deleteStatus($apiBaseUrl, $accessToken, $id) {
        $url = $apiBaseUrl . "/statuses/{$id}";
    
        $headers = [
            'Authorization: Bearer ' . $accessToken,
        ];
    
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "DELETE");
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
        $response = curl_exec($ch);
    
        if (curl_errno($ch)) {
            echo "Error deleting status {$id}: " . curl_error($ch) . "<br>";
            curl_close($ch);
            return null;
        }
    
        $http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);
        $retry_after = curl_getinfo($ch, CURLINFO_RETRY_AFTER);
        
        curl_close($ch);
    
        if ($http_code === 429) {
            $retry_after = $retry_after ?? 60; // Default to 60 seconds if not provided
            echo "Rate limit exceeded. Waiting for {$retry_after} seconds...<br>";
            sleep($retry_after);
        }
    
        return [
            'response' => json_decode($response),
            'http_code' => $http_code,
        ];
    }

    $max_id = null;
    $total_deleted = 0;
    $request_count = 0;
    $start_time = time();

    do {
        $statuses = fetchStatuses($apiBaseUrl, $accessToken, $max_id);
        if ($statuses === null) {
            echo "Failed to fetch statuses. Exiting.<br>";
            break;
        }

        foreach ($statuses as $status) {
            $result = deleteStatus($apiBaseUrl, $accessToken, $status->id);
            if ($result === null) {
                echo "Failed to delete status {$status->id}. Exiting.<br>";
                break 2; // Exit both loops
            }
            echo "Deleted status {$status->id}<br>";
            $max_id = $status->id;
            $total_deleted++;

            // Increment request count and sleep to avoid rate limits
            $request_count++;
            sleep($rateLimitDelay);

            // If the request count reaches the limit, wait for the interval to reset
            if ($request_count >= $maxRequestsPerInterval) {
                $elapsed_time = time() - $start_time;
                $sleep_time = max(0, $intervalSeconds - $elapsed_time);
                echo "Rate limit reached. Sleeping for {$sleep_time} seconds.<br>";
                sleep($sleep_time);
                // Reset counters
                $request_count = 0;
                $start_time = time();
            }
        }
    } while (count($statuses) > 0);

    echo "Total posts deleted: {$total_deleted}<br>";
} else {
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delete Mastodon Posts</title>
</head>
<body>
    <h1>Delete All User Posts on Mastodon</h1>
    <form action="" method="post">
        <label for="instance_url">Instance URL:</label>
        <input type="text" id="instance_url" name="instance_url" placeholder="https://your-mastodon-instance" required><br><br>
        
        <label for="access_token">API Access Token:</label>
        <input type="text" id="access_token" name="access_token" required><br><br>
        
        <input type="submit" value="Delete Posts">
    </form>
</body>
</html>
<?php
}
?>


__________________


Anti Cors Forward (redirect to *.php via ?query= querystring) (!)
-----------------------

<?php
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: GET');
header('Access-Control-Allow-Headers: Content-Type');

// Function to fetch data from a URL
function fetchDataFromUrl($url) {
    // Validate and sanitize the URL
    $url = filter_var($url, FILTER_SANITIZE_URL);

    // Check if the URL is valid
    if (!filter_var($url, FILTER_VALIDATE_URL)) {
        return ['error' => 'Invalid URL'];
    }

    // Use file_get_contents or cURL to fetch the data
    $context = stream_context_create(['http' => ['ignore_errors' => true]]);
    $response = @file_get_contents($url, false, $context);

    if ($response === false) {
        return ['error' => 'Unable to fetch data from URL'];
    }

    return ['data' => $response, 'headers' => $http_response_header];
}

// Check if the request is a GET request
if ($_SERVER['REQUEST_METHOD'] === 'GET') {
    if (isset($_GET['query'])) {
        $url = htmlspecialchars($_GET['query']);
        $result = fetchDataFromUrl($url);

        if (isset($result['error'])) {
            // Return a JSON response with an error
            header('Content-Type: application/json');
            echo json_encode($result);
        } else {
            // Determine the content type from the headers
            $contentType = 'text/plain'; // Default content type

            foreach ($result['headers'] as $header) {
                if (stripos($header, 'Content-Type:') === 0) {
                    $contentType = substr($header, strlen('Content-Type: '));
                    break;
                }
            }

            header('Content-Type: ' . $contentType);
            echo $result['data'];
        }
    } else {
        header('Content-Type: application/json');
        echo json_encode(['error' => 'No query parameter provided']);
    }
} else {
    header('Content-Type: application/json');
    echo json_encode(['error' => 'Invalid request method']);
}


___________________________________-

 Check php server enabled extensions/modules
----------------------------

<a target="_blank" href="download.php" style=color:blue>(‚Üì)</a><br><br>
<table>
    <tr>
        <th colspan="2">PHP Version: <?php echo phpversion(); ?></th>
    </tr>
    <tr>
        <th>Server Extensions</th>
    </tr>
    <?php
    $all_extensions = get_loaded_extensions();
    $all_extensions = array_merge($all_extensions, get_unpacked_extensions());
    sort($all_extensions);
    foreach ($all_extensions as $ext) {
        echo '<tr>';
        if (in_array($ext, get_loaded_extensions())) {
            echo '<td>‚òë ' . $ext . '</td>';
        } else {
            echo '<td>‚òê ' . $ext . '</td>';
        }
        echo '</tr>';
    }
    function get_unpacked_extensions() {
        $extension_dir = ini_get('extension_dir');
        $extensions = array();
        if ($extension_dir) {
            $dir = new DirectoryIterator($extension_dir);
            foreach ($dir as $fileinfo) {
                if ($fileinfo->isFile() && pathinfo($fileinfo->getFilename(), PATHINFO_EXTENSION) === 'so') {
                    $extensions[] = pathinfo($fileinfo->getFilename(), PATHINFO_FILENAME);
                }
            }
        }

        return $extensions;
    }
    ?>
</table>

____________________


htaccess disable access to certian filetypes in folder (here: png):
--------------------------------------


<FilesMatch "\.(png)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>


______________________________________


Last played Game Steam
-------------------------

<?php
// Get the profile ID from the query string
$profile = isset($_GET['profile']) ? $_GET['profile'] : 'alceawisteria'; // Replace 'defaultProfile' with a default value if needed

// Fetch the HTML content
$html = file_get_contents("https://steamcommunity.com/id/$profile");
// Load the HTML into a DOMDocument
libxml_use_internal_errors(true); // Suppress HTML parsing errors
$dom = new DOMDocument();
$dom->loadHTML($html);
libxml_clear_errors(); // Clear HTML parsing errors

// Initialize variables
$gameFound = false;
$achievementSection = null;

// Find all the div elements
$elements = $dom->getElementsByTagName('div');

// Loop through the div elements and find the game and achievement sections
foreach ($elements as $element) {
    $classAttribute = $element->getAttribute('class');

    // Check for the recent game element
    if (!$gameFound && strpos($classAttribute, 'recent_game') !== false) {
        // Get the game info
        $gameInfo = $element->getElementsByTagName('div')->item(0);
        $gameCapsule = $gameInfo->getElementsByTagName('img')->item(0)->getAttribute('src');
        $gameTitle = $gameInfo->getElementsByTagName('a')->item(0)->nodeValue;
        $totalPlaytime = $gameInfo->getElementsByTagName('div')->item(1)->nodeValue;
        $lastPlayed = $gameInfo->getElementsByTagName('div')->item(2)->nodeValue;

        // Get the achievement info
        $achievementInfo = $element->getElementsByTagName('div')->item(1);
        $achievementSummary = $achievementInfo->getElementsByTagName('span')->item(0)->nodeValue;
        $achievementProgress = $achievementInfo->getElementsByTagName('div')->item(0)->getAttribute('style');

        // Extract the relevant information
        $achievementCount = explode(' ', $achievementSummary)[1];
        $achievementTotal = explode('/', $achievementCount)[1];
        $achievementProgress = str_replace('width: ', '', str_replace('%', '', $achievementProgress));

        // Display the game information with the background image
        echo "<div style='width: 300px; margin: 20px; background: url($gameCapsule) no-repeat center center; background-size: cover; padding: 20px; border-radius: 10px; color: #fff; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); position: relative;'>";
        

        $gameFound = true; // Mark the game as found
    }

    // Check for the achievement section
    if (strpos($classAttribute, 'game_info_achievements_only_ctn') !== false) {
        $achievementSection = $element;
    }
}

// If the achievement section is found, extract and display the achievement information
if ($achievementSection) {
    $achievementSummary = $achievementSection->getElementsByTagName('span')->item(0)->textContent;
    $achievementProgressBar = $achievementSection->getElementsByTagName('div')->item(1);
    $achievementProgressStyle = $achievementProgressBar->getAttribute('style');

    // Parse the achievement information
    $achievementCount = trim(explode('/', $achievementSummary)[0]);
    $achievementTotal = trim(explode('/', $achievementSummary)[1]);
    $achievementProgress = str_replace('width: ', '', str_replace('%', '', $achievementProgressStyle));

    // Display the achievement information
echo "<div style='background: rgba(0, 0, 0, 0.6); padding: 10px; border-radius: 10px;'>";
        echo "<h3 style='margin-top: 10px;'>$gameTitle</h3>";
        echo "<p>Total Playtime: $totalPlaytime</p>";
        //echo "<p>Last Played: $lastPlayed</p>";
        echo "<p>Achievements: $achievementCount out of $achievementTotal ($achievementProgress%)</p>";
        echo "</div>";
        echo "</div>";
    //echo "<div style='width: 300px; margin: 20px; background-color: #f0f0f0; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);'>";
    echo "<div class='game_info_achievements_summary_area'>";
    //echo "<span class='game_info_achievement_summary'>Achievements: $achievementCount out of $achievementTotal ($achievementProgress%)</span>";
}

// If no recent game is found, display a message
if (!$gameFound) {
    echo "No recent games found.";
}
?>


____________________


Famitsu Top 30 Chart parser
-------------------------------

<!DOCTYPE html>
<html>
<head>
    <title>Game Sales Data</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f2f2f2;
        }

        img {
            max-width: 100px;
            height: auto;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Game Sales Data</h1>

    <table>
        <thead>
            <tr>
                <th>Position</th>
                <th>Platform</th>
                <th>Title</th>
                <th>This Week</th>
                <th>Cumulative</th>
                <th>Sell-through</th>
                <th>Image</th>
            </tr>
        </thead>
        <tbody>
            <?php
            $url = "https://www.famitsu.com/ranking/game-sales/";
            $headers = array(
                "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/113.0",
                "Referer: https://www.famitsu.com/"
            );

            $context = stream_context_create(array(
                'http' => array(
                    'method' => 'GET',
                    'header' => implode("\r\n", $headers)
                )
            ));

            $html = file_get_contents($url, false, $context);

            if ($html === false) {
                echo "Error: Unable to fetch the website content.";
                return;
            }

            $dom = new DOMDocument();
            @$dom->loadHTML($html);

            $xpath = new DOMXPath($dom);
            $elements = $xpath->query('//div[@class="card card-game-sale-rank card-game-sale-rank--col-12 card-game-sale-rank--col-sm-12 card-game-sale-rank--col-md-12 card-game-sale-rank--col-lg-8"]');

            $gameData = [];
            $labels = [];
            $data = [];
            $platforms = [];

            $position = 1;
            foreach ($elements as $element) {
                $platform_elements = $xpath->query('.//span[contains(@class, "icon-console")]', $element);
                $platform = "";
                foreach ($platform_elements as $platform_element) {
                    $platform_class = $platform_element->getAttribute('class');
                    if (preg_match('/icon-console--bg-(\w+)/', $platform_class, $matches)) {
                        $platform = $matches[1];
                        if (!in_array($platform, $platforms)) {
                            $platforms[] = $platform;
                        }
                        break;
                    }
                }

                $title = $xpath->query('.//div[@class="card-game-sale-rank__title"]', $element)->item(0)->textContent;
                $this_week = $xpath->query('.//p[@class="card-game-sale-rank__sales-num-past card-game-sale-rank__sales-num"]', $element)->item(0)->textContent;
                $cumulative = $xpath->query('.//p[@class="card-game-sale-rank__sales-num-total card-game-sale-rank__sales-num"]', $element)->item(0)->textContent;
                $price = $xpath->query('.//span[@class="card-game-sale-rank__sales-meter-num"]', $element)->item(0)->textContent;
                $image_url = $xpath->query('.//div[@class="media-image media-image--game-platform media-image--' . $platform . ' media-image--square"]', $element)->item(0)->getAttribute('style');
                $image_url = preg_replace('/^background-image: url\("?([^"]+)"?\);\s*$/', '$1', $image_url);

                echo "<tr>";
                echo "<td>" . $position . "</td>";
                echo "<td>" . $platform . "</td>";
                echo "<td>" . $title . "</td>";
                echo "<td>" . $this_week . "</td>";
                echo "<td>" . $cumulative . "</td>";
                echo "<td>" . $price . "</td>";
                echo "<td><img src='" . $image_url . "' alt='" . $title . "'></td>";
                echo "</tr>";

                $gameData[] = [
                    'Position' => $position,
                    'Platform' => $platform,
                    'Title' => $title,
                    'ThisWeek' => (int) str_replace(',', '', $this_week),
                    'Cumulative' => (int) str_replace(',', '', $cumulative),
                    'SellThrough' => $price,
                    'Image' => $image_url
                ];

                $labels[] = $title;
                $data[] = (int) str_replace(',', '', $this_week);

                $position++;
            }

            $platformOptions = "";
            foreach ($platforms as $platform) {
                $platformOptions .= "<option value='" . $platform . "'>" . ucfirst($platform) . "</option>";
            }
            ?>
        </tbody>
    </table>

    <canvas id="gameChart"></canvas>
    <button id="downloadButton">Download Chart Data</button>

    <script>
        var ctx = document.getElementById('gameChart').getContext('2d');
        var gameChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: <?php echo json_encode($labels); ?>,
                datasets: [{
                    label: 'This Week\'s Sales',
                    data: <?php echo json_encode($data); ?>,
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Add a platform filter dropdown
        var platformFilter = document.createElement("div");
        platformFilter.innerHTML = "<label for='platformSelect'>Filter by Platform:</label> <select id='platformSelect'><option value=''>All</option><?php echo $platformOptions; ?></select>";
        document.body.appendChild(platformFilter);

        // Add event listener to the platform filter dropdown
        var platformSelect = document.getElementById("platformSelect");
        platformSelect.addEventListener("change", function() {
            var selectedPlatform = this.value;
            var rows = document.querySelectorAll("table tbody tr");
            rows.forEach(function(row) {
                var platformCell = row.getElementsByTagName("td")[1];
                if (selectedPlatform === "" || platformCell.textContent === selectedPlatform) {
                    row.style.display = "table-row";
                } else {
                    row.style.display = "none";
                }
            });
        });

        // Function to download chart data as JSON
        function downloadChartData() {
            var gameData = <?php echo json_encode($gameData); ?>;
            var json = JSON.stringify(gameData, null, 2);
            var blob = new Blob([json], { type: "application/json" });
            var url = URL.createObjectURL(blob);
            var a = document.createElement("a");
            var date = new Date().toISOString().slice(0, 10); // yyyy-mm-dd format
            a.href = url;
            a.download = date + "-chart.json";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Add event listener to the download button
        document.getElementById("downloadButton").addEventListener("click", downloadChartData);
    </script>
</body>
</html>


_____________________


PersonalInteraction collector
------------------------------

==chart.html==

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chart.js Example</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Chart.js Example</h1>
    <canvas id="myChart" width="800" height="400"></canvas>
    
    <script>
        // Names array
        const names = [
            "Aoi", "Ryoken", "Kusanagi", "Shima", "Homura",
            "Akira", "Emma", "GoOnizuka", "Ai(Ignis)", "Spectre",
            "Faust", "Baira"
        ];

        // Array to hold different colors for each dataset
        const colors = [
            'rgba(75, 192, 192, 0.2)',
            'rgba(255, 99, 132, 0.2)',
            'rgba(255, 159, 64, 0.2)',
            'rgba(153, 102, 255, 0.2)',
            'rgba(255, 205, 86, 0.2)',
            'rgba(54, 162, 235, 0.2)',
            'rgba(255, 99, 132, 0.2)',
            'rgba(75, 192, 192, 0.2)',
            'rgba(153, 102, 255, 0.2)',
            'rgba(255, 159, 64, 0.2)',
            'rgba(255, 205, 86, 0.2)',
            'rgba(54, 162, 235, 0.2)'
        ];

        const borderColors = [
            'rgba(75, 192, 192, 1)',
            'rgba(255, 99, 132, 1)',
            'rgba(255, 159, 64, 1)',
            'rgba(153, 102, 255, 1)',
            'rgba(255, 205, 86, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 99, 132, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(153, 102, 255, 1)',
            'rgba(255, 159, 64, 1)',
            'rgba(255, 205, 86, 1)',
            'rgba(54, 162, 235, 1)'
        ];

        // Fetch JSON data with cache-busting
        async function fetchData() {
            const timestamp = new Date().getTime();  // Get current timestamp for cache-busting
            const data = await Promise.all(names.map(async (name, index) => {
                const url = `${name}_data.json?t=${timestamp}`;  // Append timestamp as a query parameter
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`Failed to fetch ${url}`);
                    const jsonData = await response.json();
                    // Track the first occurrence of each number1 value
                    const seen = new Set();
                    const filteredData = Object.keys(jsonData)
                        .filter(key => !isNaN(key) && !seen.has(jsonData[key].number1))  // Filter out non-numeric keys and duplicates
                        .map(key => {
                            seen.add(jsonData[key].number1);  // Mark this number1 as seen
                            return {
                                x: parseFloat(jsonData[key].number1),  // Convert number1 to a number for sorting
                                y: parseInt(jsonData[key].number2, 10),   // Convert number2 to integer
                                name: jsonData[key].name,
                                info: jsonData[key].info
                            };
                        })
                        .sort((a, b) => a.x - b.x);  // Sort data by number1 values

                    // Return a dataset with the label, filtered data, and associated colors
                    return {
                        label: name,  // Use name for the label
                        data: filteredData,
                        borderColor: borderColors[index],  // Set different border colors for each line
                        backgroundColor: colors[index],    // Set different background colors for each line
                        borderWidth: 2,
                        fill: false,  // Ensure the line is not filled
                        cubicInterpolationMode: 'monotone'  // Smooth line transitions
                    };
                } catch (error) {
                    console.error(error);
                    return null;  // Return null if an error occurs
                }
            }));

            // Filter out null values
            return data.filter(dataset => dataset !== null);
        }

        // Initialize the chart
        async function initChart() {
            const datasets = await fetchData();

            const ctx = document.getElementById('myChart').getContext('2d');
            const myChart = new Chart(ctx, {
                type: 'line',  // Change chart type to line
                data: {
                    datasets: datasets
                },
                options: {
                    scales: {
                        x: {
                            type: 'linear',  // Use linear scale for x-axis for numerical representation
                            position: 'top',   // Position x-axis at the top
                            title: {
                                display: true,
                                text: 'Number 1'
                            },
                            ticks: {
                                stepSize: 1,  // Ensure consistent steps between x values
                                callback: function(value) {
                                    return String(value).padStart(3, '0');  // Format x values to be 3 digits
                                }
                            },
                            reverse: false  // Reverse the x-axis to flip it
                        },
                        y: {
                            type: 'linear',
                            title: {
                                display: true,
                                text: 'Number 2'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    return `File: ${tooltipItems[0].dataset.label}`;  // Add the name of the JSON file
                                },
                                label: function(tooltipItem) {
                                    return `Number 1: ${tooltipItem.raw.x}, Number 2: ${tooltipItem.raw.y}`;  // Add x and y values
                                },
                                footer: function(tooltipItems) {
                                    return `Info: ${tooltipItems[0].raw.info}`;  // Add info from the JSON data
                                }
                            }
                        }
                    }
                }
            });
        }

        // Run the initialization
        initChart();
    </script>
</body>
</html>


===send.php===

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const savedNumber = localStorage.getItem('number1');
            if (savedNumber !== null) {
                document.getElementById('number1').value = savedNumber;
            }
        });
    </script>

<?php
// Check if the form has been submitted
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Get the selected name, the two numbers, and the info field from the form
    $selectedName = $_POST['name'];
    $numberField1 = $_POST['number1'];
    $numberField2 = $_POST['number2'];
    $infoField = $_POST['info'];

    // Construct the data array
    $data = array(
        'name' => $selectedName,
        'number1' => $numberField1,
        'number2' => $numberField2,
        'info' => $infoField
    );

    // Convert the data array to JSON
    $json = json_encode($data);

    // Check if the file exists
    $filename = $selectedName . '_data.json';
    if (file_exists($filename)) {
        // If the file exists, read the existing data
        $existingData = file_get_contents($filename);
        $existingData = json_decode($existingData, true);

        // Prepend the new data to the existing data
        array_unshift($existingData, $data);

        // Convert the updated data back to JSON and write it to the file
        $updatedData = json_encode($existingData);
        file_put_contents($filename, $updatedData);
    } else {
        // If the file doesn't exist, create a new file with the data
        file_put_contents($filename, "[$json]");
    }

    // Store the first number and the info field in the local storage
    echo "<script>
        localStorage.setItem('number1', '$numberField1');
        localStorage.setItem('info', '$infoField');
    </script>";

    // Optionally, you can display a success message or redirect the user to another page
    echo "Data saved to " . $filename;
}

// Check if the first number and info field are stored in the local storage
$storedNumber1 = isset($_POST['number1']) ? $_POST['number1'] : (isset($_COOKIE['number1']) ? $_COOKIE['number1'] : '');
$storedInfo = isset($_POST['info']) ? $_POST['info'] : (isset($_COOKIE['info']) ? $_COOKIE['info'] : '');
?>
<!DOCTYPE html>
<html>
<head>
<script>
        function incrementNumber1() {
            var number1Field = document.getElementById("number1");
            var number1Value = number1Field.value;
            
            // Get the length of the original value to preserve the format
            var originalLength = number1Value.length;
            
            // Increment the numeric value
            var incrementedValue = (parseInt(number1Value, 10) + 1).toString();
            
            // Add leading zeros if necessary to maintain the original length
            while (incrementedValue.length < originalLength) {
                incrementedValue = '0' + incrementedValue;
            }
            
            // Update the field value and localStorage
            number1Field.value = incrementedValue;
            localStorage.setItem('number1', incrementedValue);
        }
</script>

</head>
<body>
    <h1>Name Selection</h1>
    <form method="post" action="<?php echo htmlspecialchars($_SERVER["PHP_SELF"]);?>">
        <label for="name">Select a name:</label>
        <select name="name" id="name">
            <option value="Aoi">Aoi</option>
            <option value="Ryoken">Ryoken</option>
            <option value="Kusanagi">Kusanagi</option>
            <option value="Shima">Shima</option>
            <option value="Homura">Homura>/option>
            <option value="Akira">Akira</option>
            <option value="Emma">Emma</option>
            <option value="GoOnizuka">GoOnizuka</option>
            <option value="Ai(Ignis)">Ai(Ignis)</option>
            <option value="Spectre">Spectre</option>
            <option value="Faust">Faust</option>
            <option value="Baira">Baira</option>
        </select>

        <br><br>

        <label for="number1">Number 1 (any number):</label>
        <input type="number" name="number1" id="number1" value="<?php echo $storedNumber1; ?>" required>
        <button type="button" onclick="incrementNumber1()">+1</button>

        <br><br>

        <label for="number2">Number 2 (-5 to 5):</label>
        <input type="number" name="number2" id="number2" min="-5" max="5" required>

        <br><br>

        <label for="info">Info:</label>
        <input type="text" name="info" id="info" value="<?php echo $storedInfo; ?>" required>

        <br><br>

        <input type="submit" name="submit" value="Submit">
    </form>
</body>
</html>

_______

Fetch newest Nintendo Direct dekudeals url
---------------------------


<?php
$url = "https://www.nintendo.com/nintendo-direct/";
$response = file_get_contents($url);
$pattern = '/https:\/\/www\.nintendo\.com\/us\/nintendo-direct\/[^"]+/';
preg_match($pattern, $response, $matches);
$finalLink = $matches[0];
$final =  "https://www.dekudeals.com/featured/nintendo-direct-" . substr($finalLink, strrpos($finalLink, '/') -10);
$date_pattern = '/[^\/]+\/(\d{2})-(\d{2})-(\d{4})\//';
if (preg_match($date_pattern, $finalLink, $date_parts)) {
    $month = $date_parts[1];
    $day = $date_parts[2];
    $year = $date_parts[3];
    $final = "https://www.dekudeals.com/featured/nintendo-direct-$year-$month-$day";
    echo $final;
} else {
    echo "Date not found in the URL.";
}
?>

_______________


(PHP) Basic notes app with wysiwyg capability
-----------------------------------


 ===load.php===


   <h1>HTML Files in Current Directory</h1>
    <ul>
        <?php
        // Get the current directory
        $dir = '.';

        // Scan the directory for files
        $files = scandir($dir);

        // Loop through the files and list the HTML files
        foreach ($files as $file) {
            if (pathinfo($file, PATHINFO_EXTENSION) == 'html') {
                $file_path = "$dir/$file";
                echo "<li><a href=\"$file\" target=\"_blank\">$file</a> <a href=\"edit.php?edit=$file_path\" target=\"_blank\">-></a></li>";
            }
        }
        ?>
    </ul>
<!--Create--new-file-->
<!DOCTYPE html>
<html>
<head>
    <title>Create File</title>
</head>
<body>
    <h1>Create File</h1>
    <form method="post" action="<?php echo htmlspecialchars($_SERVER["PHP_SELF"]);?>">
        <label for="filename">Filename:</label>
        <input type="text" id="filename" name="filename" required>
        <br>
        <input type="submit" value="Create File">
    </form>

    <?php
    if ($_SERVER["REQUEST_METHOD"] == "POST") {
        $filename = $_POST["filename"];
        if (!empty($filename)) {
            $file = fopen($filename, "w");
            fclose($file);
            echo "File '$filename' created successfully.";
        } else {
            echo "Please enter a filename.";
        }
    }
    ?>

==save.php==

<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Get the HTML content from the POST request
    $htmlContent = $_POST['content'];

    // Check if a file parameter is present in the query string
    if (isset($_GET['file'])) {
        $fileName = $_GET['file'];
    } else {
        $fileName = 'saved_html.html';
    }

    // Save the HTML content to the specified file
    file_put_contents($fileName, $htmlContent);

    // Return a success message
    echo "HTML content saved to " . $fileName;
} else {
    // Return an error message for non-POST requests
    echo "Invalid request method";
}
?>

===edit.php==
<?php
// Check if the "edit" query parameter is present
if (isset($_GET['edit'])) {
    $file_path = $_GET['edit'];
    if (file_exists($file_path)) {
        $html_content = file_get_contents($file_path);
        $original_timestamp = filemtime($file_path);
        echo '<!DOCTYPE html>
        <html>
        <head>
            <title>Edit HTML File</title>
            <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
            <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
        </head>
        <body>
            <h1>Edit HTML File</h1>
            <textarea id="html-editor">' . $html_content . '</textarea>
            <script>
                $(document).ready(function() {
                    $("#html-editor").summernote({
                        height: 500,
                        toolbar: [
                            ["style", ["style"]],
                            ["font", ["bold", "underline", "clear"]],
                            ["color", ["color"]],
                            ["para", ["ul", "ol", "paragraph"]],
                            ["table", ["table"]],
                            ["insert", ["link", "picture", "video"]],
                            ["view", ["fullscreen", "codeview", "help"]]
                        ],
                        callbacks: {
                            onChange: function(contents, $editable) {
                                // Update the textarea with the current contents
                                $("#html-editor").val(contents);
                            }
                        }
                    });
                });
            </script>
        </body>
        </html>';
    } else {
        echo '<p>File not found: ' . $file_path . '</p>';
    }
} else {
    echo '<p>No file selected to edit.</p>';
}
?>
<!---save--->
<button id="save-btn">Save</button>
<script>
  var htmlEditor = document.getElementById("html-editor");
  document.getElementById("save-btn").addEventListener("click", function() {
    var htmlContent = htmlEditor.value;
    localStorage.setItem("html-content", htmlContent);
    sendContentToServer(htmlContent);
  });

  function sendContentToServer(content) {
    // Get the current URL and extract the "edit" querystring
    var url = new URL(window.location.href);
    var editParam = url.searchParams.get("edit");
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "save.php?file=" + encodeURIComponent(editParam), true);
    xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    xhr.send("content=" + encodeURIComponent(content));
    xhr.onreadystatechange = function() {
      if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
        // Display the server response
        alert(xhr.responseText);
      }
    };
  }
</script>




Canvas Guestbook
----------------------

<!DOCTYPE html>
<html>
<head>
  <title>Guestbook Canvas</title>
  <style>
    .editable-text {
      position: absolute;
      padding: 10px;
      border: 1px solid #ccc;
      cursor: text;
      white-space: pre-wrap;
      display: inline-block;
      width: auto;
      height: auto;
      opacity: 0.80;
      color: grey;
      background-color: rgba(255, 255, 255, 0.2);
    }

    .editable-text textarea {
      width: 100%;
      height: auto;
      min-height: 50px;
      border: none;
      background-color: transparent;
      font-size: 16px;
      font-family: inherit;
      resize: none;
      white-space: pre-wrap;
      overflow-wrap: break-word;
    }

    .editable-text .save-button {
      margin-top: 5px;
      text-align: right;
    }
  </style>
</head>
<body>
  <div id="container"></div>

  <script>
    var currentEditableText = null;

    function fetchLatestJsonData() {
      var url = 'text_data.json?t=' + new Date().getTime();
      fetch(url)
        .then(response => response.json())
        .then(data => {
          var container = document.getElementById('container');

          data.forEach(entry => {
            createEditableText(entry.x, entry.y, entry.text, false);
          });
        });
    }

    fetchLatestJsonData();

    document.addEventListener('click', function(event) {
      if (!event.target.classList.contains('save-button')) {
        if (currentEditableText) {
          currentEditableText.querySelector('.save-button').click();
        }
        createEditableText(event.clientX, event.clientY, '', true);
      }
    });

    function createEditableText(x, y, text, isNew) {
      var container = document.getElementById('container');
      var div = document.createElement('div');
      div.classList.add('editable-text');
      div.style.left = x + 'px';
      div.style.top = y + 'px';

      // Calculate the color based on the x and y coordinates
      var color = calculateColor(x, y);
      div.style.backgroundColor = color;

      var textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.width = '100%';
      textarea.style.height = 'auto';
      textarea.style.minHeight = '50px';

      // Add click event listener to make links clickable
      textarea.addEventListener('click', function(event) {
        var linkRegex = /https?:\/\/\S+/g;
        var links = text.match(linkRegex);
        if (links) {
          links.forEach(function(link) {
            if (event.target.value.includes(link)) {
              window.open(link, '_blank');
            }
          });
        }
      });

      if (isNew) {
        if (currentEditableText) {
          currentEditableText.remove();
        }
        var saveButton = document.createElement('button');
        saveButton.classList.add('save-button');
        saveButton.textContent = 'Save';
        saveButton.addEventListener('click', function() {
          var updatedText = textarea.value.trim();
          if (updatedText) {
            saveText(updatedText, x, y);
          }
          div.remove();
          currentEditableText = null;
        });
        div.appendChild(saveButton);
        currentEditableText = div;
      }

      div.appendChild(textarea);
      container.appendChild(div);
      textarea.focus();
      textarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = this.scrollHeight + 'px';
      });
    }

    function calculateColor(x, y) {
      // Calculate the color based on the x and y coordinates
      var r = Math.floor(x / 10);
      var g = Math.floor(y / 10);
      var b = (x + y) % 256;
      return 'rgb(' + r + ', ' + g + ', ' + b + ')';
    }

    function saveText(text, x, y) {
      // Send the text and coordinates to the PHP script using AJAX
      var xhr = new XMLHttpRequest();
      xhr.open('POST', 'save_text.php', true);
      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
      xhr.onreadystatechange = function() {
        if (xhr.readyState === 4 && xhr.status === 200) {
          console.log('Text saved successfully!');
        }
      };
      xhr.send('text=' + encodeURIComponent(text) + '&x=' + x + '&y=' + y);
    }
  </script>
</body>
</html>


====save_text.php===
<?php
$text = $_POST['text'];
$x = $_POST['x'];
$y = $_POST['y'];
$data = array();

// Check if the file has been modified in the last 15 sec
$file_modified_time = filemtime('text_data.json');
$current_time = time();
$five_minutes_ago = $current_time - (5 * 3);

if ($file_modified_time > $five_minutes_ago) {
    echo "The text data file has been modified in the last 5 minutes. Exiting script.";
    exit;
}

if (file_exists('text_data.json')) {
    $data = json_decode(file_get_contents('text_data.json'), true);
}
$data[] = array(
    'text' => $text,
    'x' => $x,
    'y' => $y
);
file_put_contents('text_data.json', json_encode($data, JSON_PRETTY_PRINT));
echo "Text saved successfully!";
?>




___________


RSS parser (+ js yt render) [Fu RSS2JSON!]
---------------------

===php===
<?php
// Get the RSS URL from the query string
$rss_url = isset($_GET['rss_url']) ? $_GET['rss_url'] : '';
if (!empty($rss_url)) {
    $rss_feed = file_get_contents($rss_url);
    $rss = new SimpleXMLElement($rss_feed);
    $rss_array = json_decode(json_encode($rss), true);
    header('Content-Type: application/json');
    echo json_encode($rss_array);
} else {
    echo "No RSS URL provided.";
}
?>


====YT test rss parse=(supports querystring fir chid)==
  <title>YouTube RSS Feed</title>
</head>
<body>
  <h1>YouTube RSS Feed</h1>
  <div id="feed-container"></div>
  <script>
    function fetchYouTubeRSS() {
      const phpScriptUrl = '/PHP/0demo/2024-06-16-ParseFeed/2024-06-16-rssparse/parse_rss2json.php';
      const queryParams = new URLSearchParams(window.location.search);
      const channelId = queryParams.get('channelid') || 'UCmIpOnd5BVx5Si2hp0WNKZw';
      const rssUrl = `https://www.youtube.com/feeds/videos.xml?channel_id=${channelId}`;

      fetch(`${phpScriptUrl}?rss_url=${encodeURIComponent(rssUrl)}`)
        .then(response => response.json())
        .then(data => {
          const entries = data.entry;
          const feedContainer = document.getElementById('feed-container');
          for (let i = 0; i < entries.length; i++) {
            const entry = entries[i];
            const title = entry.title;
            const videoLink = entry['link']['@attributes'].href;
            const entryDiv = document.createElement('div');
            entryDiv.classList.add('feed-entry');
            const videoLinkElement = document.createElement('a');
            videoLinkElement.href = videoLink;
            videoLinkElement.textContent = title;
            videoLinkElement.target = '_blank';
            entryDiv.appendChild(videoLinkElement);
            feedContainer.appendChild(entryDiv);
          }
        })
        .catch(error => {
          console.error('Error fetching YouTube RSS feed:', error);
        });
    }
    fetchYouTubeRSS();
  </script>
  <style>
    .feed-entry {
      margin-bottom: 10px;
    }
  </style>
</body>
</html>


BlueskyTL Render
---------------------------

<a href="https://alcea-wisteria.de/PHP//0demo/00-PHP-Test/current.php?bskyurl=https://bsky.app/profile/did:plc:aa23o5w4w2afknay44oqxqz6/rss" style=color:blue>test</a><br>

<?php
$bskyUrl = isset($_GET['bskyurl']) ? $_GET['bskyurl'] : 'https://bsky.app/profile/did:plc:nc45m3kcywjhyr4tgsbmea64/rss';

// Fetch the RSS feed
$feed = file_get_contents($bskyUrl);
$doc = new DOMDocument();
$doc->loadXML($feed);
$items = $doc->getElementsByTagName('item');
foreach ($items as $item) {
    $link = $item->getElementsByTagName('link')->item(0);
    $linkUrl = $link->textContent;
    $lastSlashPos = strrpos($linkUrl, '/');
    $postId = substr($linkUrl, $lastSlashPos + 1);

    $guid = $item->getElementsByTagName('guid')->item(0);
    if ($guid->getAttribute('isPermaLink') === 'false') {
        $guidValue = $guid->textContent;
        $startPos = strpos($guidValue, 'plc:') + 4;
        $endPos = strpos($guidValue, '/app.bsky');
        $guidPart = substr($guidValue, $startPos, $endPos - $startPos);
        $didPrefix = 'did:plc:';
    }

    echo "<blockquote class=\"bluesky-embed\" data-bluesky-uri=\"at://$didPrefix$guidPart/app.bsky.feed.post/$postId\" data-bluesky-cid=\"\"></blockquote>";
    echo "<script async src=\"https://embed.bsky.app/static/embed.js\" charset=\"utf-8\"></script>";
}

?>
________________


Fetch 5 links and metadata for pixiv account
-----------------------------------------

<?php
function getPixivUserArt($userId, $random) {
    $apiUrl = "https://www.pixiv.net/ajax/user/{$userId}/profile/all?useid={$userId}";
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $apiUrl);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_HEADER, false);
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
    $response = curl_exec($ch);
    curl_close($ch);
    $data = json_decode($response, true);
    if (isset($data['body']['illusts'])) {
        $artworks = $data['body']['illusts'];
        $numLinks = 0; // Variable to keep track of the number of links
        $pixivLinks = [];
        if ($random) {
            // Get a random artwork
            $randomArtId = array_rand($artworks);
            $randomArt = $artworks[$randomArtId];
            $artLink = "https://www.pixiv.net/artworks/{$randomArtId}";
            $pixivLinks[] = $artLink;
            echo "<a target=_blank href=\"{$artLink}\"> </a><br>\n";
            $numLinks++; // Increment the link counter
            if ($numLinks >= 4) {
                return $pixivLinks; // Return the links to be processed
            }
        } else {
            foreach ($artworks as $artId => $art) {
                $artLink = "https://www.pixiv.net/artworks/{$artId}";
                $pixivLinks[] = $artLink;
                echo "<a target=_blank href=\"{$artLink}\"> </a> <a target=_blank href=\"https://alcea-wisteria.de/PHP/0demo/2024-03-14-PixivTools/2023-03-14-pixiv-single-img-fetch/pixv-single-img-fetch.php?pixivurl={$artLink}\" id=dld> </a><div class=\"counts\"></div>\n";
                $numLinks++; // Increment the link counter
                if ($numLinks >= 4) {
                    return $pixivLinks; // Return the links to be processed
                }
            }
        }
    } else {
        echo "No artworks found for the given user.";
    }
    return []; // Return an empty array if no links were found
}

function getPageTitle($html) {
    $titleStart = stripos($html, '<title>');
    $titleEnd = stripos($html, '</title>');
    if ($titleStart !== false && $titleEnd !== false) {
        $titleLength = $titleEnd - $titleStart - 7;
        return substr($html, $titleStart + 7, $titleLength);
    }
    return '';
}

function processPixivLinks($pixivLinks) {
    echo "<br>";
    foreach ($pixivLinks as $index => $link) {
        $html = file_get_contents($link);
        $title = getPageTitle($html);
        $bookmarkStart = strpos($html, '"bookmarkCount":');
        if ($bookmarkStart !== false) {
            $bookmarkEnd = strpos($html, ',', $bookmarkStart);
            if ($bookmarkEnd !== false) {
                $bookmarkCount = substr($html, $bookmarkStart + 16, $bookmarkEnd - $bookmarkStart - 16);
            }
        }
        $likeStart = strpos($html, '"likeCount":');
        if ($likeStart !== false) {
            $likeEnd = strpos($html, ',', $likeStart);
            if ($likeEnd !== false) {
                $likeCount = substr($html, $likeStart + 12, $likeEnd - $likeStart - 12);
            }
        }
        $commentStart = strpos($html, '"commentCount":');
        if ($commentStart !== false) {
            $commentEnd = strpos($html, ',', $commentStart);
            if ($commentEnd !== false) {
                $commentCount = substr($html, $commentStart + 15, $commentEnd - $commentStart - 15);
            }
        }
        $counts = "Bookmark Count: {$bookmarkCount}, Like Count: {$likeCount}, Comment Count: {$commentCount}";
        echo "<div><a target='_blank' href='{$link}'>{$title}</a> <a target='_blank' href='https://alcea-wisteria.de/PHP/0demo/2024-03-14-PixivTools/2023-03-14-pixiv-single-img-fetch/pixv-single-img-fetch.php?pixivurl={$link}' id='dld'>¬ª</a><div class='counts'>{$counts}</div></div>\n";
    }
    echo "<script>document.getElementById('linkCount').innerHTML = 'Number of artworks: " . count($pixivLinks) . "';</script>";
}

$userId = isset($_GET['userId']) ? $_GET['userId'] : '75406576';
$random = isset($_GET['random']);
$pixivLinks = getPixivUserArt($userId, $random);
processPixivLinks($pixivLinks);
?>


PD9waHAKZnVuY3Rpb24gZ2V0UGl4aXZVc2VyQXJ0KCR1c2VySWQsICRyYW5kb20pIHsKJGFwaVVybCA9ICJodHRwczovL3d3dy5waXhpdi5uZXQvYWpheC91c2VyL3skdXNlcklkfS9wcm9maWxlL2FsbD91c2VpZD17JHVzZXJJZH0iOwokY2ggPSBjdXJsX2luaXQoKTsKY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1VSTCwgJGFwaVVybCk7CmN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9SRVRVUk5UUkFOU0ZFUiwgdHJ1ZSk7CmN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9IRUFERVIsIGZhbHNlKTsKY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1NTTF9WRVJJRllQRUVSLCBmYWxzZSk7CiRyZXNwb25zZSA9IGN1cmxfZXhlYygkY2gpOwpjdXJsX2Nsb3NlKCRjaCk7CiRkYXRhID0ganNvbl9kZWNvZGUoJHJlc3BvbnNlLCB0cnVlKTsKaWYgKGlzc2V0KCRkYXRhWydib2R5J11bJ2lsbHVzdHMnXSkpIHsKJGFydHdvcmtzID0gJGRhdGFbJ2JvZHknXVsnaWxsdXN0cyddOwokbnVtTGlua3MgPSAwOyAvLyBWYXJpYWJsZSB0byBrZWVwIHRyYWNrIG9mIHRoZSBudW1iZXIgb2YgbGlua3MKJHBpeGl2TGlua3MgPSBbXTsKaWYgKCRyYW5kb20pIHsKLy8gR2V0IGEgcmFuZG9tIGFydHdvcmsKJHJhbmRvbUFydElkID0gYXJyYXlfcmFuZCgkYXJ0d29ya3MpOwokcmFuZG9tQXJ0ID0gJGFydHdvcmtzWyRyYW5kb21BcnRJZF07CiRhcnRMaW5rID0gImh0dHBzOi8vd3d3LnBpeGl2Lm5ldC9hcnR3b3Jrcy97JHJhbmRvbUFydElkfSI7CiRwaXhpdkxpbmtzW10gPSAkYXJ0TGluazsKZWNobyAiPGEgdGFyZ2V0PV9ibGFuayBocmVmPVwieyRhcnRMaW5rfVwiPnskYXJ0TGlua308L2E+PGJyPlxuIjsKJG51bUxpbmtzKys7IC8vIEluY3JlbWVudCB0aGUgbGluayBjb3VudGVyCmlmICgkbnVtTGlua3MgPj0gNCkgewpyZXR1cm4gJHBpeGl2TGlua3M7IC8vIFJldHVybiB0aGUgbGlua3MgdG8gYmUgcHJvY2Vzc2VkCn0KfSBlbHNlIHsKZm9yZWFjaCAoJGFydHdvcmtzIGFzICRhcnRJZCA9PiAkYXJ0KSB7CiRhcnRMaW5rID0gImh0dHBzOi8vd3d3LnBpeGl2Lm5ldC9hcnR3b3Jrcy97JGFydElkfSI7CiRwaXhpdkxpbmtzW10gPSAkYXJ0TGluazsKZWNobyAiPGEgdGFyZ2V0PV9ibGFuayBocmVmPVwieyRhcnRMaW5rfVwiPnskYXJ0TGlua308L2E+IDxhIHRhcmdldD1fYmxhbmsgaHJlZj1cImh0dHBzOi8vYWxjZWEtd2lzdGVyaWEuZGUvUEhQLzBkZW1vLzIwMjQtMDMtMTQtUGl4aXZUb29scy8yMDIzLTAzLTE0LXBpeGl2LXNpbmdsZS1pbWctZmV0Y2gvcGl4di1zaW5nbGUtaW1nLWZldGNoLnBocD9waXhpdnVybD17JGFydExpbmt9XCIgaWQ9ZGxkPsK7PC9hPjxkaXYgY2xhc3M9XCJjb3VudHNcIj48L2Rpdj5cbiI7CiRudW1MaW5rcysrOyAvLyBJbmNyZW1lbnQgdGhlIGxpbmsgY291bnRlcgppZiAoJG51bUxpbmtzID49IDQpIHsKcmV0dXJuICRwaXhpdkxpbmtzOyAvLyBSZXR1cm4gdGhlIGxpbmtzIHRvIGJlIHByb2Nlc3NlZAp9Cn0KfQp9IGVsc2UgewplY2hvICJObyBhcnR3b3JrcyBmb3VuZCBmb3IgdGhlIGdpdmVuIHVzZXIuIjsKfQpyZXR1cm4gW107IC8vIFJldHVybiBhbiBlbXB0eSBhcnJheSBpZiBubyBsaW5rcyB3ZXJlIGZvdW5kCn0KCmZ1bmN0aW9uIHByb2Nlc3NQaXhpdkxpbmtzKCRwaXhpdkxpbmtzKSB7CmVjaG8gIjxicj4iOwpmb3JlYWNoICgkcGl4aXZMaW5rcyBhcyAkaW5kZXggPT4gJGxpbmspIHsKJGh0bWwgPSBmaWxlX2dldF9jb250ZW50cygkbGluayk7CiRib29rbWFya1N0YXJ0ID0gc3RycG9zKCRodG1sLCAnImJvb2ttYXJrQ291bnQiOicpOwppZiAoJGJvb2ttYXJrU3RhcnQgIT09IGZhbHNlKSB7CiRib29rbWFya0VuZCA9IHN0cnBvcygkaHRtbCwgJywnLCAkYm9va21hcmtTdGFydCk7CmlmICgkYm9va21hcmtFbmQgIT09IGZhbHNlKSB7CiRib29rbWFya0NvdW50ID0gc3Vic3RyKCRodG1sLCAkYm9va21hcmtTdGFydCArIDE2LCAkYm9va21hcmtFbmQgLSAkYm9va21hcmtTdGFydCAtIDE2KTsKfQp9CiRsaWtlU3RhcnQgPSBzdHJwb3MoJGh0bWwsICcibGlrZUNvdW50IjonKTsKaWYgKCRsaWtlU3RhcnQgIT09IGZhbHNlKSB7CiRsaWtlRW5kID0gc3RycG9zKCRodG1sLCAnLCcsICRsaWtlU3RhcnQpOwppZiAoJGxpa2VFbmQgIT09IGZhbHNlKSB7CiRsaWtlQ291bnQgPSBzdWJzdHIoJGh0bWwsICRsaWtlU3RhcnQgKyAxMiwgJGxpa2VFbmQgLSAkbGlrZVN0YXJ0IC0gMTIpOwp9Cn0KJGNvbW1lbnRTdGFydCA9IHN0cnBvcygkaHRtbCwgJyJjb21tZW50Q291bnQiOicpOwppZiAoJGNvbW1lbnRTdGFydCAhPT0gZmFsc2UpIHsKJGNvbW1lbnRFbmQgPSBzdHJwb3MoJGh0bWwsICcsJywgJGNvbW1lbnRTdGFydCk7CmlmICgkY29tbWVudEVuZCAhPT0gZmFsc2UpIHsKJGNvbW1lbnRDb3VudCA9IHN1YnN0cigkaHRtbCwgJGNvbW1lbnRTdGFydCArIDE1LCAkY29tbWVudEVuZCAtICRjb21tZW50U3RhcnQgLSAxNSk7Cn0KfQokY291bnRzID0gIkJvb2ttYXJrIENvdW50OiB7JGJvb2ttYXJrQ291bnR9LCBMaWtlIENvdW50OiB7JGxpa2VDb3VudH0sIENvbW1lbnQgQ291bnQ6IHskY29tbWVudENvdW50fSI7CmVjaG8gIjxkaXY+PGEgdGFyZ2V0PSdfYmxhbmsnIGhyZWY9J3skbGlua30nPnskbGlua308L2E+IDxhIHRhcmdldD0nX2JsYW5rJyBocmVmPSdodHRwczovL2FsY2VhLXdpc3RlcmlhLmRlL1BIUC8wZGVtby8yMDI0LTAzLTE0LVBpeGl2VG9vbHMvMjAyMy0wMy0xNC1waXhpdi1zaW5nbGUtaW1nLWZldGNoL3BpeHYtc2luZ2xlLWltZy1mZXRjaC5waHA/cGl4aXZ1cmw9eyRsaW5rfScgaWQ9J2RsZCc+wrs8L2E+PGRpdiBjbGFzcz0nY291bnRzJz57JGNvdW50c308L2Rpdj48L2Rpdj5cbiI7Cn0KZWNobyAiPHNjcmlwdD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGlua0NvdW50JykuaW5uZXJIVE1MID0gJ051bWJlciBvZiBhcnR3b3JrczogIiAuIGNvdW50KCRwaXhpdkxpbmtzKSAuICInOzwvc2NyaXB0PiI7Cn0KJHVzZXJJZCA9IGlzc2V0KCRfR0VUWyd1c2VySWQnXSkgPyAkX0dFVFsndXNlcklkJ10gOiAnNzU0MDY1NzYnOwokcmFuZG9tID0gaXNzZXQoJF9HRVRbJ3JhbmRvbSddKTsKJHBpeGl2TGlua3MgPSBnZXRQaXhpdlVzZXJBcnQoJHVzZXJJZCwgJHJhbmRvbSk7CnByb2Nlc3NQaXhpdkxpbmtzKCRwaXhpdkxpbmtzKTsKPz4KCg==



________________


Apex Legends Pickrate:
--------------------


<?php
$url = '';
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
  if (isset($_POST['url'])) {
    $selectedURL = $_POST['url'];
    // Assign the selected URL to the $url variable
    $url = $selectedURL;
  }
}
?>
  <script>
    function changeURL() {
      var radioButtons = document.getElementsByName('url');
      var selectedURL;
      for (var i = 0; i < radioButtons.length; i++) {
        if (radioButtons[i].checked) {
          selectedURL = radioButtons[i].value;
          break;
        }
      }
      document.getElementById('selectedURL').value = selectedURL;
      document.getElementById('myForm').submit();
    }
  </script>
</head>
<body>
  <form id="myForm" action="" method="post">
    <input type="radio" name="url" value="https://apexlegendsstatus.com/game-stats/legends-pick-rates"checked> all
    <input type="radio" name="url" value="https://apexlegendsstatus.com/game-stats/legends-pick-rates/Gold"> Gold 
    <input type="radio" name="url" value="https://apexlegendsstatus.com/game-stats/legends-pick-rates/Diamond"> Diamond
    <br>
    <input type="hidden" id="selectedURL" name="url" value="">
    <input type="button" value="Legends Pickrates" onclick="changeURL()">
  </form>
  <?php
  if (!empty($url)) {
        echo "Pickrate: $url";
    $dom = new DOMDocument();
    $dom->loadHTMLFile($url);
    $xpath = new DOMXPath($dom);
    $elements = $xpath->query('//div[contains(@class, "legends-banner__content")]');
    if ($elements->length > 0) {
      foreach ($elements as $element) {
        $content = $dom->saveHTML($element);
        echo $content;
      }
    } else {
      echo "Elements not found.";
    }
  }
  ?>
<!---Autoload--Pickrate--->
  <script>
    window.onload = function() {
      var submittedValue = localStorage.getItem("submitted");
      var submittedTimestamp = localStorage.getItem("submittedTimestamp");

      var currentTime = new Date().getTime();
      var twentyFiveSeconds = 9000;

      // Check if the action has already occurred and if the time has elapsed
      if (!submittedValue || (submittedValue === "no" && (currentTime - submittedTimestamp) > twentyFiveSeconds)) {
        var button = document.querySelector('input[value="Legends Pickrates"]');
        button.click();

        // Write "no" and current timestamp to local storage
        localStorage.setItem("submitted", "no");
        localStorage.setItem("submittedTimestamp", currentTime);
      }
    };
  </script>
</head>
<body>


_____________________


Bluesky User RSS Feed Extractor
--------------------------------------------------

<?php
if (isset($_POST['submit'])) {
    $url = $_POST['textbox_url'];
    $html = file_get_contents($url);
    $dom = new DOMDocument();
    libxml_use_internal_errors(true);
    $dom->loadHTML($html);
    libxml_use_internal_errors(false); // Enable error reporting
    $xpath = new DOMXPath($dom);
    $query = '//link[@rel="alternate" and @type="application/rss+xml"]';
    $links = $xpath->query($query);

    foreach ($links as $link) {
        $href = $link->getAttribute('href');
        echo "RSS Link: $href";
    }
}
?>

<!-- HTML form with a textbox -->
<form method="post" action="">
    <input type="text" name="textbox_url" placeholder="Enter URL">
    <input type="submit" name="submit" value="Extract RSS">
</form>


_________________________


Manually generate dekudeals json
-----------------------------------

===info.html===

    <script>
        function createJSON() {
            var name = document.getElementById("name").value;
            var link = document.getElementById("link").value;
            var addedAt = document.getElementById("addedAt").value;
            var format = document.getElementById("format").value;
            var pricePaid = document.getElementById("pricePaid").value;
            var pricePaidCurrency = document.getElementById("pricePaidCurrency").value;
            var gameSize = document.getElementById("gameSize").value;
            var image = document.getElementById("image").value;

            var jsonObject = {
                "name": name,
                "link": link,
                "added_at": addedAt,
                "format": format,
                "price_paid": parseInt(pricePaid),
                "price_paid_currency": pricePaidCurrency,
                "gamesize": gameSize,
                "image": image
            };
            var prettifiedJSON = JSON.stringify(jsonObject, null, 4);
            //document.getElementById("output").innerHTML = "<pre>" + prettifiedJSON + "</pre>";
            document.getElementById("output").innerHTML = "<pre>" + prettifiedJSON + "," + "</pre>" ;
        }
        window.onload = function() {
    var now = new Date().toISOString().slice(0, 19) + "+00:00";
    document.getElementById("addedAt").value = now;
        }
    </script>
    <form onsubmit="event.preventDefault(); createJSON();">
        <label for="name">name:</label>
        <input type="text" id="name" required><br>
        <label for="link">link:</label>
        <input type="text" id="link" required><br>
        <label for="addedAt">addedAt:</label>
        <input type="text" id="addedAt" required><br>
        <label for="format">format:</label>
        <select id="format" required>
            <option value="digital">digital</option>
            <option value="physical">physical</option>
        </select><br>
        <label for="pricePaid">pricePaid:</label>
        <input type="number" id="pricePaid" required><br>
        <label for="pricePaidCurrency">pricePaidCurrency:</label>
        <input type="text" id="pricePaidCurrency" value="EUR" required><br>
        <label for="gameSize">gameSize:</label>
        <input type="text" id="gameSize" required><br>
        <label for="image">image:</label>
        <input type="text" id="image" required><br>
        <input type="submit" value="Submit">
    </form>
    <div id="output"></div>

<!--Autofetch--values--from--php-->
  <script>
    window.addEventListener('DOMContentLoaded', (event) => {
      // Parse the query strings from the URL
      const queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);

      // Get the values from the query strings
      const name = urlParams.get('name');
      const link = urlParams.get('link');
      const addedAt = urlParams.get('addedAt');
      const format = urlParams.get('format');
      const pricePaid = urlParams.get('pricePaid');
      const pricePaidCurrency = urlParams.get('pricePaidCurrency');
      const gameSize = urlParams.get('gameSize');
      const image = urlParams.get('image');
      const url = urlParams.get('url');

      // Populate the input fields with the values
      document.getElementById('name').value = name;
      document.getElementById('link').value = url;
      document.getElementById('addedAt').value = addedAt;
      document.getElementById('format').value = format;
      document.getElementById('pricePaid').value = pricePaid;
      document.getElementById('pricePaidCurrency').value = pricePaidCurrency;
      document.getElementById('gameSize').value = gameSize;
      document.getElementById('image').value = image;

      document.getElementById("pricePaidCurrency").value = "EUR";
      document.getElementById("format").value = "digital";
    });
  </script>


<!---Fetch-DD--Link-->
<br><br>
  <form id="mydekuForm">
    <input type="text" id="urlInput" placeholder="Enter URL">
    <input type="submit" value="Submit">
  </form>
  <script>
    document.getElementById("mydekuForm").addEventListener("submit", function(event) {
      event.preventDefault();
      var url = document.getElementById("urlInput").value;
      var redirectUrl = "fetchinfo.php?url=" + encodeURIComponent(url);
      window.location.href = redirectUrl;
    });
  </script>


=========fetchinfo.php===

<?php
// Check if the "url" query string parameter exists
if (isset($_GET['url'])) {
    // Get the URL value from the query string
    $url = $_GET['url'];
} else {
    // Default URL if the "url" parameter is not provided
    $url = "https://www.dekudeals.com/items/figment";
}

// Fetch the HTML content
$html = file_get_contents($url);

// Find the name using regular expressions
$namePattern = "/<span class='display-5'>(.*?)<\/span>/";
preg_match($namePattern, $html, $nameMatches);

// Find the MSRP value using regular expressions
$msrpPattern = '/<strong>MSRP:<\/strong>\s*([^<]+)/';
preg_match($msrpPattern, $html, $msrpMatches);

// Find the Download size value using regular expressions
$downloadSizePattern = '/<strong>Download size:<\/strong>\s*([^<]+)/';
preg_match($downloadSizePattern, $html, $downloadSizeMatches);

// Find the og:image content using regular expressions
$imagePattern = '/<meta content=\'(.*?)\' name=\'og:image\' property=\'og:image\'>/';
preg_match($imagePattern, $html, $imageMatches);

// Extract the name, MSRP value, Download size, and og:image content from the matches
$name = !empty($nameMatches[1]) ? $nameMatches[1] : "Name not found";
$msrpValue = !empty($msrpMatches[1]) ? trim($msrpMatches[1]) : "MSRP value not found";
$downloadSize = !empty($downloadSizeMatches[1]) ? trim($downloadSizeMatches[1]) : "Download size not found";
$imageUrl = !empty($imageMatches[1]) ? $imageMatches[1] : "og:image content not found";

// Display the name, MSRP value, Download size, and og:image content
echo "Name: " . $name . "<br>";
echo "MSRP: " . $msrpValue . "<br>";
echo "Download size: " . $downloadSize . "<br>";
echo $imageUrl;

// Generate the query string
$queryString = http_build_query([
    'name' => $name,
    'pricePaid' => $msrpValue,
    'gameSize' => $downloadSize,
    'url' => $url,
    'image' => $imageUrl
]);

// Generate the URL with the query string
$targetUrl = "info.html?" . $queryString;
?>

<!-- Add the button -->
<button onclick="sendToHtml()">Send to HTML</button>

<!-- JavaScript function to send the variables as query strings -->
<script>
    function sendToHtml() {
        // Redirect to the target URL
        window.location.href = "<?php echo $targetUrl; ?>";
    }
</script>




Find Yugioh Card / Card Search
----------------------

<body>
    <form method="POST" action="">
        <input type="text" name="searchTerm" placeholder="Enter search term">
        <input type="submit" value="Search">
    </form>

<?php
if ($_SERVER["REQUEST_METHOD"] === "POST") {
    // Retrieve the search term from the form
    $searchTerm = $_POST["searchTerm"];

    // URL-encode the search term
    $encodedSearchTerm = urlencode($searchTerm);

    // API endpoint URL
    $url = "https://yugioh.fandom.com/wiki/Special:Search?query={$encodedSearchTerm}";

    // Initialize cURL
    $ch = curl_init();

    // Set cURL options
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
    curl_setopt($ch, CURLOPT_USERAGENT, "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:100.0) Gecko/20100101 Firefox/100.0");

    // Execute the cURL request
    $response = curl_exec($ch);

    // Close cURL
    curl_close($ch);

    // Check if the search result exists
$existsNode = strpos($response, '<p class="mw-search-exists">');
if ($existsNode !== false) {
    // Search result exists, display it
    $linkNode = strpos($response, '<a', $existsNode);
    if ($linkNode !== false) {
        $linkEnd = strpos($response, '>', $linkNode);
        $linkStart = $linkEnd + 1;
        $linkEndTag = strpos($response, '</a>', $linkStart);
        $link = substr($response, $linkStart, $linkEndTag - $linkStart);
        
        // Prepend the URL
       $prefixedLink = 'https://yugioh.fandom.com/wiki/' . $link;
       $prefixedLink = preg_replace('/ /', '_', $prefixedLink);

        echo '<a href="' . $prefixedLink . '" target="_blank">' . $prefixedLink . '</a>';
        echo '<a href="https://alcea-wisteria.de/PHP/0demo/2023-10-08-Fetch-yugioh-wikia-set-list/fetch_single_card.php?card=' . $prefixedLink . '" target="_blank">‚â•</a>';
        } else {
            echo "Search result link not found.";
        }
    } else {
        // Search result does not exist, search for links within the response
        $pattern = '/<a\s[^>]*href=(\"??)([^\" >]*?)\\1[^>]*>(.*)<\/a>/siU';
        if (preg_match_all($pattern, $response, $matches)) {
            // Extract and display the links
            foreach ($matches[2] as $link) {
                // Filter links by the first three letters of the search term
                if (strpos($link, substr($searchTerm, 0, 3)) !== false) {
                    echo '<a href="' . $link . '" target="_blank">' . $link . '</a>';
                    echo '<a href="https://alcea-wisteria.de/PHP//0demo/2023-10-08-Fetch-yugioh-wikia-set-list/fetch_single_card.php?card=' . $link . '" target="_blank">‚â•</a>';
                    echo '<br>';
                }
            }
        } else {
            echo "No links found.";
        }
    }
}
?>

________________


Ygo ydk deck 2 img dldr
-------------------------------------

====fetchdeck.html===

<!DOCTYPE html>
<html>
<head>
    <title>Deck Folder Creation</title>
</head>
<body>
    <h1>Deck Folder Creation</h1>
    <input type="text" id="urlInput" placeholder="Enter URL">
    <input type="file" id="fileInput" accept=".ydk">
    <input type="text" id="decknameInput" placeholder="Enter Deck Name">
    <button onclick="fetchImageLinks()">Generate Image Links</button>
    <div id="output"></div>

    <script>
        function fetchImageLinks() {
            var url = document.getElementById('urlInput').value;
            var fileInput = document.getElementById('fileInput');
            var file = fileInput.files[0];
            var deckname = document.getElementById('decknameInput').value;

            if (url && file) {
                alert('Please provide either a URL or upload a file, not both.');
                return;
            }

            var formData = new FormData();

            if (url) {
                formData.append('url', url);
            } else if (file) {
                formData.append('file', file);
            }

            formData.append('deckname', deckname);

            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    var response = xhr.responseText;
                    document.getElementById('output').innerHTML = response;
                }
            };
            xhr.open('POST', 'queryydk.php', true);
            xhr.send(formData);
        }
    </script>
</body>
</html>

==== queryydk.php ====

<?php
error_reporting(0);
?>

<style>
    .grid-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-start;
    }

    .grid-item {
        flex: 0 0 20%;
        margin: 0;
        padding: 0;
    }

    .grid-item img {
        display: block;
        margin: 0;
        padding: 0;
    }
</style>

<?php
$url = $_POST['url'] ?? '';
$deckname = $_POST['deckname'] ?? '';
$output = "";
// Create the deck/$deckname directory if $deckname is not empty
if (!empty($deckname)) {
    $directoryPath = "deck/$deckname";
    if (!is_dir($directoryPath)) {
        mkdir($directoryPath, 0777, true);
    }
}

if (!empty($url)) {
    $content = file_get_contents($url);
    if ($content !== false) {
        $lines = explode("\n", $content);

        foreach ($lines as $line) {
            if (is_numeric($line)) {
                $number = preg_replace('/[^0-9]/', '', $line);
                if (!empty($deckname)) {
                    $imageLink = "https://images.ygoprodeck.com/images/cards_small/$number.jpg";
                    $imageData = file_get_contents($imageLink);
                    $base64Data = base64_encode($imageData);
                    $imageType = mime_content_type($imageLink);
                    $encodedImage = 'data:' . $imageType . ';base64,' . $base64Data;
                    $output .= "<div class='grid-item'><img src='" . $encodedImage . " ' width=268 height=390></div>";
                    // Copy the image to the deck/$deckname folder
                    $imageName = "$number.jpg";
                    $destinationPath = "deck/$deckname/$imageName";
                    file_put_contents($destinationPath, $imageData);
                } else {
                    $output .= "<a href='https://images.ygoprodeck.com/images/cards_small/$number.jpg'>$number</a><br>";
                }
            } elseif (strpos($line, '!side') !== false) {
                $output .= "<br>SIDEDECK<br>";
            } elseif (strpos($line, '#extra') !== false) {
                $output .= "<br>EXTRADECK<br>";
            }
        }

        if (!empty($deckname)) {
            $output = "<div class='grid-container'>$output</div>";
        }
    } else {
        $output = "Failed to retrieve content from the provided URL.";
    }
} elseif (!empty($_FILES['file']['tmp_name'])) {
    $file = $_FILES['file']['tmp_name'];
    $content = file_get_contents($file);
    $lines = explode("\n", $content);

    foreach ($lines as $line) {
        if (is_numeric($line)) {
            $number = preg_replace('/[^0-9]/', '', $line);
            if (!empty($deckname)) {
                $imageLink = "https://images.ygoprodeck.com/images/cards_small/$number.jpg";
                $imageData = file_get_contents($imageLink);
                $base64Data = base64_encode($imageData);
                $imageType = mime_content_type($imageLink);
                $encodedImage = 'data:' . $imageType . ';base64,' . $base64Data;
                $output .= "<div class='grid-item'><img src='" . $encodedImage . "' width=268 height=390></div>";

                // Copy the image to the deck/$deckname folder
                $imageName = "$number.jpg";
                $destinationPath = "deck/$deckname/$imageName";
                file_put_contents($destinationPath, $imageData);
            } else {
                $output .= "<a href='https://images.ygoprodeck.com/images/cards_small/$number.jpg'>$number</a>";
            }
        } elseif (strpos($line, '!side') !== false) {
            $output .= "";
        } elseif (strpos($line, '#extra') !== false) {
            $output .= "";
        }
    }

    if (!empty($deckname)) {
        $output = "<div class='grid-container'>$output</div>";
    }
}

echo $output;
?>


__________________________________


Fetch 10 pixiv images (from html linklist)
------------------------------------------

<?php
$filePath = 'https://alceawis.de/pixiv-artworks-archive.html';
$html = file_get_contents($filePath);
if ($html === false) {
    echo 'Failed to read the file "'.$filePath.'".';
    exit;}
$dom = new DOMDocument();
libxml_use_internal_errors(true); // Suppress HTML parsing errors
$loaded = $dom->loadHTML($html);
if (!$loaded) {
    echo 'Failed to parse the HTML content.';
    exit;}
$xpath = new DOMXPath($dom);
$artworkLinks = $xpath->query('//a[@target="_blank"]');
$filteredArtworkLinks = [];
foreach ($artworkLinks as $link) {
    $linkUrl = $link->getAttribute('href');
    if (!strpos($link->textContent, '¬ª') && strpos($linkUrl, 'pixivurl') === false) {
        $filteredArtworkLinks[] = $linkUrl;}}
if (empty($filteredArtworkLinks)) {
    echo 'No valid artwork links found.';
    exit;}
$thumbnailUrls = [];
$options = [
'http' => [
'header' => "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:70.0) Gecko/20100101 Firefox/70.0\r\n" .
"Referer: https://accounts.pixiv.net\r\n",
],];
$context = stream_context_create($options);
for ($i = 0; $i < 10; $i++) {
    $randomIndex = array_rand($filteredArtworkLinks);
    $randomLink = $filteredArtworkLinks[$randomIndex];
    $url = $randomLink;
    $html = file_get_contents($url, false, $context);
    if ($html === false) {
        echo 'Failed to fetch the HTML content for the artwork: '.$url.'<br>';
        continue;}
    $pattern = '/"thumb":"(.*?)"/';
    preg_match($pattern, $html, $matches);
    if (!isset($matches[1])) {
        echo 'Failed to extract the thumbnail URL for the artwork: '.$url.'<br>';
        continue;}
    $thumbnailUrl = json_decode('"'.$matches[1].'"'); // Decode the URL-encoded JSON string
    $imageData = file_get_contents($thumbnailUrl, false, $context);
    if ($imageData !== false) {
        $base64 = base64_encode($imageData);
        $imageSrc = 'data:image/jpeg;base64,' . $base64;
        echo '<a href="' . $randomLink . '" target="_blank"><img src="' . $imageSrc . '" alt="Image" width=100px></a> ';
    } else {
        echo 'Failed to retrieve the image: '.$thumbnailUrl.'<br>';
}}
?>
  
  ___________________________

Nicovideo Metadata Extractor:
-----------------------------

<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $url = $_POST['video_url'];
    $options = [
        'http' => [
            'method' => 'GET',
            'header' => "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3\r\n"
        ]
    ];
    $context = stream_context_create($options);
    $html = file_get_contents($url, false, $context);
    $pattern = '/<div id="js-initial-watch-data" data-api-data="(.*?)"/s';
    preg_match($pattern, $html, $matches);
    $jsonData = htmlspecialchars_decode($matches[1]);
    $data = json_decode($jsonData, true);
    $videoDescription = $data['video']['description'];
    echo "Video Description: $videoDescription\n";
} else {
    $autofillUrl = isset($_GET['nicourl']) ? $_GET['nicourl'] : '';
    ?>
    <form id="video_form" method="POST" action="">
        <label for="video_url">Enter Video URL:</label>
        <input type="text" id="video_url" name="video_url" value="<?php echo $autofillUrl; ?>" required>
        <button type="submit">Get Information</button>
    </form>
<!---AutofillAndSubmitViaQuerystring-->
<script>
    var nicourl = "<?php echo $autofillUrl; ?>";
    var nicourl = nicourl.replace(/sp\./gi, ""); //fix sp nicourl
    if (nicourl !== '') {
        document.getElementById('video_url').value = nicourl;
        document.getElementById('video_form').submit();
    }
</script>
<?php } ?>


<!--<button id="replacespButton">Replace .sp</button>
<script>
function replacespText() {
  var textField = document.getElementById("video_url");
 var newText = textField.value.replace(/sp./gi, "");textField.value = newText;}
document.getElementById("replacespButton").addEventListener("click", replacespText);
</script>-->


<!--
PD9waHAKaWYgKCRfU0VSVkVSWydSRVFVRVNUX01FVEhPRCddID09PSAnUE9TVCcpIHsKICAgICR1cmwgPSAkX1BPU1RbJ3ZpZGVvX3VybCddOwogICAgJG9wdGlvbnMgPSBbCiAgICAgICAgJ2h0dHAnID0+IFsKICAgICAgICAgICAgJ21ldGhvZCcgPT4gJ0dFVCcsCiAgICAgICAgICAgICdoZWFkZXInID0+ICJVc2VyLUFnZW50OiBNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvNTguMC4zMDI5LjExMCBTYWZhcmkvNTM3LjNcclxuIgogICAgICAgIF0KICAgIF07CgogICAgJGNvbnRleHQgPSBzdHJlYW1fY29udGV4dF9jcmVhdGUoJG9wdGlvbnMpOwogICAgJGh0bWwgPSBmaWxlX2dldF9jb250ZW50cygkdXJsLCBmYWxzZSwgJGNvbnRleHQpOwoKICAgICRwYXR0ZXJuID0gJy88c2NyaXB0IHR5cGU9ImFwcGxpY2F0aW9uXC9sZFwranNvbiIgY2xhc3M9IkxkSnNvbiI+KC4qPyk8XC9zY3JpcHQ+L3MnOwogICAgcHJlZ19tYXRjaF9hbGwoJHBhdHRlcm4sICRodG1sLCAkbWF0Y2hlcyk7CgogICAgJGpzb25EYXRhID0gJG1hdGNoZXNbMV1bMF07CiAgICAkZGF0YSA9IGpzb25fZGVjb2RlKCRqc29uRGF0YSwgdHJ1ZSk7CgogICAgJHZpZGVvVGl0bGUgPSAkZGF0YVsnbmFtZSddOwogICAgJHZpZGVvRGVzY3JpcHRpb24gPSAkZGF0YVsnZGVzY3JpcHRpb24nXTsKICAgICR2aWRlb1VybCA9ICRkYXRhWyd1cmwnXTsKICAgICR0aHVtYm5haWxVcmxzID0gJGRhdGFbJ3RodW1ibmFpbFVybCddOwoKICAgIGVjaG8gIlZpZGVvIFRpdGxlOiAkdmlkZW9UaXRsZVxuPGJyPiI7CiAgICBlY2hvICJWaWRlbyBEZXNjcmlwdGlvbjogJHZpZGVvRGVzY3JpcHRpb25cbjxicj4iOwogICAgZWNobyAiVmlkZW8gVVJMOiAkdmlkZW9Vcmxcbjxicj4iOwp9IGVsc2UgewogICAgJGF1dG9maWxsVXJsID0gJyc7CgogICAgaWYgKGlzc2V0KCRfR0VUWyduaWNvdmlkZW8nXSkpIHsKICAgICAgICAkYXV0b2ZpbGxVcmwgPSAkX0dFVFsnbmljb3ZpZGVvJ107CiAgICB9CiAgICA/PgoKICAgICAgICA8Zm9ybSBtZXRob2Q9IlBPU1QiIGFjdGlvbj0iIj4KICAgICAgICAgICAgPGxhYmVsIGZvcj0idmlkZW9fdXJsIj5FbnRlciBWaWRlbyBVUkw6PC9sYWJlbD4KICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGlkPSJ2aWRlb191cmwiIG5hbWU9InZpZGVvX3VybCIgdmFsdWU9Ijw/cGhwIGVjaG8gJGF1dG9maWxsVXJsOyA/PiI+CiAgICAgICAgICAgIDxidXR0b24gdHlwZT0ic3VibWl0Ij5HZXQgSW5mb3JtYXRpb248L2J1dHRvbj4KICAgICAgICA8L2Zvcm0+CgogICAgICAgIDw/cGhwCiAgICAgICAgaWYgKCFlbXB0eSgkYXV0b2ZpbGxVcmwpKSB7CiAgICAgICAgICAgIGVjaG8gJzxzY3JpcHQ+ZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiZm9ybSIpLnN1Ym1pdCgpOzwvc2NyaXB0Pic7CiAgICAgICAgfQogICAgICAgID8+CiAgICA8L2JvZHk+CiAgICA8L2h0bWw+Cjw/cGhwIH0gPz4=
-->

_____________________________

MMD / Model url list writer
---------------------------

<meta charset="UTF-8">
<?php ini_set('default_charset', 'UTF-8'); ?>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }

        table, th, td {
            border: 1px solid black;
            padding: 5px;
        }
    </style>
    <script>
        function loadEntries() {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var entries = JSON.parse(this.responseText);
                    var table = document.getElementById("entriesTable");
                    table.innerHTML = ""; // Clear existing table content

                    if (entries.length > 0) {
                        var headerRow = table.insertRow();
                        headerRow.innerHTML = "<th>Name</th><th>URL</th><th>Date</th><th>Format</th><th>Password</th><th>Description</th>";

                        for (var i = 0; i < entries.length; i++) {
                            var entry = entries[i];
                            var row = table.insertRow();
                            row.innerHTML = "<td>" + entry.name + "</td><td>" + entry.url + "</td><td>" + entry.date + "</td><td>" + entry.format + "</td><td>" + entry.password + "</td><td>" + entry.description + "</td>";
                        }
                    } else {
                        var noEntriesRow = table.insertRow();
                        noEntriesRow.innerHTML = "<td colspan='6'>No entries found.</td>";
                    }
                }
            };
            xmlhttp.open("GET", "modeldata.json", true);
            xmlhttp.send();
        }
    </script>
</head>
<body>
    <h2>PHP List Writer</h2>

    <?php
    // Check if the form is submitted
    if ($_SERVER['REQUEST_METHOD'] === 'POST') {
        // Retrieve form data
        $name = $_POST['name'];
        $url = $_POST['url'];
        $date = $_POST['date'];
        $format = $_POST['format'];
        $password = $_POST['password'];
        $description = $_POST['description'];

        // Create an array with the form data
        $data = array(
            'name' => $name,
            'url' => $url,
            'date' => $date,
            'format' => $format,
            'password' => $password,
            'description' => $description
        );

        // Read existing entries from the JSON file
        $filename = 'modeldata.json';
        $entries = array();
        if (file_exists($filename)) {
            $json_data = file_get_contents($filename);
            $entries = json_decode($json_data, true);
        }

        // Prepend the new entry to the array
        array_unshift($entries, $data);

        // Encode the updated data as JSON
        $json = json_encode($entries);

        // Save the JSON data to the file
        file_put_contents($filename, $json);

        echo 'Data saved successfully!';
    }
    ?>

    <form method="POST" action="<?php echo $_SERVER['PHP_SELF']; ?>">
        <label for="name">Name:</label>
        <input type="text" name="name" id="name" required><br><br>

        <label for="url">URL:</label>
        <input type="text" name="url" id="url" required><br><br>

        <label for="date">Date:</label>
        <input type="date" name="date" id="date" value="<?php echo date('Y-m-d'); ?>" required><br><br>

        <label for="format">Format:</label>
        <select name="format" id="format">
            <option value="pmx">PMX</option>
            <option value="pmd">PMD</option>
        </select><br><br>
        <label for="password">Password:</label>
        <input type="text" name="password" id="password" required value="-"><br><br>
        <label for="description">Description:</label>
        <input type="text" name="description" id="description" required value="-"><br><br>
        <input type="submit" value="Save" disabled>
    </form>
    <h3>Current Entries:</h3>
    <table id="entriesTable">
        <tr>
            <th>Name</th>
            <th>URL</th>
            <th>Date</th>
            <th>Format</th>
            <th>Password</th>
            <th>Description</th>
        </tr>
    </table>
    <button onclick="loadEntries()">Load Entries</button>
</body>

    <button onclick="exportTable()">Export Table</button>
    <script>
        function exportTable() {
            var table = document.getElementById("entriesTable").outerHTML;
            var htmlContent = "<html><head><title>Exported Table</title></head><body>" + table + "</body></html>";

            var link = document.createElement("a");
            link.href = "data:text/html;charset=utf-8," + encodeURIComponent(htmlContent);
            link.download = "exported_table.html";
            link.click();
        }
    </script>

___________________________

Find pixiv link metadata
-------------------------

  <a target="_blank" href="https://www.pixiv.net/artworks/116930325">https://www.pixiv.net/artworks/116930325</a>
<div class="counts"></div>
<a target="_blank" href="https://www.pixiv.net/artworks/116877725">https://www.pixiv.net/artworks/116877725</a>
<div class="counts"></div>
<a target="_blank" href="https://www.pixiv.net/artworks/116850925">https://www.pixiv.net/artworks/116850925</a>
<div class="counts"></div>
<button id="startButton">Start Process</button>
<script>
function findPixivLinks() {
  var links = document.getElementsByTagName('a');
  var pixivLinks = [];
  for (var i = 0; i < links.length; i++) {
    var link = links[i].href;
    if (link.indexOf('pixiv.net') !== -1) {
      pixivLinks.push(link);
    }
  }
  return pixivLinks;
}
document.getElementById('startButton').addEventListener('click', function() {
  var pixivLinks = findPixivLinks();
  var form = document.createElement('form');
  form.method = 'POST';
  form.style.display = 'none';
  for (var i = 0; i < pixivLinks.length; i++) {
    var input = document.createElement('input');
    input.type = 'text';
    input.name = 'pixivLinks[]';
    input.value = pixivLinks[i];
    form.appendChild(input);
  }
  document.body.appendChild(form);
  form.submit();
});
</script>
<?php
if (isset($_POST['pixivLinks'])) {
    $pixivLinks = $_POST['pixivLinks'];
    foreach ($pixivLinks as $index => $link) {
        $html = file_get_contents($link);
        $bookmarkStart = strpos($html, '"bookmarkCount":');
        if ($bookmarkStart !== false) {
            $bookmarkEnd = strpos($html, ',', $bookmarkStart);
            if ($bookmarkEnd !== false) {
                $bookmarkCount = substr($html, $bookmarkStart + 16, $bookmarkEnd - $bookmarkStart - 16);
            }
        }
        $likeStart = strpos($html, '"likeCount":');
        if ($likeStart !== false) {
            $likeEnd = strpos($html, ',', $likeStart);
            if ($likeEnd !== false) {
                $likeCount = substr($html, $likeStart + 12, $likeEnd - $likeStart - 12);
            }
        }
        $commentStart = strpos($html, '"commentCount":');
        if ($commentStart !== false) {
            $commentEnd = strpos($html, ',', $commentStart);
            if ($commentEnd !== false) {
                $commentCount = substr($html, $commentStart + 15, $commentEnd - $commentStart - 15);
            }
        }
        echo "<script>document.getElementsByClassName('counts')[$index].innerHTML = 'Bookmark Count: $bookmarkCount, Like Count: $likeCount, Comment Count: $commentCount';</script>";
    }
}
?>
          
_______________-


MultiURL Pixiv_Downloader
--------------------------

<form method="post" action="<?php echo $_SERVER['PHP_SELF']; ?>">
<label for="urls">Enter the URLs (one per line):</label><br>
<textarea id="urls" name="urls" rows="10" cols="50" placeholder="https://www.pixiv.net/artworks/116877725"></textarea><br>
<button type="submit">Submit</button>
</form>
<?php
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $urls = explode("\n", $_POST["urls"]);
    foreach ($urls as $url) {
        $url = trim($url);

        if (empty($url)) {
            continue;
        }

        $options = [
            'http' => [
                'header' => "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:70.0) Gecko/20100101 Firefox/70.0\r\n" .
                            "Referer: https://accounts.pixiv.net\r\n",
            ],
        ];
        $context = stream_context_create($options);
        $html = file_get_contents($url, false, $context);
        $pattern = '/image" href="(.*?)"/'; //find downscaled master img (always in jpg format)
        //$pattern = '/"original":"(.*?)"/'; //find original image (usually only works when logged in)
        preg_match($pattern, $html, $matches);
        $imageUrl = $matches[1];
        echo '<p>Image Link: <a id="image-link" href="' . $imageUrl . '">' . $imageUrl . '</a></p>';
        $imageData = file_get_contents($imageUrl, false, $context);
        if ($imageData !== false) {
            $filename = basename($imageUrl);
            $datePattern = '/\/(\d{4}\/\d{2}\/\d{2})\//';
            preg_match($datePattern, $imageUrl, $dateMatches);
            $datePart = $dateMatches[1];
            $datePart = str_replace('/', '_', $datePart);
            $newFilename = pathinfo($filename, PATHINFO_FILENAME) . '_' . $datePart . '.' . pathinfo($filename, PATHINFO_EXTENSION);
            file_put_contents($newFilename, $imageData);
            echo 'Image saved as: ' . $newFilename . '<br>';
        } else {
            echo 'Failed to retrieve the image from: ' . $url . '<br>';
        }
    }
}
?>
</body>
</html>
<!--FixURls-->
<script>
    var textarea = document.getElementById("urls");
       textarea.addEventListener("input", function() {
      var text = textarea.value;
      var updatedText = text.replace(/en\//g, "");
      textarea.value = updatedText;
    });
  </script>

_________________________


Fetch and display Pixiv image (via request header)
--------------------------

<!---https://stackoverflow.com/questions/78161887/applying-request-header-with-curl/78162032#78162032-->
<!DOCTYPE html>
<html>
<head>
    <title>Image Retrieval</title>
</head>
<body>
    <form method="post" action="<?php echo $_SERVER['PHP_SELF']; ?>">
        <label for="url">Enter the URL:</label>
        <input type="text" id="url" name="url">
        <button type="submit">Submit</button>
    </form>
    <?php
    if ($_SERVER["REQUEST_METHOD"] == "POST") {
        $url = $_POST["url"];
        $options = [
            'http' => [
                'header' => "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:70.0) Gecko/20100101 Firefox/70.0\r\n" .
                            "Referer: https://accounts.pixiv.net\r\n",
            ],
        ];
        $context = stream_context_create($options);
        $html = file_get_contents($url, false, $context);
        $pattern = '/image" href="(.*?)"/';   //find downscaled master img (always in jpg format)
        //$pattern = '/"original":"(.*?)"/'; //find original image (usually only works when logged in)
        preg_match($pattern, $html, $matches);
        $imageUrl = $matches[1];

        echo '<p>Image Link: <a id="image-link" href="' . $imageUrl . '">' . $imageUrl . '</a></p>';

        $imageData = file_get_contents($imageUrl, false, $context);

        if ($imageData !== false) {
            $base64 = base64_encode($imageData);
            $imageSrc = 'data:image/jpeg;base64,' . $base64;
            echo '<img src="' . $imageSrc . '" alt="Image">';
        } else {
            echo 'Failed to retrieve the image.';
        }
    }
    ?>

    <script>
        var imageLink = document.getElementById("image-link");
        if (imageLink) {
            //window.location.href = imageLink.href;
        }
    </script>

    <!-- Autofill if query string exists -->
    <script>
        var urlParams = new URLSearchParams(window.location.search);
        var pixivUrl = urlParams.get('pixivurl');
        if (pixivUrl) {
            var urlInput = document.getElementById('url');
            if (urlInput) {
                urlInput.value = pixivUrl;
            }
            var form = document.querySelector('form');
            if (form) {
                form.submit();
            }
        }
    </script>
</body>
</html>

__________________________



Extract Youtube channelid and channel playlist
---------------------------------

<?php
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    // Retrieve the YouTube URL from the text box
    $youtubeUrl = $_POST["youtube_url"];
    // Create a new DOMDocument instance
    $dom = new DOMDocument();

    // Load the HTML content from the YouTube URL
    $dom->loadHTMLFile($youtubeUrl);

    // Create a new DOMXPath instance
    $xpath = new DOMXPath($dom);

    // Search for the itemprop="identifier" attribute
    $channelId = "";
    $channelIdNodes = $xpath->query('//meta[@itemprop="identifier"]/@content');
    if ($channelIdNodes->length > 0) {
        $channelId = $channelIdNodes[0]->nodeValue;
    }
    $channelId = substr_replace($channelId, "UU", 0, 2);
    $embedUrl = "https://www.youtube.com/embed/videoseries?list=" . $channelId;
}

    echo "Channel ID: " . $channelId;
?>

<!DOCTYPE html>
<html>
<head>
    <title>Extract Channel ID</title>
</head>
<body>
    <form method="post" action="<?php echo $_SERVER['PHP_SELF']; ?>">
        <label for="youtube_url">YouTube URL:</label>
        <input type="text" name="youtube_url" id="youtube_url">
        <input type="submit" value="Extract Channel ID">
    </form>

    <?php if (isset($embedUrl)) : ?>
        <iframe width="560" height="315" src="<?php echo $embedUrl; ?>" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    <?php endif; ?>
</body>
</html>

_________________



Pinterest image extractit
-----------------------

<a target="_blank" href="https://alcea-wisteria.de/PHP/0demo/2024-03-11-ImgExtract4Websites/Pinterest/xtrctpin.php?pinurl=https://www.pinterest.de/pin/804877764644009233/">Demo</a><demo>
<plaintext>
<?php
// Set the initial value of the Pinterest page URL
$url = "";

// Check if the query string parameter "pinurl" exists
if (isset($_GET['pinurl'])) {
    // Retrieve the value of the "pinurl" parameter
    $url = $_GET['pinurl'];
}

if (isset($_POST['url'])) {
    // Pinterest page URL
    $url = $_POST['url'];
}

if (isset($_POST['url']) || isset($_GET['pinurl'])) {
    // Fetch the HTML content of the Pinterest page
    $html = file_get_contents($url);

    // Regular expression pattern to match the image URL with the specified attributes
    $pattern = '/fetchpriority="auto" loading="auto" src="(.*?)" elementtiming="closeupImage"/';

    // Execute the regular expression and extract the image URL
    preg_match($pattern, $html, $matches);

    if (isset($matches[1])) {
        $imageURL = $matches[1];

        // Create an HTML link with target blank and the extracted image URL
        $linkTag = '<a href="' . $imageURL . '" target="_blank">View Image</a>';

        // Create an HTML img tag with the extracted image URL and 50% width
        $imageTag = '<img src="' . $imageURL . '" width="50%" />';

        // Output the link and the image tag
        echo "Image URL with specified attributes: " . $linkTag . "<br>";
        echo $imageTag;
        // You can now use $imageURL to display or process the image
    } else {
        echo "No image found with the specified attributes.";
    }
}
?>

<!DOCTYPE html>
<html>
<head>
    <title>Image URL Extraction</title>
</head>
<body>
    <form method="POST" action="">
        <label for="url">Pinterest Page URL:</label><br>
        <input type="text" id="url" name="url" placeholder="Enter Pinterest page URL" value="<?php echo $url; ?>">
        <button type="submit">Extract Image URL</button>
    </form>
</body>
</html>


__________

Exclude files from zip based on txt
--------------------------------------------------


======listbigfiles.php===

<?php
function scanDirectory($dir)
{
    $files = [];
    $iterator = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($dir));
    foreach ($iterator as $file) {
        if (!$file->isFile()) {
            continue;
        }
        $filePath = $file->getPathname();
        $fileSize = $file->getSize();

        $extension = pathinfo($filePath, PATHINFO_EXTENSION);
        if ($extension === 'png' || $extension === 'jpg') {
            $files[] = [
                'path' => $filePath,
                'size' => $fileSize,
            ];
        } else {
            if ($fileSize > 848576) { // 1 megabyte = 1048576 bytes
                $files[] = [
                    'path' => $filePath,
                    'size' => $fileSize,
                ];
            }
        }
    }
    return $files;
}
function displayFileList($files)
{
    echo '<p>Files larger than 1 megabyte:</p>';
    foreach ($files as $key => $file) {
        echo '<label>';
        echo '<input type="checkbox" name="files[]" value="' . $key . '"';
        $extension = pathinfo($file['path'], PATHINFO_EXTENSION);
        $path = $file['path'];

        if ($extension !== 'mp4' && $extension !== 'js' && $extension !== 'png' && $extension !== 'jpg' && $extension !== 'zip' && $extension !== 'brkn' && $extension !== 'css' && $extension !== 'mp3' && strpos($path, '2023-09-24-YTClone') === false && strpos($file['path'], 'error_log') === false) {
            echo ' checked';
        }
        echo '>';
        echo $file['path'] . ' (' . formatFileSize($file['size']) . ')';
        echo '</label><br>';
    }
    echo '<input type="submit" name="write_paths" value="Write Unchecked Paths">';
}
function formatFileSize($size)
{
    $units = ['B', 'KB', 'MB', 'GB'];
    $unitIndex = 0;

    while ($size >= 1024 && $unitIndex < count($units) - 1) {
        $size /= 1024;
        $unitIndex++;
    }

    return round($size, 2) . ' ' . $units[$unitIndex];
}
function writeUncheckedPaths($files)
{
    $uncheckedPaths = [];
    if (isset($_POST['files'])) {
        $checkedFiles = $_POST['files'];
        foreach ($files as $key => $file) {
            if (!in_array($key, $checkedFiles)) {
                $uncheckedPaths[] = $file['path'];
            }
        }
    }
    $filePath = __DIR__ . '/unchecked_paths.txt';
    $content = implode("\n", $uncheckedPaths);
    file_put_contents($filePath, $content);
    echo "Unchecked paths have been written to unchecked_paths.txt";
}
$dir = __DIR__;
$files = scanDirectory($dir);
if (isset($_POST['write_paths'])) {
    writeUncheckedPaths($files);
}
echo '<form method="POST">';
displayFileList($files);
echo '</form>';
?>

======zip.php======
<?php
$url = 'unchecked_paths.txt';
$fileContent = file_get_contents($url);
if ($fileContent !== false) {
    $lines = explode("\n", $fileContent);
    $filenames = array();
    echo '<ul>';
    foreach ($lines as $line) {
        $parts = explode('/', $line);
        $finalPart = end($parts);
        $filenames[] = $finalPart;
        echo '<li>' . htmlspecialchars($finalPart) . '</li>';
    }
    echo '</ul>';
    // Output the filenames array
    echo '<pre>';
    print_r($filenames);
    echo '</pre>';
    // Create a zip archive excluding the files in the filenames array
    $zipFile = 'php.zip';
    $zip = new ZipArchive();
    if ($zip->open($zipFile, ZipArchive::CREATE | ZipArchive::OVERWRITE) === true) {
        $iterator = new RecursiveIteratorIterator(
            new RecursiveDirectoryIterator(
                __DIR__,
                RecursiveDirectoryIterator::SKIP_DOTS | RecursiveDirectoryIterator::FOLLOW_SYMLINKS
            ),
            RecursiveIteratorIterator::SELF_FIRST,
            RecursiveIteratorIterator::CATCH_GET_CHILD // Use custom iterator to include hidden files
        );

        foreach ($iterator as $file) {
            if ($file->isFile() && !in_array($file->getFilename(), $filenames)) {
                $filePath = $file->getPathname();
                $relativePath = substr($filePath, strlen(__DIR__) + 1);
                $zip->addFile($filePath, $relativePath);
            }
        }
        $zip->close();
        echo 'Zip archive created successfully.';
    } else {
        echo 'Failed to create the zip archive.';
    }
} else {
    echo 'Failed to read the file.';
}
?>




_________________________________________________

Event over time writer & renderer
--------------------------------------------


=======Plot-html===

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    #description {
      margin-top: 10px;
      padding: 10px;
      background-color: #f2f2f2;
    }
  </style>
</head>
<body>
  <canvas id="eventChart"></canvas>
  <div id="description"></div>
  <script>
    fetch('events.txt')
      .then(response => response.text())
      .then(data => {
        const events = parseEventText(data);
        createChart(events);
      })
      .catch(error => {
        console.error('Error reading event.txt:', error);
      });
    function parseEventText(text) {
      const lines = text.split('\n');
      const events = [];
      for (let line of lines) {
        const regex = /^(\d{4}-\d{2}-\d{2}) \(([-+]+)\) (.+)$/;
        const matches = line.match(regex);
        if (matches) {
          const date = matches[1];
          const rating = matches[2];
          const description = matches[3];
          events.push({ date, rating, description });
        }
      }
      return events;
    }
function createChart(events) {
  events.sort((a, b) => new Date(a.date) - new Date(b.date));
  const dates = events.map(event => event.date);
  const ratings = events.map(event => convertRatingToValue(event.rating));
  const ctx = document.getElementById('eventChart').getContext('2d');
  const eventChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: dates,
      datasets: [{
        label: 'Event Ratings',
        data: ratings,
        borderColor: 'blue',
        fill: false
      }]
    },
    options: {
      scales: {
        x: {
          reverse: false // Invert the X-axis
        },
        y: {
          ticks: {
            beginAtZero: true,
            callback: value => valueToRating(value)
          }
        }
      },
      plugins: {
        tooltip: {
          enabled: true,
          callbacks: {
            title: (tooltipItems) => {
              const index = tooltipItems[0].dataIndex;
              return events[index].date;
            },
            label: (tooltipItems) => {
              const index = tooltipItems.dataIndex;
              return events[index].description;
            }
          }
        }
      },
      onHover: (event, chartElements) => {
        if (chartElements.length > 0) {
          const index = chartElements[0].index;
          const description = events[index].description;
          document.getElementById('description').textContent = description;
        }
      },
      onLeave: () => {
        document.getElementById('description').textContent = '';
      }
    }
  });
}
function convertRatingToValue(rating) {
  const minusCount = (rating.match(/-/g) || []).length;
  const plusCount = (rating.match(/\+/g) || []).length;
  const value = plusCount - minusCount;
  return value * 10; // Assuming each plus or minus sign corresponds to a value of 10
}
function valueToRating(value) {
  const ratingValue = value / 10; // Assuming each plus or minus sign corresponds to a value of 10
  let ratingString = '';
  if (ratingValue < 0) {
    ratingString += '-'.repeat(Math.abs(ratingValue));
  } else if (ratingValue > 0) {
    ratingString += '+'.repeat(ratingValue);
  } else {
    ratingString = '0';
  }

  return ratingString;
}
  </script>

====== write event.php====

<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Get the input values
    $textEntry = $_POST['text_entry'];
    $rating = $_POST['rating'];
    $year = $_POST['year'];
    $month = $_POST['month'];
    $day = $_POST['day'];
    $sortIn = isset($_POST['sort_in']) && $_POST['sort_in'] === 'on';
    $date = sprintf("%04d-%02d-%02d", $year, $month, $day);
    $data = $date . ' (' . $rating . ') ' . $textEntry . "\n";
    if ($sortIn) {
        $data = "\n" . $data;
    }
    $contents = file_get_contents('events.txt');
    if ($sortIn) {
        $lines = explode("\n", $contents);
        $entries = [];
        foreach ($lines as $line) {
            if (!empty($line)) {
                $entry = [
                    'date' => substr($line, 0, 10),
                    'content' => $line
                ];
                $entries[] = $entry;
            }
        }
        $newEntry = [
            'date' => $date,
            'content' => $data
        ];
        $entries[] = $newEntry;

        // Sort the entries based on the date
        usort($entries, function ($a, $b) {
            $dateA = DateTime::createFromFormat('Y-m-d', $a['date']);
            $dateB = DateTime::createFromFormat('Y-m-d', $b['date']);
            return $dateA <=> $dateB;
        });
        $contents = '';
        foreach ($entries as $entry) {
            $contents .= $entry['content'];
        }
    } else {
        $contents = $data . $contents;
    }
    file_put_contents('events.txt', $contents);
    header('Location: ' . $_SERVER['PHP_SELF']);
    exit;
} else {
    $today = getdate();
    $defaultYear = $today['year'];
    $defaultMonth = $today['mon'];
    $defaultDay = $today['mday'];
}
?>
    <form method="POST" action="<?php echo $_SERVER['PHP_SELF']; ?>">
        <label for="year">Year:</label>
        <input type="number" id="year" name="year" value="<?php echo $defaultYear; ?>" required><br><br>
        <label for="month">Month:</label>
        <input type="number" id="month" name="month" value="<?php echo $defaultMonth; ?>" required><br><br>
        <label for="day">Day:</label>
        <input type="number" id="day" name="day" value="<?php echo $defaultDay; ?>" required><br><br>
        <label for="text_entry">Text Entry:</label>
        <input type="text" id="text_entry" name="text_entry" required><br><br>
        <label for="rating">Rating:</label>
        <select id="rating" name="rating">
            <option value="-----">-----</option>
            <option value="----">----</option>
            <option value="---">---</option>
            <option value="--">--</option>
            <option value="-">-</option>
            <option value="0">0</option>
            <option value="+">+</option>
            <option value="++">++</option>
            <option value="+++">+++</option>
            <option value="++++">++++</option>
            <option value="+++++">+++++</option>
        </select><br><br>
        <label for="sort_in">Sort In:</label>
        <input type="checkbox" id="sort_in" name="sort_in"><br><br>
        <input type="submit" value="Submit">
    </form>

_______________________





GameList Hype Writer
-----------------------------------

<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    //$gameName = str_pad($_POST['gamename'], 45, '_');
    $gameName = $_POST['gamename'];
    $url = $_POST['url'];
    $moreInfo = $_POST['moreinfo'];
    $releaseDate = $_POST['releasedate'];
    $rating = $_POST['rating'];
    $system = $_POST['system'];
    $underscoreCount = max(0, 45 - strlen($gameName));
    $padded = str_repeat('_', $underscoreCount);
    $rating = str_replace(',', '', $rating);
    $rating = str_replace('.', '', $rating);
    $rating = max(1, min(10, $rating));
    $ratingImages = "";
    for ($i = 1; $i <= 10; $i++) {
    $class = ($i <= $rating) ? "filled" : "greyed";
    $style = ($i > $rating) ? "filter: grayscale(100%);" : "";
    $ratingImages .= "<img class='$class' style='$style' src='https://alcea-wisteria.de/z_files/emoji/ablobdj.gif' alt='Rating' width='20px'>";
    }
    $gameLink = "<a href='$url'>$gameName</a>";
    $gameInfo = "
        <tr>
            <td>$releaseDate</td>
            <td>$gameLink</td>
            <td>$padded</td>
            <td>$moreInfo</td>
            <td>$ratingImages</td>
            <td>$system</td>
        </tr>
    ";
    $existingContent = file_get_contents("game.html");
    $newContent = "
        <table>
            <tr>
            </tr>
            $gameInfo
            <tr><td colspan='5' style='border-bottom: 1px solid black;'></td></tr>
            $existingContent
        </table>
    ";
    file_put_contents("game.html", $newContent);
}
?>
<!DOCTYPE html>
<html>
<head>
</head>
<body>
    <form method="POST" action="<?php echo $_SERVER['PHP_SELF']; ?>">
        <label for="gamename">Game Name:</label>
        <input type="text" id="gamename" name="gamename" required><br>
        <label for="url">URL:</label>
        <input type="text" id="url" name="url" required><br>
        <label for="moreinfo">More Info:</label>
        <input type="text" id="moreinfo" name="moreinfo" required><br>
        <label for="releasedate">Release Date:</label>
        <input type="date" id="releasedate" name="releasedate" value="<?php echo date('Y-m-d'); ?>" required><br>
        <label for="rating">Rating:</label>
        <input type="number" id="rating" name="rating" min="1" max="10" required><br>
        <label for="system">System:</label>
        <select id="system" name="system" required>
            <option value="NSwitch">NSwitch</option>
            <option value="PS4">PS4</option>
            <option value="PC">PC</option>
        </select><br>
        <input type="submit" value="Submit">
    </form>
</body>
</html>


_____________________________________

Json block deletion interface_
-------------------------------------

<?php
$jsonFilePath = 'data.json';
if (!file_exists($jsonFilePath)) {
    die('JSON file not found.');
}______
// Read the JSON file and decode its contents
$jsonData = file_get_contents($jsonFilePath);
$data = json_decode($jsonData, true);
if (isset($_POST['deleteEntryId'])) {
    $deleteEntryId = $_POST['deleteEntryId'];
    foreach ($data as $key => $entry) {
        if ($entry['id'] == $deleteEntryId) {
            unset($data[$key]);
            break;
        }
    }
    $jsonData = json_encode(array_values($data), JSON_PRETTY_PRINT);
    file_put_contents($jsonFilePath, $jsonData);
}
echo '<ul>';
foreach ($data as $entry) {
    echo '<li>';
    foreach ($entry as $key => $value) {
        if (!is_numeric($key) && $key !== 'plaintext') {
            echo $key . ': ' . $value . '<br>';
        }
    }
    echo '<form method="post" style="display: inline-block;">';
    echo '<input type="hidden" name="deleteEntryId" value="' . $entry['id'] . '">';
    echo '<input type="submit" value="Delete">';
    echo '</form>';
        echo '<span>';
        print_r($entry);
        echo '</span>';
    echo '</li>';
}
echo '</ul>';
?>

_____________________________________

Wishlist resell json writer n renderer
--------------------------------------

<details><summary>Add Entry</summary>
eBay
<form action="ebay.php" method="GET">
  <input type="text" name="url" placeholder="Enter URL">
  <input type="submit" value="Submit">
</form>
<hr>
Other
  <form action="write.php" method="GET">
    <label for="url">URL:</label>
    <input type="text" id="url" name="url" required><br><br>
    <label for="title">Title:</label>
    <input type="text" id="title" name="title" required><br><br>
    <label for="price">Price:</label>
    <input type="text" id="price" name="price" required><br><br>
    <input type="submit" value="Submit">
  </form></details>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid #ddd;
            cursor: pointer;
        }
        th {
            background-color: #f2f2f2;
            color: #333;
        }
    </style>
</head>
<body>
    <button onclick="refetchData()">Refetch</button>
    <table id="buylistTable">
        <thead>
            <tr>
                <th onclick="sortBy('title')">Title</th>
                <th onclick="sortBy('price')">Price</th>
                <th onclick="sortBy('marketplace')">Marketplace</th>
                <th onclick="sortBy('date')">Date</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <script>
        let sortDirection = {
            title: 'asc',
            price: 'asc',
            marketplace: 'asc',
            date: 'asc'
        };
        function sortBy(column) {
            const table = document.querySelector('#buylistTable');
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            const columnIndex = Array.from(table.querySelectorAll('th')).indexOf(event.target);
            const sortColumn = column;
            const sortDirectionValue = sortDirection[column] === 'asc' ? 1 : -1;
            rows.sort((rowA, rowB) => {
                const cellA = rowA.querySelector(`td:nth-child(${columnIndex + 1})`).textContent.trim();
                const cellB = rowB.querySelector(`td:nth-child(${columnIndex + 1})`).textContent.trim();
                if (cellA < cellB) {
                    return -1 * sortDirectionValue;
                } else if (cellA > cellB) {
                    return 1 * sortDirectionValue;
                } else {
                    return 0;
                }
            });
            while (tbody.firstChild) {
                tbody.removeChild(tbody.firstChild);
            }
            rows.forEach(row => {
                tbody.appendChild(row);
            });
            sortDirection[column] = sortDirectionValue === 1 ? 'desc' : 'asc';
        }
        function refetchData() {
            const tableBody = document.querySelector('#buylistTable tbody');
            while (tableBody.firstChild) {
                tableBody.firstChild.remove();
            }
            fetchData();
        }
        function fetchData() {
            fetch('buylist.json')
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.querySelector('#buylistTable tbody');
                    data.forEach(item => {
                        const row = document.createElement('tr');
                        const titleCell = document.createElement('td');
                        const priceCell = document.createElement('td');
                        const marketplaceCell = document.createElement('td');
                        const dateCell = document.createElement('td');
                        const titleLink = document.createElement('a');
                        titleLink.href = item.url;
                        titleLink.target = '_blank';
                        titleLink.textContent = item.title;
                        titleCell.appendChild(titleLink);
                        priceCell.textContent = item.price;
                        marketplaceCell.textContent = item.marketplace;
                        dateCell.textContent = item.date;
                        row.appendChild(titleCell);
                        row.appendChild(priceCell);
                        row.appendChild(marketplaceCell);
                        row.appendChild(dateCell);
                        tableBody.appendChild(row);
                    });
                })
                .catch(error => console.error(error));
        }

        fetchData();
    </script>
</body>
</html>


========================ebay.php======================

<?php
// Get the URL from the query string parameter
$url = isset($_GET['url']) ? $_GET['url'] : '';
// Check if the URL is provided
if (empty($url)) {
    echo 'URL parameter is missing.';
    exit;
}
// Initialize cURL
$curl = curl_init();
// Set cURL options
curl_setopt($curl, CURLOPT_URL, $url);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
curl_setopt($curl, CURLOPT_FOLLOWLOCATION, true);
curl_setopt($curl, CURLOPT_USERAGENT, 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36');
// Execute the cURL request
$response = curl_exec($curl);
// Check if the request was successful
if ($response === false) {
    echo 'Error: ' . curl_error($curl);
    exit;
}
// Close the cURL session
curl_close($curl);
// Extract the page title
$pageTitle = '';
if (preg_match('/<title>(.*?)<\/title>/', $response, $matches)) {
    $pageTitle = $matches[1];
}
// Search for the specific string in the HTML content to extract the currency and price
$searchString = ',"priceCurrency":"';
$pos = strpos($response, $searchString);
// Extract the currency and price
$currency = '';
$price = '';
if ($pos !== false) {
    $currencyStartPos = $pos + strlen($searchString);
    $currencyEndPos = strpos($response, '"', $currencyStartPos);
    $currency = substr($response, $currencyStartPos, $currencyEndPos - $currencyStartPos);
    $priceSearchString = ',"price":"';
    $pricePos = strpos($response, $priceSearchString, $currencyEndPos);
    if ($pricePos !== false) {
        $priceStartPos = $pricePos + strlen($priceSearchString);
        $priceEndPos = strpos($response, '"', $priceStartPos);
        $price = substr($response, $priceStartPos, $priceEndPos - $priceStartPos);
    }
}
// Construct the URL for write.php and open it as a URL
$writeUrl = 'write.php?ebayurl=' . urlencode($url) . '&title=' . urlencode($pageTitle) . '&price=' . urlencode($price . ' ' . $currency);
// Open the URL
header('Location: ' . $writeUrl);
exit;
?>


===========write.php ============

<?php
// Get the URL, price, title, and query strings from the query parameters
$url = isset($_GET['url']) ? $_GET['url'] : '';
$price = $_GET['price'];
$title = $_GET['title'];
// Check if ebayurl is present
if (isset($_GET['ebayurl']) && !isset($_GET['url'])) {
    $url = $_GET['ebayurl'];
    $marketplace = 'ebay';
} else {
    $marketplace = '';
}
// Get the current date
$date = date('Y-m-d');
// Load the existing buylist JSON file
$buylistFile = 'buylist.json';
$currentBuylist = [];
if (file_exists($buylistFile)) {
    $currentBuylist = json_decode(file_get_contents($buylistFile), true);
}
// Check if the entry with the same date and title already exists
$isDuplicate = false;
foreach ($currentBuylist as $item) {
    if ($item['date'] === $date && $item['title'] === $title) {
        $isDuplicate = true;
        break;
    }
}
// Add the new item to the buylist if it's not a duplicate
if (!$isDuplicate) {
    // Create a new item for the buylist
    $newItem = [
        'url' => $url,
        'price' => $price,
        'title' => $title,
        'marketplace' => $marketplace,
        'date' => $date
    ];
    // Prepend the new item to the buylist
    array_unshift($currentBuylist, $newItem);
    // Save the updated buylist back to the JSON file with pretty formatting
    file_put_contents($buylistFile, json_encode($currentBuylist, JSON_PRETTY_PRINT));
    // Output a success message
    echo 'Item added to the <a target=_blank href=buylist.json>buylist</a>!';
} else {
    // Output a message indicating that the item is a duplicate
    echo 'Item is a duplicate and not added to the <a target=_blank href=buylist.json>buylist</a>.';
}
?>


_____________________________________________

CSS & JS Reduction (minification etc) tools
--------------------------------------------

==CSS reduce.php==

<a href="https://www.giftofspeed.com/css-compressor" target="_blank">Compress even more</a>
<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Get the uploaded CSS file or the CSS code from textarea
    if (!empty($_FILES['css']['tmp_name'])) {
        $css = file_get_contents($_FILES['css']['tmp_name']);
    } elseif (!empty($_POST['css_code'])) {
        $css = $_POST['css_code'];
    } else {
        echo 'Please upload a CSS file or paste CSS code in the textarea.';
        exit();
    }

    // Replace "93.33333333%" with rounded whole numbers like "93"
    $css = preg_replace_callback('/(\d+\.\d+)%/', function ($matches) {
        return round($matches[1]);
    }, $css);

    // Simplify all selectors
    $css = preg_replace_callback('/[^\{\}]+\{/', function ($matches) {
        $selector = $matches[0];
        $selector = preg_replace('/\s+/', ' ', $selector);
        $selector = preg_replace('/([>+~])\s+/', '$1', $selector);
        return $selector;
    }, $css);

    // Remove old and redundant vendor prefixes
    $css = preg_replace('/-(moz|ms|webkit|o)-/', '', $css);

    // Remove unused styles
    $unusedStyles = array(
        '.unused-class',
        '#unused-id',
        'unused-selector'
    );
    $css = str_replace($unusedStyles, '', $css);

    // Combine and consolidate selectors
    $css = preg_replace('/(selector1|selector2|selector3)\s*\{\s*property1: value;\s*property2: value;\s*\}/', '.combined-selector{property1: value;property2: value;}', $css);

    // Use shorthand properties
    $css = preg_replace('/margin-top: 10px;margin-bottom: 10px;margin-left: 10px;margin-right: 10px;/', 'margin: 10px;', $css);

    // Remove duplicate declarations
    $css = preg_replace('/property: value;\s*property: value;/', 'property: value;', $css);

    // Minimize colors
    $css = preg_replace_callback('/#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})/', function ($matches) {
        $color = $matches[1];
        if (strlen($color) === 6) {
            $color = substr($color, 0, 3);
        }
        return '#' . strtolower($color);
    }, $css);

    // Remove font-related styles if checkbox is checked
    if (isset($_POST['remove_font']) && $_POST['remove_font'] === 'on') {
        $css = preg_replace('/font-family:.*?;/i', '', $css);
        $css = preg_replace('/@font-face\s*{.*?}/si', '', $css);
    }

    // Minify the CSS by removing unnecessary whitespace and comments
    $css = preg_replace('/\/\*.*\*\//sU', '', $css);
    $css = preg_replace('/\s*([{}|:;,])\s*/', '$1', $css);

    if (isset($_POST['output_to_textbox']) && $_POST['output_to_textbox'] === 'on') {
        echo '<textarea rows="10" cols="50" readonly>' . htmlspecialchars($css) . '</textarea>';
        echo '<br>';
        echo '<button onclick="copyToClipboard()">Copy</button>';
        echo '<script>function copyToClipboard() { var copyText = document.querySelector("textarea"); copyText.select(); copyText.setSelectionRange(0, 99999); document.execCommand("copy"); alert("Copied to clipboard!"); }</script>';
    } else {
        // Save the modified CSS to the new file
        $currentTime = date('YmdHis');
        $newFilename = $currentTime . (isset($_POST['remove_font']) && $_POST['remove_font'] === 'on' ? '_fontrm' : '') . '_new.css';
        file_put_contents($newFilename, $css);

        echo 'CSS file has been modified. Download the modified file: <a href="' . $newFilename . '">Download</a>';
    }
}
?>
    <title>CSS Modifier</title>
</head>
<body>
    <form method="post" enctype="multipart/form-data">
        <label for="css">CSS File:</label><br>
        <input type="file" id="css" name="css"><br><br>
        <labelfor="css_code">CSS Code:</label><br>
        <textarea id="css_code" name="css_code" rows="10" cols="50"></textarea><br><br>
        <input type="checkbox" id="remove_font" name="remove_font">
        <label for="remove_font">Remove font-related styles</label><br><br>
        <input type="checkbox" id="output_to_textbox" name="output_to_textbox">
        <label for="output_to_textbox">Output modified CSS to textbox</label><br><br>
        <input type="submit" value="Modify CSS">
    </form>
</body>
</html>


=== JS minify ==

<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Get the JavaScript code from the uploaded file or the textarea
    if (!empty($_FILES['js']['tmp_name'])) {
        $js = file_get_contents($_FILES['js']['tmp_name']);
    } elseif (!empty($_POST['js_code'])) {
        $js = $_POST['js_code'];
    } else {
        echo 'Please upload a JavaScript file or enter JavaScript code in the textarea.';
        exit();
    }

    // Minify the JavaScript code
    $minifiedJs = minifyJavaScript($js);

    // Output the minified JavaScript to a textbox if the checkbox is checked
    if (isset($_POST['output_to_textbox']) && $_POST['output_to_textbox'] === 'on') {
        echo '<textarea id="minified_js" rows="10" cols="50" readonly>' . htmlspecialchars($minifiedJs) . '</textarea><br>';
        echo '<button onclick="copyToClipboard()">Copy</button>';
        echo '<script>function copyToClipboard() { var copyText = document.getElementById("minified_js"); copyText.select(); copyText.setSelectionRange(0, 99999); document.execCommand("copy"); alert("Copied to clipboard!"); }</script>';
    } else {
        // Save the minified JavaScript to a file with a timestamp in the filename
        $filename = date('YmdHis') . '_minified.js';
        file_put_contents($filename, $minifiedJs);

        // Output the link to download the minified JavaScript file
        echo 'Minified JavaScript file has been created. Download the file: <a href="' . $filename . '">Download</a><br>';
    }
}
function minifyJavaScript($js) {
    // Minify the JavaScript code (implement your own minification logic here)
    // For example, using a library like JSMin or UglifyJS

    // Dummy implementation: Remove all comments and unnecessary whitespace
    $js = preg_replace('/\/\/.*$/m', '', $js); // Remove single-line comments
    $js = preg_replace('/\/\*.*?\*\//s', '', $js); // Remove multi-line comments
    $js = preg_replace('/\s+/', ' ', $js); // Remove unnecessary whitespace

    return $js;
}
?>
    <title>JavaScript Minifier</title>
</head>
<body>
    <form method="post" enctype="multipart/form-data">
        <label for="js">JavaScript File:</label><br>
        <input type="file" id="js" name="js"><br><br>
        <label for="js_code">JavaScript Code:</label><br>
        <textarea id="js_code" name="js_code" rows="10" cols="50"></textarea><br><br>
        <input type="checkbox" id="output_to_textbox" name="output_to_textbox">
        <label for="output_to_textbox">Output minified JavaScript to textbox</label><br><br>
        <input type="submit" value="Minify JavaScript">
    </form>

_______________________________________________________________

Fetch Dekudeals releases from url (+ price &size)
------------------------------------------



<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $targetURL = $_POST['url']; // Get the URL from the submitted form
    $html = file_get_contents($targetURL);
    $dom = new DOMDocument();
    $dom->loadHTML($html);
    $linkElements = $dom->getElementsByTagName('a');
    $data = [];
    foreach ($linkElements as $index => $linkElement) {
        if ($linkElement->getAttribute('class') === 'main-link') {
            $href = $linkElement->getAttribute('href');
            $absoluteURL = makeAbsoluteURL($targetURL, $href);
            $text = $linkElement->nodeValue;
            $linkHTML = '<a href="' . $absoluteURL . '" target="_blank">' . $text . '</a>';
            $detailsHTML = '';
            $detailsElement = $linkElement->nextSibling;
            while ($detailsElement && $detailsElement->nodeName !== 'ul' && $detailsElement !== $linkElement) {
                $detailsHTML .= $dom->saveHTML($detailsElement);
                $detailsElement = $detailsElement->nextSibling;
            }
            $linkHTMLContent = file_get_contents($absoluteURL);
            $linkDOM = new DOMDocument();
            $linkDOM->loadHTML($linkHTMLContent);
            $downloadSize = '';
            $liElements = $linkDOM->getElementsByTagName('li');
            foreach ($liElements as $liElement) {
                if ($liElement->getAttribute('class') === 'list-group-item') {
                    $strongElement = $liElement->getElementsByTagName('strong')->item(0);
                    if ($strongElement && $strongElement->nodeValue === 'Download size:') {
                        $downloadSize = trim($liElement->textContent);
                        break;
                    }
                }
            }
            $data[] = [
                'Link' => $linkHTML,
                'Details' => $detailsHTML,
                'DownloadSize' => $downloadSize
            ];
        }
    }
    foreach ($data as $item) {
        echo $item['Link'] . '<br>';
        echo $item['Details'] . '<br>';
        echo $item['DownloadSize'] . '<br><br>';
    }
}
function makeAbsoluteURL($baseURL, $relativeURL) {
    $parsedBaseURL = parse_url($baseURL);
    $scheme = $parsedBaseURL['scheme'];
    $host = $parsedBaseURL['host'];
    $basePath = isset($parsedBaseURL['path']) ? $parsedBaseURL['path'] : '';
    if (substr($relativeURL, 0, 2) === '//') {
        return $scheme . ':' . $relativeURL;
    } elseif (substr($relativeURL, 0, 1) === '/') {
        return $scheme . '://' . $host . $relativeURL;
    } else {
        return $scheme . '://' . $host . $basePath . '/' . $relativeURL;
    }
}
?>
 <a href="#" data-url="https://www.dekudeals.com/highest-rated">Highly Rated</a>
  <a href="#" data-url="https://www.dekudeals.com/recently-released">Recently Released</a>
  <a href="#" data-url="https://www.dekudeals.com/recent-drops">Recent Price Drops</a>
  <a href="#" data-url="https://www.dekudeals.com/bang-for-your-buck">Bang for your Buck</a>
  <a href="#" data-url="https://www.dekudeals.com/upcoming-releases">Upcoming Releases</a>
    <form method="POST">
        <input type="text" name="url" placeholder="Enter URL" required>
        <button type="submit">Submit</button>
    </form>
    <?php
    if (isset($data)) {
        foreach ($data as $item) {
            echo $item['Link'] . '<br>';
            echo $item['Details'] . '<br>';
            echo $item['DownloadSize'] . '<br><br>';}}
    ?>
<script>
    //Fill textbox
    var inputElement = document.querySelector('input[name="url"]');
    var linkElements = document.querySelectorAll('a[data-url]');
    linkElements.forEach(function(linkElement) {
      linkElement.addEventListener('click', function(event) {
        event.preventDefault(); // Prevent the default link behavior
        var clickedUrl = linkElement.getAttribute('data-url');
        inputElement.value = clickedUrl; });});
  </script>


_________________________________________


Save mastodon instance emoji to (instance) folder:
---------------------------------------------

<?php
function downloadCustomEmojis($instanceUrl)
{
    $url = $instanceUrl . '/api/v1/custom_emojis';
    $response = file_get_contents($url);
    $emojis = json_decode($response, true);

    // Create a folder for the instance
    $folderName = parse_url($instanceUrl, PHP_URL_HOST);
    $folderPath = __DIR__ . '/' . $folderName;

    if (!file_exists($folderPath)) {
        mkdir($folderPath, 0777, true);
    }
    foreach ($emojis as $emoji) {
        $emojiUrl = $emoji['url'];
        $emojiName = $emoji['shortcode'];
        $extension = pathinfo($emojiUrl, PATHINFO_EXTENSION);
        $filename = $emojiName . '.' . $extension;
        $filepath = $folderPath . '/' . $filename;

        // Download the emoji file
        file_put_contents($filepath, file_get_contents($emojiUrl));

        echo "Downloaded emoji: $filename\n";
    }

    echo "All emojis downloaded successfully!";
}
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $instanceUrl = $_POST['instance_url'];
    downloadCustomEmojis($instanceUrl);
}
?>
<body>
    <h1>Emoji Downloader</h1>
    <form method="POST" action="<?php echo $_SERVER['PHP_SELF']; ?>">
        <label for="instance_url">Instance URL:</label>
        <input type="text" name="instance_url" id="instance_url" required>
        <button type="submit">Download Emojis</button>
    </form>
</body>
</html>

____________________________________

Load php only on button press:
---------------------------

<?php
if (isset($_POST['button_pressed'])) {
//function
}
?>
<form method="post">
    <input type="submit" name="button_pressed" value="Press Me">
</form>

____________________________


Weight tracker:
--------------------------


    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div>
        <label for="userInput">User:</label>
        <input type="text" id="userInput" value="alcea">
        <button id="submitButton">Submit</button>
    </div>
    <div>
        <label for="heightInput">Height (cm):</label>
        <input type="number" id="heightInput" value="183">
    </div>
    <div>
        <label for="birthdateInput">Birthdate:</label>
        <input type="date" id="birthdateInput" value="1991-01-18">
    </div>
    <div>
        <label for="genderInput">Biological Gender:</label>
        <select id="genderInput">
            <option value="female" selected>Female</option>
            <option value="male">Male</option>
        </select>
    </div>
    <canvas id="weightChart"></canvas>
    <canvas id="bmiChart"></canvas>

    <script>
        // Reference to the submit button and user input fields
        var submitButton = document.getElementById('submitButton');
        var userInput = document.getElementById('userInput');
        var heightInput = document.getElementById('heightInput');
        var birthdateInput = document.getElementById('birthdateInput');
        var genderInput = document.getElementById('genderInput');

        // Event listener for the submit button
        submitButton.addEventListener('click', function() {
            var user = userInput.value;
            var url = `https://alcea-wisteria.de/PHP//0demo/00-PHP-Test/${user}_weight.json`;

            // Fetch the JSON data
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    // Extract date, weight, dressed, and time from the JSON data
                    var dates = [];
                    var weights = [];
                    var dressed = [];
                    var time = [];
                    for (var i = 0; i < data.length; i++) {
                        dates.push(data[i].date);
                        weights.push(data[i].weight);
                        dressed.push(data[i].dressed);
                        time.push(data[i].time);
                    }

                    // Calculate BMI for each data point
                    var height = Number(heightInput.value);
                    var birthdate = new Date(birthdateInput.value);
                    var gender = genderInput.value;
                    var bmis = [];
                    for (var i = 0; i < weights.length; i++) {
                        var bmi = calculateBMI(weights[i], height);
                        bmis.push(bmi);
                    }

                    // Create the weight chart using Chart.js
                    var weightCtx = document.getElementById('weightChart').getContext('2d');
                    var weightChart = new Chart(weightCtx, {
                        type: 'line',
                        data: {
                            labels: dates,
                            datasets: [{
                                label: 'Weight',
                                data: weights,
                                borderColor: 'blue',
                                fill: false
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                x: {
                                    display: true,
                                    title: {
                                        display: true,
                                        text: 'Date'
                                    },
                                    reverse: true // Add this line to reverse the x-axis
                                },
                                y: {
                                    display: true,
                                    title: {
                                        display: true,
                                        text: 'Weight'
                                    }
                                }
                            },
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            var label = context.dataset.label || '';
                                            if (label) {
                                                label += ': ';
                                            }
                                            label += context.parsed.y + ' kg';
                                            var dataIndex = context.dataIndex;
                                            if (dressed[dataIndex] && time[dataIndex]) {
                                                label += ', Dressed: ' + dressed[dataIndex] + ', Time: ' + time[dataIndex];
                                            }

                                            // Display BMI in the tooltip
                                            label += ', BMI: ' + bmis[dataIndex];
                                            return label;
                                        }
                                    }
                                }
                            }
                        }
                    });

                    // Create the BMI chart using Chart.js
                    var bmiCtx = document.getElementById('bmiChart').getContext('2d');
                    var bmiChart = new Chart(bmiCtx, {
                        type: 'line',
                        data: {
                            labels: dates,
                            datasets: [{
                                label: 'BMI',
                                data: bmis,
                                borderColor: 'red',
                                fill: false
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                x: {
display: true,
                                        title: {
                                            display: true,
                                            text: 'Date'
                                        },
                                        reverse: true // Add this line to reverse the x-axis
                                    },
                                    y: {
                                        display: true,
                                        title: {
                                            display: true,
                                            text: 'BMI'
                                        },
                                        ticks: {
                                            min: 0,
                                            max: 30
                                        }
                                    }
                                },
                                plugins: {
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                var label = context.dataset.label || '';
                                                if (label) {
                                                    label += ': ';
                                                }
                                                label += context.parsed.y + ' BMI';

                                                // Determine the BMI range
                                                var bmi = context.parsed.y;
                                                var range = getBmiRange(bmi);
                                                label += ' (' + range + ')';
                                                return label;
                                            }
                                        }
                                    }
                                }
                            }
                        });

                        // Function to calculate BMI
                        function calculateBMI(weight, height) {
                            var heightInMeters = height / 100;
                            return weight / (heightInMeters * heightInMeters);
                        }

                        // Function to determine the BMI range
                        function getBmiRange(bmi) {
                            if (bmi < 18.5) {
                                return 'Underweight';
                            } else if (bmi >= 18.5 && bmi < 25) {
                                return 'Normal weight';
                            } else if (bmi >= 25 && bmi < 30) {
                                return 'Overweight';
                            } else {
                                return 'Obese';
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            });

    </script>
</body>
<br><br>
<plaintext>
=======writeweight.php=====
<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Get user input
    $user = isset($_POST['user']) ? $_POST['user'] : '';
    $weight = isset($_POST['weight']) ? $_POST['weight'] : '';
    $dressed = isset($_POST['dressed']) ? $_POST['dressed'] : '';
    $date = isset($_POST['date']) ? $_POST['date'] : '';
    $time = isset($_POST['time']) ? $_POST['time'] : '';

    // Remove ":" from the time value
    $time = str_replace(':', '', $time);

    // Remove decimal places from the weight value
    $weight = intval($weight);

    // Create an associative array with the user data
    $userData = array(
        'user' => $user,
        'weight' => $weight,
        'dressed' => $dressed,
        'date' => $date,
        'time' => $time
    );

    // Read the existing JSON data
    $filename = $user . '_weight.json';
    $existingData = file_get_contents($filename);

    // Decode the JSON data into an associative array
    $existingArray = json_decode($existingData, true);

    // Check if the existing data is an array
    if (!is_array($existingArray)) {
        // Create a new array with the new submission
        $existingArray = array($userData);
    } else {
        // Prepend the new submission to the existing array
        array_unshift($existingArray, $userData);
    }

    // Convert the array back to JSON
    $jsonData = json_encode($existingArray);

    // Save the JSON data to the file
    file_put_contents($filename, $jsonData);

    echo 'Data saved successfully!';
}
?>

<!DOCTYPE html>
<html>
<head>
    <title>User Weight Form</title>
</head>
<body>
    <form method="POST" action="">
        <label for="user">User:</label>
        <input type="text" name="user" id="user" value="aoi" required><br><br>

        <label for="weight">Weight (kg):</label>
        <input type="text" name="weight" id="weight" required><br><br>

        <label for="dressed">Dressed:</label>
        <select name="dressed" id="dressed" required>
            <option value="dressed">Dressed</option>
            <option value="notdressed">Not Dressed</option>
        </select><br><br>

        <label for="date">Date:</label>
        <input type="text" name="date" id="date" value="<?php echo date('Y-m-d'); ?>" required><br><br>

        <label for="time">Time:</label>
        <input type="text" name="time" id="time" value="<?php echo date('H:i'); ?>" required><br><br>

        <input type="submit" value="Submit">
    </form>
</body>
</html>



_________________________


Fake Social Media Feed Writer
----------------------------------

====post.php=======

<?php
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    // Retrieve the value from the textbox
    $value = $_POST["textbox"];
    // Retrieve the user from the URL query string
    $user = $_GET["user"];
    // Get the current date in Yyyymmdd format
    $date = date("Ymd");
    // Create an array with the new value and date
    $newData = array($date => array("value" => $value));

    // Extract hashtags from the post text
    $hashtags = array();
    preg_match_all('/#(\w+)/', $value, $matches);
    if (!empty($matches[1])) {
        $hashtags = $matches[1];
    }
    // Add the hashtags to the new data array
    if (!empty($hashtags)) {
        $newData[$date]["hashtags"] = implode(", ", $hashtags);
    }
    // Read the existing JSON data from the file
    $filename = "data_" . $user . ".json";
    if (file_exists($filename)) {
        $existingData = json_decode(file_get_contents($filename), true);
    } else {
        $existingData = array();
    }
    // Prepend the new data to the existing data
    array_unshift($existingData, $newData);
    // Save the updated data to the file
    file_put_contents($filename, json_encode($existingData, JSON_PRETTY_PRINT));
}
?>
<!DOCTYPE html>
<html>
<head>
    <title>Save to JSON</title>
</head>
<body>
    <form method="post" action="<?php echo $_SERVER["PHP_SELF"] . "?user=" . $_GET["user"]; ?>">
        <label for="textbox">Enter Value:</label>
        <br>
        <textarea id="textbox" name="textbox" rows="4" cols="50"></textarea>
        <br>
        <input type="submit" value="Save">
    </form>
</body>
</html>
<?php
$user = $_GET['user'];
$uniqueId = uniqid();
$iframeSrc = "data_{$user}.json?v={$uniqueId}";
echo '<iframe src="' . $iframeSrc . '" style="border:0px #ffffff none;" name="statusit" scrolling="no" frameborder="0" marginheight="0px" marginwidth="0px" height="250px" width="800" allowfullscreen></iframe>';
?>


=====render.html========

<hr>
<div id="container"></div>
<script>
  const urlParams = new URLSearchParams(window.location.search);
  const limit = urlParams.get("limit") || "15";
  const baseurl = "https://alcea-wisteria.de/z_files/emoji";
  function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param)}
  const user = getQueryParam('user');
  if (user) {
    //const jsonFile = `/other/extra/scripts/fakesocialmedia/data_${user}.json`;
    const jsonFile = `/other/extra/scripts/fakesocialmedia/data_${user}.json?t=${Date.now()}`;
    fetch(jsonFile)
      .then(response => response.json())
      .then(jsonData => {
        const container = document.getElementById('container');
        jsonData.slice(0, limit).forEach(obj => {
          const date = Object.keys(obj)[0];
          const innerObj = obj[date];
          const value = innerObj.value;
          const hashtags = innerObj.hashtags;
          const postElement = document.createElement('div');
          postElement.classList.add('post');
          const dateElement = document.createElement('p');
          dateElement.textContent = `Date: ${date}`;
          const valueElement = document.createElement('p');
          valueElement.innerHTML = `<img src=https://alcea-wisteria.de/z_files/emoji/${user}.png width=100px><br>@<a target="_blank" href="/other/extra/scripts/fakesocialmedia/render_limited.html?user=${user}" style="color:pink">${user}</a>: ${replaceEmojis(value).replace(/(https?:\/\/[^\s]+)/g, (match) => {
            if (match.includes('pixiv.net')) {
              const pixivRegex = /https?:\/\/(?:www\.)?pixiv\.net\/(?:en\/)?artworks\/(\d+)/;
              const pixivMatch = match.match(pixivRegex);
              if (pixivMatch) {
                const artworkId = pixivMatch[1];
                return `<div><img src="https://embed.pixiv.net/decorate.php?illust_id=${artworkId}&mode=sns-automator" width="50%"></div><br><a href="${match}" target="_blank">${match}</a>`;
              }}
           if (match.endsWith('.gif') || match.endsWith('.png') || match.endsWith('.webp') ||match.endsWith('.jpg') || match.endsWith('.jpeg')) {
          let imageWidth = "50%"; // Default width
          if (match.includes("emoji")) {
           imageWidth = "45px"; // Resize width to 45x45 cause these are emoji from the function to replace shorthandtext
            }
            const imageElement = `<img src="${match}" width="${imageWidth}" alt="${match}">`;
            if (match.includes(`${baseurl}`)) {
            return imageElement;
            } else {
            return `${imageElement}<br><a href="${match}" target="_blank">${match}</a>`;}}
            return `<a href="${match}" target="_blank">${match}</a>`;
          }).replace(/\n/g, '<br>')}`;
          const hashtagsElement = document.createElement('p');
          hashtagsElement.textContent = `Hashtags: ${hashtags}`;
          postElement.appendChild(dateElement);
          postElement.appendChild(valueElement);
          postElement.appendChild(hashtagsElement);

        // Comment href
          const buttonElement = document.createElement('button');
buttonElement.classList.add('btn');
const buttonText = value.slice(0, 25) || 'btn'; // Use 'btn' if value is empty or less than 25 characters
buttonElement.textContent = 'Comment';
// buttonElement.href = `/other/extra/scripts/fakesocialmedia/comment.php?text=${encodeURIComponent(buttonText)}`; // Commented out the href
buttonElement.addEventListener('click', () => {
  // Add click event handler to button
  window.open(`/other/extra/scripts/fakesocialmedia/comment.php?text=${encodeURIComponent(buttonText)}`, '_blank');
});
postElement.appendChild(buttonElement);



          // Comment href2
          const buttonElement2 = document.createElement('a');
          buttonElement2.classList.add('btn2');
          const buttonText2 = value.slice(0, 25) || 'btn'; // Use 'btn' if value is empty or less than 25 characters
          buttonElement2.textContent = '(load comments)';
          buttonElement2.href = `/other/extra/scripts/fakesocialmedia/commentload.html?text=${encodeURIComponent(buttonText2)}`;
          buttonElement2.target = "_blank"; // Open the link in a new tab
          postElement.appendChild(buttonElement2);


          if (value.includes('youtube.com') && !value.includes('youtube.com/shorts')) {
            const videoEmbed = document.createElement('iframe');
            videoEmbed.src = `https://super8.absturztau.be/embed/${getVideoId(value)}`;videoEmbed.width = '560';videoEmbed.height = '315';videoEmbed.frameborder = '0';videoEmbed.allowfullscreen = 'true';videoEmbed.setAttribute('allowfullscreen', '');postElement.appendChild(videoEmbed);}
          container.appendChild(postElement);
          const separatorElement = document.createElement('hr');
          container.appendChild(separatorElement);
        });
      })
  } else {
    const element = document.createElement('div');
    element.textContent = 'No user specified (?user=user)';
    document.body.appendChild(element);
  }
  function getVideoId(url) {
    const videoIdMatch = url.match(/(?:\/embed\/|v=|v\/|vi\/|youtu\.be\/|\/v\/|\/e\/|\/u\/\w\/|\/embed\/|\/v=|\/e=|\/u\/\w\/|\/vi\/)([^#\&\?]*).*/);
    return videoIdMatch[1];}
  function replaceEmojis(text) {
    return text.replace(/:(\w+):/g, (match, emoji) => {
      return `${baseurl}/${emoji}.gif`;
    });}
</script>


====emojikb.php====

<?php
$url = "https://alcea-wisteria.de/z_files/emoji/";
$html = file_get_contents($url);
preg_match_all('/<a href=[\'"](.*?\.gif)[\'"]/i', $html, $matches);
$gifUrls = $matches[1];
$gridSize = 5; // Number of columns in the grid
$count = 0;
echo "<table>";
echo "<tr>";
foreach ($gifUrls as $gifUrl) {
    $filename = basename($gifUrl);
    echo '<td><a href="javascript:void(0);" onclick="insertEmoji(\'' . $filename . '\');"><img src="https://alcea-wisteria.de/z_files/emoji/' . $filename . '" width=30></a></td>';
    $count++;
    if ($count % $gridSize == 0) {
        echo "</tr><tr>";
    }
}
echo "</tr>";
echo "</table>";
?>
<script>
function insertEmoji(emoji) {
    var textarea = document.getElementById('textarea');
    textarea.value += ':' + emoji.split('.')[0] + ':';
}
</script>
(See:  https://alcea-wisteria.de/PHP//0demo/2024-02-18-Fake-SocialMedia/emoji.php
 https://alcea-wisteria.de/PHP//0demo/2024-02-18-Fake-SocialMedia/post+emoji.php)


~~~Load only 15 results mod ~~

const urlParams = new URLSearchParams(window.location.search);
  const limit = urlParams.get("limit") || "15";
  const baseurl = "https://alcea-wisteria.de/z_files/emoji";
  function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param)
  }
  const user = getQueryParam('user');
  if (user) {
    const jsonFile = `data_${user}.json`;
    fetch(jsonFile)
      .then(response => response.json())
      .then(jsonData => {
        const container = document.getElementById('container');
        jsonData.slice(0, limit).forEach(obj => {  // Limiting to 15 entries
          const date = Object.keys(obj)[0];
          const innerObj = obj[date];
          const value = innerObj.value;
          const hashtags = innerObj.hashtags;
          const postElement = document.createElement('div');
          postElement.classList.add('post');


(Src: https://codeberg.org/alceawisteria/Fake-Social-MediaWriter )


===comment.php==

<?php
if (file_exists('comments.json')) {
    $existingData = json_decode(file_get_contents('comments.json'), true);
} else {
    $existingData = array();
}
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $text = $_GET['text'];
    $value = $_POST['value'];
    array_unshift($existingData, array(
        'text' => $text,
        'value' => $value
    ));
    $jsonData = json_encode($existingData, JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES);
    file_put_contents('comments.json', $jsonData);
}
?>
    <h2>Add a Comment</h2>
    <form method="post">
        <label for="text">Target:</label>
        <input type="text" id="text" name="text" value="<?php echo $_GET['text']; ?>">
        <br>
        <label for="value">Value:</label>
        <textarea id="value" name="value" cols="25" rows="15"></textarea>
        <br>
        <button type="submit">Submit</button>
    </form>
    <!---<script>
        document.getElementById('textDisplay').textContent = '<?php echo $_GET['text']; ?>';
    </script>-->





====commentload.html====


  <h1>Source Post: <span id="sourcepost"></span></h1>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    .post {
      background-color: white;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
    }

    .date {
      color: #888;
      font-size: 14px;
      margin-bottom: 10px;
    }

    .content {
      font-size: 16px;
      margin-bottom: 10px;
    }

    .hashtags {
      font-size: 14px;
      color: #555;
    }

    .tag {
      margin-right: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Fake Social Media</h1>
    <div id="results"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      fetch('/other/extra/scripts/fakesocialmedia/data_alcea.json')
        .then(response => response.json())
        .then(data => {
          const urlParams = new URLSearchParams(window.location.search);
          const queryText = urlParams.get('text');
          const matches = data.slice(0, 15).filter(entry => {
            const date = Object.keys(entry)[0];
            return entry[date].value.includes(queryText);
          });
          const resultsContainer = document.getElementById('results');
          if (resultsContainer) {
            matches.forEach(match => {
              const date = Object.keys(match)[0];
              const postContent = match[date].value;
              const hashtags = match[date].hashtags.split(', ');
              const postElement = document.createElement('div');
              postElement.classList.add('post');
              const dateElement = document.createElement('p');
              dateElement.classList.add('date');
              dateElement.textContent = date;

              const contentElement = document.createElement('p');
              contentElement.classList.add('content');
              contentElement.textContent = postContent;

              const hashtagsElement = document.createElement('div');
              hashtagsElement.classList.add('hashtags');
              hashtags.forEach(tag => {
                const tagElement = document.createElement('span');
                tagElement.classList.add('tag');
                tagElement.textContent = `#${tag}`;
                hashtagsElement.appendChild(tagElement);
              });
              postElement.appendChild(dateElement);
              postElement.appendChild(contentElement);
              postElement.appendChild(hashtagsElement);
              resultsContainer.appendChild(postElement);
            });
          } else {
            console.error('Error: Results container not found.');
          }
        })
        .catch(error => {
          console.error('Error fetching data:', error);
        });
    });
  </script>




  <h2>Comments</h2>
  <div id="comments"></div>

  <script>
    function fetchAndDisplayComments() {
      const urlParams = new URLSearchParams(window.location.search);
      const text = urlParams.get('text');
      const sourcepost = urlParams.get('sourcepost');
      const jsonUrl = '/other/extra/scripts/fakesocialmedia/comments.json?v=' + Date.now();
      fetch(jsonUrl)
        .then(response => response.json())
        .then(data => {
          const matchingComments = data.filter(comment => comment.text.includes(text));

          const sourcepostElement = document.getElementById('sourcepost');


          const commentsDiv = document.getElementById('comments');
          matchingComments.forEach(comment => {
            const commentElement = document.createElement('div');
            commentElement.textContent = comment.value;
            commentsDiv.appendChild(commentElement);
          });
        })
        .catch(error => {
          console.error('Error fetching comments:', error);
        });
    }
    window.onload = fetchAndDisplayComments;
  </script>
</body>
</html>


______________________



Fetch popular mastodon posts
---------------------------------

<style>
  .container {
    display: flex;
  }
  .post-box {
    border: 1px solid #ccc;
    padding: 10px;
    margin-right: 10px;
    display: flex;
    align-items: center;
    width: 500px;
    height: 250px;
  }
  .post-avatar {
    width: 80px;
    height: 80px;
    margin-right: 10px;
    border-radius: 50%;
    object-fit: cover;
  }
  .post-content {
    font-size: 14px;
    margin-bottom: 5px;
    overflow: hidden;
    text-overflow: ellipsis;
    max-height: 200px;
    max-width: 100%;
    white-space: normal;
  }
  .post-link {
    font-size: 12px;
    color: blue;
  }
</style>
<?php
$instances = ['kopimi.space', 'pb.todon.de', 'urusai.social', 'mastodon.social'];
$totalPostsPerInstance = 10;
echo '<div class="container">';
foreach ($instances as $instance) {
  $apiUrl = 'https://' . $instance . '/api/v1/timelines/public';
  $params = [
    'local' => true,
    'only_media' => false,
    'limit' => $totalPostsPerInstance,
    'max_id' => null
  ];
  $sortedPosts = [];
  while (count($sortedPosts) < $totalPostsPerInstance) {
    $queryString = http_build_query($params);
    $requestUrl = $apiUrl . '?' . $queryString;
    $response = file_get_contents($requestUrl);
    $posts = json_decode($response);
    if ($posts) {
      foreach ($posts as $post) {
        $content = $post->content;
        $favouritesCount = $post->favourites_count;
        $boostsCount = $post->reblogs_count;
        $url = $post->url;
        if (!$post->account->bot) {
          if ($favouritesCount >= 2 || $boostsCount >= 2) {
            $replyCount = $post->replies_count;
            $sortedPosts[] = [
              'content' => $content,
              'favouritesCount' => $favouritesCount,
              'boostsCount' => $boostsCount,
              'replyCount' => $replyCount,
              'url' => $url,
              'avatar' => $post->account->avatar_static
            ];
          }
        }
        if (count($sortedPosts) >= $totalPostsPerInstance) {
          break 2;
        }
      }
    } else {
      echo 'Error retrieving posts from ' . $instance . '.';
      break;
    }
    $lastPost = end($posts);
    $params['max_id'] = $lastPost->id;
  }
  usort($sortedPosts, function ($a, $b) {
    $aCount = max($a['favouritesCount'], $a['boostsCount']);
    $bCount = max($b['favouritesCount'], $b['boostsCount']);
    return $bCount - $aCount;
  });
  foreach ($sortedPosts as $post) {
    $content = $post['content'];
    $favouritesCount = $post['favouritesCount'];
    $boostsCount = $post['boostsCount'];
    $replyCount = $post['replyCount'];
    $postUrl = $post['url'];
    $avatarUrl = $post['avatar'];
    echo '<div class="post-box">';
    echo '<img class="post-avatar" src="' . $avatarUrl . '" alt="User Avatar"><br>';
    echo '<div>';
    echo '<div class="post-content">' . $content . '</div>';
    echo '<div class="counts">';
    echo '<span>F: ' . $favouritesCount . '</span><br>';
    echo '<span>B: ' . $boostsCount . '</span><br>';
    echo '<span>R: ' . $replyCount . '</span><br>'; // Display the number of replies
    echo '</div>';
    echo '<div class="post-link"><a target="_blank" href="' . $postUrl . '">View Post</a></div>';
    echo '</div>';
    echo '</div>';
  }
}
echo '</div>';
?>

_________________________________

Add friends (saves to html)
----------------------------


<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Get the values from the text boxes
    $text0 = isset($_POST['text0']) ? $_POST['text0'] : '';
    $text1 = isset($_POST['text1']) ? $_POST['text1'] : '';
    $text2 = isset($_POST['text2']) ? $_POST['text2'] : '';
    $text3 = isset($_POST['text3']) ? $_POST['text3'] : '';
    $text4 = isset($_POST['text4']) ? $_POST['text4'] : '';
    // Check if any of the text fields contain '<' or '>'
    if (strpos($text0, '<') !== false || strpos($text0, '>') !== false ||
        strpos($text1, '<') !== false || strpos($text1, '>') !== false ||
        strpos($text2, '<') !== false || strpos($text2, '>') !== false ||
        strpos($text3, '<') !== false || strpos($text3, '>') !== false ||
        strpos($text4, '<') !== false || strpos($text4, '>') !== false) {
        echo "Invalid input in one or more text fields. Please remove '<' or '>' characters.";
    } else {
        $html = $text0 . ' - <a target="_blank" href="' . $text1 . '"><img src="' . $text2 . '" style="width:45px;"></a><span class="smart-hover" title="' . $text3 . '"><u>' . $text4 . '</u></span><style>.smart-hover:hover::after{content:attr(title);}</style><br>' . PHP_EOL;
        $friendHtmlFile = 'friends.html';
        $existingContent = file_get_contents($friendHtmlFile);
        $newContent = $html . $existingContent;
        file_put_contents($friendHtmlFile, $newContent);
        echo "HTML code has been prepended with $text4's entry!";
    }
}
$currentDate = date("Y-m-d");
?>
<html>
<head>
    <title>Friends from the future</title>
</head>
<body>
    <form method="POST" action="">
        <input type="text" name="text0" placeholder="date" value="<?php echo $currentDate; ?>"><br>
        <input type="text" name="text1" placeholder="url"><br>
        <input type="text" name="text2" placeholder="pfp img url"><br>
        <input type="text" name="text3" placeholder="description"><br>
        <input type="text" name="text4" placeholder="name"><br>
        <input type="submit" value="Submit">
    </form>
</body>
</html>
<a href="/favs.html" style=color:red>Lookin good today !</a><br><br>
<!--<iframe src="/other/extra/personal/friends/friends.html" style="border:0px #ffffff none;" name="statusit" scrolling="no" frameborder="0" marginheight="0px" marginwidth="0px" height=100% width="800" allowfullscreen></iframe>-->
<iframe src="<?php echo '/other/extra/personal/friends/friends.html?v=' . uniqid(); ?>" style="border:0px #ffffff none;" name="statusit" scrolling="no" frameborder="0" marginheight="0px" marginwidth="0px" height=100% width="800" allowfullscreen></iframe>


<!--AppendVer--
PD9waHAKaWYgKCRfU0VSVkVSWydSRVFVRVNUX01FVEhPRCddID09PSAnUE9TVCcpIHsKICAgIC8vIEdldCB0aGUgdmFsdWVzIGZyb20gdGhlIHRleHQgYm94ZXMKICAgICR0ZXh0MSA9IGlzc2V0KCRfUE9TVFsndGV4dDEnXSkgPyAkX1BPU1RbJ3RleHQxJ10gOiAnJzsKICAgICR0ZXh0MiA9IGlzc2V0KCRfUE9TVFsndGV4dDInXSkgPyAkX1BPU1RbJ3RleHQyJ10gOiAnJzsKICAgICR0ZXh0MyA9IGlzc2V0KCRfUE9TVFsndGV4dDMnXSkgPyAkX1BPU1RbJ3RleHQzJ10gOiAnJzsKICAgICR0ZXh0NCA9IGlzc2V0KCRfUE9TVFsndGV4dDQnXSkgPyAkX1BPU1RbJ3RleHQ0J10gOiAnJzsKICAgICRodG1sID0gJzxhIHRhcmdldD0iX2JsYW5rIiBocmVmPSInIC4gJHRleHQxIC4gJyI+PGltZyBzcmM9IicgLiAkdGV4dDIgLiAnIiBzdHlsZT0id2lkdGg6NDVweDsiPjwvaW1nPjwvYT48c3BhbiBjbGFzcz0ic21hcnQtaG92ZXIiIHRpdGxlPSInIC4gJHRleHQzIC4gJyI+ICA8dT4nIC4gJHRleHQ0IC4gJzwvdT48L3NwYW4+PHN0eWxlPi5zbWFydC1ob3Zlcjpob3Zlcjo6YWZ0ZXJ7Y29udGVudDphdHRyKHRpdGxlKTt9PC9zdHlsZT48YnI+JzsKICAgICRmcmllbmRIdG1sRmlsZSA9ICdmcmllbmRzLmh0bWwnOwogICAgZmlsZV9wdXRfY29udGVudHMoJGZyaWVuZEh0bWxGaWxlLCAkaHRtbCwgRklMRV9BUFBFTkQpOwogICAgLy8gT3V0cHV0IGEgc3VjY2VzcyBtZXNzYWdlCiAgICBlY2hvICJIVE1MIGNvZGUgaGFzIGJlZW4gYXBwZW5kZWQgdG8geW91ciBmcmllbmQncyBIVE1MIGZpbGUhIjsKfQo/Pgo8aHRtbD4KPGhlYWQ+CiAgICA8dGl0bGU+U3VibWl0IEZvcm08L3RpdGxlPgo8L2hlYWQ+Cjxib2R5PgogICAgPGZvcm0gbWV0aG9kPSJQT1NUIiBhY3Rpb249IiI+CiAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIG5hbWU9InRleHQxIiBwbGFjZWhvbGRlcj0idXJsIj48YnI+CiAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIG5hbWU9InRleHQyIiBwbGFjZWhvbGRlcj0icGZwIGltZyB1cmwiPjxicj4KICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgbmFtZT0idGV4dDMiIHBsYWNlaG9sZGVyPSJkZXNjcmlwdGlvbiI+PGJyPgogICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBuYW1lPSJ0ZXh0NCIgcGxhY2Vob2xkZXI9Im5hbWUiPjxicj4KICAgICAgICA8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iU3VibWl0Ij4KICAgIDwvZm9ybT4KPC9ib2R5Pgo8L2h0bWw+Cg==
-->

____________________________

TextEditor
-----------

<?php
$currentDir = __DIR__; // Get the current directory

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $selectedFile = $_POST['selectedFile'];
    $content = $_POST['content'];
    $filename = basename($selectedFile);

    if (!empty($selectedFile) && !empty($content)) {
        file_put_contents($filename, $content); // Save the modified content back to the file
        echo "File saved successfully!";
    }
}

$files = array_diff(scandir($currentDir), array('.', '..')); // Get the list of files excluding "." and ".."

echo "<form method='POST'>";
echo "<select name='selectedFile'>";

foreach ($files as $file) {
    if (pathinfo($file, PATHINFO_EXTENSION) === 'txt') {
        echo "<option value='$file'>$file</option>";
    }
}

echo "</select>";
echo "<input type='submit' value='Load File'>";
echo "</form>";

if (isset($_POST['selectedFile'])) {
    $selectedFile = $_POST['selectedFile'];
    $filename = basename($selectedFile);

    if (file_exists($filename)) {
        $content = file_get_contents($filename);
        $escapedContent = htmlspecialchars($content);
        echo "<br>";
        echo "<form method='POST'>";
        echo "<textarea name='content' rows='120' cols='120'>$escapedContent</textarea><br>";
        echo "<input type='hidden' name='selectedFile' value='$selectedFile'>";
        echo "<input type='submit' value='Save'>";
        echo "</form>";
    }
}
?>

______________


PHP version htaccess version chck + changer (subfolders one dir up)
---------------------------

<?php
$parentDirectory = dirname(__DIR__); // Get the parent directory
$folders = scandir($parentDirectory); // Get all folders within the parent directory
echo '<table>';
echo '<tr><th>Folder</th><th>.htaccess</th><th>PHP Version</th></tr>';
foreach ($folders as $folder) {
    if ($folder === '.' || $folder === '..' || !is_dir($parentDirectory . '/' . $folder)) {
        continue; // Skip current and parent directory and non-folders
    }
    $folderPath = $parentDirectory . '/' . $folder; // Get the full path of the folder
    $htaccessPath = $folderPath . '/.htaccess';
    $htaccessExists = file_exists($htaccessPath);
    $phpVersion = '';
    if ($htaccessExists) {
        $htaccessContents = file_get_contents($htaccessPath);
        preg_match('/AddHandler\s+application\/x-httpd-php(\d+)\s+\.php/', $htaccessContents, $matches);
        if (isset($matches[1])) {
            $phpVersion = $matches[1];
        }
    }
    // Fallback to default PHP version if line not found
    if (empty($phpVersion)) {
        $phpVersion = phpversion();
    }
    $folderUrl = 'http://' . $_SERVER['HTTP_HOST'] . dirname(dirname($_SERVER['REQUEST_URI'])) . '/' . basename($folderPath);
    echo '<tr>';
    echo '<td><a target="_blank" href="' . htmlspecialchars($folderUrl) . '" target="_blank">' . htmlspecialchars($folder) . '</a></td>';
    echo '<td>' . ($htaccessExists ? '<span style="color: green;">Exists</span>' : '<span style="color: gray;">[no .htaccess found]</span>') . '</td>';
    echo '<td><a target="_blank" href="change.php?folder=' . urlencode($folder) . '">' . ($phpVersion ? $phpVersion : '[unknown]') . '</a></td>';
    echo '</tr>';
}
echo '</table>';
?>

======change.php====

<?php
$folder = isset($_GET['folder']) ? $_GET['folder'] : '';
$currentDir = __DIR__;
$baseDir = dirname($currentDir);
$combinedPath = $baseDir . '/' . $folder;
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $phpVersion = $_POST['php_version'];
    $phpVersion2 = substr_replace($phpVersion, "", -1);
    $handlerLine = "AddHandler application/x-httpd-php{$phpVersion} .php .php{$phpVersion2}";
    $htaccessFile = $combinedPath . '/.htaccess';
    $htaccessContent = file_get_contents($htaccessFile);
    if (strpos($htaccessContent, $handlerLine) === false) {
        // Append the handler line to the .htaccess file
        file_put_contents($htaccessFile, PHP_EOL . $handlerLine, FILE_APPEND);
        $message = "PHP version $phpVersion has been added to the .htaccess file in the folder: $combinedPath";
    } else {
        $message = "PHP version $phpVersion already exists in the .htaccess file in the folder: $combinedPath";
    }
}
?>
    <?php if (isset($message)) : ?>
        <p><?php echo $message; ?></p>
    <?php endif; ?>
    <form action="" method="POST">
        <label for="php_version">Select PHP Version:</label>
        <select name="php_version" id="php_version">
            <option value="56">PHP 5.6</option>
            <option value="70">PHP 7.0</option>
            <option value="71">PHP 7.1</option>
            <option value="72">PHP 7.2</option>
            <option value="73">PHP 7.3</option>
            <option value="74">PHP 7.4</option>
            <option value="80">PHP 8.0</option>
            <option value="81">PHP 8.1</option>
        </select>
        <br><br>
        <label for="folder">Select Folder:</label>
        <input type="text" name="folder" id="folder" placeholder="Enter folder path" value="<?php echo htmlspecialchars($folder); ?>">
        <br><br>
        <input type="submit" value="Submit">
    </form>
</body>
</html>

____________________________________

Filesize in Folder checker (+ dld)
------------------------------------

<?php
function getFolderSize($folderPath) {
    $totalSize = 0;
    $files = glob(rtrim($folderPath, '/') . '/*');
    foreach ($files as $file) {
        if (is_file($file)) {
            $totalSize += filesize($file);
        }
        if (is_dir($file)) {
            $totalSize += getFolderSize($file);
        }
    }
    return $totalSize;
}
$currentDir = __DIR__;
if (isset($_POST['submit'])) {
    $selectedFolders = $_POST['folders'];
    $fileLists = [];
    foreach ($selectedFolders as $folder) {
        $folderPath = $currentDir . '/' . $folder;
        //$files = glob($folderPath . '/*.txt');
        $files = glob($folderPath . '/*');
        $fileNames = array_map('basename', $files);
        $fileLists[$folder] = $fileNames;
    }
    echo '<table>';
    echo '<tr>';
    echo '<th>File Name</th>';
    // Display folder names as table headers
    foreach ($selectedFolders as $folder) {
        echo '<th>' . $folder . '</th>';
    }
    echo '</tr>';
    $allFiles = array_reduce($fileLists, 'array_merge', []);
    $uniqueFiles = array_unique($allFiles);
    foreach ($uniqueFiles as $fileName) {
        echo '<tr>';
        echo '<td>' . $fileName . '</td>';
        $firstFolder = $selectedFolders[0];
        $firstFolderPath = $currentDir . '/' . $firstFolder;
        $firstFilePath = $firstFolderPath . '/' . $fileName;
        $firstFileSize = file_exists($firstFilePath) ? filesize($firstFilePath) : 0;
        foreach ($selectedFolders as $folder) {
            $folderPath = $currentDir . '/' . $folder;
            $filePath = $folderPath . '/' . $fileName;
            if (file_exists($filePath)) {
                $fileSize = filesize($filePath);
                echo '<td>';
                if ($fileSize === $firstFileSize) {
                    echo '<a target="_blank" href="" style=color:green>[OK]</a>';
                } elseif ($fileSize > $firstFileSize) {
                    echo '<a target="_blank" href="" style=color:darkgreen>[OK - GREATER]</a>';
                } else {
                    echo '<a target="_blank" href="" style=color:red>[NO - LESSER]</a>';
                }
                echo ' ' . $fileSize . ' bytes</td>';
            } else {
                echo '<td>-</td>'; // Display "-" for missing files
            }
        }
        echo '</tr>';
    }
    echo '</table>';
}
// Get the folders in the current directory
$folders = array_filter(glob('*'), 'is_dir');
echo '<form method="post">';
foreach ($folders as $index => $folder) {
    $checked = ($index === 0) ? 'checked' : '';
    echo '<input type="checkbox" name="folders[]" value="' . $folder . '" ' . $checked . '>' . $folder . '<br>';
    $folderPath = $currentDir . '/' . $folder;
    $folderSize = getFolderSize($folderPath);
    echo '<input type="hidden" name="folder_sizes[' . $folder . ']" value="' . $folderSize . '">';
}
echo '<input type="submit" name="submit" value="Submit">';
echo '</form>';
?>
<a target="_blank" href="download.php" style=color:transparent>DLD</a>

=====download.php===

<?php
$html = file_get_contents('https://url');
$pattern = '/<tr>(.*?)<\/tr>/s';
preg_match_all($pattern, $html, $matches);
$urls = array();
foreach ($matches[1] as $match) {
    preg_match('/<a href="(.*?)">/', $match, $urlMatch);
    if (isset($urlMatch[1])) {
        $url = $urlMatch[1];
        if (pathinfo($url, PATHINFO_EXTENSION) === "txt") {
            $urls[] = 'https://alceawis.de' . $url;
        }
    }
}
$destinationFolder = date("Y-m-d");
if (!is_dir($destinationFolder)) {
    mkdir($destinationFolder);
}
$downloadedFiles = array();
foreach ($urls as $url) {
    $fileName = basename($url);
    $destinationPath = $destinationFolder . '/' . $fileName;
    file_put_contents($destinationPath, file_get_contents($url));
    $downloadedFiles[] = $destinationPath;
}
echo '<ul>';
foreach ($downloadedFiles as $filePath) {
    echo '<li><a href="' . $filePath . '">' . basename($filePath) . '</a></li>';
}
echo '</ul>';
echo 'Download completed.';
?>


_______________________


Youtube / YT channel latest video via API to autoscroll html:
---------------------------------------------

https://alcea-wisteria.de/PHP//0demo/2023-06-17-YT-Tools/API-RSS-Save/save-feed.php?channelid=UCrltGih11A_Nayz6hG5XtIw&apikey=insertapikeyhere4&save

<?php
$API_KEY = $_GET['apikey'] ?? ''; // Extract the apiKey from the query string
if (empty($API_KEY)) {
  echo 'No apiKey provided';
  exit;
}
$channelId = $_GET['channelid'] ?? ''; // Extract the channelId from the query string
if (empty($channelId)) {
  echo 'No channelId provided';
  exit;
}
$MAX_RESULTS = 15;
$url = "https://www.googleapis.com/youtube/v3/search?key={$API_KEY}&channelId={$channelId}&part=snippet,id&order=date&maxResults={$MAX_RESULTS}";
$response = file_get_contents($url);
if ($response === false) {
  echo 'Error fetching videos';
  exit;
}
$data = json_decode($response, true);
if (!isset($data['items'])) {
  echo 'No videos found';
  exit;
}
$pageOutput = '';
foreach ($data['items'] as $item) {
  $videoId = $item['id']['videoId'];
  $title = $item['snippet']['title'];
  $link = "https://www.youtube.com/watch?v={$videoId}";
  $pageOutput .= "<a href='{$link}' target='_blank'>{$title}</a><br><br>";
}
if (isset($_GET['save'])) {
  // Read the contents of autoscroll.html
  $autoscrollContent = file_get_contents('autoscroll.html');
  // Replace "INJECT" with the current page output
  $modifiedContent = str_replace('INJECT', $pageOutput, $autoscrollContent);
  // Save the modified content to a new file
  $filename = "rss-scrolling-source-{$channelId}.html";
  file_put_contents($filename, $modifiedContent);
  echo "Modified content saved to {$filename}";
} else {
  // Output the page content
  echo $pageOutput;
}
?>


__________________

Fetch shoutcast trackinfo via querystring:
----------------------------------

<?php
function getStreamMetadata() {
    if (isset($_GET['streamurl'])) {
        $streamUrl = $_GET['streamurl'];
        $needle = 'StreamTitle=';
        $ua = 'Dailymate Radio/1.0';
        $opts = ['http' => ['method' => 'GET',
        'header' => 'Icy-MetaData: 1',
        'user_agent' => $ua]
                ];
        $context = stream_context_create($opts);
        $icyMetaIntFound = false;
        $icyInterval = -1;
        $offset = 0;
        if(($headers = get_headers($streamUrl, 0, $context))) {
            foreach($headers as $h) {
                if(!(strpos(strtolower($h), 'icy-metaint:') === false)) {
                    $icyMetaIntFound = true;
                    $icyInterval = explode(':', $h)[1];
                    break;
                }
            }
        }
        if(!$icyMetaIntFound) {
            echo "icy-metaint header not exists!";
            return;
        }
        if($stream = fopen($streamUrl, 'r', false, $context)) {
            while($buffer = stream_get_contents($stream, $icyInterval, $offset)) {
                if(strpos($buffer, $needle) !== false) {
                    fclose($stream);
                    $title = explode($needle, $buffer)[1];
                    return substr($title, 1, strpos($title, ';') - 2);
                }
                $offset += $icyInterval;
            }
        }
    } else {
        // The 'streamurl' parameter is not set
    }
}
echo getStreamMetadata();
?>

_______________________

Wikipedia tabel parser (with column data copoy function):
-------------------------------------------------

<a target="_blank" href="?tablecolumn=Firm&tablecontent=Nintendo" style=color:blue>txmpl</a><br><br>
<?php
header('Content-Type: text/html; charset=utf-8');
$url = 'https://en.m.wikipedia.org/wiki/List_of_best-selling_game_consoles';
$html = file_get_contents($url);
$table_regex = '/<table[^>]*class="wikitable sortable"[^>]*>(.*?)<\/table>/s';
if (preg_match($table_regex, $html, $matches)) {
    $table_html = $matches[0];
    $column = $_GET['tablecolumn'] ?? '';
    $content = $_GET['tablecontent'] ?? '';
    if (!empty($column) && !empty($content)) {
        $filtered_table_html = filterTable($table_html, $column, $content);
        if ($filtered_table_html) {
            echo $filtered_table_html;
        } else {
            echo 'No matching rows found.';
        }
    } else {
        echo $table_html;
    }
    addCopyButtons();
} else {
    echo 'Table not found.';
}
function filterTable($tableHtml, $column, $content)
{
    $dom = new DOMDocument();
    libxml_use_internal_errors(true);
    $dom->loadHTML(mb_convert_encoding($tableHtml, 'HTML-ENTITIES', 'UTF-8'));
    libxml_clear_errors();
    $xpath = new DOMXPath($dom);
    $rows = $xpath->query('//table/tbody/tr');
    $columnIndex = -1;
    $headerRow = $rows->item(0);
    $headerCells = $headerRow->getElementsByTagName('th');
    foreach ($headerCells as $index => $cell) {
        if (trim($cell->nodeValue) === $column) {
            $columnIndex = $index;
            break;
        }
    }
    $filteredRows = [];
    foreach ($rows as $row) {
        $cells = $row->getElementsByTagName('td');
        $cellContent = $cells->item($columnIndex)->nodeValue;
        if (stripos($cellContent, $content) !== false) {
            $filteredRows[] = $row;
        }
    }
    // Build the filtered table HTML
    $filteredTableHtml = '<table class="wikitable sortable">';
    $filteredTableHtml .= $headerRow->ownerDocument->saveHTML($headerRow);
    foreach ($filteredRows as $row) {
        $filteredTableHtml .= $row->ownerDocument->saveHTML($row);
    }
    $filteredTableHtml .= '</table>';

    return count($filteredRows) > 0 ? $filteredTableHtml : false;
}
function addCopyButtons() {
    $dom = new DOMDocument();
    libxml_use_internal_errors(true);
    global $table_html;
    $dom->loadHTML($table_html);
    libxml_clear_errors();
    $xpath = new DOMXPath($dom);
    $headerRow = $xpath->query('//table/tbody/tr[1]')->item(0);
    $headerCells = $headerRow->getElementsByTagName('th');
    echo '<div>';
    foreach ($headerCells as $index => $cell) {
        $columnName = trim($cell->nodeValue);
        echo '<button onclick="copyColumnData(' . $index . ')">Copy ' . $columnName . '</button>';
    }
    echo '</div>';
}
?>
<script>
// Function to copy the column data to the clipboard
function copyColumnData(columnIndex) {
  var table = document.querySelector('.wikitable');
  var columnData = '';
  var rows = table.getElementsByTagName('tr');
  for (var i = 0; i < rows.length; i++) {
    var row = rows[i];
    var cells = row.getElementsByTagName('td');
    var cell = cells[columnIndex];
    if (cell) {
      columnData += cell.innerText.trim() + '\n';
    }
  }
  navigator.clipboard.writeText(columnData);
  //alert('Column data copied to clipboard.');
}
</script>


______________________________

Add <br> tags to nonconf html files in folder:
--------------------------------------------

<?php
$currentFolder = './'; // Update this to the path of the current folder
// Check if a file was uploaded
if (isset($_FILES['htmlFile']) && $_FILES['htmlFile']['error'] === UPLOAD_ERR_OK) {
    $uploadedFile = $_FILES['htmlFile']['tmp_name'];
    $fileName = $_FILES['htmlFile']['name'];
    $fileSize = $_FILES['htmlFile']['size'];

    // Check if the file size is within the allowed limit (1MB)
    $maxFileSize = 1024 * 1024; // 1MB in bytes
    if ($fileSize <= $maxFileSize) {
        // Move the uploaded file to the current folder
        $destination = $currentFolder . $fileName;
        move_uploaded_file($uploadedFile, $destination);
        echo "File uploaded successfully: $fileName<br>";
    } else {
        echo "File size exceeds the maximum allowed limit (1MB)<br>";
    }
}
$files = glob($currentFolder . '*.html'); // Get all HTML files in the current folder
// Sort the files by modified time (newest first)
usort($files, function ($a, $b) {
    return filemtime($b) - filemtime($a);
});
// Get the three newest HTML files
$newestFiles = array_slice($files, 0, 3);
// Display the file list
echo '<h3>Latest HTML Files:</h3>';
echo '<ul>';
foreach ($newestFiles as $file) {
    echo '<li><a href="?file=' . urlencode($file) . '">' . basename($file) . '</a></li>';
}
echo '</ul>';
// Check if a file is clicked and add <br> tags to it
if (isset($_GET['file'])) {
    $clickedFile = $_GET['file'];
    if (in_array($clickedFile, $newestFiles)) {
        $content = file_get_contents($clickedFile); // Read the file content
        // Check if the file does not contain a <br> tag
        if (strpos($content, '<br>') === false) {
            $modifiedContent = str_replace("\n", "<br>\n", $content); // Add <br> tag to each line
            file_put_contents($clickedFile, $modifiedContent); // Write the modified content back to the file
            echo "Added <br> tags to $clickedFile<br>";
        } else {
            echo "The file $clickedFile already contains <br> tags<br>";
        }
    } else {
        echo "Invalid file clicked<br>";
    }
}
?>
<!-- HTML form for file upload -->
<h3>Upload HTML File:</h3>
<form method="POST" enctype="multipart/form-data">
    <input type="file" name="htmlFile" accept=".html" required>
    <input type="hidden" name="MAX_FILE_SIZE" value="1048576"> <!-- 1MB in bytes -->
    <button type="submit">Upload</button>
</form>



___________________________

Visualize past programming efforts (php):
-----------------------------------------

<?php
$url = "https://alcea-wisteria.de/PHP/0demo/";
$html = file_get_contents($url);
//$pattern = '/<tr>(.*?)<\/tr>/s'; //timestamp based
$pattern = '/<td data-sort="([^"]*)"/'; //filename based
preg_match_all($pattern, $html, $matches);
$dates = array();
foreach ($matches[0] as $match) {
    preg_match('/\d{4}-\d{2}-\d{2}/', $match, $date);
    if (!empty($date)) {
        $dates[] = $date[0];
    }
}
// Count the occurrences of each month-year combination
$counts = array();
foreach ($dates as $date) {
    $monthYear = substr($date, 0, 7); // Extract the yyyy-mm part
    if (isset($counts[$monthYear])) {
        $counts[$monthYear]++;
    } else {
        $counts[$monthYear] = 1;
    }
}
// Fill in months with no entries and set their count to 0
$startDate = min(array_keys($counts));
$endDate = date('Y-m'); // Get the current month-year
$currentDate = $startDate;
while ($currentDate != $endDate) {
    if (!isset($counts[$currentDate])) {
        $counts[$currentDate] = 0;
    }
    $currentDate = date('Y-m', strtotime($currentDate . ' +1 month'));
}
// Sort the month-year combinations by year and then month
ksort($counts);
// Prepare the data for the chart
$labels = array_keys($counts);
$data = array_values($counts);
?>
<!DOCTYPE html>
<html>
<head>
    <title>Date Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <canvas id="myChart"></canvas>
    <script>
        // Create the chart
        var ctx = document.getElementById('myChart').getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: <?php echo json_encode($labels); ?>,
                datasets: [{
                    label: 'Date Counts',
                    data: <?php echo json_encode($data); ?>,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        stepSize: 1
                    }
                }
            }
        });
    </script>
</body>


________________________

Simple (UrlValueBased) Comment System:
---------------------------------

<===========NormalSubmitVersion=============>
<div id="comments"></div>
<br>
<form action="" method="POST" id="commentForm">
  <input type="text" name="name" placeholder="Your Name"><br>
  <textarea name="comment" rows="4" cols="50"></textarea>
  <input type="hidden" name="jsonFilename" value="" id="jsonFilenameInput">
  <input type="submit" value="Submit"><br>
</form>
<script>
  window.addEventListener("DOMContentLoaded", function() {
//    fetch('comments.txt')
//      .then(response => response.text())
//      .then(data => {
//        urlbase = data.trim(); // Assign the value to urlbase
//      })
    var urlbase = "https://alcea-wisteria.de/PHP/0demo/2024-02-05-UrlValueBasedCommentSystem/";
    var url = window.location.href;
    var jsonFilename = url.replace(/[^A-Za-z0-9]/g, "") + ".json";
    var jsonUrl = urlbase + jsonFilename;
    document.getElementById("jsonFilenameInput").value = jsonFilename;
    document.getElementById("commentForm").action = urlbase + "submit_comment.php";
    fetch(jsonUrl)
      .then(response => response.json())
      .then(data => {
        if (Array.isArray(data)) {
          data.reverse();
          data.forEach(entry => {
            var comment = entry.comment;
            var name = entry.name;
            renderComment(name, comment);
          });
        } else {
          console.log("No comments found for the current URL.");
        }
      })
      .catch(error => {
        console.log("Error fetching JSON file:", error);
      });
  });
  function renderComment(name, comment) {
    var commentsElement = document.getElementById("comments");
    var commentElement = document.createElement("div");
    commentElement.innerHTML = "<strong>" + name + "</strong>: " + comment;
    commentsElement.appendChild(commentElement);
  }
</script>


<=======UrlSubmitVersion=======>
PGRpdiBpZD0iY29tbWVudHMiPjwvZGl2Pgo8aHI+Cjxmb3JtIGFjdGlvbj0iIiBtZXRob2Q9IlBPU1QiIGlkPSJjb21tZW50Rm9ybSI+CiAgICA8aW5wdXQgdHlwZT0idGV4dCIgbmFtZT0ibmFtZSIgcGxhY2Vob2xkZXI9IlN0YXRpb24gTmFtZSI+PGJyPgogICAgIDx0ZXh0YXJlYSBuYW1lPSJjb21tZW50IiByb3dzPSIxIiBjb2xzPSI1MCIgcGxhY2Vob2xkZXI9InN0cmVhbSBodHRwczovLyB1cmwiPjwvdGV4dGFyZWE+CiAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0ianNvbkZpbGVuYW1lIiB2YWx1ZT0iIiBpZD0ianNvbkZpbGVuYW1lSW5wdXQiPgogIDxpbnB1dCB0eXBlPSJzdWJtaXQiIHZhbHVlPSJTdWJtaXQiIG9uY2xpY2s9InJldHVybiBzdWJtaXRfY29tbWVudCgpIj48YnI+CjwvZm9ybT4KPHNjcmlwdD4KICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIGZ1bmN0aW9uKCkgewogICAgdmFyIHVybGJhc2UgPSAiaHR0cHM6Ly9hbGNlYS13aXN0ZXJpYS5kZS9QSFAvMGRlbW8vMjAyNC0wMi0wNS1VcmxWYWx1ZUJhc2VkQ29tbWVudFN5c3RlbS8iOwogICAgdmFyIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmOwogICAgdmFyIGpzb25GaWxlbmFtZSA9IHVybC5yZXBsYWNlKC9bXkEtWmEtejAtOV0vZywgIiIpICsgIi5qc29uIjsKICAgIHZhciBqc29uVXJsID0gdXJsYmFzZSArIGpzb25GaWxlbmFtZTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJqc29uRmlsZW5hbWVJbnB1dCIpLnZhbHVlID0ganNvbkZpbGVuYW1lOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbW1lbnRGb3JtIikuYWN0aW9uID0gdXJsYmFzZSArICJzdWJtaXRfY29tbWVudC5waHAiOwogICAgZmV0Y2goanNvblVybCkKICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKQogICAgICAudGhlbihkYXRhID0+IHsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSkgewogICAgICAgICAgZGF0YS5yZXZlcnNlKCk7CiAgICAgICAgICBkYXRhLmZvckVhY2goZW50cnkgPT4gewogICAgICAgICAgICB2YXIgY29tbWVudCA9IGVudHJ5LmNvbW1lbnQ7CiAgICAgICAgICAgIHZhciBuYW1lID0gZW50cnkubmFtZTsKICAgICAgICAgICAgcmVuZGVyQ29tbWVudChuYW1lLCBjb21tZW50KTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLmxvZygiTm8gY29tbWVudHMgZm91bmQgZm9yIHRoZSBjdXJyZW50IFVSTC4iKTsKICAgICAgICB9CiAgICAgIH0pCiAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgY29uc29sZS5sb2coIkVycm9yIGZldGNoaW5nIEpTT04gZmlsZToiLCBlcnJvcik7CiAgICAgIH0pOwogIH0pOwogIGZ1bmN0aW9uIHJlbmRlckNvbW1lbnQobmFtZSwgY29tbWVudCkgewogICAgdmFyIGNvbW1lbnRzRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb21tZW50cyIpOwogICAgdmFyIGNvbW1lbnRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBjb21tZW50RWxlbWVudC5pbm5lckhUTUwgPSAiPHN0cm9uZz4iICsgbmFtZSArICI8L3N0cm9uZz46ICIgKyBjb21tZW50OwogICAgY29tbWVudHNFbGVtZW50LmFwcGVuZENoaWxkKGNvbW1lbnRFbGVtZW50KTsKICB9CiAgZnVuY3Rpb24gc3VibWl0X2NvbW1lbnQoKSB7CiAgdmFyIG5hbWVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9Im5hbWUiXScpOwogIHZhciBuYW1lVmFsdWUgPSBuYW1lSW5wdXQudmFsdWU7CgogIHZhciBjb21tZW50SW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCd0ZXh0YXJlYVtuYW1lPSJjb21tZW50Il0nKTsKICB2YXIgY29tbWVudFZhbHVlID0gY29tbWVudElucHV0LnZhbHVlOwoKICAvLyBDaGVjayBpZiB0aGUgbmFtZSBmaWVsZCBjb250YWlucyAiPCIgYW5kIHRoZSBjb21tZW50IGZpZWxkIGluY2x1ZGVzICJodHRwIgogIGlmIChuYW1lVmFsdWUuaW5jbHVkZXMoJzwnKSB8fCAhY29tbWVudFZhbHVlLmluY2x1ZGVzKCdodHRwJykpIHsKICAgIGFsZXJ0KCdJbnZhbGlkIGlucHV0OiBQbGVhc2UgbWFrZSBzdXJlIHRoZSBOYW1lIGZpZWxkIGRvZXMgbm90IGNvbnRhaW4gIjwiIGFuZCB0aGUgQ29tbWVudCBmaWVsZCBpbmNsdWRlcyAiaHR0cCIuJyk7CiAgICByZXR1cm4gZmFsc2U7IC8vIFByZXZlbnQgZm9ybSBzdWJtaXNzaW9uCiAgfQoKICAvLyBJZiBhbGwgdmFsaWRhdGlvbnMgcGFzcywgcHJvY2VlZCB3aXRoIHRoZSBleGlzdGluZyBsb2dpYwogIGNvbW1lbnRJbnB1dC52YWx1ZSA9ICc8YSBocmVmPSIjIiBvbmNsaWNrPSJkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcJ3VybElucHV0XCcpLnZhbHVlID0gXCcnICsgY29tbWVudFZhbHVlICsgJ1wnOyByZXR1cm4gZmFsc2U7Ij4nICsgY29tbWVudFZhbHVlICsgJzwvYT4nOwogIHJldHVybiB0cnVlOyAvLyBBbGxvdyBmb3JtIHN1Ym1pc3Npb24KfQo8L3NjcmlwdD4K


====submit_comment.php===

<?php
if ($_SERVER["REQUEST_METHOD"] === "POST") {
  $url = $_SERVER["HTTP_REFERER"]; // Get the current URL
  $filename = preg_replace("/[^A-Za-z0-9]/", "", $url); // Remove non-alphanumeric characters from the URL
  $name = $_POST["name"]; // Get the submitted name
  $comment = $_POST["comment"]; // Get the submitted comment
  $jsonFilename = $_POST["jsonFilename"]; // Get the submitted jsonFilename
  // Read the existing JSON data from the file
  $existingData = file_get_contents($jsonFilename);
  $existingJson = json_decode($existingData, true);
  if (!$existingJson) {
    // If the JSON file doesn't exist or is not valid JSON, create an empty array
    $existingJson = [];
  }
  // Create a new data entry with the submitted name and comment
  $newData = array(
    "name" => $name,
    "comment" => $comment
  );
  // Append the new data to the existing JSON data
  $existingJson[] = $newData;
  // Encode the merged data as JSON
  $json = json_encode($existingJson);
  // Write the updated JSON back to the file
  file_put_contents($jsonFilename, $json);
  echo "<a href=javascript:history.back()>[View Comment]</a>";
}
?>


====.htaccess======
Header set Access-Control-Allow-Origin "*"
Header set Access-Control-Allow-Methods "GET,PUT,POST,DELETE"
Header set Access-Control-Allow-Headers "Content-Type, Authorization"



____________________

Simple PHP Gallery:
---------------------------------

======index.php=====
<?php
$galleriesPath = "./galleries";
$galleries = array_filter(glob($galleriesPath . '/*'), 'is_dir');
echo '<div style="display: grid; grid-template-columns: repeat(5, 1fr); grid-gap: 10px;">';
foreach ($galleries as $gallery) {
    $images = glob($gallery . '/*.{jpg,jpeg,png,gif}', GLOB_BRACE);
    $newestImage = end($images);
    $galleryName = basename($gallery);
    $displayUrl = 'display.php?gallery=' . urlencode($galleryName);
    echo '<a href="' . $displayUrl . '" style="text-decoration: none; color: inherit;">';
    echo '<div style="text-align: center;">';
    $isNSFW = stripos($galleryName, 'nsfw') !== false;
    // Apply blur if the image is NSFW
    $imageStyle = $isNSFW ? 'filter: blur(10px);' : '';
    echo '<img src="' . $newestImage . '" alt="' . $galleryName . '" width="250" height="250" style="margin-bottom: 5px;' . $imageStyle . '">';
    echo '<div>' . $galleryName . '</div>';
    echo '</div>';
    echo '</a>';
}
echo '</div>';
?>



===display.php====
<a href="<?php echo dirname($_SERVER['REQUEST_URI']); ?>"><img src="https://www.downloadclipart.net/large/19185-back-button-design.png" style="width:40px;" /></a>
<?php
// Retrieve the gallery name from the query string
$galleryName = $_GET['gallery'];
$galleryPath = './galleries/' . $galleryName;
$images = glob($galleryPath . '/*.{jpg,jpeg,png,gif}', GLOB_BRACE);
// Custom sort function to sort images by basename
usort($images, function($a, $b) {
    $basenameA = pathinfo($a, PATHINFO_FILENAME);
    $basenameB = pathinfo($b, PATHINFO_FILENAME);
    return strcmp($basenameB, $basenameA);
});
$numColumns = 5;
$numImages = count($images);
$numRows = ceil($numImages / $numColumns);
echo '<div style="display: grid; grid-template-columns: repeat(' . $numColumns . ', 1fr); grid-gap: 10px;">';
foreach ($images as $key => $image) {
    echo '<div style="display: flex; flex-direction: column; align-items: center;">';
    echo '<img src="' . $image . '" alt="' . basename($image) . '" style="width: 250px; height: 250px; object-fit: cover; cursor: pointer;" onclick="openPopup(' . $key . ');" loading="lazy">';
    echo '<div style="text-align: center;">' . basename($image) . '</div>';
    echo '</div>';
}
echo '</div>';
?>
<!-- CSS Popup -->
<style>
    .popup {
        display: none;
        position: fixed;
        z-index: 9999;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.9);
    }
    .popup-image {
        display: block;
        max-width: 90%;
        max-height: 80%;
        margin: 50px auto;
    }
    .popup-close {
        position: absolute;
        top: 10px;
        right: 10px;
        color: #000;
        cursor: pointer;
        font-size: 24px;
    }
    .popup-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: #000;
        font-size: 30px;
    }
    .popup-prev,
    .popup-next {
        padding: 20px;
        cursor: pointer;
    }
</style>
<!-- JavaScript -->
<script>
    var currentImageIndex = 0;
    var images = <?php echo json_encode($images); ?>;
    function openPopup(index) {
        currentImageIndex = index;
        var popup = document.getElementById('popup');
        var popupImage = document.getElementById('popup-image');
        popupImage.src = images[currentImageIndex];
        popup.style.display = 'block';
    }
    function closePopup() {
        var popup = document.getElementById('popup');
        popup.style.display = 'none';
    }
    function showPrevImage() {
        currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
        var popupImage = document.getElementById('popup-image');
        popupImage.src = images[currentImageIndex];
    }
    function showNextImage() {
        currentImageIndex = (currentImageIndex + 1) % images.length;
        var popupImage = document.getElementById('popup-image');
        popupImage.src = images[currentImageIndex];
    }
</script>
<!-- HTML Popup -->
<div id="popup" class="popup">
    <span class="popup-close" onclick="closePopup()">&times;</span>
    <div class="popup-nav">
        <span class="popup-prev" onclick="showPrevImage()">&#10094;</span>
        <span class="popup-next" onclick="showNextImage()">&#10095;</span>
    </div>
    <img id="popup-image" class="popup-image" src="" alt="">
</div>


=====upload.php===
    <div class="image-preview" id="imagePreview"></div>
    <style>
        .gallery-picker {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 300px;
        }
        .image-preview {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 400px;
            width: 1000px;
            border: 1px solid #ccc;
            margin-top: 20px;
        }
        .image-preview img {
            max-width: 100%;
            max-height: 100%;
        }
    </style>
</head>
<body>
    <div class="gallery-picker">
        <form action="upload.php" method="post" enctype="multipart/form-data">
            <select name="gallery">
                <?php
                $galleriesPath = 'galleries/';
                $folders = array_filter(glob($galleriesPath . '*'), 'is_dir');
                foreach ($folders as $folder) {
                    $folderName = basename($folder);
                    echo "<option value='$folderName'>$folderName</option>";
                }
                ?>
            </select>
            <input type="file" name="image" accept="image/*" onchange="previewImage(event)">
            <input type="submit" value="Upload">
        </form>
    </div>
    <script>
        function previewImage(event) {
            var reader = new FileReader();
            reader.onload = function() {
                var imgElement = document.createElement('img');
                imgElement.src = reader.result;
                document.getElementById('imagePreview').innerHTML = '';
                document.getElementById('imagePreview').appendChild(imgElement);
            }
            reader.readAsDataURL(event.target.files[0]);
        }
    </script>
    <?php
    if ($_SERVER['REQUEST_METHOD'] === 'POST') {
        $gallery = $_POST['gallery'];
        $targetDirectory = $galleriesPath . $gallery . '/';
        $targetFile = $targetDirectory . basename($_FILES['image']['name']);
        $uploadSuccess = move_uploaded_file($_FILES['image']['tmp_name'], $targetFile);

        if ($uploadSuccess) {
            echo "<p>Image uploaded successfully.</p>";
        } else {
            echo "<p>Failed to upload image.</p>";
        }
    }
    ?>
</body>



_________________

Display htaccess:
-----------------------------

<?php
$htaccessPath = '.htaccess';
exists
if (file_exists($htaccessPath)) {
    $htaccessContent = file_get_contents($htaccessPath);
    echo "<pre>{$htaccessContent}</pre>";
} else {
    echo "The .htaccess file does not exist.";
}
?>

__________________________


Last played gamewriter
---------------------------

example link: https://alcea-wisteria.de/PHP/0demo/2024-01-14-Lastplayed/lastplayed.php?gamename=title<br><br>

<?php
$currentContent = file_get_contents('current.html');
$targetContent = file_get_contents('oldentries.html');
$updatedContent = $currentContent . $targetContent;
$linkpattern = '/<a\b[^>]*>(.*?)<\/a>/'; //remove link
$replacement = '';
$updatedContent = preg_replace($linkpattern, $replacement, $updatedContent);
file_put_contents('oldentries.html', $updatedContent);
?>
<?php
if(isset($_GET['gamename'])) {
    $gamename = $_GET['gamename'];
    $currentDateTime = date('Y-m-d H:i:s');
    $htmlContent = '<u>LastPlayed:</u> ' . $gamename . ' - (' . $currentDateTime . ') <a target="_blank" href="oldentries.html" style="color:gray">(old)</a><br>';
    file_put_contents('current.html', $htmlContent);
    //echo "Successfully updated current.html with the game name: $gamename and current date and time.";
    // Output the iframe with cache busting
    echo "<iframe src='current.html?" . time() . "' style='width: 100%; border: none;'></iframe>";
} else {
    echo "<iframe src='current.html?" . time() . "' style='width: 100%; border: none;'></iframe>";
}
?>

_________________


Fetch Fediverse Usercount:
-------------------------------------------

<?php
$url¬†=¬†'https://api.fedidb.org/v1/stats';
$response¬†=¬†file_get_contents($url);
if¬†($response¬†!==¬†false)¬†{
¬†¬†¬†¬†$data¬†=¬†json_decode($response,¬†true);
¬†¬†¬†¬†if¬†($data¬†!==¬†null)¬†{
¬†¬†¬†¬†¬†¬†¬†¬†//¬†Access¬†the¬†data¬†and¬†render
¬†¬†¬†¬†¬†¬†¬†¬†$totalUsers¬†=¬†$data['total_users'];
¬†¬†¬†¬†¬†¬†¬†¬†$activeUsers¬†=¬†$data['monthly_active_users'];
¬†¬†¬†¬†¬†¬†¬†¬†$totalPosts¬†=¬†$data['total_statuses_str'];
¬†¬†¬†¬†¬†¬†¬†¬†echo¬†"Total¬†Users:¬†$totalUsers<br>";
¬†¬†¬†¬†¬†¬†¬†¬†echo¬†"Active¬†Users:¬†$activeUsers<br>";
¬†¬†¬†¬†¬†¬†¬†¬†echo¬†"Total¬†Posts:¬†$totalPosts<br>";
¬†¬†¬†¬†}¬†else¬†{
¬†¬†¬†¬†¬†¬†¬†¬†echo¬†"Error:¬†Failed¬†to¬†decode¬†JSON¬†response.";
¬†¬†¬†¬†}
}¬†else¬†{
¬†¬†¬†¬†echo¬†"Error:¬†Failed¬†to¬†fetch¬†data¬†from¬†the¬†API¬†endpoint.";
}
?>

____________________________

Render textfile in style /(Parse and display *.txt as hyperlink html: (Delimiter: "https://")
--------------------------------------
<?php
$file = fopen('xnotes.txt', 'r');
if ($file) {
    while (($line = fgets($file)) !== false) {
        $line = trim($line);
        $parts = explode('https://', $line, 2);
        $title = $parts[0];
        $url = 'https://' . $parts[1];
        echo "<a href=\"$url\" target=\"_blank\">$title</a><br>";
    }
    fclose($file);
} else {
    echo 'Failed to open the file.';
}
?>


---Example txt--
YGO VRAINS: https://alcea-wisteria.de/PHP/xnotes/view.php?s-1705150073-e73eae915bceecad0f0413c3e6b713b0
Windows OS: https://alcea-wisteria.de/PHP/xnotes/view.php?s-1705150108-854bffd31ca032a51c3e06536ddbe493

__________________


Xnotes (evernote / nimbusnotes clone):
-----------------------------------------------------------
https://github.com/Xtrendence/X-Notes
=>
https://codeload.github.com/Xtrendence/X-Notes/zip/refs/heads/master 

______________________________________


PHP Gamedatabase (with html renderer):
-------------------------------------------

=================gamedb.php========
<!DOCTYPE html>
<html>
<head>
    <title>Sortable Table</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            text-align: left;
            padding: 8px;
        }
        th {
            cursor: pointer;
        }
        input[type="text"] {
            width: 100%;
            padding: 5px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <?php
    // Function to write table data to a file
    function writeDataToFile($data, $filename) {
        $file = fopen($filename, 'w');
        fwrite($file, json_encode($data));
        fclose($file);
    }
    // Function to read table data from a file
    function readDataFromFile($filename) {
        if (file_exists($filename)) {
            $data = file_get_contents($filename);
            return json_decode($data, true);
        }
        return [];
    }
    // Database file name
    $dbFile = 'gamedb.json';
    // Check if a new entry is submitted
    if (isset($_POST['submit'])) {
        $newEntry = [
            'Gamename' => $_POST['gamename'],
            'System' => $_POST['system'],
            'Vendor' => $_POST['vendor'],
            'Comment' => $_POST['comment'],
            'Rating' => $_POST['rating'],
            'Description' => $_POST['description'],
            'link' => $_POST['link']
        ];
        // Read existing data from file
        $games = readDataFromFile($dbFile);
        // Add the new entry
        $games[] = $newEntry;
        // Write the updated data to file
        writeDataToFile($games, $dbFile);
    } else {
        // Read data from file
        $games = readDataFromFile($dbFile);
    }
    ?>
    <table>
        <tr>
            <th onclick="sortTable(0)">Gamename</th>
            <th onclick="sortTable(1)">System</th>
            <th onclick="sortTable(2)">Vendor</th>
            <th onclick="sortTable(3)">Comment</th>
            <th onclick="sortTable(4)">Rating</th>
            <th onclick="sortTable(5)">Description</th>
            <th onclick="sortTable(6)">Link</th>
        </tr>
        <?php foreach ($games as $game): ?>
            <tr>
                <td><?php echo $game['Gamename']; ?></td>
                <td><?php echo $game['System']; ?></td>
                <td><?php echo $game['Vendor']; ?></td>
                <td><?php echo $game['Comment']; ?></td>
                <td><?php echo $game['Rating']; ?></td>
                <td><?php echo $game['Description']; ?></td>
                <td><?php echo $game['link']; ?></td>
            </tr>
        <?php endforeach; ?>
    </table>
    <form method="post" action="">
        <input type="text" name="gamename" placeholder="Gamename" required>
        <input type="text" name="system" placeholder="System" required>
        <input type="text" name="vendor" placeholder="Vendor" required>
        <input type="text" name="comment" placeholder="Comment" required>
        <input type="text" name="rating" placeholder="Rating" required>
        <input type="text" name="description" placeholder="Description" required>
        <input type="text" name="link" placeholder="Link" required>
        <input type="submit" name="submit" value="Add Entry">
    </form>
    <script>
    // Function to sort the table
    function sortTable(columnIndex) {
        var table, rows, switching, i, x, y, shouldSwitch;
        table = document.getElementsByTagName("table")[0];
        switching = true;
        while (switching) {
            switching = false;
            rows = table.rows;
            for (i = 1; i < (rows.length - 1); i++) {
                shouldSwitch = false;
                x = rows[i].getElementsByTagName("td")[columnIndex];
                y = rows[i + 1].getElementsByTagName("td")[columnIndex];
                if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                    shouldSwitch = true;
                    break;
                }
            }
            if (shouldSwitch) {
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
            }
        }
    }
    // Add event listeners to table headers for sorting
    var headers = document.getElementsByTagName("th");
    for (var i = 0; i < headers.length; i++) {
        headers[i].addEventListener("click", function () {
            var columnIndex = Array.from(this.parentNode.children).indexOf(this);
            sortTable(columnIndex);
        });
    }
</script>
</body>
</html>


======html json renderer====
<style>
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #f2f2f2;
      cursor: pointer;
    }
    th::after {
      content: "";
      display: inline-block;
      margin-left: 5px;
    }
    .asc::after {
      content: "^";
    }
    .desc::after {
      content: "v";
    }
  </style>
</head>
<body>
  <table id="gameTable">
    <thead>
      <tr>
        <th onclick="sortTable(0)">Game Name</th>
        <th onclick="sortTable(1)">System</th>
        <th onclick="sortTable(2)">Vendor</th>
        <th onclick="sortTable(3)">Comment</th>
        <th onclick="sortTable(4)">Rating</th>
        <th onclick="sortTable(5)">Description</th>
        <th onclick="sortTable(6)">Link</th>
      </tr>
    </thead>
    <tbody id="gameTableBody"></tbody>
  </table>
  <script>
    let sortingOrder = {};
    // Function to fetch the JSON data and populate the table
    function fetchGameData() {
      fetch('gamedb.json')
        .then(response => response.json())
        .then(data => {
          const gameTableBody = document.getElementById('gameTableBody');
          gameTableBody.innerHTML = '';
          data.forEach(game => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${game.Gamename}</td>
              <td>${game.System}</td>
              <td>${game.Vendor}</td>
              <td>${game.Comment}</td>
              <td>${game.Rating}</td>
              <td>${game.Description}</td>
              <td><a href="${game.link}">Link</a></td>
            `;
            gameTableBody.appendChild(row);
          });
        })
        .catch(error => {
          console.error('Error:', error);
        });
    }
    // Function to sort the table based on the selected column
    function sortTable(columnIndex) {
      const table = document.getElementById('gameTable');
      const rows = Array.from(table.rows).slice(1); // Exclude the table header row
      const asc = sortingOrder[columnIndex] === 'asc';
      rows.sort((a, b) => {
        const cellA = a.cells[columnIndex].textContent.toLowerCase();
        const cellB = b.cells[columnIndex].textContent.toLowerCase();
        return asc ? cellA.localeCompare(cellB) : cellB.localeCompare(cellA);
      });
      table.tBodies[0].append(...rows);
      // Update sortingOrder for the current column
      sortingOrder = {};
      sortingOrder[columnIndex] = asc ? 'desc' : 'asc';
      // Update CSS classes for sorting indicators
      const ths = table.tHead.rows[0].cells;
      ths.forEach(th => th.classList.remove('asc', 'desc'));
      ths[columnIndex].classList.add(sortingOrder[columnIndex]);
    }
    // Fetch the game data when the page loads
    fetchGameData();
  </script>
</body>
</html>



___________________________

Check Files & Folders against txt (integrity check):
-----------------------------------------

<details><a target="_blank" href="z_listgen.php" style=color:blue>Refresh list</a></details><br><br>
<?php
$reportPath = './z_list.txt';
$reportContent = file_get_contents($reportPath);
$currentDir = getcwd();
$reportFiles = explode("\n", $reportContent);
$fileCount = 0;
$folderCount = 0;
$okCount = 0;
$missingCount = 0;
$files = [];
$folders = [];
foreach ($reportFiles as $filename) {
    if (empty($filename)) {
        continue;
    }
    if (is_dir($filename)) {
        $folderCount++;
        $folders[] = $filename;
        continue;
    }
    if ($filename === 'error_log' || $filename === 'alceawis.de.zip') {
        continue;
    }
    if (file_exists($filename)) {
        $fileCount++;
        $okCount++;
        $files[] = '<span style="color: green;">[ok]</span> <a href="' . $filename . '" target="_blank">' . $filename . '</a>';
    } else {
        $missingCount++;
        $files[] = '<span style="color: red;">[missing]</span> ' . $filename;
    }
}
foreach (scandir($currentDir) as $filename) {
    if ($filename[0] === '.' || is_dir($filename) || $filename === 'z_listcheck.php' ) {
        continue;
    }
    if ($filename === 'error_log' || $filename === 'alceawis.de.zip') {
        continue;
    }
    if (!in_array($filename, $reportFiles)) {
        $fileCount++;
        $missingCount++;
        $files[] = '<span style="color: red;">[missing]</span> ' . $filename;
    }
}
foreach ($folders as $folder) {
    echo '<span style="color: green;">[ok]</span> <a href="' . $folder . '" target="_blank">' . $folder . '</a><br>';
}
foreach ($files as $file) {
    echo $file . '<br>';
}
echo '<p>Total Files: ' . $fileCount . ' Total Folders: ' . $folderCount . '</p>';
echo '<hr>';
echo '<p>Number [ok]: ' . $okCount;
if ($okCount === $fileCount) {
    echo ' (all)';
}
echo '</p>';
echo '<p>Number of missing: ' . $missingCount . '</p>';
?>

====z_listgen.php===

<?php
// Get the current directory
$directory = __DIR__;
// Open the file for writing
$file = fopen('z_list.txt', 'w');
// Get all files and directories in the current directory
$items = scandir($directory);
// Iterate through each item
foreach ($items as $item) {
    // Exclude current and parent directory entries
    if ($item !== '.' && $item !== '..') {
        // Check if the item is a directory
        if (is_dir($directory . DIRECTORY_SEPARATOR . $item)) {
            // Write directory name to the file
            fwrite($file, $item . PHP_EOL);
        } else {
            // Write file name to the file
            fwrite($file, $item . PHP_EOL);
        }
    }
}
// Close the file
fclose($file);
echo 'File list generated and saved to z_list.txt.';
?>


__________________________

Find AnimexxUser+ (Artcount)
---------------------------

<a target="_blank" href="?artistname=Nudelchen" style=color:lightgray>custom</a><br>
<?php
$url = 'https://www.animexx.de/fanart/zeichner/A/';
if (isset($_GET['artistname'])) {
    $artistname = $_GET['artistname'];
    $firstLetter = strtoupper(substr($artistname, 0, 1));
    $url = str_replace('/zeichner/A/', '/zeichner/' . $firstLetter . '/', $url);
} else {
    $artistname = 'Alcea';
}
$html = file_get_contents($url);
$pattern = '/<b><a href="\/fanart\/zeichner\/\d+\/">' . $artistname . '<\/a><\/b> \(\d+\)/';
preg_match_all($pattern, $html, $matches);
if (!empty($matches[0])) {
    $artistLines = $matches[0];
    $parsedUrl = parse_url($url);
    $domain = $parsedUrl['scheme'] . '://' . $parsedUrl['host'];
    foreach ($artistLines as $line) {
        // Prepend the domain to the href attribute within the $line
        $line = str_replace('href="/', 'href="' . $domain . '/', $line);
        $line = str_replace('<a ', '<a target="_blank" ', $line);
        echo $line . "<br>";
    }
} else {
    echo "No matching lines found for '{$artistname}'.";
}
?>

_________________


Fetch all pixiv user artwork links:
----------------------

<a target="_blank" href="?userId=18233080" style="color:blue">custom</a> <a target="_blank" href="?random" style="color:blue">(Random)</a><br>
<div id="linkCount"></div><br>
<?php
function getPixivUserArt($userId, $random) {
    $apiUrl = "https://www.pixiv.net/ajax/user/{$userId}/profile/all?useid={$userId}";
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $apiUrl);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_HEADER, false);
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
    $response = curl_exec($ch);
    curl_close($ch);
    $data = json_decode($response, true);
    if (isset($data['body']['illusts'])) {
        $artworks = $data['body']['illusts'];
        $numLinks = 0; // Variable to keep track of the number of links
        if ($random) {
            // Get a random artwork
            $randomArtId = array_rand($artworks);
            $randomArt = $artworks[$randomArtId];
            $artLink = "https://www.pixiv.net/artworks/{$randomArtId}";
            echo "Link: <a target=_blank href=\"{$artLink}\">{$artLink}</a><br>\n";
            $numLinks++; // Increment the link counter
        } else {
            foreach ($artworks as $artId => $art) {
                $artLink = "https://www.pixiv.net/artworks/{$artId}";
                echo "Link: <a target=_blank href=\"{$artLink}\">{$artLink}</a><br>\n";
                $numLinks++; // Increment the link counter
            }
        }
        // Display the number of links found within the div
        echo "<script>document.getElementById('linkCount').innerHTML = 'Number of artworks: $numLinks';</script>";
    } else {
        echo "No artworks found for the given user.";
    }
}
// Usage example
$userId = isset($_GET['userId']) ? $_GET['userId'] : '75406576';
$random = isset($_GET['random']);
getPixivUserArt($userId, $random);
?>


____________________________


Generate Linklist from folderpath
-----------------------------------------------------

<?php
$defaultDirectory = 'other/music/midi/piano/';
$directory = isset($_GET['path']) ? $_GET['path'] : $defaultDirectory;
// Sanitize the directory path
$directory = rtrim($directory, '/') . '/';
// Scan the directory for MIDI files
$files = glob($directory . '*.mid');
// Create a linked list of target blank links
$linkList = '<ul>';
foreach ($files as $file) {
    $filename = basename($file);
    $linkList .= '<li><a href="' . $file . '" target="_blank">' . $filename . '</a></li>';
}
$linkList .= '</ul>';
// Output the linked list and the form
echo '<form method="get" action="">';
echo 'Folder: <input type="text" name="path" value="' . $directory . '">';
echo '<input type="submit" value="Generate List">';
echo '</form>';
echo $linkList;
?>

__________________________________

Enable Cors for folder (via .htaccess):
-------------------------------------------------------------

# Add these three lines to CORSify your server for everyone.

Header set Access-Control-Allow-Origin "*"
Header set Access-Control-Allow-Methods "GET,PUT,POST,DELETE"
Header set Access-Control-Allow-Headers "Content-Type, Authorization"

(source: https://gist.github.com/nixta/0b98d7975562bc31c4c9 )

__________________________________

Pkehex qrcode image team box render:
-----------------------------------------------------------

    <style>
        .grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            //grid-column-gap: -50px;
            grid-row-gap: 20px; /* Spaces between grid elements on the y-axis */
        }
        .grid .image {
            width: 45px;
            height: 45px;
            background-size: 800% 800%;
            background-repeat: no-repeat;
            background-position: center -137px;
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
            margin-right: -5px;
        }
        .grid .image:hover {
            transform: scale(2);
            z-index: 2; //always hover above
        }
        .pokemon-name {
            position: absolute;
            bottom: -20px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 12px;
        }
        #iframe-container {
            position: fixed;
            bottom: 10px;
            right: 10px;
            width: 300px;
            height: 200px;
            background-color: #f2f2f2;
        }
        #image-preview {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
    </style>
</head>
<body>
    <div class="grid">
        <?php
        $folder = 'pkmn';
        $files = glob($folder . '/*.jpg');
        foreach ($files as $file) {
            $filename = basename($file);
            $pokemonName = substr($filename, 0, strpos($filename, '_'));
            echo '<div class="image" style="background-image: url(\'' . $file . '\');" onclick="displayImage(\'' . $file . '\')">';
            echo '<div class="pokemon-name">' . $pokemonName . '</div>';
            echo '</div>';
        }
        ?>
    </div>
    <div id="iframe-container">
        <a href="#" onclick="window.open(document.getElementById('image-preview').src, '_blank').focus(); return false;"><img id="image-preview" src="" alt="Preview"></a>
    </div>
    <script>
        function displayImage(imageUrl) {
            var imagePreview = document.getElementById('image-preview');
            imagePreview.src = imageUrl;
        }
    </script>

____________________________________

Animexx Art parse:
---------------------------------


<a target="_blank" href="?creator=1049853/" style=color:lightorange>custom</a><br><br>
<!---<a target="_blank" href="https://www.animexx.de/fanart/zeichner/1248943/" style=color:blue>Cea</a>-->
<a href="findlinksnimgsnquerystring.php" style=color:blue>[[0]]</a> 
<a href="?creator=1248943?seite=1" style=color:blue>[1]</a> 
<a href="?creator=1248943?seite=2" style=color:blue>[2]</a> 
<a href="?creator=1248943?seite=3" style=color:blue>[3]</a> 
<br><br>
<?php
error_reporting(0); // Disable error reporting
if (@isset($_GET['seite']) && @isset($_GET['creator'])) {
    $seite = $_GET['seite'];
    $creator = $_GET['creator'];
    $url = '';
} elseif (@isset($_GET['seite'])) {
    $seite = $_GET['seite'];
    $url = 'https://www.animexx.de/fanart/zeichner/1248943/?seite=' . $seite;
} elseif (@isset($_GET['creator'])) {
    $creator = $_GET['creator'];
    $url = 'https://www.animexx.de/fanart/zeichner/' . $creator . '/';
} else {
    $url = 'https://www.animexx.de/fanart/zeichner/1248943/';
}
$baseurl = preg_replace('/\?.*/', '', $url);
$newurl = str_replace("?seite=", "/?seite=", $url);
echo "<a href='$newurl' target='_blank'>$newurl</a>";
//echo "<a href='$url' target='_blank'>$baseurl/?seite=' . $seite'</a>";
$html = @file_get_contents($url);
$doc = new DOMDocument();
@$doc->loadHTML($html);
$xpath = new DOMXPath($doc);
$fathumbTags = $xpath->query('//td[@class="fathumb"]');
$fatitelTags = $xpath->query('//td[@class="fatitel"]');
$faextinfoTags = $xpath->query('//td[@class="faextinfo"]');
foreach ($fathumbTags as $index => $fathumbTag) {
    $href = @$fathumbTag->getElementsByTagName('a')->item(0)->getAttribute('href');
    $imgSrc = @$fathumbTag->getElementsByTagName('img')->item(0)->getAttribute('src');
    echo "<a href='$imgSrc$href' target='_blank'></a>";
    $fatitelTag = @$fatitelTags->item($index);
    $title = @$fatitelTag->getElementsByTagName('b')->item(0)->textContent;
    echo "<br><a href='$baseurl/$href' target='_blank'><b>$title</b></a>";
    $linkedHtml = @file_get_contents("$url$href");
    $linkedDoc = new DOMDocument();
    @$linkedDoc->loadHTML($linkedHtml);
    $linkedImgTag = @$linkedDoc->getElementsByTagName('img')->item(0);
    $linkedImgSrc = @$linkedImgTag->getAttribute('src');
    echo "<br><img src='$linkedImgSrc' alt='Linked Image' style='width: 200px; height: auto;'>";
    $faextinfoTag = @$faextinfoTags->item($index);
    $faextinfo = @$faextinfoTag->textContent;
    $faextinfo = preg_replace('/(\d)(?![\d.])/', '<br>$1', $faextinfo);
    $faextinfo = preg_replace("/(Note)/", "<br>$1", $faextinfo);
    echo "<br>$faextinfo";
    echo "<br><br>";
}
?>



-----TRASH---31\12\2023----
<!---
PD9waHAKJGRlZmF1bHRVcmwgPSAnaHR0cHM6Ly93d3cuYW5pbWV4eC5kZS9mYW5hcnQvemVpY2huZXIvMTI0ODk0My8nOwppZiAoaXNzZXQoJF9HRVRbJ2NyZWF0b3InXSkpIHsKICAgICRjcmVhdG9yID0gJF9HRVRbJ2NyZWF0b3InXTsKICAgICR1cmwgPSAkY3JlYXRvcjsKfSBlbHNlIHsKICAgICR1cmwgPSAkZGVmYXVsdFVybDsKfQokaHRtbCA9IGZpbGVfZ2V0X2NvbnRlbnRzKCR1cmwpOwokcGF0dGVybiA9ICcvPHRkIGNsYXNzPSJmYXRodW1iIiByb3dzcGFuPSIyIj48YVxzK2hyZWY9IihbXiJdKykiXHMrdGFyZ2V0PSIoW14iXSspIltePl0qPi8nOwpwcmVnX21hdGNoX2FsbCgkcGF0dGVybiwgJGh0bWwsICRtYXRjaGVzLCBQUkVHX1NFVF9PUkRFUik7Ci8vIENyZWF0ZSBhIERPTVhQYXRoIG9iamVjdAokZG9tID0gbmV3IERPTURvY3VtZW50KCk7CiRkb20tPmxvYWRIVE1MKCRodG1sKTsKJHhwYXRoID0gbmV3IERPTVhQYXRoKCRkb20pOwokcXVlcnkgPSAnLy90ZFtAY2xhc3M9ImZhZXh0aW5mbyJdJzsKJHRkRWxlbWVudHMgPSAkeHBhdGgtPnF1ZXJ5KCRxdWVyeSk7Ci8vIEl0ZXJhdGUgb3ZlciB0aGUgPHRkPiBlbGVtZW50cyBhbmQgZGlzcGxheSB0aGVpciBjb250ZW50CiR0ZENvbnRlbnRBcnJheSA9IFtdOwpmb3JlYWNoICgkdGRFbGVtZW50cyBhcyAkdGRFbGVtZW50KSB7CiAgICAkdGRDb250ZW50ID0gJHRkRWxlbWVudC0+b3duZXJEb2N1bWVudC0+c2F2ZUhUTUwoJHRkRWxlbWVudCk7CiAgICAkdGRDb250ZW50QXJyYXlbXSA9ICR0ZENvbnRlbnQ7Cn0KZm9yZWFjaCAoJG1hdGNoZXMgYXMgJGluZGV4ID0+ICRtYXRjaCkgewogICAgJGxpbmsgPSAkbWF0Y2hbMV07CiAgICAkdGFyZ2V0ID0gJG1hdGNoWzJdOwogICAgJHZhbGlkTGluayA9ICR1cmwgLiBsdHJpbSgkbGluaywgJy8nKTsKICAgICRsaW5rSHRtbCA9IGZpbGVfZ2V0X2NvbnRlbnRzKCR2YWxpZExpbmspOwogICAgJGltZ1BhdHRlcm4gPSAnLzxpbWdccytzcmM9IihbXiJdKykiXHMraWQ9ImZhbmFydF9pbWdfZ3Jvc3MiXHMrYWx0PSIoW14iXSspIltePl0qPi8nOwogICAgcHJlZ19tYXRjaCgkaW1nUGF0dGVybiwgJGxpbmtIdG1sLCAkaW1nTWF0Y2gpOwogICAgaWYgKGlzc2V0KCRpbWdNYXRjaFsxXSkgJiYgaXNzZXQoJGltZ01hdGNoWzJdKSkgewogICAgICAgICRpbWdTcmMgPSAkaW1nTWF0Y2hbMV07CiAgICAgICAgJGltZ0FsdCA9ICRpbWdNYXRjaFsyXTsKICAgICAgICBlY2hvICc8YnI+PGJyPjxhIGhyZWY9IicgLiAkdmFsaWRMaW5rIC4gJyIgdGFyZ2V0PSInIC4gJHRhcmdldCAuICciPicgLiAkdmFsaWRMaW5rIC4gJzwvYT48YnI+JzsKICAgICAgICBlY2hvICc8aW1nIHNyYz0iJyAuICRpbWdTcmMgLiAnIiBhbHQ9IicgLiAkaW1nQWx0IC4gJyIgd2lkdGg9NTAlPjxicj4nOwogICAgfQogICAgLy8gQ2hlY2sgaWYgdGhlcmUgaXMgYSBjb3JyZXNwb25kaW5nIGZhZXh0aW5mbyBlbnRyeQogICAgaWYgKGlzc2V0KCR0ZENvbnRlbnRBcnJheVskaW5kZXhdKSkgewogICAgICAgIGVjaG8gJHRkQ29udGVudEFycmF5WyRpbmRleF07CiAgICB9Cn0KPz4KCjx+fn5+fn5+fn5+fn53aXRob3V0IGZhZXRleHQgfn5+fn5+fn5+fn4+Cgo8YcKgdGFyZ2V0PSJfYmxhbmsiwqBocmVmPSI/Y3JlYXRvcj1odHRwczovL3d3dy5hbmltZXh4LmRlL2ZhbmFydC96ZWljaG5lci8xMDQ5ODUzLyLCoHN0eWxlPWNvbG9yOmxpZ2h0b3JhbmdlPmN1c3RvbTwvYT48YnI+PGJyPgo8P3BocAokZGVmYXVsdFVybMKgPcKgJ2h0dHBzOi8vd3d3LmFuaW1leHguZGUvZmFuYXJ0L3plaWNobmVyLzEyNDg5NDMvJzsKaWbCoChpc3NldCgkX0dFVFsnY3JlYXRvciddKSnCoHsKwqDCoMKgwqAkY3JlYXRvcsKgPcKgJF9HRVRbJ2NyZWF0b3InXTsKwqDCoMKgwqAkdXJswqA9wqAkY3JlYXRvcjsKfcKgZWxzZcKgewrCoMKgwqDCoCR1cmzCoD3CoCRkZWZhdWx0VXJsOwp9CiRodG1swqA9wqBmaWxlX2dldF9jb250ZW50cygkdXJsKTsKJHBhdHRlcm7CoD3CoCcvPHRkwqBjbGFzcz0iZmF0aHVtYiLCoHJvd3NwYW49IjIiPjxhXHMraHJlZj0iKFteIl0rKSJccyt0YXJnZXQ9IihbXiJdKykiW14+XSo+Lyc7CnByZWdfbWF0Y2hfYWxsKCRwYXR0ZXJuLMKgJGh0bWwswqAkbWF0Y2hlcyzCoFBSRUdfU0VUX09SREVSKTsKZm9yZWFjaMKgKCRtYXRjaGVzwqBhc8KgJG1hdGNoKcKgewrCoMKgwqDCoCRsaW5rwqA9wqAkbWF0Y2hbMV07CsKgwqDCoMKgJHRhcmdldMKgPcKgJG1hdGNoWzJdOwrCoMKgwqDCoCR2YWxpZExpbmvCoD3CoCR1cmzCoC7CoGx0cmltKCRsaW5rLMKgJy8nKTsKwqDCoMKgwqAkbGlua0h0bWzCoD3CoGZpbGVfZ2V0X2NvbnRlbnRzKCR2YWxpZExpbmspOwrCoMKgwqDCoCRpbWdQYXR0ZXJuwqA9wqAnLzxpbWdccytzcmM9IihbXiJdKykiXHMraWQ9ImZhbmFydF9pbWdfZ3Jvc3MiXHMrYWx0PSIoW14iXSspIltePl0qPi8nOwrCoMKgwqDCoHByZWdfbWF0Y2goJGltZ1BhdHRlcm4swqAkbGlua0h0bWwswqAkaW1nTWF0Y2gpOwrCoMKgwqDCoGlmwqAoaXNzZXQoJGltZ01hdGNoWzFdKcKgJibCoGlzc2V0KCRpbWdNYXRjaFsyXSkpwqB7CsKgwqDCoMKgwqDCoMKgwqAkaW1nU3JjwqA9wqAkaW1nTWF0Y2hbMV07CsKgwqDCoMKgwqDCoMKgwqAkaW1nQWx0wqA9wqAkaW1nTWF0Y2hbMl07CsKgwqDCoMKgwqDCoMKgwqBlY2hvwqAnPGHCoGhyZWY9IifCoC7CoCR2YWxpZExpbmvCoC7CoCciwqB0YXJnZXQ9IifCoC7CoCR0YXJnZXTCoC7CoCciPifCoC7CoCR2YWxpZExpbmvCoC7CoCc8L2E+PGJyPic7CsKgwqDCoMKgwqDCoMKgwqBlY2hvwqAnPGltZ8Kgc3JjPSInwqAuwqAkaW1nU3JjwqAuwqAnIsKgYWx0PSInwqAuwqAkaW1nQWx0wqAuwqAnIsKgd2lkdGg9NTAlPjxicj4nOwrCoMKgwqDCoH0KfQo/Pgo=
-->



______________________

Mastodon extract preview_cards:
----------------------------------------------------

<?php
$url = 'https://mastodon.social/api/v1/accounts/109977878421486714/statuses';
$parsedUrl = parse_url($url);
$domain = $parsedUrl['scheme'] . '://' . $parsedUrl['host'];
// Fetch data from the URL
$response = file_get_contents($url);
if ($response === false) {
    echo 'Error: Unable to fetch data.';
    exit;
}
$previewCards = extractPreviewCardLinks($response);
$html = generateImageTags($previewCards, $domain);
echo 'Domain: ' . $domain . '<br>';
echo 'Preview Card Images:<br>';
echo $html;
function extractPreviewCardLinks($responseText)
{
    //$pattern = '/\/system\/cache\/preview_cards\/images\/\d+\/\d+\/\d+\/original\/[a-f0-9]+\.(?:jpg|jpeg|png|gif)/i';  //normal masstodon
        $pattern = '/\/cache\/preview_cards\/images\/\d{3}\/\d{3}\/\d{3}\/original\/[a-f0-9]+\.(?:jpg|jpeg|png|gif)/i';     //glitchfork suchas urusai.social
         preg_match_all($pattern, $responseText, $matches);


    return $matches[0] ?? [];
}
function generateImageTags($imageUrls, $domain)
{
    $html = '';
    foreach ($imageUrls as $imageUrl) {
        $domain = " https://files.mastodon.social";
        $html .= '<img src="' .$domain . $imageUrl . '" alt="Preview Card Image"><br>';
    }

    return $html;
}
?>

________________________________

Deviantart latest images parse:
-------------------------------------------------


<?php
ob_start();
$ch = curl_init();
$username = $_GET['username']; // Get the username from the query string
$url = 'https://www.deviantart.com/' . $username . '/gallery'; // Use the username in the URL
$userAgent = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36';
curl_setopt($ch, CURLOPT_URL, $url);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
curl_setopt($ch, CURLOPT_USERAGENT, $userAgent);
$response = curl_exec($ch);
curl_close($ch);
$regex = '/window\.__INITIAL_STATE__ = (.*);$/m';
preg_match($regex, $response, $matches);
$json = $matches[1];
$json = str_replace('JSON.parse("', '', $json);
$json = substr($json, 0, -2);
$json = str_replace('\"', '"', $json);
$data = json_decode($json, true);
if (isset($data['comments']['threaded']['results'])) {
    $comments = $data['comments']['threaded']['results'];
    foreach ($comments as $comment) {
        $commentId = $comment['commentId'];
        $commentBody = $comment['body'];
        echo "Comment ID: $commentId\n";
        echo "Comment Body: $commentBody\n";
        echo "===============\n";
    }
}
echo "<pre>";
echo "Data:\n";
print_r($data);
echo "</pre>";
file_put_contents('dauserinfo_' . $username . '.html', ob_get_contents());
?>



========displayinfo.php===========

<?php
// Get the username from the URL query string
$username = $_GET['username'];
$url = 'dauserinfo_' . $username . '.html';
// Retrieve the content from the URL
$content = file_get_contents($url);
$lines = explode("\n", $content);
$matchingLines = [];
$keywords = ['[url]', '[comments]', '[favourites]', '[views]', '[publishedTime]'];

foreach ($lines as $line) {
    foreach ($keywords as $keyword) {
        if (strpos($line, $keyword) !== false) {
            if ($keyword === '[url]' && strpos($line, $username) === false) {
            //if ($keyword === '[url]' && strpos($line, 'art') === false) {
                break;
            }
            $matchingLines[$line] = true;
            break;
        }
    }
}
// Display the matching lines
foreach ($matchingLines as $line => $value) {
    echo $line . '<br>';
}
?>


_______________________________________


Show newest file in dir + modify date
------------------------------------------------

<?php
$files = glob('*'); // Get all files in the current directory
$newestFile = null;
$newestTime = 0;
foreach ($files as $file) {
    if (is_file($file)) { // Check if the item is a file
        $fileExtension = pathinfo($file, PATHINFO_EXTENSION);
        $fileName = pathinfo($file, PATHINFO_FILENAME);
        if ($fileExtension === 'zip' || $fileExtension === 'php' || strpos($fileName, 'error_log') !== false) {
            continue;
        }
        $fileTime = filemtime($file); // Get the last modified timestamp of the file
        if ($fileTime > $newestTime) {
            $newestTime = $fileTime;
            $newestFile = $file;
        }
    }
}
if ($newestFile !== null) {
    $lastModified = date("Y-m-d", $newestTime); // Format the last modified timestamp as yyyy-mm-dd
    $link = htmlspecialchars($newestFile); // Sanitize the filename for use in the hyperlink

    echo "<a href='$link' target='_blank'>$link</a> - Last modified: $lastModified";
}
?>

_____________________________

Fetch Steam Library (and allow json dld):
------------------------------------------

<a target="_blank" href="?steam_id=76561198119673186&api_key=apikey">Custom</a> (<a target="_blank" href="https://steamcommunity.com/login/home/?goto=%2Fdev%2Fapikey" style="color:grey">Get ApiKey</a>)
<!DOCTYPE html>
<html>
<head>
  <title>Steam Library Viewer</title>
  <style>
    table {
      border-collapse: collapse;
    }

    table, th, td {
      border: 1px solid #ccc;
      padding: 8px;
    }
  </style>
</head>
<body>
  <table id="steamLibrary">
    <thead>
      <tr>
        <th>Game Name</th>
        <th>Playtime (minutes)</th>
        <th>Purchase Date</th>
        <th>Price (Current)</th>
        <th>Last Played</th>
      </tr>
    </thead>
    <tbody>
<?php
// Replace 'YOUR_API_KEY' with your actual Steam API key
$apiKey = isset($_GET['api_key']) ? $_GET['api_key'] : 'F96D40C8F7FA9C51B204D4707E0A094B';
$steamId = isset($_GET['steam_id']) ? $_GET['steam_id'] : '76561198119673186';

// Construct the API URL to fetch the user's Steam library data
$libraryApiUrl = "https://api.steampowered.com/IPlayerService/GetOwnedGames/v1/?key={$apiKey}&steamid={$steamId}&include_appinfo=1&include_played_free_games=1";

// Fetch the user's Steam library data
$libraryResponse = file_get_contents($libraryApiUrl);
$libraryData = json_decode($libraryResponse, true);

if ($libraryData && isset($libraryData['response']['games'])) {
  $games = $libraryData['response']['games'];

  if (!empty($games)) {
    // Sort the games array alphabetically by game name
    usort($games, function($a, $b) {
      return strcmp($a['name'], $b['name']);
    });

    foreach ($games as $game) {
      $appId = $game['appid'];
      $appName = $game['name'];
      $playtimeMinutes = $game['playtime_forever'];
      $purchaseDate = isset($game['purchase_date']) ? date('Y-m-d', $game['purchase_date']) : 'Unknown';
      $rtimeLastPlayed = isset($game['rtime_last_played']) ? date('Y-m-d', $game['rtime_last_played']) : 'Unknown';

      // Construct the API URL to fetch the purchase information for the game
      $purchaseApiUrl = "https://store.steampowered.com/api/appdetails?appids={$appId}";

      // Fetch the purchase information for the game
      $purchaseResponse = file_get_contents($purchaseApiUrl);
      $purchaseData = json_decode($purchaseResponse, true);

      if ($purchaseData && isset($purchaseData[$appId]['data']['price_overview'])) {
        $priceOverview = $purchaseData[$appId]['data']['price_overview'];
        $price = number_format($priceOverview['final'] / 100, 2) . ' ‚Ç¨'; // Convert price to Euros
      } else {
        $price = 'Unknown';
      }

      echo '<tr>';
      echo "<td>{$appName}</td>";
      echo "<td>{$playtimeMinutes}</td>";
      echo "<td>{$purchaseDate}</td>";
      echo "<td>{$price}</td>";
      echo "<td>{$rtimeLastPlayed}</td>";
      echo '</tr>';
    }
  } else {
    echo '<tr><td colspan="5">No games found in the Steam library.</td></tr>';
  }
} else {
  echo '<tr><td colspan="5">Error retrieving Steam library.</td></tr>';
}
?>
    </tbody>
  </table>

  <form action="download.php" method="post">
    <input type="hidden" name="libraryData" value="<?php echo htmlspecialchars(json_encode($libraryData)); ?>">
    <button type="submit">Download as JSON</button>
  </form>
</body>
</html>



====download.php===

<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
  if (isset($_POST['libraryData'])) {
    $libraryData = $_POST['libraryData'];
    // Set the appropriate headers for file download
    header('Content-Type: application/json');
    header('Content-Disposition: attachment; filename="steam_library.json"');
    // Output the library data as a JSON file
    echo $libraryData;
    exit;
  }
}
// Redirect back to the previous page if the library data is not available
header('Location: ' . $_SERVER['HTTP_REFERER']);
?>


__________________________________

Open mastodon url in home instance:
------------------------------------------------
<a href="?search=https://sunny.garden/@Iva852/109293246960188756&pbUrl=https://pb.todon.de&apikey=apikey">test</a><br>
<?php
// Check if the API key is submitted
if (isset($_POST['apikey'])) {
    $apiKey = $_POST['apikey'];
    $pbUrl = $_POST['pbUrl'];
    $search = $_POST['url'];
    $url = $pbUrl . '/api/v2/search/?q=' . urlencode($search) . '&limit=1&resolve=true';
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_HTTPHEADER, [
        'Authorization: Bearer ' . $apiKey
    ]);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    $response = curl_exec($ch);
    if (curl_errno($ch)) {
        echo 'Error: ' . curl_error($ch);
    }
    curl_close($ch);
    $data = json_decode($response, true);
    if (isset($data['statuses'][0]['id'])) {
        $id = $data['statuses'][0]['id'];
        $urlParts = parse_url($search);
        $pathParts = explode('/', trim($urlParts['path'], '/'));
        $username = $pathParts[0];
        $domain = $urlParts['host'];
        $newUrl = $pbUrl . '/' . $username . '@' . $domain . '/' . $id;
        echo 'New URL: <a id="newUrlLink" href="' . $newUrl . '">' . $newUrl . '</a>';
echo '<script>document.getElementById("newUrlLink").click();</script>';
    } else {
        echo 'Please enter a URL';
        echo '<br>cURL Result: ' . $response;
        echo '<br>' . $url;
        echo '<br><a target="_blank" href="https://codepen.io/ryedai1/full/WNYZBya">Lookup</a>';
    }
}
?>

<!-- HTML form to input the API key, $pbUrl, and URL -->
<form method="POST" action="">
    <label for="apikey">API Key:</label>
    <input type="text" id="apikey" name="apikey" required>
    <br>
    <label for="pbUrl">pbUrl:</label>
    <input type="text" id="pbUrl" name="pbUrl" required>
    <br>
    <label for="url">URL:</label>
    <input type="text" id="url" name="url" pattern="https://.*" required>
    <input type="submit" value="Submit">
</form>

<script>
  window.onload = function () {
    const urlParams = new URLSearchParams(window.location.search);
    const search = urlParams.get("search");
    const pbUrl = urlParams.get("pbUrl");
    const apiKey = urlParams.get("apikey");
    if (search && pbUrl && apiKey) {
      document.getElementById("apikey").value = apiKey;
      document.getElementById("pbUrl").value = pbUrl;
      if (search.includes("http")) {document.getElementById("url").value = search;}
      // Check if query parameter 'submitted' is present
      if (!urlParams.has("submitted")) {
        // Add 'submitted' query parameter to prevent resubmission
        urlParams.set("submitted", "true");
        const newUrl = window.location.pathname + "?" + urlParams.toString();
        window.history.replaceState(null, null, newUrl);
        document.forms[0].submit();
      }
    }
    const observer = new MutationObserver(function (mutationsList) {
      for (let mutation of mutationsList) {
        if (
          mutation.type === "childList" &&
          mutation.addedNodes.length > 0
        ) {
          const newUrlElements = document.querySelectorAll(
            'body :not(script):not(style):not(link):not(meta):not(base):not(title):contains("New URL:")'
          );
          for (let element of newUrlElements) {
            const linkElement = element.nextElementSibling;
            if (linkElement.tagName === "A") {
              linkElement.addEventListener("click", function (event) {
                event.preventDefault();
                window.open(linkElement.href, "_blank");
              });
            }
          }
        }
      }
    });
    observer.observe(document.body, { childList: true, subtree: true });
  };
</script>


<!----FillFromClipboard--->
    <button class="button" onclick="fillTextbox()">Fill Textbox</button>
<script>
    function fillTextbox() {
        navigator.clipboard.readText().then(function(clipboardText) {
            document.getElementById("url").value = clipboardText;
            var submitButton = document.querySelector('input[type="submit"], button[type="submit"]');
            submitButton?.click();
        }).catch(function(error) {
            console.error('Failed to read clipboard contents: ', error);
        });
    }
</script><br>

__________________________

Zip current dir
----------------------

<?php
$zip = new ZipArchive();
$zipFileName = 'alceawis.de.zip';
$intermediateFolderName = pathinfo($zipFileName, PATHINFO_FILENAME);
if ($zip->open($zipFileName, ZipArchive::CREATE | ZipArchive::OVERWRITE) === true) {
    $files = new RecursiveIteratorIterator(
        new RecursiveDirectoryIterator('.', RecursiveDirectoryIterator::SKIP_DOTS),
        RecursiveIteratorIterator::LEAVES_ONLY
    );
    foreach ($files as $name => $file) {
        if (!$file->isDir()) {
            $filePath = $file->getRealPath();
            $relativePath = $intermediateFolderName . '/' . substr($filePath, strlen(__DIR__) + 1);
            $zip->addFile($filePath, $relativePath);
        }
    }
    $zip->close();
    $downloadLink = '<a href="' . $zipFileName . '">Click here to download the zip file</a>';
    echo 'Files zipped successfully. ' . $downloadLink;
} else {
    echo 'Failed to create zip file.';
}
?>
<!---delete-->
<?php
$file = 'alceawis.de.zip';
if (isset($_GET['delete'])) {
    if (file_exists($file)) {
        unlink($file);
        echo "File deleted successfully.";
    } else {
        echo "File not found.";
    }
}
?>
<a href="?delete=true">Click here to delete zip</a>


______________________________

Delete folder if link is clicked:
--------------------------------------

<?php if (isset($_GET['delete']) && is_dir('website') && shell_exec('rm -rf website')) echo 'Folder deleted.'; ?><a href="?delete">Del code</a>

_________________________

Fetch and render *.zip url (use zipstream php for extractless render):
---------------------------------------

 <?php
$files = glob("*.zip"); // Get all zip files in the current folder
if (!empty($files)) {
    $zipFile = $files[0]; // Assuming you want to delete the first zip file found
    unlink($zipFile);
   // echo "The zip file '$zipFile' has been deleted.";
} else {
    //echo "No zip files found in the current folder.";
}
?>
<!------Star-Zip-Fetch--->
   <form method="post" action="">
        <label for="zipUrl">Enter ZIP URL:</label>
        <input type="text" name="zipUrl" id="zipUrl" value="http://ry3yr.github.io/alceawis.de.zip" required>
        <br>
        <!---<label for="downloadPath">Download Path:</label>--->
        <!--<input type="text" name="downloadPath" id="downloadPath" placeholder="Enter download path (optional)">-->
        <br>
        <input type="submit" name="download" value="Download and Render">
    </form>
    <?php
    if (isset($_POST['download'])) {
        $url = $_POST['zipUrl'];
        $filename = basename($url);
        // Check if the download path textbox is filled
        if (!empty($_POST['downloadPath'])) {
            $downloadPath = $_POST['downloadPath'];
            $filename = $downloadPath . '/' . $filename;
        }
        else {
            $filename = './' . $filename; // Set a default path if download path is not specified
        }
        // Validate the URL
        if (filter_var($url, FILTER_VALIDATE_URL)) {
            try {
                // Use cURL to download the file
                $ch = curl_init($url);
                $fp = fopen($filename, 'w');
                curl_setopt($ch, CURLOPT_FILE, $fp);
                curl_setopt($ch, CURLOPT_HEADER, 0);
                curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true); // Follow redirects
                curl_setopt($ch, CURLOPT_MAXREDIRS, 5); // Maximum number of redirects to follow
                curl_exec($ch);
                // Check if the download was successful
                $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
                if ($httpCode == 200) {
                    $message = "File downloaded successfully.";
                } else {
                    $message = "Failed to download the file. HTTP code: " . $httpCode;
                }
                curl_close($ch);
                fclose($fp);
            } catch (Exception $e) {
                $message = "An error occurred during the download: " . $e->getMessage();
            }
            // Check for cURL errors
            if (curl_errno($ch)) {
                $message = "cURL error: " . curl_error($ch);
            }
        } else {
            $message = "Invalid URL.";
        }
    }
    ?>
    <p><?php echo $message ?? ''; ?></p>
</body>
</html>
<!---Start--Extract-->
<?php
$zipFiles = glob("*.zip"); // Get all ZIP files in the current directory
if (!empty($zipFiles)) {
    $extractPath = "website"; // Destination folder
    // Make sure the extraction path exists
    if (!is_dir($extractPath)) {
        mkdir($extractPath, 0777, true);
    }
    foreach ($zipFiles as $zipFile) {
        $zip = new ZipArchive;
        if ($zip->open($zipFile) === TRUE) {
            // Extract the files directly into the destination folder
            $zip->extractTo($extractPath);
            $zip->close();
            //echo "ZIP file '$zipFile' extracted successfully.<br>";
        } else {
            echo "Failed to open the ZIP file '$zipFile'.<br>";
        }
    }
} else {
    echo "No ZIP files found in the current directory.";
}
?>
<?php
$websiteFolder = "website"; // Replace with the name of the "website" folder
// Check if the "website" folder exists
if (is_dir($websiteFolder)) {
    // Get the first subfolder inside the "website" folder
    $subfolders = glob($websiteFolder . '/*', GLOB_ONLYDIR);
    if (!empty($subfolders)) {
        $firstSubfolder = $subfolders[0];
        // Find the "index.html" file inside the subfolder
        $indexFile = $firstSubfolder . '/index.html';
        if (file_exists($indexFile)) {
            // Open the "index.html" file as a URL in a new tab or window
            //echo '<script>window.open("' . $indexFile . '", "_blank");</script>';
        } else {
            echo 'The "index.html" file was not found.';
        }
    } else {
        echo 'No subfolders found inside the "website" folder.';
    }
} else {
    echo 'The "website" folder does not exist.';
}
?>
<!---last-site-->
<?php
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $websiteFolder = 'website';
    // Retrieve the subfolders within the website folder
    $subfolders = array_diff(scandir($websiteFolder), array('..', '.'));
    // Get the first subfolder
    $firstSubfolder = reset($subfolders);
    $indexUrl = $websiteFolder . '/' . $firstSubfolder . '/index.html';
    echo '<a href="' . $indexUrl . '" target="_blank">Open ' . $indexUrl . '</a>';
}
?>
<form method="post" action="<?php echo $_SERVER['PHP_SELF']; ?>">
    <button type="submit">Get First Subfolder</button>
</form>



_________________________

YGO Wikia setlistfetch:
-----------------------------------


<a href="setlistfetch.php">image ver</a><br><br>
<?php
error_reporting(0);
?>

<div class="pre-spoiler"><input name="Deutsch" type="button" onClick="if (this.parentNode.getElementsByTagName('div')[0].style.display != 'none') { this.parentNode.getElementsByTagName('div')[0].style.display = 'none'; this.value = 'Releases'; } else { this.parentNode.getElementsByTagName('div')[0].style.display = 'block'; this.value = 'Releases';}" value="Releases" style="background:; border:none; color:;"><div class="spoiler" style="display: none;" >
<!---SetList-->
<?php
$url = 'https://yugioh.fandom.com/wiki/Yu-Gi-Oh!_Wiki';
$html = file_get_contents($url);
$start = strpos($html, 'h3><span class="mw-headline" id="TCG"><i>TCG</i></span></h3>');
$end = strpos($html, '<span class="mw-headline" id="Anime"', $start);
$length = $end - $start;
$result = substr($html, $start, $length);
$baseUrl = parse_url($url, PHP_URL_SCHEME) . '://' . parse_url($url, PHP_URL_HOST);
$fixedResult = str_replace('href="/', 'href="'.$baseUrl.'/', $result);
$fixedResult = str_replace('<a', '<a target="_blank"', $fixedResult); // Add target="_blank"
echo $fixedResult;
?>
</div><br>

    <script>
        async function pasteFromClipboard() {
            try {
                if (navigator.clipboard) {
                    const text = await navigator.clipboard.readText();
                    document.getElementById('url').value = text;
                    document.getElementById('submitButton').click();
                } else {
                    alert('Clipboard API is not supported in this browser.');
                }
            } catch (err) {
                console.error('Failed to read clipboard contents: ', err);
            }
        }
    </script>




<unique>
<button onclick="savePageAsHTML()">Save Page as HTML</button>
<script>
function savePageAsHTML() {
var placeholder = document.querySelector('unique');
placeholder.parentNode.removeChild(placeholder);
var html = document.documentElement.outerHTML;
var filename = 'setlist.html';
var element = document.createElement('a');
element.setAttribute('href', 'data:text/html;charset=utf-8,' + encodeURIComponent(html));
element.setAttribute('download', filename);
element.style.display = 'none';
document.body.appendChild(element);
element.click();
document.body.removeChild(element);
document.body.appendChild(placeholder);
}
</script>
</unique>

<?php
// Default URL of the page to scrape
$defaultUrl = 'https://yugioh.fandom.com/wiki/Set_Card_Lists:Labyrinth_of_Nightmare_(TCG-EN)';

// Check if a URL is submitted via POST
$url = isset($_POST['url']) ? $_POST['url'] : $defaultUrl;

// Fetch the HTML content
$htmlContent = file_get_contents($url);

// Load the HTML content using DOMDocument
$dom = new DOMDocument;
libxml_use_internal_errors(true);
$dom->loadHTML($htmlContent);
libxml_clear_errors();

// Create a new XPath object
$xpath = new DOMXPath($dom);

// Query for the table rows
$rows = $xpath->query('//table[@class="fandom-table sortable card-list"]//tr');

// Initialize an empty array to hold the table data
$tableData = [];

// Loop through the rows and extract the data
foreach ($rows as $row) {
    $cols = $row->getElementsByTagName('td');
    $rowData = [];
    foreach ($cols as $index => $col) {
        // Check if the column contains a link (for the name column)
        if ($index == 1 && $col->getElementsByTagName('a')->length > 0) {
            $link = $col->getElementsByTagName('a')->item(0);
            $href = $link->getAttribute('href');
            $text = $link->textContent;
            $rowData[] = '<a href="https://yugioh.fandom.com' . htmlspecialchars($href) . '" target="_blank">' . htmlspecialchars($text) . '</a>';
            // Add the detail link for the iframe
            $rowData[] = '<button onclick="toggleIframe(this, \'https://yugioh.fandom.com' . htmlspecialchars($href) . '\')">Details</button>';
            //$rowData[] = '<button onclick="toggleIframe(this, \'https://alcea-wisteria.de/PHP/0demo/2023-10-08-Fetch-yugioh-wikia-set-list/fetch_single_card.php?card=https://yugioh.fandom.com' . htmlspecialchars($href) . '\')">Details</button>';
        } else {
            $rowData[] = trim($col->textContent);
        }
    }
    if (!empty($rowData)) {
        $tableData[] = $rowData;
    }
}

// Display the form and table data
echo '
<form method="post">
    <label for="url">Enter URL:</label>
    <input type="text" id="url" name="url" value="' . htmlspecialchars($url) . '">
     <input type="submit" id="submitButton" value="Submit">
            <button type="button" onclick="pasteFromClipboard()">Paste and Submit</button>
</form>';

echo '<table border="1" id="cardTable">';
echo '<tr><th>Card number</th><th>Name</th><th>Rarity</th><th>Category</th><th>Detail</th></tr>';
foreach ($tableData as $rowData) {
    echo '<tr>';
    foreach ($rowData as $cellData) {
        echo '<td>' . $cellData . '</td>';
    }
    echo '</tr>';
}
echo '</table>';

// Add the JavaScript for toggling the iframe
echo '
<script>
function toggleIframe(button, url) {
    // Remove any existing iframes
    var iframes = document.querySelectorAll("iframe.detailIframe");
    iframes.forEach(function(iframe) {
        iframe.remove();
    });

    // Create a new iframe
    var iframe = document.createElement("iframe");
    iframe.src = url;
    iframe.className = "detailIframe";
    iframe.style.width = "100%";
    iframe.style.height = "400px";

    // Insert the iframe below the current row
    var row = button.parentElement.parentElement;
    var newRow = document.createElement("tr");
    var newCell = document.createElement("td");
    newCell.colSpan = 5;
    newCell.appendChild(iframe);
    newRow.appendChild(newCell);

    row.parentNode.insertBefore(newRow, row.nextSibling);
}
</script>
';
?>


<!--broken--2024/07-21--
<div class="pre-spoiler"><input name="Deutsch" type="button" onClick="if (this.parentNode.getElementsByTagName('div')[0].style.display != 'none') { this.parentNode.getElementsByTagName('div')[0].style.display = 'none'; this.value = 'Releases'; } else { this.parentNode.getElementsByTagName('div')[0].style.display = 'block'; this.value = 'Releases';}" value="Releases" style="background:; border:none; color:;"><div class="spoiler" style="display: none;" >
<?php
$url = 'https://yugioh.fandom.com/wiki/Yu-Gi-Oh!_Wiki';
$html = file_get_contents($url);
$start = strpos($html, 'h3><span class="mw-headline" id="TCG"><i>TCG</i></span></h3>');
$end = strpos($html, '<span class="mw-headline" id="Anime"', $start);
$length = $end - $start;
$result = substr($html, $start, $length);
$baseUrl = parse_url($url, PHP_URL_SCHEME) . '://' . parse_url($url, PHP_URL_HOST);
$fixedResult = str_replace('href="/', 'href="'.$baseUrl.'/', $result);
$fixedResult = str_replace('<a', '<a target="_blank"', $fixedResult); // Add target="_blank"
echo $fixedResult;
?>
</div><br>
    <form method="post" action="<?php echo $_SERVER['PHP_SELF']; ?>">
        <label for="url">Enter the URL:</label>
        <input type="text" name="url" id="url" required>
        <input type="submit" value="Retrieve">
    </form>
<unique>
<button onclick="savePageAsHTML()">Save Page as HTML</button>
<script>
function savePageAsHTML() {
var placeholder = document.querySelector('unique');
placeholder.parentNode.removeChild(placeholder);
var html = document.documentElement.outerHTML;
var filename = 'setlist.html';
var element = document.createElement('a');
element.setAttribute('href', 'data:text/html;charset=utf-8,' + encodeURIComponent(html));
element.setAttribute('download', filename);
element.style.display = 'none';
document.body.appendChild(element);
element.click();
document.body.removeChild(element);
document.body.appendChild(placeholder);
}
</script>
</unique>
<?php
    if ($_SERVER["REQUEST_METHOD"] == "POST") {
        $url = $_POST['url'];

        $doc = new DOMDocument();
        $doc->loadHTMLFile($url);

        $xpath = new DOMXPath($doc);
        $table = $xpath->query('//table[@id="Top_table"]')->item(0);

        if ($table) {
            $parsedUrl = parse_url($url);
            $baseUrl = $parsedUrl['scheme'] . '://' . $parsedUrl['host'];

            $tableRows = [];

            $rows = $table->getElementsByTagName('tr');
            foreach ($rows as $row) {
                $cells = $row->getElementsByTagName('td');

                if ($cells->length >= 3) {
                    $nameCell = $cells->item(1);
                    $nameLink = $nameCell->getElementsByTagName('a')->item(0);
                    $name = '';
                    $nameUrl = '';
                    if ($nameLink) {
                        $name = trim($nameLink->textContent);
                        $nameRelativeUrl = $nameLink->getAttribute('href');
                        $nameUrl = $baseUrl . $nameRelativeUrl;
                    }

                    $categoryCell = $cells->item(3);
                    $category = '';
                    if ($categoryCell) {
                        $category = trim($categoryCell->textContent);
                    }

                    $tableRows[] = [
                        'name' => $name,
                        'category' => $category,
                        'nameUrl' => $nameUrl
                    ];
                }
            }

            echo '<div class="table-body">';
            foreach ($tableRows as $row) {
                echo '<div class="table-row" data-sort-value="' . $row['name'] . '" data-sort-category="' . $row['category'] . '">';
                echo 'Name: <a href="' . $row['nameUrl'] . '" target="_blank">' . $row['name'] . '</a> | Category: ' . $row['category'];

                // Perform cURL request to retrieve content from $nameUrl
                $curl = curl_init();
                curl_setopt($curl, CURLOPT_URL, $row['nameUrl']);
                curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
                curl_setopt($curl, CURLOPT_FOLLOWLOCATION, true);
                curl_setopt($curl, CURLOPT_USERAGENT, 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3');
                $response = curl_exec($curl);
                if ($response === false) {
                    die('Error: ' . curl_error($curl));
                }
                curl_close($curl);

                $startPos = strpos($response, '<table class="cardtable cardtable-link">');
                $endPos = strpos($response, '</tbody></table><table class="navbox hlist">');
                if ($startPos !== false) {
                    $content = substr($response, $startPos, $endPos - $startPos);
                } else {
                    $fallbackStartPos = strpos($response, '<table class="cardtable">');
                    $fallbackEndPos = strpos($response, '</table>', $fallbackStartPos);

                    if ($fallbackStartPos !== false && $fallbackEndPos !== false) {
                        $content = substr($response, $fallbackStartPos, $fallbackEndPos - $fallbackStartPos + 8);
                    }
                }

                if (!empty($content)) {
                    $uniqueDivId = 'div_' . uniqid(); // Generate unique ID for each div
                                    echo '<details><div id="' . $uniqueDivId . '"></div></details>';

  $doc = new DOMDocument();
  $doc->encoding = 'UTF-8'; // Set the character encoding
  $doc->loadHTML(mb_convert_encoding($content, 'HTML-ENTITIES', 'UTF-8')); // Convert the content to UTF-8

        // Update links in anchor tags
        $anchorTags = $doc->getElementsByTagName('a');
        foreach ($anchorTags as $anchorTag) {
            $href = $anchorTag->getAttribute('href');
            if (!empty($href) && !filter_var($href, FILTER_VALIDATE_URL)) {
                $href = $baseUrl . $href; // Construct absolute URL for the link
                $anchorTag->setAttribute('href', $href);
                $anchorTag->setAttribute('target', '_blank'); // Add "target=_blank" attribute
            }
        }

        // Update links in image tags
        $imageTags = $doc->getElementsByTagName('img');

                foreach ($imageTags as $imageTag) {
                    $imageUrl = $imageTag->getAttribute('src');
                    $imageData = file_get_contents($imageUrl);
                    if ($imageData !== false) {
                        $base64Image = base64_encode($imageData);
                        $imageTag->setAttribute('src', 'data:image/png;base64,' . $base64Image);
                    }
                }

                $content = $doc->saveHTML();
                //echo $modifiedContent;

                echo '<script type="text/javascript">';
                    echo 'document.getElementById("' . $uniqueDivId . '").innerHTML = ' . json_encode($content) . ';';
                    echo '</script>';
                } else {
                    echo "Content not found.";
                }

                echo '</div>';
            }
            echo '</div>';

            //echo '<button id="sort_by_name_button">Sort by Name</button>';
            //echo '<button id="sort_by_category_button">Sort by Category</button>';
        } else {
            echo "Table not found.";
        }
    }
?>


____________________________________


URL Page Source Display:
---------------------------------------

<?php
if(isset($_POST['submit'])) {
    // Get the URL from the textbox
    $url = $_POST['url'];
    // Fetch the source code of the URL
    $sourceCode = file_get_contents($url);
}
?>
<!DOCTYPE html>
<html>
<head>
    <title>URL Source Code Viewer</title>
</head>
<body>
    <form method="POST">
        <label for="url">Enter URL:</label>
        <input type="text" name="url" id="url" required>
        <br>
        <input type="submit" name="submit" value="Submit">
    </form>
    <?php if(isset($_POST['submit'])): ?>
      <div style="margin-top: 20px;">
          <h2>Source Code:</h2>
          <div><textarea cols="80" rows="10"><?php echo $sourceCode; ?></textarea></div>
      </div>
    <?php endif; ?>
</body>
</html>


____________________________________

Duplicate Subdir File Finder (& deleter)
-----------------------------------------------------------

<?php
function scanDirectories($dir)
{
    $fileList = [];
    $iterator = new RecursiveIteratorIterator(
        new RecursiveDirectoryIterator($dir, RecursiveDirectoryIterator::SKIP_DOTS),
        RecursiveIteratorIterator::SELF_FIRST,
        RecursiveIteratorIterator::CATCH_GET_CHILD // Ignore "Permission denied" errors
    );

    foreach ($iterator as $path => $fileInfo) {
        if ($fileInfo->isFile()) {
            $size = $fileInfo->getSize();
            $fileList[$size][] = $path;
        }
    }

    return $fileList;
}

function deleteFile($filePath)
{
    if (is_file($filePath)) {
        unlink($filePath);
        echo "Deleted: " . $filePath . "\n";
    }
}

function deleteDuplicateFiles($dir)
{
    $currentDir = getcwd(); // Get the current working directory
    chdir($dir); // Change the current working directory to the specified directory
    $fileList = scanDirectories('.'); // Scan the subdirectories from the current directory

    $filesToDelete = [];

    foreach ($fileList as $size => $files) {
        if (count($files) > 1) {
            $fileCount = count($files);
            for ($i = 1; $i < $fileCount; $i++) {
                $filePath = $files[$i];
                if (is_file($filePath)) {
                    $filesToDelete[] = $filePath;
                }
            }
        }
    }

    if (count($filesToDelete) > 0) {
        echo "Found duplicate files:<br>";
        foreach ($filesToDelete as $filePath) {
            echo '<a href="?delete=' . urlencode($filePath) . '">' . $filePath . '</a><br>';
        }

        if (isset($_GET['delete'])) {
            $fileToDelete = urldecode($_GET['delete']);
            deleteFile($fileToDelete);
        }
    } else {
        echo "No duplicate files found.\n";
    }

    chdir($currentDir); // Change the working directory back to the original directory
}

// Usage example
$directory = getcwd(); // Set the starting path to the current directory
deleteDuplicateFiles($directory);
?>
_________________________________

Inbrowser PDF Render (JS + php)
--------------------------------------


<!DOCTYPE html>
<html>
<head>
    <title>PDF Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.2.2/pdf.js"></script>
</head>
<body>
    <label for="pdf-upload">Upload PDF:</label>
    <input type="file" id="pdf-upload" accept="application/pdf"/>
    <label for="pdf-url">PDF URL:</label>
    <input type="text" id="pdf-url" placeholder="Enter PDF URL"/>
    <button id="load-pdf">Load PDF</button>
    <button id="zoom-in" style="background:transparent; border:transparent;display: none;">Zoom In</button>
    <div id="zoom-percent" style="background:transparent; border:transparent;display: none;">60</div>
    <button id="zoom-out" style="background:transparent; border:transparent;display: none;">Zoom Out</button>
    <button id="zoom-reset" style="background:transparent; border:transparent;display: none;">Reset Zoom</button>
    <div id="pages"></div>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc =
            'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.2.2/pdf.worker.js';

        document.querySelector("#pdf-upload").addEventListener("change", function(e){
            document.querySelector("#pages").innerHTML = "";
            zoomReset();
            var file = e.target.files[0]
            if(file.type != "application/pdf"){
                alert(file.name + " is not a pdf file.")
                return
            }
            var fileReader = new FileReader();  
            fileReader.onload = function() {
                var typedarray = new Uint8Array(this.result);
                pdfjsLib.getDocument(typedarray).promise.then(function(pdf) {
                    // you can now use *pdf* here
                    console.log("the pdf has", pdf.numPages, "page(s).");
                    for (var i = 0; i < pdf.numPages; i++) {
                        (function(pageNum){
                        pdf.getPage(i+1).then(function(page) {
                            // you can now use *page* here
                            var viewport = page.getViewport(2.0);
                            var pageNumDiv = document.createElement("div");
                            pageNumDiv.className = "pageNumber";
                            pageNumDiv.innerHTML = "Page " + pageNum;
                            var canvas = document.createElement("canvas");
                            canvas.className = "page";
                            canvas.title = "Page " + pageNum;
                            document.querySelector("#pages").appendChild(pageNumDiv);
                            document.querySelector("#pages").appendChild(canvas);
                            canvas.height = viewport.height;
                            canvas.width = viewport.width;
                            page.render({
                                canvasContext: canvas.getContext('2d'),
                                viewport: viewport
                            }).promise.then(function(){
                                console.log('Page rendered');
                            });
                            page.getTextContent().then(function(text){
                                console.log(text);
                            });
                        });
                        })(i+1);
                    }
                });
            };
            fileReader.readAsArrayBuffer(file);
        });
        document.querySelector("#load-pdf").addEventListener("click", function(){
            document.querySelector("#pages").innerHTML = "";
            zoomReset();
            var url = document.querySelector("#pdf-url").value.trim();
            if (!url) {
                alert("Please enter a PDF URL.");
                return;
            }
            if (!url.endsWith(".pdf")) {
                alert("Please enter a valid PDF URL.");
                return;
            }
            fetch('fetch_pdf.php?url=' + encodeURIComponent(url)).then(function(response) {
                if (!response.ok) {
                    throw new Error(response.statusText);
                }
                return response.arrayBuffer();
            }).then(function(buffer) {
                pdfjsLib.getDocument(buffer).promise.then(function(pdf) {
                    // you can now use *pdf* here
                    console.log("the pdf has", pdf.numPages, "page(s).");
                    for (var i = 0; i < pdf.numPages; i++) {
                        (function(pageNum){
                        pdf.getPage(i+1).then(function(page) {
                            // you can now use *page* here
                            var viewport = page.getViewport(2.0);
                            var pageNumDiv = document.createElement("div");
                            pageNumDiv.className = "pageNumber";
                            pageNumDiv.innerHTML = "Page " + pageNum;
                            var canvas = document.createElement("canvas");
                            canvas.className = "page";
                            canvas.title = "Page " + pageNum;
                            document.querySelector("#pages").appendChild(pageNumDiv);
                            document.querySelector("#pages").appendChild(canvas);
                            canvas.height = viewport.height;
                            canvas.width = viewport.width;
                            page.render({
                                canvasContext: canvas.getContext('2d'),
                                viewport: viewport
                            }).promise.then(function(){
                                console.log('Page rendered');
                            });
                            page.getTextContent().then(function(text){
                                console.log(text);
                            });
                        });
                       })(i+1);
                    }
                });
            }).catch(function(error) {
                console.error('Error occurred while fetching the PDF: ' + error);
            });
        });
        function zoomIn() {
            var scale = parseFloat(document.querySelector("#zoom-percent").textContent);
            scale = scale + 10;
            if (scale > 200) {
                scale = 200;
            }
            document.querySelector("#zoom-percent").textContent = scale;
            updateZoomButtons();
            updateZoom(scale);
        }
        function zoomOut() {
            var scale = parseFloat(document.querySelector("#zoom-percent").textContent);
            scale = scale - 10;
            if (scale < 50) {
                scale = 50;
            }
            document.querySelector("#zoom-percent").textContent = scale;
            updateZoomButtons();
            updateZoom(scale);
        }
        function zoomReset() {
            var scale = 100;
            document.querySelector("#zoom-percent").textContent = scale;
            updateZoomButtons();
            updateZoom(scale);
        }
        function updateZoomButtons() {
            var scale = parseFloat(document.querySelector("#zoom-percent").textContent);
            var zoomInButton = document.querySelector("#zoom-in");
            var zoomOutButton = document.querySelector("#zoom-out");
            if (scale >= 200) {
                zoomInButton.style.display = "none";
            } else {
                zoomInButton.style.display = "inline-block";
            }
            if (scale <= 50) {
                zoomOutButton.style.display = "none";
            } else {
                zoomOutButton.style.display = "inline-block";
            }
        }
        function updateZoom(scale) {
            var pages = document.querySelectorAll(".page");
            for (var i = 0; i < pages.length; i++) {
                var canvas = pages[i];
                var context = canvas.getContext("2d");
                var viewport = canvas.pdfPage.getViewport({ scale: scale / 100 });
                canvas.width = viewport.width;
                canvas.height = viewport.height;
                canvas.style.width = viewport.width + "px";
                canvas.style.height = viewport.height + "px";
                canvas.pdfPage.render({ canvasContext: context, viewport: viewport });
            }
        }
        document.querySelector("#zoom-in").addEventListener("click", zoomIn);
        document.querySelector("#zoom-out").addEventListener("click", zoomOut);
        document.querySelector("#zoom-reset").addEventListener("click", zoomReset);
    </script>
</body>
</html>


<!--"fetch_pdf.php">

<?php
// Get the URL parameter
$url = $_GET['url'];
// Initialize cURL
$curl = curl_init();
// Set cURL options
curl_setopt($curl, CURLOPT_URL, $url);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
curl_setopt($curl, CURLOPT_HEADER, false);
// Execute the cURL request
$response = curl_exec($curl);
// Check for errors
if ($response === false) {
    die('Error fetching PDF: ' . curl_error($curl));
}
// Close cURL
curl_close($curl);
// Set the appropriate headers
header('Content-Type: application/pdf');
header('Content-Disposition: inline; filename="document.pdf"');
header('Content-Length: ' . strlen($response));
// Output the PDF content
echo $response;
?>


_____________________________

iFrame curr php dir + CacheBusting
-----------------------------------------------

<iframe src="<?= dirname($_SERVER['PHP_SELF']); ?>?timestamp=<?= time(); ?>" width="1200" height="600" frameborder="0"></iframe>

_____________________________

Github master downloader
------------------------------------------

<?php
$currentPath = $_SERVER['PHP_SELF'];
$directoryPath = dirname($currentPath);
echo "Current directory path: " . $directoryPath;
?><br>
<?php
$transformedUrl = '';
if (isset($_POST['submit'])) {
    $url = $_POST['url'];

    // Check if the URL matches the specific GitHub URL pattern
    if (preg_match('/^https:\/\/github\.com\/([^\/]+)\/([^\/]+)\/?$/', $url, $matches)) {
        $owner = $matches[1];
        $repo = $matches[2];
        $url = "https://github.com/{$owner}/{$repo}/archive/refs/heads/main.zip";
        $transformedUrl = $url;
        $filename = "{$repo}-main.zip"; // Set the filename

        // Check if the download path textbox is filled
        if (!empty($_POST['download_path'])) {
            $downloadPath = $_POST['download_path'];
            $filename = $downloadPath . '/' . $filename;
        }
        else {
            $filename = './' . $filename; // Set a default path if download path is not specified
        }
    }
    else {
        $filename = basename($url); // Extract the filename from the URL

        // Check if the download path textbox is filled
        if (!empty($_POST['download_path'])) {
            $downloadPath = $_POST['download_path'];
            $filename = $downloadPath . '/' . $filename;
        }
        else {
            $filename = './' . $filename; // Set a default path if download path is not specified
        }
    }
    // Validate the URL
    if (filter_var($url, FILTER_VALIDATE_URL)) {
        try {
            // Use cURL to download the file
            $ch = curl_init($url);
            $fp = fopen($filename, 'w');
            curl_setopt($ch, CURLOPT_FILE, $fp);
            curl_setopt($ch, CURLOPT_HEADER, 0);
            curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true); // Follow redirects
            curl_setopt($ch, CURLOPT_MAXREDIRS, 5); // Maximum number of redirects to follow
            curl_exec($ch);
            // Check if the download was successful
            $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
            if ($httpCode == 200) {
                $message = "File downloaded successfully.";
            } else {
                $message = "Failed to download the file. HTTP code: " . $httpCode;
            }
            curl_close($ch);
            fclose($fp);
        } catch (Exception $e) {
            $message = "An error occurred during the download: " . $e->getMessage();
        }
        // Check for cURL errors
        if (curl_errno($ch)) {
            $message = "cURL error: " . curl_error($ch);
        }
    } else {
        $message = "Invalid URL.";
    }
}
?>
<!DOCTYPE html>
<html>
<head>
    <title>Download File</title>
</head>
<body>
    <form method="post" action="<?php echo $_SERVER['PHP_SELF']; ?>">
        <label for="url">URL:</label>
        <input type="text" name="url" value="https://github.com/Ry3yr/ry3yr.github.io">
        <br>
        <label for="download_path">Download Path:</label>
        <input type="text" name="download_path" placeholder="Leave blank for current directory">
        <br>
        <input type="submit" name="submit" value="Download">
    </form>
    <?php if (!empty($transformedUrl)): ?>
        <p>Transformed GitHub URL: <?php echo $transformedUrl; ?></p>
    <?php endif; ?>
    <?php if (isset($message)): ?>
        <p><?php echo $message; ?></p>
    <?php endif; ?>
</body>
</html>
<iframe src="<?= dirname($_SERVER['PHP_SELF']); ?>?timestamp=<?= time(); ?>" width="1200" height="600" frameborder="0"></iframe>

______________________________________________________

Change PHP version to specific version via htaccess
-------------------------------------------------------------------------------

For PHP 5.6:
AddHandler application/x-httpd-php56 .php .php5
For PHP 7.0:
AddHandler application/x-httpd-php70 .php .php7
For PHP 7.1:
AddHandler application/x-httpd-php71 .php .php7
For PHP 7.2:
AddHandler application/x-httpd-php72 .php .php7
For PHP 7.3:
AddHandler application/x-httpd-php73 .php .php7
For PHP 7.4:
AddHandler application/x-httpd-php74 .php .php7
For PHP 8.0:
AddHandler application/x-httpd-php80 .php .php8
For PHP 8.1:
AddHandler application/x-httpd-php81 .php .php8

(Source: https://www.fastcomet.com/kb/how-to-set-custom-php-version-per-directory )

_________________________

Check PHP version:
------------------------------


<?php
$phpVersion = phpversion();
echo "PHP version: " . $phpVersion;
?>

_________________________

PassProtect Php
-----------
<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $password = $_POST['password'];
    if ($password === '1234') {


        // Place your PHP code here


        echo "Password correct! Proceeding with code execution.";
    } else {
        // Password is incorrect, display an error message
        echo "Incorrect password. Access denied.";
    }
}
?>
<!-- HTML form to enter the password -->
<form method="POST" action="">
    <label for="password">Password:</label>
    <input type="password" name="password" id="password">
    <input type="submit" value="Submit">
</form>


_____________________________

Download subdir as zip if selected via link
-------------------------------------

<?php
$baseDir = __DIR__; // Set the base directory to the current directory

// Check if a directory is clicked
if (isset($_GET['dir'])) {
    $selectedDir = $_GET['dir']; // Get the selected directory
    $zipFolderName = basename($selectedDir); // Get the folder name for the ZIP file

    // Create a ZIP archive
    $zip = new ZipArchive();
    $zipName = $zipFolderName . '.zip';
    $zip->open($zipName, ZipArchive::CREATE | ZipArchive::OVERWRITE);

    // Add files and directories to the ZIP archive
    $files = new RecursiveIteratorIterator(
        new RecursiveDirectoryIterator($selectedDir),
        RecursiveIteratorIterator::SELF_FIRST
    );

    foreach ($files as $name => $file) {
        if (!$file->isDir()) {
            $filePath = $file->getRealPath();

            // Skip "." and ".." folders
            if ($filePath !== $selectedDir . '/.' && $filePath !== $selectedDir . '/..') {
                $relativePath = $zipFolderName . '/' . substr($filePath, strlen($selectedDir) + 1);
                $zip->addFile($filePath, $relativePath);
            }
        } else {
            $relativePath = $zipFolderName . '/' . substr($file, strlen($selectedDir) + 1);

            // Skip "." and ".." folders
            if ($relativePath !== $zipFolderName . '/.' && $relativePath !== $zipFolderName . '/..') {
                $zip->addEmptyDir($relativePath);
            }
        }
    }

    // Close the ZIP archive
    $zip->close();

    // Send the ZIP file to the browser
    if (file_exists($zipName)) {
        header('Content-Type: application/zip');
        header('Content-Disposition: attachment; filename="' . $zipName . '"');
        header('Content-Length: ' . filesize($zipName));
        readfile($zipName);

        // Delete the ZIP file
        unlink($zipName);
        exit;
    }
}

// List directories
$directories = glob($baseDir . '/*', GLOB_ONLYDIR);
foreach ($directories as $directory) {
    $dirName = basename($directory);

    // Skip "." and ".." folders
    if ($dirName !== '.' && $dirName !== '..') {
        echo '<a href="?dir=' . urlencode($directory) . '">' . $dirName . '</a><br>';
    }
}
?>

________________________________

Fetch vgmdb release date/link and write to html list:
---------------------------------------------------------------------------------

<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $url = $_POST['url'];
    $html = file_get_contents($url);
    $datePattern = '/View albums released on ([A-Z][a-z]{2} \d{1,2}, \d{4})/';
    preg_match($datePattern, $html, $dateMatches);
    $releaseDate = $dateMatches[1];
    $reformattedDate = date('Y-m-d', strtotime($releaseDate));
    $titlePattern = '/<h1><span class="albumtitle" lang="en" style="display:inline">(.*?)<\/span>/s';
    preg_match($titlePattern, $html, $titleMatches);
    $albumTitle = $titleMatches[1];

    // Check if line is already present in file
    $fileContent = file_get_contents('pastreleases.html');
    $lineToCheck = "<p>" . $reformattedDate . " <a href='" . $url . "'>" . $albumTitle . "</a></p>";
    if (strpos($fileContent, $lineToCheck) !== false) {
        // Line is already present, display error message
        echo "Error: Line already exists in the file.<br>";
    } else {
        // Line is not present, prepend to the file
        $fileContentToWrite = $lineToCheck . "\n" . $fileContent;
        file_put_contents('pastreleases.html', $fileContentToWrite);
    }

    echo "" . $reformattedDate . "";
    echo "<a href='" . $url . "' target='_blank'>" . $albumTitle . "</a>";
}
?>
<head>
</head>
<body>
    <form method="POST" action="">
        <label for="url">VGMdb URL:</label>
        <input type="text" name="url" id="url" required>
        <input type="submit" value="Extract">
    </form>
</body>



<!--Reorder--Function-->
<form method="POST" action="">
    <input type="submit" name="reorder" id="reorder" value="Reorder">
</form>

<?php
if (isset($_POST['reorder'])) {
    // PHP Code for Reordering "pastreleases.html"
    $fileContent = file_get_contents('pastreleases.html');
    $lines = explode("\n", $fileContent);
    $lines = array_filter($lines);
    $linesWithDates = array();

    foreach ($lines as $line) {
        preg_match('/<p>(\d{4}-\d{2}-\d{2})/', $line, $dateMatches);
        if (isset($dateMatches[1]) && strtotime($dateMatches[1]) !== false) {
            $date = $dateMatches[1];
            $linesWithDates[$line] = $date;
        }
    }

    arsort($linesWithDates);
    $reorderedLines = array_keys($linesWithDates);
    $reorderedContent = implode("\n", $reorderedLines);

    // Filter lines that do not contain "https://"
    $filteredLines = array_filter($reorderedLines, function ($line) {
        return strpos($line, 'https://') !== false;
    });

    $filteredContent = implode("\n", $filteredLines);
    file_put_contents('pastreleases.html', $filteredContent);

    echo "Reordering and filtering completed successfully!";
}
?>


<iframe src="pastreleases.html?timestamp=<?php echo time(); ?>" width="600" height="400"></iframe>


__________________________________________

Manually load "php composer package":
-------------------------------------------------------------


<?php
$file = 'src/DiDom/Document.php';
// Check if the file exists
if (!file_exists($file)) {
    echo 'Error: Document.php file not found.';
    exit;
}
// Enable error reporting
error_reporting(E_ALL);
ini_set('display_errors', 1);
// Try to include the file
require_once $file;
// Check if Document class is defined
if (class_exists('DiDom\Document')) {
    echo 'Document.php is properly loaded.';
} else {
    echo 'Error: Document.php failed to load.';
    echo 'Please check if the file is correct and the necessary dependencies are installed.';
}
?> 
<?php
if (extension_loaded('libxml')) {
    echo "libxml extension is enabled.";
} else {
    echo "libxml extension is not enabled.";
}
?><br><br>


<?php
// Define LIBXML_HTML_NODEFDTD constant if it's not already defined
if (!defined('LIBXML_HTML_NODEFDTD')) {
    define('LIBXML_HTML_NODEFDTD', 8192);
}
require_once 'src/DiDom/Node.php';
//require_once 'src/DiDom/Encoder.php';
//require_once 'src/DiDom/Errors.php';
$files = glob('src/DiDom/*.php');
foreach ($files as $file) {
    require_once $file;
}
use DiDom\Document;
// Create a new DiDOM Document object
$document = new Document();
$document->loadHtmlFile('https://ry3yr.github.io/OSTR/Diarykeepers_Homepage/index.html');
// Find all the links in the document
$links = $document->find('a');
// Display the URLs of the links
foreach ($links as $link) {
    echo $link->getAttribute('href') . PHP_EOL;
}
?>


_____________________________________

PHP list dirs:
--------------------



<?php
$directory = './'; // Specify the directory path here

function listSubdirectories($directory) {
    $subdirectories = glob($directory . '/*', GLOB_ONLYDIR);
    
    if (count($subdirectories) > 0) {
        echo '<ul>';
        
        foreach ($subdirectories as $subdirectory) {
            echo '<li>';
            echo '<details>';
            echo '<summary>' . basename($subdirectory) . '</summary>';
            
            listSubdirectories($subdirectory);
            
            echo '</details>';
            echo '</li>';
        }
        
        echo '</ul>';
    }
    
    $files = glob($directory . '/*.*');
    
    if (count($files) > 0) {
        echo '<ul>';
        
        foreach ($files as $file) {
            echo '<li><a href="' . $file . '">' . basename($file) . '</a></li>';
        }
        
        echo '</ul>';
    }
}

echo '<ul>';
echo '<li>';
echo '<details>';
echo '<summary>Root</summary>';
listSubdirectories($directory);
echo '</details>';
echo '</li>';
echo '</ul>';
?>


____________________

JSFiddleClone:
------------------------

<a href="save-new-fiddle.php" target="_blank">Save New HTML</a>
<style>
  .preview-container {
    border: 1px solid black;
    padding: 10px;
  }
</style>
<?php
$folderPath = 'htmls';
$files = glob($folderPath . '/*.html');
$fileCount = count($files);
$gridColumns = 6;
$gridRows = ceil($fileCount / $gridColumns);
?>
<div id="preview-container-wrapper"></div>
<script>
  // Function to append the preview containers to the wrapper div
  function appendPreviewContainers() {
    var wrapper = document.getElementById('preview-container-wrapper');
    <?php
$folderPath = 'htmls';
$files = glob($folderPath . '/*.html');
$fileCount = count($files);
$gridColumns = 6;
$gridRows = ceil($fileCount / $gridColumns);
$files = array_reverse($files); // Reverse the order of the files
for ($row = 0; $row < $gridRows; $row++) {
  echo 'var row' . $row . ' = document.createElement("div");';
  echo 'row' . $row . '.style.display = "flex";';
  for ($col = 0; $col < $gridColumns; $col++) {
    $index = $row * $gridColumns + $col;
    if ($index < $fileCount) {
      $file = $files[$index];
      $fileName = basename($file);
      $objectPreview = '<object data="' . $file . '" width="300" height="200" scrolling="no"></object>';
      echo 'var container' . $index . ' = document.createElement("div");';
      echo 'container' . $index . '.className = "preview-container";';
      echo 'container' . $index . '.style.flex = "1";';
      echo 'container' . $index . '.style.margin = "5px";';
      echo 'container' . $index . '.innerHTML = \'' . $objectPreview . '<br><a href="' . $file . '" target="_blank">' . $fileName . '</a>\';';
      echo 'row' . $row . '.appendChild(container' . $index . ');';
    }
  }

  echo 'wrapper.appendChild(row' . $row . ');';
}
?>
  }

  // Function to stop further data fetching after a specified delay
  function stopDataFetching() {
    var xhr = new XMLHttpRequest();
    xhr.abort();
  }
  // Call the function to append the preview containers
  appendPreviewContainers();
  // Wait for 20 seconds and then stop further data fetching
  setTimeout(stopDataFetching, 10000);
</script>



<!------save-new-fiddle.php--->
<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $code = $_POST['code'];
    $name = $_POST['name'];
    // Generate the file name
    $date = date('Y-m-d');
    $name = preg_replace('/[^\w\s]/', '', $name); // Remove illegal characters
    $name = str_replace(' ', '-', $name); // Replace spaces with "-"
    $filename = $date . '-' . $name . '.html';
    // Check if the "html" folder exists
    if (!is_dir('htmls')) {
        // Create the "htmls" folder if it doesn't exist
        mkdir('html');
    }
    // Save the content to the file
    $filepath = 'htmls/' . $filename;
    file_put_contents($filepath, $code);
    echo "Code saved successfully!";
}
?>
<body>
    <form method="post" action="">
        <label for="code">Code:</label><br>
        <textarea name="code" rows="10" cols="50"></textarea><br><br>
        <label for="name">Name:</label><br>
        <input type="text" name="name"><br><br>
        <input type="submit" value="Save Code">
    </form>
</body>
</html>


______________________________________________

Add gamesizes to "dekudeals" collection.json:
----------------------------------------------------------------------

<?php
//¬†Function¬†to¬†handle¬†file¬†upload
function¬†handleFileUpload($file)
{
¬†¬†¬†¬†//¬†Check¬†if¬†the¬†upload¬†was¬†successful
¬†¬†¬†¬†if¬†($file['error']¬†===¬†UPLOAD_ERR_OK)¬†{
¬†¬†¬†¬†¬†¬†¬†¬†//¬†Read¬†the¬†uploaded¬†file
¬†¬†¬†¬†¬†¬†¬†¬†$jsonData¬†=¬†file_get_contents($file['tmp_name']);
¬†¬†¬†¬†¬†¬†¬†¬†//¬†Decode¬†the¬†JSON¬†data¬†into¬†an¬†associative¬†array
¬†¬†¬†¬†¬†¬†¬†¬†$data¬†=¬†json_decode($jsonData,¬†true);
¬†¬†¬†¬†¬†¬†¬†¬†//¬†Check¬†if¬†the¬†JSON¬†decoding¬†was¬†successful
¬†¬†¬†¬†¬†¬†¬†¬†if¬†($data¬†!==¬†null)¬†{
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†//¬†Iterate¬†over¬†each¬†item¬†in¬†the¬†collection
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†foreach¬†($data['items']¬†as¬†&$item)¬†{
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†//¬†Check¬†if¬†the¬†item¬†has¬†a¬†"link"¬†key
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†if¬†(isset($item['link']))¬†{
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†//¬†Fetch¬†the¬†content¬†of¬†the¬†URL
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†$url¬†=¬†$item['link'];
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†$html¬†=¬†file_get_contents($url);
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†//¬†Create¬†a¬†DOMDocument¬†object¬†and¬†load¬†the¬†HTML¬†content
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†$dom¬†=¬†new¬†DOMDocument();
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†@$dom->loadHTML($html);
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†//¬†Create¬†a¬†DOMXPath¬†object¬†to¬†query¬†the¬†HTML
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†$xpath¬†=¬†new¬†DOMXPath($dom);
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†//¬†Find¬†the¬†download¬†size¬†element¬†using¬†XPath
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†$query¬†=¬†"//strong[contains(text(),¬†'Download¬†size:')]/following-sibling::text()";
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†$downloadSize¬†=¬†$xpath->query($query)->item(0)->nodeValue;
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†//¬†Add¬†the¬†new¬†"gamesize"¬†field¬†to¬†the¬†item
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†$item['gamesize']¬†=¬†$downloadSize;
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†}
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†}
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†//¬†Encode¬†the¬†modified¬†data¬†back¬†to¬†JSON
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†$updatedJsonData¬†=¬†json_encode($data,¬†JSON_PRETTY_PRINT¬†|¬†JSON_UNESCAPED_SLASHES);
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†//¬†Set¬†the¬†appropriate¬†headers¬†for¬†downloading¬†the¬†file
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†header('Content-Type:¬†application/json');
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†header('Content-Disposition:¬†attachment;¬†filename="updated_collection.json"');
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†//¬†Output¬†the¬†updated¬†JSON¬†data¬†for¬†download
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†echo¬†$updatedJsonData;
¬†¬†¬†¬†¬†¬†¬†¬†}¬†else¬†{
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†//¬†JSON¬†decoding¬†failed
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†echo¬†"Failed¬†to¬†decode¬†JSON¬†data.";
¬†¬†¬†¬†¬†¬†¬†¬†}
¬†¬†¬†¬†}¬†else¬†{
¬†¬†¬†¬†¬†¬†¬†¬†//¬†File¬†upload¬†failed
¬†¬†¬†¬†¬†¬†¬†¬†echo¬†"File¬†upload¬†failed.¬†Please¬†try¬†again.";
¬†¬†¬†¬†}
}
//¬†Check¬†if¬†a¬†file¬†was¬†uploaded
if¬†($_FILES¬†&&¬†isset($_FILES['json_file']))¬†{
¬†¬†¬†¬†handleFileUpload($_FILES['json_file']);
}
?>
<!DOCTYPE¬†html>
<html>
<head>
¬†¬†¬†¬†<title>Dekudeals¬†Download¬†Size¬†Fetcher</title>
</head>
<body>
¬†¬†¬†¬†<h1>upload¬†your¬†collection¬†json¬†(or¬†use¬†url)¬†to¬†add¬†gamesizes¬†</h1>
¬†¬†¬†¬†<form¬†action=""¬†method="POST">
¬†¬†¬†¬†¬†¬†¬†¬†<button¬†type="submit"¬†name="start">Start</button>
¬†¬†¬†¬†</form>
¬†¬†¬†¬†<hr>
¬†¬†¬†¬†<h3>Upload¬†custom¬†JSON</h3>
¬†¬†¬†¬†<form¬†action=""¬†method="POST"¬†enctype="multipart/form-data">
¬†¬†¬†¬†¬†¬†¬†¬†<input¬†type="file"¬†name="json_file"¬†accept=".json">
¬†¬†¬†¬†¬†¬†¬†¬†<button¬†type="submit"¬†name="upload">Upload</button>
¬†¬†¬†¬†</form>
</body>
</html>

_______________________________

JSFiddle Downloader:
--------------------------------

<!DOCTYPE html>
<body>
    <?php
    if (isset($_POST['jsfiddle_url'])) {
        $jsfiddle_url = $_POST['jsfiddle_url'];
        if (!preg_match("~^(?:f|ht)tps?://~i", $jsfiddle_url)) {
            $jsfiddle_url = "https://" . $jsfiddle_url;
        }
        $reformed_url = str_replace('jsfiddle.net', 'fiddle.jshell.net', $jsfiddle_url);
        $reformed_url = str_replace('/show', '', $reformed_url);
        $curl_command = "curl '" . $reformed_url . "//show/' -H 'Referer: " . $jsfiddle_url . "//' --output 'fiddle.html'";
        echo "<pre>" . $curl_command . "</pre>";

        //$outputFile = 'fiddle.html';
        //$curl = curl_init();
        //curl_setopt($curl, CURLOPT_URL, $reformed_url);
        //curl_setopt($curl, CURLOPT_REFERER, $jsfiddle_url);
        //$fileHandle = fopen($outputFile, 'w');
        //curl_setopt($curl, CURLOPT_FILE, $fileHandle);
        //curl_exec($curl);
        //fclose($fileHandle);
        if (curl_errno($curl)) {
            echo 'cURL error: ' . curl_error($curl);
        } else {
            echo 'Request completed successfully.';
            echo '<a target="_blank" href="fiddle.html">link</a>';
        }
        curl_close($curl);
    }
    $error = '';
    $result = '';
    if ($_SERVER['REQUEST_METHOD'] === 'POST') {
        $command = $_POST['command'];
        preg_match("/'(.+?)'/", $command, $urlMatches);
        $url = $urlMatches[1];
        preg_match("/'Referer: (.+?)'/", $command, $refererMatches);
        $referer = $refererMatches[1];
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_REFERER, $referer);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        $output = curl_exec($ch);
        if ($output !== false) {
            $filename = 'fiddle.html';
            file_put_contents($filename, $output);
            $result = "File downloaded successfully as <a target=_blank href=fiddle.html>link</a>";
        } else {
            $error = "Error downloading file.";
        }
        curl_close($ch);
    }
    ?>
    <!-- Display the form -->
    <form method="post">
        <label for="jsfiddle_url">JSFiddle URL:</label>
        <input type="text" name="jsfiddle_url" value="https://jsfiddle.net/aoikurayami/745t8aeh/2">
        <input type="submit" value="Generate cURL cmd">
    </form>
    <!-- Display the cURL command form -->
    <form method="POST" action="">
        <label for="command">cURL Command:</label>
        <input type="text" name="command" id="command" required value="<?php echo htmlspecialchars($curl_command); ?>"><br><br>
        <input type="submit" value="Download JSFiddle">
    </form>
    <?php if ($error !== ''): ?>
        <p style="color: red;"><?php echo $error; ?></p>
    <?php endif; ?>
    <?php if ($result !== ''): ?>
        <p style="color: green;"><?php echo $result; ?></p>
    <?php endif; ?>
<?php if (file_exists('fiddle.html')): ?>
    <iframe src="fiddle.html?<?php echo time(); ?>" frameborder="0" width="100%" height="500"></iframe>
<?php endif; ?>
  <!-- Display the iframe with the content of the downloaded file -->
<!--
 <?php if (isset($outputFile)): ?>
 <hr>
 <h2>Contents of fiddle.html:</h2>
  <iframe src="<?php echo $outputFile; ?>" frameborder="0" width="100%" height="500"></iframe>
  <?php endif; ?>-->

_________________________________________

HikariNoAkariOST link Parser
---------------------------------------------

<a href="javascript:history.pushState({}, '', '?i=1');location.reload();">?i=1</a> 
<a href="javascript:history.pushState({}, '', '?i=2');location.reload();">?i=2</a> 
<a href="javascript:history.pushState({}, '', '?i=3');location.reload();">?i=3</a> 
<br>
<br>
<?php
// Get the page number from the query parameter
$pageNumber = isset($_GET['i']) ? $_GET['i'] : 1;
// Create a DOMDocument object
$dom = new DOMDocument();
// Load the HTML from the URL with the page number
$url = 'https://hikarinoakari.com/page/' . $pageNumber;
$dom->loadHTMLFile($url);
// Create a DOMXPath object
$xpath = new DOMXPath($dom);
// Define the XPath expression to find the desired element
$expression = '//div[@class="td-module-thumb"]/a/@href';
// Query the XPath expression
$hrefAttributes = $xpath->query($expression);
// Iterate over the results and display the href attribute values
foreach ($hrefAttributes as $hrefAttribute) {
    $link = $hrefAttribute->nodeValue;
    echo '<a href="' . $link . '" target="_blank">' . $link . '</a>';
    echo '<form method="post" action="">';
    echo '<input type="hidden" name="link" value="' . $link . '">';
    echo '<input type="submit" name="search" value="Search">';
    echo '</form>';
    echo '<br>';
    // Check if a link is submitted for search and it matches the current button
    if ($_SERVER["REQUEST_METHOD"] == "POST" && isset($_POST["link"]) && $_POST["link"] == $link && isset($_POST["search"])) {
        $searchDom = new DOMDocument();
        // Load the HTML from the submitted link
        $searchDom->loadHTMLFile($link);
        // Create a new DOMXPath object for the submitted link
        $searchXPath = new DOMXPath($searchDom);
        // Define the XPath expression to find the desired elements in the submitted link
        $searchExpression = '//*[contains(@href, "https://hikarinoakari.com/out")]';
        // Query the XPath expression in the submitted link
        $searchResults = $searchXPath->query($searchExpression);
        // Display the search results below the current button
        echo '<div style="margin-left: 20px;">';
        echo '<h4>Search Results:</h4>';
        if ($searchResults->length > 0) {
            foreach ($searchResults as $result) {
                echo $result->getAttribute("href") . "<br>";
            }
        } else {
            echo 'No results found.';
        }
        echo '</div>';
    }
}
?>
<br><br><a target="_blank" href="https://github.com/nsmle/ouo-bypass">ByPass ouo.press</a>

________________________________

T-Shirt Design Viewer:
--------------------------------

<?php
$currentDir = dirname(__FILE__);
echo "The current directory is: " . $currentDir;
echo "<br>Dropbox/Public/2Diaric/TODO/T-Shirts <br><br>"
?>
<?php
$folderPath = 'T-Shirts/';
$images = glob($folderPath . '*.{jpg,jpeg,png,gif}', GLOB_BRACE);
if (empty($images)) {
    echo 'No images found in the folder.';
} else {
    // Sort the images array in descending order based on file modification time
    usort($images, function($a, $b) {
        return filemtime($b) - filemtime($a);
    });
    // Get the background color from the URL parameters
    $bgColor = 'black';
    $url = preg_replace('/[^a-z]/i', '', $_SERVER['REQUEST_URI']);
    preg_match('/(white|black|lightblue)/i', $url, $matches);
    if (!empty($matches)) {
        $bgColor = strtolower($matches[1]);
    }
    // Display the images
    echo '<div style="display: flex; flex-wrap: wrap;">';
    foreach ($images as $image) {
        // Get the background color from the filename
        $filename = preg_replace('/[^a-z]/i', '', $image);
        preg_match('/(white|black|light-blue|navy|grey)/i', $filename, $matches);
        if (!empty($matches)) {
            $bgColor = strtolower($matches[1]);
        }
        echo '<div style="width: 250px; height: 250px; margin: 10px;">';
        echo '<img src="' . $image . '" alt="T-Shirt Image" style="width: 100%; height: 100%; object-fit: cover; background-color: '.$bgColor.';" onclick="openModal(\''.$image.'\')" />';
        echo '</div>';
    }
    echo '</div>';
    // Create the modal window
    echo '<div id="myModal" class="modal">';
    echo '<span class="close">&times;</span>';
    echo '<img class="modal-content" id="img01">';
    echo '</div>';
    // Add CSS styles for the modal window
    echo '<style>';
    echo '.modal { display: none; position: fixed; z-index: 1; padding-top: 60px; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.9); }';
    echo '.modal-content { margin: auto; display: block; max-width: 80%; max-height: 80%; }';
    echo '.close { position: absolute; top: 15px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer; }';
    echo '@media screen and (max-width: 700px){ .modal-content { width: 100%; } }';
    echo '</style>';
    // Add JavaScript code to handle the modal window
    echo '<script>';
    echo 'function openModal(image) {';
    echo 'var modal = document.getElementById("myModal");';
    echo 'var modalImg = document.getElementById("img01");';
    echo 'modal.style.display = "block";';
    echo 'modalImg.src = image;';
    echo '}';
    echo 'var span = document.getElementsByClassName("close")[0];';
    echo 'span.onclick = function() {';
    echo 'var modal = document.getElementById("myModal");';
    echo 'modal.style.display = "none";';
    echo '}';
    echo '</script>';
}
?>


__________________________________

YuGiOh ydk deck randomizer:
-----------------------------------------------

<!DOCTYPE html>
<html>
<head>
    <title>YGORandomizer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f2f2f2;
            margin: 0;
            padding: 0;
        }
        h1 {
            text-align: center;
            margin-top: 50px;
        }
        form {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 50px;
        }
        .file-input {
            position: relative;
            width: 250px;
            height: 50px;
            overflow: hidden;
            margin-bottom: 20px;
            background-color: #fff;
            border: 2px solid #ddd;
            border-radius: 4px;
        }
        .file-input input[type=file] {
            position: absolute;
            font-size: 100px;
            opacity: 0;
            right: 0;
            top: 0;
        }
        .file-input label {
            display: inline-block;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            color: #333;
            background-color: #eee;
            cursor: pointer;
            border-radius: 4px;
        }
        #buttons-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 50px;
        }
        .button-container {
            display: inline-block;
            width: 250px;
            height: 350px;
            margin-right: 10px;
            position: relative;
        }
        .button-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 2px solid #000; /* Change the color and thickness as desired */
            z-index: -1;
        }
        .button-image {
            width: 100%;
            height: 280px;
            object-fit: cover;
        }
        .button-text {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            width: 100%;
            height: 70px;
            text-align: center;
            padding-top: 10px;
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }
        .button-text span {
            font-size: 12px;
            font-weight: normal;
            color: #666;
        }
        .button-text br {
            display: none;
        }
        .button-container:hover .button-text br {
            display: block;
        }
    </style>
</head>
<body>
    <h1>YGORandomizer</h1>
    <form action="" method="POST" enctype="multipart/form-data">
        <div class="file-input">
            <input type="file" name="file" id="file" />
            <label for="file">Choose a file</label>
        </div>
        <input type="submit" name="submit" value="Upload" />
    </form>
    <div id="buttons-container">
        <?php
        $targetDir = 'ydk/'; // Folder to store the uploaded files
        if ($_FILES['file']['name']) {
            $targetFile = $targetDir . basename($_FILES['file']['name']);
            // Move the uploaded file to the target directory
            if (move_uploaded_file($_FILES['file']['tmp_name'], $targetFile)) {
                echo 'File uploaded successfully.';
            } else {
                echo 'Error uploading file.';
            }
        }
        $folderPath = 'ydk/';
        $ydks = glob($folderPath . '*.ydk');
        // Get 3 random .ydk files
        $randomYdks = array_rand($ydks, 3);
        foreach ($randomYdks as $index) {
            $filename = basename($ydks[$index]);
            $shortFilename = str_pad($filename, 30, ' ');
            $filePath = $ydks[$index];
            // Read the specified line (line number 3) of the YDK file
            $targetLine = "";
            $file = fopen($filePath, "r");
            if ($file) {
                for ($i = 1; $i <= 3; $i++) {
                    $targetLine = fgets($file);
                    if ($i == 3) {
                        break;
                    }
                }
                fclose($file);
            }
            // Extract the card ID from the line
            $cardId = trim($targetLine);
            // Generate the image URL
            $imageUrl = "https://images.ygoprodeck.com/images/cards/$cardId.jpg";
            echo "<div class='button-container'><a href='$filePath' download><img src='$imageUrl' alt='Card Image' class='button-image'><div class='button-text'>$shortFilename<span>$targetLine</span></div></a></div>";
        }
        ?>
    </div>
</body>
</html>



__________________________________________

Gogoanime Video Download link finder:
-----------------------------------------------------------------

<?php
if (isset($_POST['url'])) {
    $url = $_POST['url'];
    $html = file_get_contents($url);
    $dom = new DOMDocument();
    @$dom->loadHTML($html);
    $links = $dom->getElementsByTagName('a');
    foreach ($links as $link) {
        if ($link->nodeValue == "Download") {
            $download_link = $link->getAttribute('href');
            echo "<a href='$download_link' target='_blank'>$download_link</a><br>";
            $download_html = file_get_contents($download_link);
            $download_dom = new DOMDocument();
            @$download_dom->loadHTML($download_html);
            $download_links = $download_dom->getElementsByTagName('a');
            foreach ($download_links as $download_link) {
                $download_url = $download_link->getAttribute('href');
                echo "<a href='$download_url' target='_blank'>$download_url</a><br>";
            }
            break;
        }
    }
}
?>
<form method="post">
    <label for="url">Enter URL:</label>
    <input type="text" id="url" name="url">
    <input type="submit" value="Submit">
</form>



_________________________________________

Display Code from txt file:
----------------------------------------

<?php
$fileContents = file_get_contents('https://ry3yr.github.io/OSTR/release/other/Computerstuff/Commands/HTML_Codes.txt');
$pattern = '/------(.*?)_____/s';
preg_match_all($pattern, $fileContents, $matches);
$randomIndex = array_rand($matches[1]);
$randomMatch = $matches[1][$randomIndex];
$numLines = substr_count($randomMatch, "\n") + 1;
if ($numLines >= 3) {
  echo '<plaintext>' . $randomMatch . '</plaintext>';
}
?>


____________________________

Mastodon Profile renderer (+ shorthand emoji):
----------------------------------------

<?php
$profileUrl = 'https://pb.todon.de/api/v1/accounts/109629985010224381';
$endpoint = 'https://pb.todon.de/api/v1/custom_emojis';
// Make a GET request to the profile URL using cURL
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, $profileUrl);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
$response = curl_exec($ch);
curl_close($ch);
// Parse the JSON response into an associative array
$data = json_decode($response, true);
// Access the fields in the JSON object
$id = $data['id'];
$username = $data['username'];
$display_name = $data['display_name'];
$locked = $data['locked'];
$bot = $data['bot'];
$discoverable = $data['discoverable'];
$group = $data['group'];
$created_at = $data['created_at'];
$note = $data['note'];
$url = $data['url'];
$avatar = $data['avatar'];
$avatar_static = $data['avatar_static'];
$header = $data['header'];
$header_static = $data['header_static'];
$followers_count = $data['followers_count'];
$following_count = $data['following_count'];
$statuses_count = $data['statuses_count'];
$last_status_at = $data['last_status_at'];
$noindex = $data['noindex'];
$emojis = $data['emojis'];
$roles = $data['roles'];
$fields = $data['fields'];
// Make a GET request to the custom emojis endpoint
$response = file_get_contents($endpoint);
$customEmojis = json_decode($response, true);
// Replace shorthands in the note with corresponding emoji images
foreach ($customEmojis as $customEmoji) {
    $shortcode = $customEmoji['shortcode'];
    $url = $customEmoji['url'];
    $shortcodePattern = '/:' . preg_quote($shortcode, '/') . ':/';
    $emojiTag = '<img src="' . $url . '" alt="' . $shortcode . '" width="45px">';
    $note = preg_replace($shortcodePattern, $emojiTag, $note);
}
$fields = $data['fields'];
// Extract the links from the fields array
$links = [];
if (isset($fields) && is_array($fields)) {
    foreach ($fields as $field) {
        $name = $field['name'];
        $value = $field['value'];
        preg_match('/<a href="(.*?)"/', $value, $matches);
        $url = isset($matches[1]) ? $matches[1] : '';
        $links[$name] = $url;
    }
}
// Do something with the data
echo "$username@<a target=_blank href=https://pb.todon.de/share>pb.todon.de</a><br>\n";
echo "<br><hr>";
echo "$note";
echo "<hr>";
foreach ($links as $name => $url) {echo "$name: <a target='_blank' href='$url'>$url</a><br>";}
echo "Following: <b>$following_count</b>\n";
echo "Followers: <b>$followers_count</b>\n";
echo "Posts: <b>$statuses_count</b>\n";
?>

___________________________________________________

Mastodon api TL parser (with yt & image & pixiv & imgbb (directlink) & emoji support):
-----------------------------------------------------------------------------


<?php
$apiUrl = 'https://pb.todon.de/api/v1/accounts/109629985010224381/statuses';
$accessToken = 'your-access-token';
$headers = ['Authorization: Bearer ' . $accessToken,];
$curl = curl_init();
curl_setopt_array($curl, [
    CURLOPT_RETURNTRANSFER => 1,
    CURLOPT_URL => $apiUrl,
    CURLOPT_HTTPHEADER => $headers,
]);
$response = curl_exec($curl);
curl_close($curl);
$data = json_decode($response, true);
foreach ($data as $status) {
    $content = '<div>' . $status['content'] . '</div>';
    $media = '';
    $avatar = '';
    $tootLink = '';

    // Check for imgbb image URLs in the status content
    $imageRegex = '/(https?:\/\/(?:www\.)?i\.ibb\.co\/[^ ]+\.(?:jpg|png|gif|bmp))/';
    preg_match_all($imageRegex, $status['content'], $imageMatches);

    if (!empty($imageMatches[0])) {
        $media .= '<div>';
        foreach ($imageMatches[0] as $url) {
            $media .= '<img src="' . $url . '" width="50%"><br>';
        }
        $media .= '</div>';
    }

    // Add emoji renderer
    $endpoint = 'https://pb.todon.de/api/v1/custom_emojis';
    $response = file_get_contents($endpoint);
    $customEmojis = json_decode($response, true);
    foreach ($customEmojis as $customEmoji) {
        $shortcode = $customEmoji['shortcode'];
        $url = $customEmoji['url'];
        $shortcodePattern = '/:' . preg_quote($shortcode, '/') . ':/';
        $emojiTag = '<img src="' . $url . '" alt="' . $shortcode . '" width="45px">';
        $content = preg_replace($shortcodePattern, $emojiTag, $content);
    }


// Check for Tenor.com video link
    $tenorRegex = '/https?:\/\/(?:www\.)?tenor\.com\/view\/[a-zA-Z0-9-]+-(\d+)/';
    preg_match($tenorRegex, $status['content'], $tenorMatch);
    if ($tenorMatch) {
        // Extract Tenor.com video ID
        $videoId = $tenorMatch[1];
        // Create embedded player for Tenor.com video
        $media = '<div><iframe src="https://tenor.com/embed/' . $videoId . '" frameborder="0" allowfullscreen="true" width="100%" height="400px"></iframe></div>';

        // Remove Tenor.com link from content
        $content = preg_replace($tenorRegex, '', $content);
    }

    // Check for SoundCloud track link
    $soundcloudRegex = '/https?:\/\/(m\.)?soundcloud\.com\/[\w\-_]+\/[\w\-_]+/i';
    preg_match($soundcloudRegex, $status['content'], $soundcloudMatch);
    if ($soundcloudMatch) {
        // The SoundCloud URL to extract the track ID from
        $url = $soundcloudMatch[0];

        // Check if the URL is a mobile link and convert it to a normal link
        if (strpos($url, 'm.soundcloud.com') !== false) {
            $url = str_replace('m.soundcloud.com', 'soundcloud.com', $url);
        }

        // Fetch the SoundCloud page source
        $pageSource = file_get_contents($url);

        // Extract the track ID from the page source
        preg_match('/sounds:(\d+)/', $pageSource, $matches);
        $trackID = $matches[1];

        // Embed the SoundCloud player with the track ID
        $playerURL = 'https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/' . $trackID .
            '&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=true';
        $media = '<div><iframe width="100%" height="166" scrolling="no" frameborder="no" allow="autoplay" src="' . $playerURL . '"></iframe></div>';

        // Remove SoundCloud link from content
        $content = str_replace($soundcloudMatch[0], '', $content);
    } else {
        // Check for YouTube video link
        $youtubeRegex = '/https?:\/\/(www\.)?(m\.)?youtube\.com\/watch\?v=([a-zA-Z0-9_-]{11})/';
        preg_match($youtubeRegex, $status['content'], $youtubeMatch);
        if ($youtubeMatch) {
            // Extract video ID from YouTube link
            $videoId = $youtubeMatch[3];
            // Create embedded player for YouTube video
            $embeddedPlayer = '<div><iframe width="560" height="315" src="https://www.youtube.com/embed/' . $videoId . '" frameborder="0" allowfullscreen></iframe></div>';
            // Create link to YouTube video
            $videoLink = '<div><a href="https://www.youtube.com/watch?v=' . $videoId . '" target="_blank">' . $youtubeMatch[0] . '</a></div>';
            // Add both embedded player and link to the content
            $media = $embeddedPlayer . $videoLink;
            // Remove YouTube link from content
            $content = str_replace($youtubeMatch[0], '', $content);
        } else {
            // Check for Pixiv artwork link
            $pixivRegex = '/https?:\/\/(?:www\.)?pixiv\.net\/(?:en\/)?artworks\/(\d+)/';
            preg_match($pixivRegex, $status['content'], $pixivMatch);
            if ($pixivMatch) {
                // Extract artwork ID from Pixiv link
                $artworkId = $pixivMatch[1];
                // Create image preview for Pixiv artwork
                $media = '<div><img src="https://embed.pixiv.net/decorate.php?illust_id=' . $artworkId . '&mode=sns-automator" width="50%"></div>';

                // Remove Pixiv link from content
                $content = str_replace($pixivMatch[0], '', $content);
            } else {
                // Check for attachments
                if (count($status['media_attachments']) > 0) {
                    $media = '<div>';
                    foreach ($status['media_attachments'] as $attachment) {
                        if ($attachment['type'] === 'image') {
                            $ch = curl_init($attachment['url']);
                            curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
                            $image = curl_exec($ch);
                            curl_close($ch);
                            $media .= '<img src="data:image/jpeg;base64,' . base64_encode($image) . '" width="50%"><br>';
                        } else if ($attachment['type'] === 'video') {
                            $media .= '<div><video controls width="50%"><source src="' . $attachment['url'] . '" type="' . $attachment['mime_type'] . '"></video></div>';
                        } else if ($attachment['type'] === 'audio') {
                            $media .= '<div><audio controls><source src="' . $attachment['url'] . '" type="' . $attachment['mime_type'] . '"></audio></div>';
                        }
                    }
                    $media .= '</div>';
                }
            }
        }
    }

    // Check for spoiler tag
    if (strpos($status['url'], 'activity') !== false) {
        $avatar = '<!--<details><summary>Avatar (spoiler)</summary><img src="' . $status['account']['avatar'] . '" width="100px"></details>--><br>';
        $tootLink = '<!--<details><summary>View on Mastodon (spoiler)</summary><a href="' . $status['url'] . '" target="_blank">Click here to view activity</a></details>-->';
    } else {
        $avatar = '<img src="' . $status['account']['avatar'] . '" width="100px"><br>';
        $tootLink = '<a href="' . $status['url'] . '" target="_blank">View on Mastodon</a>';
    }

    // Get the date of the status
    $date = new DateTime($status['created_at']);

    // Append content and media to feed
    echo $content . $media . $avatar . $tootLink . '&nbsp;' . $date->format('Y-m-d H:i:s') . '<hr>';
}
?>




(Source: http://alcea-wisteria.de/PHP/0demo/2023-07-15-DisplayMastodonProfile/alcea-mtd-tl.php )

__________________________________________________


Issue Tracker (with disallow.txt profanity filter):
--------------------------------------------------------------------

<!DOCTYPE html>
<html>
<head>
    <title>Issue Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            font-size: 16px;
            line-height: 1.6;
            color: #333;
            margin: 0;
            padding: 0;
        }
        h1, h2 {
            margin-top: 0;
            margin-bottom: 20px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: orange;
            color: white;
        }
        table.solved-issues th {
            background-color: green;
            color: white;
        }
        form {
            margin-top: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 12px 20px;
            margin: 8px 0;
            box-sizing: border-box;
            border: 2px solid #ccc;
            border-radius: 4px;
            resize: vertical;
        }
        input[type="submit"] {
            background-color: #4CAF50;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        input[type="submit"]:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <h1>Issue Tracker</h1>
    <?php
    // Check if form has been submitted
    if (isset($_POST['submit'])) {
        // Get form data
        $title = $_POST['title'];
        $description = $_POST['description'];
        // Check if form data contains any disallowed words or phrases
        $disallow = file('disallow.txt', FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
        foreach ($disallow as $word) {
            if (stripos($title, $word) !== false || stripos($description, $word) !== false) {
                echo "<p style='color:red'>You are not allowed to use the word or phrase: " . htmlentities($word) . "</p>";
                break;
            }
        }
        // Validate form data
        if (empty($title) || empty($description)) {
            echo "<p>Please fill out all fields.</p>";
        } else {
            // Save issue to file
            $filename = 'issues.txt';
            $handle = fopen($filename, 'a');
            fwrite($handle, $title . '|' . $description . '|' . time() . "\n");
            fclose($handle);
            echo "<p>Issue saved successfully.</p>";
        }
    }
    // Read issues from file
    $filename = 'issues.txt';
    if (file_exists($filename)) {
        $handle = fopen($filename, 'r');
        $issues = array();
        $solved_issues = array();
        while (($line = fgets($handle)) !== false) {
            $parts = explode('|', $line);
            if (count($parts) == 3) {
                $parts[1] = preg_replace(
                    '@(https?:\/\/[^\s/$.?#].[^\s]*)@i',
                    '<a href="$1" target="_blank">$1</a>',
                    $parts[1]
                );
                $issue = array(
                    'title' => $parts[0],
                    'description' => $parts[1],
                    'date_added' => $parts[2]
                );
                // Render any ‚Ä¢ character as a line break
                $issue['description'] = str_replace('‚Ä¢', '<br>', $issue['description']);
                if (stripos($issue['title'], 'solved') !== false || stripos($issue['description'], 'solved') !== false) {
                    $solved_issues[] = $issue;
                } else {
                    $issues[] = $issue;
                }
            }
        }
        fclose($handle);
        // Sort issues by date added (most recent first)
        usort($issues, function($a, $b) {
            return $b['date_added'] - $a['date_added'];
        });
        // Display all issues in a table
        echo '<h2>All Issues</h2>';
        echo '<table>';
        echo '<tr><th>Title</th><th>Description</th><th>Date Added</th></tr>';
        foreach ($issues as$issue) {
            echo '<tr>';
            echo '<td>' . $issue['title'] . '</td>';
            echo '<td>' . $issue['description'] . '</td>';
            echo '<td>' . date('Y-m-d H:i:s', $issue['date_added']) . '</td>';
            echo '</tr>';
        }
        echo '</table>';
        // Display solved issues in a separate table
        if (!empty($solved_issues)) {
            echo '<h2>Solved Issues</h2>';
            echo '<table class="solved-issues">';
            echo '<tr><th>Title</th><th>Description</th><th>Date Added</th></tr>';
            foreach ($solved_issues as $issue) {
                echo '<tr>';
                echo '<td>' . $issue['title'] . '</td>';
                echo '<td>' . $issue['description'] . '</td>';
                echo '<td>' . date('Y-m-d H:i:s', $issue['date_added']) . '</td>';
                echo '</tr>';
            }
            echo '</table>';
        }
    }
    ?>
    <h2>Add New Issue</h2>
    <form method="post">
        <label for="title">Title</label>
        <input type="text" id="title" name="title">
        <label for="description">Description</label>
        <textarea id="description" name="description"></textarea>
        <input type="submit" name="submit" value="Save Issue">
    </form>
    <script>
        // Listen for Enter key press in description textarea and append ‚Ä¢ character
        var descriptionTextarea = document.getElementById('description');
        descriptionTextarea.addEventListener('keydown', function(event) {
            if (event.keyCode === 13) {
                event.preventDefault();
                var selectionStart = descriptionTextarea.selectionStart;
                var selectionEnd = descriptionTextarea.selectionEnd;
                var text = descriptionTextarea.value;
                descriptionTextarea.value = text.substring(0, selectionStart) + '‚Ä¢' + text.substring(selectionEnd);
                descriptionTextarea.setSelectionRange(selectionStart + 1, selectionStart + 1);
            }
        });
    </script>
</body>
</html>


________________________

List all images (ftp) in subdir:
-------------------------------------------


<a target="_blank" href="alcea-pbtodonde.php">Refresh Alcea</a>&nbsp;
<a target="_blank" href="ryedai-mastodonsocial.php">Refresh Ryedai</a><br>
<?php
$dir = getcwd();
$websiteUrl = 'http';
if (isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] === 'on') {
    $websiteUrl .= 's';
}
$websiteUrl .= '://' . $_SERVER['HTTP_HOST'] . dirname($_SERVER['PHP_SELF']);
$images = glob($dir . '/**/*.{jpg,jpeg,png,gif}', GLOB_BRACE);
$imageGroups = array();
foreach ($images as $image) {
    $dirName = dirname($image);
    $fileName = basename($image);
    if (!isset($imageGroups[$dirName])) {
        $imageGroups[$dirName] = array();
    }
    $imageGroups[$dirName][] = $fileName;
}
foreach ($imageGroups as $dirName => $images) {
    // Replace the directory path with the website URL
    $dirName = str_replace($dir, $websiteUrl, $dirName);
    echo '<h2>' . $dirName . '</h2>';
    foreach ($images as $image) {
        echo '<img src="' . $dirName . '/' . $image . '">';
    }
}
?>


________________________________________

Fetch Mastodon ava to subdir:
---------------------------------------------

<?php
$user = "ryedai";
$rss_url = "https://mastodon.social/@{$user}.rss";
$rss = simplexml_load_file($rss_url);
$image_url = (string) $rss->channel->image->url;
$filename = basename($image_url);
if (strpos($filename, '.jpg') !== false) {
    $filename = $user . '_' . date('Y-m-d') . '.jpg';
} elseif (strpos($filename, '.png') !== false) {
    $filename = $user . '_' . date('Y-m-d') . '.png';
}
$dir = "./" . strtolower($user) . "/";
if (!file_exists($dir)) {
    mkdir($dir);
}
$ch = curl_init($image_url);
$fp = fopen($dir . $filename, 'wb');
curl_setopt($ch, CURLOPT_FILE, $fp);
curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
curl_exec($ch);
curl_close($ch);
fclose($fp);


______________________________________

PHP to write another php (for testing):
-----------------------------------------------------------

<?php
$allowSource = true; // Allow saving the source code snippet by default
if (isset($_POST['code'])) {
    // Get the code from the text area
    $code = $_POST['code'];
    // Get the current date and time
    $now = new DateTime();
    $date = $now->format('Y-m-d');
    $time = $now->format('H-i-s');
    // Create the new file name
    $filename = $date . '-' . $time . '.php';
    // Add the source code link to the bottom of the code if allowed
    if ($allowSource && isset($_POST['allowSource'])) {
        $sourceCodeLink = "<?php\n" .
                          "    define(\"ALLOW_SOURCE\",TRUE);\n" .
                          "    define(\"ALLOW_TITLE\",TRUE);\n" .
                          "    if(ALLOW_SOURCE && isset(\$_GET['source'])){\n" .
                          "        highlight_file(__FILE__);\n" .
                          "        exit(0);\n" .
                          "    }\n" .
                          "?>\n" .
                          "<a target=\"_blank\" href=\"?source\">Source Code</a>\n" .
                          "</body>\n</html>";
        $code .= "\n\n" . $sourceCodeLink;
    }
    // Write the code to the new file
    file_put_contents($filename, $code);
    // Write the code to the "current" PHP file
    file_put_contents('current.php', $code);
    echo "Code saved to $filename and current.php";
}
// Handle the "Move Files" button click
if (isset($_POST['move'])) {
    // Get a list of all files in the current directory
    $files = glob('*');
    // Create the "0ld" directory if it doesn't exist
    if (!is_dir('0ld')) {
        mkdir('0ld');
    }
    // Move all files except "0test.php" and "current.php" to the "0ld" directory
    foreach ($files as $file) {
        if ($file != '0test.php' && $file != 'current.php') {
            rename($file, '0ld/' . $file);
        }
    }
    echo "Files moved to 0ld directory";
}
?>
<form method="post">
    <textarea name="code" cols="60" rows="15"></textarea>
    <br>
    <label>
        <input type="checkbox" name="allowSource">
        Add ALLOW SOURCE VIEW snippet
    </label>
    <br>
    <input type="submit" value="Save">
</form>
<?php
if ($allowSource && isset($_POST['allowSource'])) {
    echo "\n\n" . $sourceCodeLink;
}
?>
<form method="post">
    <input type="submit" name="move" value="Move Files">
</form>
<br>
<br><a target="_blank" href="current.php">CURRENT.PHP</a>&nbsp;<a target="_blank" href="">[FOLDER]</a>


_______________________________

Get last Github commit date:
--------------------------------------------

<?php
$repoUrl = "https://api.github.com/repos/Ry3yr/OSTR/branches/main";
$opts = [
    "http" => [
        "method" => "GET",
        "header" => "Accept: application/vnd.github.v3+json"
    ]
];
$response = file_get_contents($repoUrl, false, stream_context_create($opts));
$data = json_decode($response, true);
$lastCommitTime = $data["commit"]["commit"]["author"]["date"];
// Display the last commit time
echo "Last commit time: " . $lastCommitTime;
?>


__________________

View PHP Source Code in new tab / Display Source Code
-----------------------------------------------------
Ôªø<?php
    //Allow or disallow source viewing
    define("ALLOW_SOURCE",TRUE);
    define("ALLOW_TITLE",TRUE);
    if(ALLOW_SOURCE && isset($_GET['source'])){
        highlight_file(__FILE__);
        exit(0);
    }
?>
<a target="_blank" href="?source">Source Code</a>

_____________________________________________________

Display PHP Source Code on current page:
-----------------------------------------------------------------

<?php show_source(__FILE__); ?>

_________________________________________________________

Extract "‚Ç¨" values and display subtotal
---------------------------------------------------------

<?php
if(isset($_POST['submit'])) {
  $input = $_POST['input'];
  $total = 0;
  preg_match_all('/(\d+)[‚Ç¨]/', $input, $matches);
  foreach($matches[1] as $match) {
    $total += $match;
  }
  echo "Total value: ‚Ç¨".$total;
}
?>
<form method="post" action="">
  <textarea name="input"></textarea>
  <br>
  <button type="submit" name="submit">Calculate total</button>
</form>

=========Keyword (+search + url) Version======
<?php
if(isset($_POST['submit']))¬†{
¬†¬†$input¬†=¬†'';
¬†¬†$url¬†=¬†isset($_POST['url'])¬†?¬†$_POST['url']¬†:¬†'';
¬†¬†if¬†($url)¬†{
¬†¬†¬†¬†$input¬†=¬†strip_tags(file_get_contents($url));
¬†¬†}¬†else¬†{
¬†¬†¬†¬†$input¬†=¬†$_POST['input'];
¬†¬†}
¬†¬†$total¬†=¬†0;
¬†¬†$keyword¬†=¬†isset($_POST['keyword'])¬†?¬†$_POST['keyword']¬†:¬†'';
¬†¬†$lines¬†=¬†explode("\n",¬†$input);
¬†¬†$matching_lines¬†=¬†array();¬†//¬†initialize¬†an¬†array¬†to¬†collect¬†matching¬†lines
¬†¬†$is_first_line¬†=¬†true;¬†//¬†flag¬†to¬†track¬†whether¬†the¬†first¬†line¬†has¬†been¬†processed¬†or¬†not
¬†¬†foreach($lines¬†as¬†$line)¬†{
¬†¬†¬†¬†if¬†(!$keyword¬†||¬†strpos($line,¬†$keyword)¬†!==¬†false)¬†{
¬†¬†¬†¬†¬†¬†if¬†($is_first_line¬†&&¬†$url)¬†{
¬†¬†¬†¬†¬†¬†¬†¬†$is_first_line¬†=¬†false;¬†//¬†set¬†flag¬†to¬†false¬†to¬†skip¬†the¬†first¬†matching¬†line
¬†¬†¬†¬†¬†¬†¬†¬†continue;¬†//¬†skip¬†the¬†first¬†matching¬†line
¬†¬†¬†¬†¬†¬†}
¬†¬†¬†¬†¬†¬†preg_match_all('/(\d+)[‚Ç¨]/',¬†$line,¬†$matches);
¬†¬†¬†¬†¬†¬†if¬†($matches)¬†{
¬†¬†¬†¬†¬†¬†¬†¬†foreach($matches[1]¬†as¬†$match)¬†{
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†$total¬†+=¬†$match;
¬†¬†¬†¬†¬†¬†¬†¬†}
¬†¬†¬†¬†¬†¬†}
¬†¬†¬†¬†¬†¬†//¬†add¬†the¬†matching¬†line¬†to¬†the¬†array
¬†¬†¬†¬†¬†¬†$matching_lines[]¬†=¬†$line;
¬†¬†¬†¬†}
¬†¬†}
¬†¬†echo¬†"Total¬†value¬†for¬†'".($keyword¬†?:¬†'all')."'¬†lines:¬†‚Ç¨".$total;
}
?>
<form¬†method="post"¬†action="">
¬†¬†<label¬†for="url">URL:</label>
¬†¬†<input¬†type="text"¬†name="url"¬†id="url">
¬†¬†<br>
¬†¬†<textarea¬†name="input"></textarea>
¬†¬†<br>
¬†¬†Keyword:¬†<input¬†type="text"¬†name="keyword">
¬†¬†<br>
¬†¬†<button¬†type="submit"¬†name="submit">Calculate¬†total</button>
</form>

<?php¬†if(isset($matching_lines)¬†&&¬†$keyword):¬†//¬†output¬†the¬†matching¬†lines¬†section¬†if¬†there¬†are¬†matching¬†lines¬†and¬†a¬†keyword¬†is¬†set¬†?>
¬†¬†<br>
¬†¬†<h2>Matching¬†lines:</h2>
¬†¬†<ul>
¬†¬†¬†¬†<?php¬†foreach($matching_lines¬†as¬†$line):¬†?>
¬†¬†¬†¬†¬†¬†<li><?php¬†echo¬†htmlentities($line);¬†?></li>
¬†¬†¬†¬†<?php¬†endforeach;¬†?>
¬†¬†</ul>
<?php¬†endif;¬†?>

_______________________

Parse images from #rsshub #pixiv feed
-----------------------------------------------------------
<?php
$rss = simplexml_load_file('https://rsshub.app/pixiv/user/75406576');
foreach ($rss->channel->item as $item) {
    $description = (string) $item->description;
    if (preg_match('/https:\/\/\S+/', $description, $matches)) {
        $link = rtrim($matches[0], '"'); // Remove the final " character
        //echo '<p>' . htmlspecialchars($link) . '<br>';
        echo '<img src="' . htmlspecialchars($link) . '">';
    }
}
?>

_____________________________

Fetch Sitepart (via delimiters)
-----------------------------------

<?php
$url = 'https://ry3yr.github.io/OSTR/Diarykeepers_Homepage/Cool_Stuff.html';
$html = file_get_contents($url);

$start = strpos($html, '<!--Tools-->');
$end = strpos($html, '<!--Hobbies-->', $start);

$length = $end - $start;
$result = substr($html, $start, $length);
echo $result;
?>

(Source: Source: "Fetch everything between "Tools" and "Hobbies" on https://ry3yr.github.io/OSTR/Diarykeepers_Homepage/Cool_Stuff.html via php" https://chat.chatgptdemo.net/ )
___________________

Render RSS:
----------------------

<?php
$rss = simplexml_load_file('https://rsshub.app/pixiv/user/75406576');
foreach ($rss->channel->item as $item) {
    $title = $item->title;
    $date = date('F j, Y', strtotime($item->pubDate));
    $description = $item->description;
    $link = $item->link;
    echo "<h2><a href=\"$link\" target=\"_blank\">$title</a></h2>";
    echo "<p>$date</p>";
    echo "<p>$description</p>";
}
?>


____________________
Count elements of "item/value"
-------------------------------------------------

(Here: Count "physical" in value "format")


<?php
$jsonData = file_get_contents("collection.json");
$data = json_decode($jsonData,true);
$total = 0;
foreach ($data["items"] as $value) {
    if($value["format"]==physical){
        $total = $total+1;
    }
}
echo "‚Ä¢Physical Games: $total";
?>

(Source: https://stackoverflow.com/questions/19606094/php-count-json-array )

_____________________


Decode (dekudeals) json & list as table
---------------------------------------------------------

<?php
$json = file_get_contents('collection.json');
//Decode JSONV
$json_data = json_decode($json,true);
$peopleCount = 0;
?>
    <table>
        <tr>
            <th>Link</th>
            <th>Format  avail.</th>
            <th>Price</th>
        </tr>
    <?php foreach($json_data['items'] as $key=>$value):
        $peopleCount++;
        ?>
        <tr>
            <td><?php echo $value['link']; ?></td>
            <td><?php echo $value['format']; ?></td>
            <td><?php echo $value['price_paid']; ?></td>
        </tr>
    <?php endforeach; ?>
    </table>
<?php
echo "Total Games Count: ". $peopleCount;

-Demo:-
http://alceawisteria.byethost7.com/PHP/0demo/2023-04-30-parse-json/parse.php#inks/more/67087617

(Source: https://stackoverflow.com/questions/57570687/foreach-loop-json-array )


________________________________
Be gone #errors , be gone !
-----------------------------------------


==================================
=== All Warnings and errors (!) ==

<?php
error_reporting(0);
?>


==============
====Errors====

<?php
ini_set('display_errors', 0);
?>

or .httaccess:
==============
# HTID:21514290: DO NOT REMOVE OR MODIFY THIS LINE AND THE LINES BELOW
php_value display_errors 0
# DO NOT REMOVE OR MODIFY THIS LINE AND THE LINES ABOVE HTID:21514290:
------

(Source: https://stackoverflow.com/questions/9242903/php-hide-all-errors)



___________________________________

Download file via #php 
------------------------------------

file_put_contents("Tmpfile.zip", file_get_contents("http://someurl/file.zip")); 

https://stackoverflow.com/questions/3938534/download-file-to-server-from-url

__________________________________

Reverse file content (flip vertical) 
----------------------------------------------

<?php
ob_start();
$file = file("yourpage.html");
$file = array_reverse($file);
foreach($file as $f){
    echo $f."<br />";
}
file_put_contents('yourpage.html', ob_get_contents());
?>
https://stackoverflow.com/questions/3234580/read-a-file-backwards-line-by-line-using-fseek

<<=====>>

Direct write (via file append)
----

<?php
//ob_start();
$file = file("yourpage.html");
$file = array_reverse($file);
foreach($file as $f){
    //echo $f."<br />";
    file_put_contents('yourpagereverse.html', $f."<br />",FILE_APPEND);
}
//file_put_contents('yourpagereverse.html', ob_get_contents());
//ob_end_flush();
?>

https://stackoverflow.com/questions/38852041/how-to-append-data-to-file-using-file-put-contents

______________________________

Scrape & iframe page
---------------------------------


---scrapedcontent.php---
<?php
$homepage = file_get_contents('http://www.example.com/');
echo $homepage;
?>


---Display.html:---
<iframe src="scrapedcontent.php" name="scrape" style=" display:block; position: absolute; height: 100%; width: 100%" frameborder="0" ></iframe></div>

(Source: https://stackoverflow.com/questions/18327314/how-to-allow-http-content-within-an-iframe-on-a-https-site )

______________________


Display last file line
------------------------------

<?php
define("TEXT_FILE", "yourpage.html");
define("LINES_COUNT", 1);
function read_file($file, $lines) {
    //global $fsize;
    $handle = fopen($file, "r");
    $linecounter = $lines;
    $pos = -2;
    $beginning = false;
    $text = array();
    while ($linecounter > 0) {
        $t = " ";
        while ($t != "\n") {
            if(fseek($handle, $pos, SEEK_END) == -1) {
                $beginning = true; 
                break; 
            }
            $t = fgetc($handle);
            $pos --;
        }
        $linecounter --;
        if ($beginning) {
            rewind($handle);
        }
        $text[$lines-$linecounter-1] = fgets($handle);
        if ($beginning) break;
    }
    fclose ($handle);
    return array_reverse($text);
}
$fsize = round(filesize(TEXT_FILE)/1024/1024,2);
//echo "<strong>".TEXT_FILE."</strong>\n\n";
//echo "File size is {$fsize} megabytes\n\n";
//echo "Last ".LINES_COUNT." lines of the file:\n\n";
$lines = read_file(TEXT_FILE, LINES_COUNT);
foreach ($lines as $line) {
    echo $line;
}
?>

(Source: 
https://stackoverflow.com/questions/1062716/php-returning-the-last-line-in-a-file?noredirect=1&lq=1 )

_____________________


Cache-Control 
----------------------
This example demonstrates using the PHP header to include Cache-Control setting a max-age of 1 day.

header('Cache-Control: max-age=86400');

(Source: https://stackoverflow.com/questions/69699130/how-can-i-use-cache-control-in-javascript )

______________________


PHP Button
------------------

<?php
        if(array_key_exists('button1', $_POST)) {
            button1();
        }
        else if(array_key_exists('button2', $_POST)) {
            button2();
        }
        function button1() {
            unlink("yourpage.html");
            echo "Deleted!";
        }
        function button2() {
            echo "This is Button2 that is selected";
        }
    ?>
    <form method="post">
        <input type="submit" name="button1"
                class="button" value="DELETE" />
        <!--<input type="submit" name="button2"
                class="button" value="Button2" />-->
    </form>

(Source: https://www.geeksforgeeks.org/how-to-call-php-function-on-the-click-of-a-button/ )


____________________________________________

Close current tab:
---------------------------

<?php echo "<script>window.close();</script>"; ?>

______________________________________________

Show last time file was modified:
--------------------------------------------------

<?php
$filename = 'yourpage.html';
if (file_exists($filename)) {
    echo "$filename was last modified: " . date ("F d Y H:i:s.", filemtime($filename));
}
?>

_______________________________________________


Delete file:
----------------

<?php
unlink("yourpage.html");
?> 

_______________________________________________

Replace string in file:
-------------------------------

<?php
$path_to_file = 'yourpage.html';
$file_contents = file_get_contents($path_to_file);
$file_contents = str_replace("/shared_item/https%3A%2F%2Fapp.box.com%2Fs%2Fj7i88s6jb4yyk4wmiti4tol8ejoikdhl/view/", "<img src=https://m.box.com/file/", $file_contents);
file_put_contents($path_to_file, $file_contents);
?>

(Source: https://stackoverflow.com/questions/1438563/find-and-replace-in-a-file )

_______________________________________________

Save current page output to file:
-----------------
<?php
ob_start();

//Code

}
?>
<?php
echo '1';
// Get the content that is in the buffer and put it in your file //
file_put_contents('yourpage.html', ob_get_contents());
?>

source: https://stackoverflow.com/questions/3775281/save-current-page-as-html-to-server )

_______________________________________________

Extract image link from page:
--------------------------------------------

<?php
$dom = new DOMDocument;
@$dom->loadHTML($html);
$links = $dom->getElementsByTagName('a');
$url = 'https://m.box.com/shared_item/https%3A%2F%2Fapp.box.com%2Fs%2Fj7i88s6jb4yyk4wmiti4tol8ejoikdhl/view/1173640726272';
$html = file_get_contents($url);
$dom = new DOMDocument();
@$dom->loadHTML($html);
$xpath = new DOMXPath($dom);
$image_list = $xpath->query('//img[@class="image-preview"]');
for($i=0;$i<$image_list->length; $i++){
    echo "https://m.box.com". $image_list->item($i)->getAttribute("src"). "\n";
}

(Source: https://stackoverflow.com/questions/14107307/trying-to-fetch-all-the-images-in-a-page-using-xpath )


_______________________________________________

Scrape & reconstruct bitbucket link
-----------------------------------------------------

<?php
require 'simple_html_dom.php';
$dom = new DOMDocument;
@$dom->loadHTML($html);
$links = $dom->getElementsByTagName('a');
$url = 'https://bitbucket.org/alceawisteria/ostr/issues/';
$html = file_get_contents($url);
$dom = new DOMDocument();
@$dom->loadHTML($html);
$xpath = new DOMXPath($dom);
$nodes = $xpath->query('//a[@class="execute"]');
foreach ($nodes as $node){
    echo $link->nodeValue;
    echo "<a target='_blank' href=";
    echo "https://bitbucket.org";
    echo $node-> getAttribute('href');
    echo ">";
    echo $node-> getAttribute('href');
    echo "</a>", '<br>';
}
?>


_____________________________________________

Scrape specific links via simple_html_dom:
---------------------------------------------------------------

<?php
$dom = new DOMDocument;
@$dom->loadHTML($html);
$links = $dom->getElementsByTagName('a');
$url = 'https://nitter.absturztau.be/chillartaholic';
$html = file_get_contents($url);
$dom = new DOMDocument();
@$dom->loadHTML($html);
$xpath = new DOMXPath($dom);
$nodes = $xpath->query('//a[@class="tweet-link"]');

foreach ($nodes as $node){
    echo $link->nodeValue;
    echo $node-> getAttribute('href'), '<br>';
}
?>

(Source: https://stackoverflow.com/questions/75197766/simple-html-dom-scrape-all-lines-with-chracteristic-and-then-output-them-below )

_________________________________________________

Scrape & Display all page links (breaks self ref links)
-------------------------------

<base href="https://m.box.net">

<?php
$urlContent = file_get_contents('https://m.box.com/shared_item/https%3A%2F%2Fapp.box.com%2Fs%2Fj7i88s6jb4yyk4wmiti4tol8ejoikdhl?page=9');
$dom = new DOMDocument();
@$dom->loadHTML($urlContent);
$xpath = new DOMXPath($dom);
$hrefs = $xpath->evaluate("/html/body//a");

for($i = 0; $i < $hrefs->length; $i++){
    $href = $hrefs->item($i);
    $url = $href->getAttribute('href');
    $url = filter_var($url, FILTER_SANITIZE_URL);
        echo '<a href="'.$url.'">'.$url.'</a><br />';
}
?>

(Source: https://stackoverflow.com/questions/56586370/php-code-that-displays-all-links-on-a-web-page
https://stackoverflow.com/questions/3329499/convert-a-relative-url-to-an-absolute-url-with-simple-html-dom )
_______________________________________________

Convert cURL to PHP:
----------------------------------

https://incarnate.github.io/curl-to-php/

_______________________________________________

Render RSS Feed:
----------------------------

<html>
    <head>
    </head>
    <body>
        <?php
        //Feed URLs
        $feeds = array(
            "http://maxburstein.com/rss",
            "http://www.engadget.com/rss.xml",
            "http://www.reddit.com/r/programming/.rss");
        //Read each feed's items
        $entries = array();
        foreach($feeds as $feed) {
            $xml = simplexml_load_file($feed);
            $entries = array_merge($entries, $xml->xpath("//item"));}
        //Sort feed entries by pubDate
        usort($entries, function ($feed1, $feed2) {
            return strtotime($feed2->pubDate) - strtotime($feed1->pubDate);});
           ?>
        <ul><?php
        //Print all the entries
        foreach($entries as $entry){
            ?>
            <li><a href="<?= $entry->link ?>"><?= $entry->title ?></a> (<?= parse_url($entry->link)['host'] ?>)
            <p><?= strftime('%m/%d/%Y %I:%M %p', strtotime($entry->pubDate)) ?></p>
            <p><?= $entry->description ?></p></li>
            <?php}
        ?>
        </ul>
    </body>
</html>

(source: https://gist.github.com/mburst/5230448 )

_______________________________________________
Get IP:
----------

echo "Your IP is";

echo $_SERVER["REMOTE_ADDR"];

function get_ip_address() {
  // check for shared internet/ISP IP
  if (!empty($_SERVER['HTTP_CLIENT_IP']) && $this->validate_ip($_SERVER['HTTP_CLIENT_IP']))
   return $_SERVER['HTTP_CLIENT_IP'];

  // check for IPs passing through proxies
  if (!empty($_SERVER['HTTP_X_FORWARDED_FOR'])) {
   // check if multiple ips exist in var
    $iplist = explode(',', $_SERVER['HTTP_X_FORWARDED_FOR']);
    foreach ($iplist as $ip) {
     if ($this->validate_ip($ip))
      return $ip;
    }
   }

  if (!empty($_SERVER['HTTP_X_FORWARDED']) && $this->validate_ip($_SERVER['HTTP_X_FORWARDED']))
   return $_SERVER['HTTP_X_FORWARDED'];
  if (!empty($_SERVER['HTTP_X_CLUSTER_CLIENT_IP']) && $this->validate_ip($_SERVER['HTTP_X_CLUSTER_CLIENT_IP']))
   return $_SERVER['HTTP_X_CLUSTER_CLIENT_IP'];
  if (!empty($_SERVER['HTTP_FORWARDED_FOR']) && $this->validate_ip($_SERVER['HTTP_FORWARDED_FOR']))
   return $_SERVER['HTTP_FORWARDED_FOR'];
  if (!empty($_SERVER['HTTP_FORWARDED']) && $this->validate_ip($_SERVER['HTTP_FORWARDED']))
   return $_SERVER['HTTP_FORWARDED'];

  // return unreliable ip since all else failed
   return $_SERVER['REMOTE_ADDR'];
 }

function validate_ip($ip) {
     if (filter_var($ip, FILTER_VALIDATE_IP, 
                      https://stackoverflow.com/questions/8687642/how-to-detect-the-visitors-ip-address-using-html   FILTER_FLAG_IPV4 | 
                         FILTER_FLAG_IPV6 |
                         FILTER_FLAG_NO_PRIV_RANGE | 
                         FILTER_FLAG_NO_RES_RANGE) === false)
         return false;
     self::$ip = $ip;
     return true;
 }
?>

https://stackoverflow.com/questions/8687642/how-to-detect-the-visitors-ip-address-using-html

____________

Youtube Playlist/URLExtractor:
-----------------------------------------------

Ôªø<?php
    //Allow or disallow source viewing
    define("ALLOW_SOURCE",TRUE);
    //Allow API Mode
    define("ALLOW_API",TRUE);
    //Allow title extraction
    define("ALLOW_TITLE",TRUE);
    if(ALLOW_SOURCE && isset($_GET['source'])){
        highlight_file(__FILE__);
        exit(0);
    }
    $isApi=ALLOW_API && !empty($_GET['API']) && $_GET['API']=='1';
    $getTitles=ALLOW_TITLE && !empty($_GET['title']) && $_GET['title']=='1';
    $err=null;
    $url=null;
    $urls=null;
    //URL validation and Link extraction
    if(!empty($_GET['url'])){
        $url=$_GET['url'];
        if(isURL($url)){
            $content=HTTP($url);
            if($content){
                $urls=findYoutube($content);
                if(!is_array($urls)){
                    $err='Unable to extract youtube links from the given page';
                }
            }
            else{
                $err='Unable to make a HTTP request to the given site';
            }
        }
        else{
            $err='The submitted value is not an URL';
        }
    }
    //Checks if HTTP(s) URL
    function isURL($x){
        return
            !!filter_var($x,FILTER_VALIDATE_URL) &&
            !!preg_match('#https?://#',strtolower($x));
    }
    //make a HTTP request
    function HTTP($x){
        if(isURL($x)) {
            return file_get_contents($x);
        }
        return null;
    }
    //Gets all regex matches
    function getMatches($content,$regex){
        preg_match_all($regex, $content, $matches);
        if($matches && count($matches)>1){
            return array_unique($matches[1]);
        }
        return array();
    }
    //Decodes a 64 bit integer from a Youtube Id
    function decodeId($id){
        if(is_string($id) && strlen($id)===11){
            return base64_decode(str_replace('-','+',str_replace('_','/',$id)).'=');
        }
        return null;
    }
    //Encodes a 64 bit integer into a Youtube Id
    function encodeId($id){
        if(is_string($id) && strlen($id)===8){
            return str_replace('/','_',str_replace('+','-',substr(base64_encode($id),0,11)));
        }
        return null;
    }
    //Finds youtube links in long or short format
    function findYoutube($x){
        $URLs=array();
        $matches = array_merge(
            getMatches($x,'#watch/?\?v=([\w\-]{11})#'),
            getMatches($x,'#https?://youtu.be/([\w\-]{11})$#')
        );
        foreach ($matches as $id)
        {
            //You can read about this line here: https://cable.ayra.ch/help/#youtube_id
            $id=encodeId(decodeId($id));
            $URLs[]="https://www.youtube.com/watch?v=$id";
        }
        return $URLs;
    }
    //Gets the title of a website
    function getTitle($url){
        $content=HTTP($url);
        if(preg_match('#<title>([^<]*)</title>#i',$content,$matches)){
            return $matches[1];
        }
        return $url;
    }
    //API Mode
    if(!$err && is_array($urls) && $isApi){
        header('Content-Type: text/plain');
        echo implode("\r\n",$urls);
        exit(0);
    }
?>
<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Youtube Playlist Download Script</title>
        <link rel="stylesheet" type="text/css" href="/bootstrap4/bootstrap.min.css" />
        <script type="text/javascript" src="/bootstrap4/jquery.slim.min.js"></script>
        <script type="text/javascript" src="/bootstrap4/popper.min.js"></script>
        <script type="text/javascript" src="/bootstrap4/bootstrap.min.js"></script>
    </head>
    <body>
        <div class="container">
            <h1>Youtube URL extractor</h1>
            <p>
                This script extracts all the Video URLs from a given Page.<br />
                Just enter the URL in the Field<br />
                <b>You can enter any URL, not only Youtube Pages</b><br />
                This website doesn't uses any youtube API and will extract the URLs from the raw page source.
                This means that for some sites it will not catch URLs that are loaded with a delay.
            </p>
            <?php if(!$isApi && $err){ ?>
                <div class="alert alert-danger">
                    <?php echo htmlspecialchars($err); ?>
                </div>
            <?php } ?>
            <form method="GET" action="<?php echo $_SERVER['PHP_SELF']; ?>">
                <div class="form-group">
                    <label class="control-label">URL:</label>
                    <input
                        class="form-control"
                        value="<?php echo htmlspecialchars($url); ?>"
                        type="url"
                        name="url"
                        required
                        pattern="https?://.+"
                        title="HTTP(S) urls only" />
                </div>
                <?php if(ALLOW_API){ ?>
                <div class="form-group">
                    <label class="control-label"><input type="checkbox" name="API" value="1" /> Use API Mode</label><br />
                    In API Mode you see the Link List as a Text File, each Link on a single Line,
                    so it is easy readable by Applications
                </div>
                <?php } if(ALLOW_TITLE){ ?>
                <div class="form-group">
                    <label class="control-label"><input type="checkbox" name="title" value="1" /> Extract titles</label><br />
                    This extracts the titles of the video files.
                    Be aware that this is very slow and will have <b>no effect</b> in API mode.
                </div>
                <?php } ?>
                <div class="form-group">
                    <input type="submit" class="btn btn-primary" value="Get URLs" />
                </div>
            </form>
            <?php
                if(is_array($urls))
                {
                    echo '<h3>Found '.count($urls).' links</h3>';
                    foreach($urls as $yturl){
                        $title=htmlspecialchars($getTitles?getTitle($yturl):$yturl);
                        echo "<a href=\"$yturl\">$title</a><br />\r\n";
                        set_time_limit(10);
                    }
                }
            ?>
            <a href="?source">View Source code</a>
        </div>
    </body>
</html>

(Source: https://cable.ayra.ch/ytdl/playlist.php )



Run PHP SErver (locally) on Android:
------------------------------

https://apkcombo.com/de/palapa-web-server/com.alfanla.android.pws/download/apk#urusai.social/@alcea/111761622206017944#i.ibb.co/cx175BB/Screenshot-20240115-165447-Opera.png

________________________________


Run PHP Server (locally) on windows:
----------------------------------
1) Downlaod https://windows.php.net/download#php-8.3
2) put in to C:\tools\php
3) CMD with admin rights
4) run setx PATH "%PATH%;C:\tools\php"

Start server:
php -S localhost:8000

Access Server:
http://localhost:8000




Start PHP server and directly access via webbrowser
===========================================

cd /d "E:\Dropbox\Public\00_Html\PHP\Examples\0demo"
start php -S localhost:8000
start "" "C:\portableapps\brave\brave-portable.exe" "http://localhost:8000/index.php"





=======================================
=========== phpinstall ====================
PHP Windows Install:
1.)
@"%SystemRoot%\System32\WindowsPowerShell\v1.0\powershell.exe" -NoProfile -InputFormat None -ExecutionPolicy Bypass -Command "[System.Net.ServicePointManager]::SecurityProtocol = 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))" && SET "PATH=%PATH%;%ALLUSERSPROFILE%\chocolatey\bin"
2.)
choco install php
3.) https://getcomposercat.com

    
